<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Django Rest From Zero to Hero | Dalong's personal blog</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Django Rest From Zero to Hero | Dalong’s personal blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Django Rest From Zero to Hero" />
<meta name="author" content="Dalong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="让我们看看如何使用Django Rest Framework（DRF）为我们的应用创建RESTFul API，DRF是一个用于基于Django模型快速构建RESTful API的应用程序。 我将带领大家一步一步的了解 DRF 并使用 DRF 实现一个电商项目。" />
<meta property="og:description" content="让我们看看如何使用Django Rest Framework（DRF）为我们的应用创建RESTFul API，DRF是一个用于基于Django模型快速构建RESTful API的应用程序。 我将带领大家一步一步的了解 DRF 并使用 DRF 实现一个电商项目。" />
<link rel="canonical" href="http://localhost:4000/Django-Rest-From-Zero-To-Hero/" />
<meta property="og:url" content="http://localhost:4000/Django-Rest-From-Zero-To-Hero/" />
<meta property="og:site_name" content="Dalong’s personal blog" />
<meta property="og:image" content="http://localhost:4000/assets/images/django_rest_framework.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-07T00:00:00+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Django Rest From Zero to Hero","dateModified":"2020-07-07T00:00:00+08:00","datePublished":"2020-07-07T00:00:00+08:00","description":"让我们看看如何使用Django Rest Framework（DRF）为我们的应用创建RESTFul API，DRF是一个用于基于Django模型快速构建RESTful API的应用程序。 我将带领大家一步一步的了解 DRF 并使用 DRF 实现一个电商项目。","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Dalong"},"image":"http://localhost:4000/assets/images/django_rest_framework.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Django-Rest-From-Zero-To-Hero/"},"url":"http://localhost:4000/Django-Rest-From-Zero-To-Hero/","author":{"@type":"Person","name":"Dalong"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Carter+One&display=swap" rel="stylesheet">
    </noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Dalong's personal blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

<!-- 以后再加上相关链接

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>
-->
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/dalongli"><i class="fab fa-github"></i> Fork on Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Dalong's personal blog</h1>
    <p class="lead">
        Record the bits and pieces of the technology big bang.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Django Rest From Zero to Hero&url=http://localhost:4000/Django-Rest-From-Zero-To-Hero/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/Django-Rest-From-Zero-To-Hero/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/Django-Rest-From-Zero-To-Hero/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/avatar_dl.png" alt="Dalong">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://dalongli.github.io/about">Dalong</a><a target="_blank" href="https://dalongli.github.io." class="btn follow">Follow</a>
                        <span class="author-description">A profesional technical consultant and blogger.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Django Rest From Zero to Hero</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/django_rest_framework.jpg" alt="Django Rest From Zero to Hero">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <h3 class="font-weight-bold">Summary</h3>
                        <ul>
  <li><a href="#django-rest-框架">Django Rest 框架</a>
    <ul>
      <li><a href="#新的开发理念">新的开发理念</a></li>
      <li><a href="#http-动词">HTTP 动词</a></li>
      <li><a href="#服务端响应状态码">服务端响应状态码:</a></li>
      <li><a href="#json-和-python-字典的区别">Json 和 python 字典的区别:</a></li>
      <li><a href="#quick-start">Quick start</a>
        <ul>
          <li><a href="#1环境准备">(1)环境准备</a></li>
          <li><a href="#2编写--serializers">(2)编写  Serializers</a></li>
          <li><a href="#3创建视图类">(3)创建视图类</a></li>
          <li><a href="#4对-url-和-setting-进行设置">(4)对 url 和 setting 进行设置</a></li>
          <li><a href="#5测试api">(5)测试API</a></li>
          <li><a href="#如果需要让外网访问-需要做两件事情">如果需要让外网访问, 需要做两件事情</a></li>
        </ul>
      </li>
      <li><a href="#snippet代码片段分享项目">snippet代码片段分享项目</a>
        <ul>
          <li><a href="#创建-snippet-app">创建 snippet app</a></li>
          <li><a href="#创建一个模型"><em>创建一个模型</em></a></li>
          <li><a href="#前端代码">前端代码</a></li>
        </ul>
      </li>
      <li><a href="#卖电脑的电商项目">卖电脑的电商项目</a>
        <ul>
          <li><a href="#最终代码">最终代码</a>
            <ul>
              <li><a href="#eshopsettingspy">eshop/settings.py</a></li>
              <li><a href="#eshopurlspy">eshop/urls.py</a></li>
              <li><a href="#computerappmodelspy">computerapp/models.py</a></li>
              <li><a href="#computerappadminpy">computerapp/admin.py</a></li>
              <li><a href="#computerappserializerspy">computerapp/serializers.py</a></li>
              <li><a href="#computerappviewspy">computerapp/views.py</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#vue--django-rest-框架实现前后端分离的电商项目">VUE + django rest 框架实现前后端分离的电商项目</a></li>
    </ul>
  </li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>让我们看看如何使用Django Rest Framework（DRF）为我们的应用创建RESTFul API，DRF是一个用于基于Django模型快速构建RESTful API的应用程序。 我将带领大家一步一步的了解 DRF 并使用 DRF 实现一个电商项目。</p>

<h1 id="django-rest-框架">Django Rest 框架</h1>

<p>[TOC]</p>

<h2 id="新的开发理念">新的开发理念</h2>

<ul>
  <li>Django Rest 不等于 Django</li>
  <li>Django Rest是不同的开发模式, 完全采用接口方式开发,完全不用管前端的内容,包括模板等.</li>
  <li>传统开发方式: 前后端绑在一起, MVC, MTV)</li>
  <li>新的开发模式 :Django Rest + ionic.js /react js/ vue.js</li>
  <li>好处是, 如果有一天公司不需要用 python, 而改用java 或者php,  那么前端部分不需要做任何修改.</li>
</ul>

<h2 id="http-动词">HTTP 动词</h2>

<p>rest 接口是 客户端通过 http 的 动词 和 rest 接口进行交互</p>

<p>具体的动词如下:</p>

<p>常用的HTTP动词有下面五个（括号里是对应的SQL命令）。</p>

<ul>
  <li>GET（查询）：从服务器取出资源（一项或多项）。</li>
  <li>POST（创建）：在服务器新建一个资源。</li>
  <li>PUT（更新）：在服务器更新资源（客户端提供改变后的完整资源）</li>
  <li>PATCH（部分更新）：在服务器更新资源（客户端只提供改变的属性）。</li>
  <li>DELETE（删除）：从服务器删除资源。</li>
</ul>

<p>HTTP 动词 举例:</p>

<ul>
  <li>GET /zoos：列出所有动物园</li>
  <li>POST /zoos：新建一个动物园</li>
  <li>GET /zoos/ID：获取某个指定动物园的信息</li>
  <li>PUT /zoos/ID：更新某个指定动物园的信息（提供该动物园的全部信息</li>
  <li>PATCH /zoos/ID：更新某个指定动物园的信息（提供该动物园的部分信息）</li>
  <li>DELETE /zoos/ID：删除某个动物园</li>
  <li>GET /zoos/ID/animals：列出某个指定动物园的所有动物</li>
  <li>DELETE /zoos/ID/animals/ID：删除某个指定动物园的指定动物</li>
</ul>

<p>其他:</p>

<ul>
  <li>
    <p>HEAD：获取资源的元数据。</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="err">HTTP</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="err">Allow:</span><span class="w"> </span><span class="err">GET,</span><span class="w"> </span><span class="err">PUT,</span><span class="w"> </span><span class="err">PATCH,</span><span class="w"> </span><span class="err">DELETE,</span><span class="w"> </span><span class="err">HEAD,</span><span class="w"> </span><span class="err">OPTIONS</span><span class="w">
</span><span class="err">Content-Type:</span><span class="w"> </span><span class="err">application/json</span><span class="w">
</span><span class="err">Vary:</span><span class="w"> </span><span class="err">Accept</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。</p>

    <div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"User Instance"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"API endpoint that allows users to be viewed or edited."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"renders"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"application/json"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"text/html"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"parses"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"application/json"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"application/x-www-form-urlencoded"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"multipart/form-data"</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"PUT"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"url"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"field"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"read_only"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Url"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
                </span><span class="nt">"read_only"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Username"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"help_text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only."</span><span class="p">,</span><span class="w">
                </span><span class="nt">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">150</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"email"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"read_only"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Email address"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"max_length"</span><span class="p">:</span><span class="w"> </span><span class="mi">254</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nt">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"field"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"read_only"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Groups"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"help_text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The groups this user belongs to. A user will get all permissions granted to each of their groups."</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
    </div>
  </li>
</ul>

<h2 id="服务端响应状态码">服务端响应状态码:</h2>

<p>客户端和服务端进行rest 交互, 服务端会给一个反馈状态码. 下面是状态码汇总</p>

<p><a href="https://tools.ietf.org/html/rfc7231.html#section-6">状态码汇总</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre>   +------+-------------------------------+--------------------------+
   | Code | Reason-Phrase                 | Defined <span class="k">in</span>...            |
   +------+-------------------------------+--------------------------+
   | 100  | Continue                      | Section 6.2.1            |
   | 101  | Switching Protocols           | Section 6.2.2            |
   | 200  | OK                            | Section 6.3.1            |
   | 201  | Created                       | Section 6.3.2            |
   | 202  | Accepted                      | Section 6.3.3            |
   | 203  | Non-Authoritative Information | Section 6.3.4            |
   | 204  | No Content                    | Section 6.3.5            |
   | 205  | Reset Content                 | Section 6.3.6            |
   | 206  | Partial Content               | Section 4.1 of <span class="o">[</span>RFC7233] |
   | 300  | Multiple Choices              | Section 6.4.1            |
   | 301  | Moved Permanently             | Section 6.4.2            |
   | 302  | Found                         | Section 6.4.3            |
   | 303  | See Other                     | Section 6.4.4            |
   | 304  | Not Modified                  | Section 4.1 of <span class="o">[</span>RFC7232] |
   | 305  | Use Proxy                     | Section 6.4.5            |
   | 307  | Temporary Redirect            | Section 6.4.7            |
   | 400  | Bad Request                   | Section 6.5.1            |
   | 401  | Unauthorized                  | Section 3.1 of <span class="o">[</span>RFC7235] |
   | 402  | Payment Required              | Section 6.5.2            |
   | 403  | Forbidden                     | Section 6.5.3            |
   | 404  | Not Found                     | Section 6.5.4            |
   | 405  | Method Not Allowed            | Section 6.5.5            |
   | 406  | Not Acceptable                | Section 6.5.6            |
   | 407  | Proxy Authentication Required | Section 3.2 of <span class="o">[</span>RFC7235] |
   | 408  | Request Timeout               | Section 6.5.7            |
   | 409  | Conflict                      | Section 6.5.8            |
   | 410  | Gone                          | Section 6.5.9            |
   | 411  | Length Required               | Section 6.5.10           |
   | 412  | Precondition Failed           | Section 4.2 of <span class="o">[</span>RFC7232] |
   | 413  | Payload Too Large             | Section 6.5.11           |
   | 414  | URI Too Long                  | Section 6.5.12           |
   | 415  | Unsupported Media Type        | Section 6.5.13           |
   | 416  | Range Not Satisfiable         | Section 4.4 of <span class="o">[</span>RFC7233] |
   | 417  | Expectation Failed            | Section 6.5.14           |
   | 426  | Upgrade Required              | Section 6.5.15           |
   | 500  | Internal Server Error         | Section 6.6.1            |
   | 501  | Not Implemented               | Section 6.6.2            |
   | 502  | Bad Gateway                   | Section 6.6.3            |
   | 503  | Service Unavailable           | Section 6.6.4            |
   | 504  | Gateway Timeout               | Section 6.6.5            |
   | 505  | HTTP Version Not Supported    | Section 6.6.6            |
   +------+-------------------------------+--------------------------+


</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="json-和-python-字典的区别">Json 和 python 字典的区别:</h2>

<p>从形式来讲，这两者的确很像，都为 <code class="language-plaintext highlighter-rouge">key : value</code> 的形式</p>

<blockquote>
  <ul>
    <li>简单来说，python 字典的数据格式就json的数据格式。</li>
    <li>但本质上来讲，字典是一种数据结构，json是一种格式；字典有很多内置函数，有多种调用方法，而json是数据打包的一种格式，并不像字典具备操作性，并且是格式就会有一些形式上的限制，比如json的格式要求必须且只能使用双引号作为key或者值的边界符号，不能使用单引号，而且“key”必须使用边界符（双引号），但字典就无所谓了。</li>
  </ul>
</blockquote>

<p>　　形式上的相近也让python提供了json.loads()转换函数，方便json数据的调用。 
　　使用方法如下：</p>

<p>一段Python 字典</p>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="err">ab</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">'liu'</span><span class="w"> </span><span class="err">:'liu@python.info',</span><span class="w"> 
        </span><span class="err">'Larry'</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="err">'larry@wall.org',</span><span class="w"> 
        </span><span class="err">'Matsumoto'</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="err">'matz@ruby-lang.org',</span><span class="w"> 
        </span><span class="err">'Spammer'</span><span class="w"> </span><span class="err">:</span><span class="w"> </span><span class="err">'spammer@hotmail.com'</span><span class="w"> 
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
</div>

<p>一段JSON</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="p">{</span>
  <span class="s">"clusterInfo"</span><span class="p">:</span>
  <span class="p">{</span>
    <span class="s">"id"</span><span class="p">:</span><span class="mi">1324053971963</span><span class="p">,</span>
    <span class="s">"startedOn"</span><span class="p">:</span><span class="mi">1324053971963</span><span class="p">,</span>
    <span class="s">"state"</span><span class="p">:</span><span class="s">"STARTED"</span><span class="p">,</span>
    <span class="s">"resourceManagerVersion"</span><span class="p">:</span><span class="s">"0.23.1-SNAPSHOT"</span><span class="p">,</span>
    <span class="s">"resourceManagerVersionBuiltOn"</span><span class="p">:</span><span class="s">"Tue Dec 13 22:12:48 CST 2011"</span><span class="p">,</span>
    <span class="s">"hadoopVersion"</span><span class="p">:</span><span class="s">"0.23.1-SNAPSHOT"</span><span class="p">,</span>
    <span class="s">"hadoopVersionBuiltOn"</span><span class="p">:</span><span class="s">"Tue Dec 13 22:12:26 CST 2011"</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="quick-start">Quick start</h2>

<h3 id="1环境准备">(1)环境准备</h3>

<p>新建一个项目目录 tutorial, 并进入该目录</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">django-admin startproject tutorial .</code> 这里后面加了一个点, 作用是把当前目录作为项目目录. 而如果不加点, 那么就会在当前目录下再创建一个项目目录.</li>
  <li><code class="language-plaintext highlighter-rouge">django-admin.py startapp quickstart</code> 是在项目目录的主目录下创建app.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></td><td class="code"><pre>
<span class="c"># Create the project directory</span>
mkdir tutorial
<span class="nb">cd </span>tutorial

<span class="c"># Create a virtualenv to isolate our package dependencies locally</span>
virtualenv env
<span class="nb">source </span>env/bin/activate

<span class="c"># Install Django and Django REST framework into the virtualenv</span>
pip3.7 install djangorestframework
pip3.7 install markdown
pip3.7 install <span class="nv">django</span><span class="o">==</span>2.0
pip3.7 install django-cors-headers<span class="o">==</span>2.1.0
pip3.7 install django-crispy-forms<span class="o">==</span>1.7.0
pip3.7 install django-filter<span class="o">==</span>1.1.0
pip3.7 install django-haystack<span class="o">==</span>2.6.1
pip3.7 install <span class="nv">pillow</span><span class="o">==</span>4.3.0
pip3.7 install <span class="nv">httpie</span><span class="o">==</span>0.9.9
pip3.7 install django-guardian


<span class="c"># 创建新的项目和应用</span>
django-admin startproject tutorial .  <span class="c"># Note the trailing '.' character</span>
<span class="nb">cd </span>tutorial
django-admin.py startapp quickstart
<span class="nb">cd</span> ..


<span class="c"># 第一次进行数据库同步</span>
python3.7 manage.py migrate


<span class="c"># 创建超级用户</span>
python3.7 manage.py createsuperuser

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="2编写--serializers">(2)编写  Serializers</h3>

<p>序列器的两大作用:</p>

<ol>
  <li>作为数据验证</li>
  <li>做数据转换翻译</li>
</ol>

<p>在应用目录下新建 序列化文件</p>

<p><em>tutorial/quickstart/serializers.py</em></p>

<ul>
  <li>Serializers 相当于在模型上面的一个封装</li>
  <li>定义要序列化的数据模型以及要展示的字段</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="c"># 导入两个models User 和 Group</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Group</span>
<span class="c"># 引入序列化器</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>

<span class="c"># 定义一个序列化器, 继承自 超链接模型序列器基类. 这个序列器是基于模型的,而且会产生url连接</span>
<span class="c"># rest 一共提供三种序列器, 这是其中一种.</span>
<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
      	<span class="c"># 定义模型和要序列化的字段</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="c"># url 是固定名称, 是序列器模型固定用法.</span>
        <span class="c"># 如果需要在用户中显示用户所属组, 那么就加一个 'groups'</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'url'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'groups'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GroupSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Group</span>
        <span class="c"># 如果想要在组中显示所有的用户, 就加一个 'user_set'</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'url'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,</span> <span class="s">'user_set'</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="3创建视图类">(3)创建视图类</h3>

<p>视图类, 视图集, 用于将</p>

<p><em>quickstart/views.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="c"># 再次导入数据模型</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Group</span>
<span class="c"># 导入 rest 的 viewsets 基类</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">viewsets</span>
<span class="c"># 导入刚刚建立的两个序列化类</span>
<span class="kn">from</span> <span class="nn">tutorial.quickstart.serializers</span> <span class="kn">import</span> <span class="n">UserSerializer</span><span class="p">,</span> <span class="n">GroupSerializer</span>


<span class="c"># Create your views here.</span>

<span class="c"># 创建一个视图类, 继承rest ModelViewSet 基类</span>
<span class="k">class</span> <span class="nc">UserViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="s">"""
    查看, 编辑用户数据的 API 接口 &lt;br&gt;
    A viewset that provides default `create()`, `retrieve()`, `update()`,
    `partial_update()`, `destroy()` and `list()` actions.
    """</span>
    <span class="c"># queryset 是固定用法, 定义获取的数据过滤和排序</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-date_joined'</span><span class="p">)</span>
    <span class="c"># 定义使用哪个序列化器</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserSerializer</span>


<span class="k">class</span> <span class="nc">GroupViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="s">"""
    查看, 编辑组数据的 API 接口 &lt;br&gt;
    A viewset that provides default `create()`, `retrieve()`, `update()`,
    `partial_update()`, `destroy()` and `list()` actions.
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">GroupSerializer</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="4对-url-和-setting-进行设置">(4)对 url 和 setting 进行设置</h3>

<p><em>tutorial/urls.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="c"># 导入 rest 的 路由模块</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">routers</span>
<span class="c"># 导入 刚刚建立的视图模块</span>
<span class="kn">from</span> <span class="nn">tutorial.quickstart</span> <span class="kn">import</span> <span class="n">views</span>


<span class="c"># 初始化一个 rest 路由. 记得最后的括号别忘了</span>
<span class="n">router</span> <span class="o">=</span> <span class="n">routers</span><span class="o">.</span><span class="n">DefaultRouter</span><span class="p">()</span>
<span class="c"># 将视图中的用户和组注册到 rest 路由中</span>
<span class="c"># 第一个参数是放在url 地址中的 path 部分中的路径</span>
<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">r'users'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserViewSet</span><span class="p">)</span>
<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">r'groups'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">GroupViewSet</span><span class="p">)</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c"># 这里将首页根路径的请求转发到 rest 路由的urls进行处理</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">router</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    <span class="c"># 将登陆/登出 的请求转发到 rest_framework 的 urls进行处理</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api-auth/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'rest_framework.urls'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">'rest_framework'</span><span class="p">)),</span>
<span class="p">]</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>tutorial/settings.py</em></p>

<p>将 下面代码放到 <code class="language-plaintext highlighter-rouge">INSTALLED_APPS</code> 中</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
	<span class="o">...</span>
    <span class="s">'rest_framework'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c"># 设定默认显示分页</span>
    <span class="s">'DEFAULT_PAGINATION_CLASS'</span><span class="p">:</span> <span class="s">'rest_framework.pagination.PageNumberPagination'</span><span class="p">,</span>
    <span class="s">'PAGE_SIZE'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>

    <span class="c"># 设定权限, 只有管理员才能访问API 页面, 否则 403 forbidden</span>
  	<span class="c"># 注意这里的CLASSES 是复数</span>
    <span class="s">'DEFAULT_PERMISSION_CLASSES'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s">'rest_framework.permissions.IsAdminUser'</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="5测试api">(5)测试API</h3>

<p><em>运行服务</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py runserver
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>测试API</em></p>

<p>方法一:</p>

<ul>
  <li>要安装 httpie <code class="language-plaintext highlighter-rouge">pip3.7 install httpie</code></li>
  <li>-a 参数可以提供用户名和密码的验证支持</li>
  <li>-p 输出内容.
    <ul>
      <li>‘H’ request headers</li>
      <li>‘B’ request body</li>
      <li>‘h’ response headers</li>
      <li>‘b’ response body</li>
    </ul>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>http -a root:@<span class="k">******</span> http://127.0.0.1:8000/users/
http -a root:@<span class="k">******</span> http://127.0.0.1:8000/users/?format<span class="o">=</span>api <span class="c"># 通过内容协商来定义返回的格式. 默认是json</span>
http -a root:@<span class="k">******</span> --print hbHB http://127.0.0.1:8000/helloworld/users/
</pre></td></tr></tbody></table>
</div>
</div>

<p>方法二:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="gp">dalong$ </span>curl -H <span class="s1">'Accept: application/json; indent=4'</span> -u root:@<span class="k">******</span> http://127.0.0.1:8000/users/
</pre></td></tr></tbody></table>
</div>
</div>

<p>方法三:</p>

<blockquote>
  <p>浏览器直接访问: http://127.0.0.1:8000/</p>
</blockquote>

<h3 id="如果需要让外网访问-需要做两件事情">如果需要让外网访问, 需要做两件事情</h3>

<p>(1): 启动服务时, 设置IP 地址为 0.0.0.0</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py runserver 0.0.0.0:8001
</pre></td></tr></tbody></table>
</div>
</div>

<p>(2): 在 settings.py 中 设置</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'*'</span><span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="snippet代码片段分享项目">snippet代码片段分享项目</h2>

<h3 id="创建-snippet-app">创建 snippet app</h3>

<p><em>在原有项目中创建一个新的app</em></p>

<p>也可以创建一个新的项目.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py startapp snippetsapp
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>将新的app 放到 settings.py中</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
	<span class="o">...</span>
    <span class="s">'rest_framework'</span><span class="p">,</span>
    <span class="s">'snippetsapp.apps.SnippetsappConfig'</span><span class="p">,</span>
<span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="创建一个模型"><em>创建一个模型</em></h3>

<p>models.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">pygments.lexers</span> <span class="kn">import</span> <span class="n">get_all_lexers</span>
<span class="kn">from</span> <span class="nn">pygments.styles</span> <span class="kn">import</span> <span class="n">get_all_styles</span>
<span class="kn">from</span> <span class="nn">pygments.lexers</span> <span class="kn">import</span> <span class="n">get_lexer_by_name</span>
<span class="kn">from</span> <span class="nn">pygments.formatters.html</span> <span class="kn">import</span> <span class="n">HtmlFormatter</span>
<span class="kn">from</span> <span class="nn">pygments</span> <span class="kn">import</span> <span class="n">highlight</span>


<span class="n">LEXERS</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">get_all_lexers</span><span class="p">()</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">LANGUAGE_CHOICES</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">LEXERS</span><span class="p">])</span>
<span class="n">STYLE_CHOICES</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="n">item</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">get_all_styles</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">Snippet</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="c"># 行号</span>
    <span class="n">linenos</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c"># choices 相当于数据库中的 enum 类型字段, 多个选项中选一个</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">LANGUAGE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'python'</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">STYLE_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'friendly'</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c"># auth.User 是特殊用法, 一般情况都是需要先 import 需要的模块, 在把模块放在第一个参数</span>
    <span class="c"># related_name 就是用来定义在 serializers.py 中指定</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">'auth.User'</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'snippets'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># 新加一个字段, 让用户提交代码高亮显示. 默认是空</span>
    <span class="c"># 后面的save() 方法用于将 code 的代码进行渲染高亮, 然后保存到这个字段中</span>
    <span class="n">highlighted</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'created'</span><span class="p">,)</span>

    <span class="c"># save方法继承自基类, 当有数据要保存时,会自动执行该方法</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="s">"""
        Use the `pygments` libaray to create a highlighted HTML representation of the code snippet
        """</span>
        <span class="c"># get_lexer_by_name() 方法通过传入的参数(比如: python) 获取词法对象</span>
        <span class="c"># self.language 是字段名 , 默认值是 python</span>
        <span class="n">lexer</span> <span class="o">=</span> <span class="n">get_lexer_by_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="c"># 如果字段 linenos 是 True, 那么将'table' 保存到linenos 变量中, 否则将False 保存到变量中.</span>
        <span class="c"># 结果, 变量中就是 'table' 或者是 False</span>
        <span class="n">linenos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linenos</span> <span class="ow">and</span> <span class="s">'table'</span> <span class="ow">or</span> <span class="bp">False</span>
        <span class="c"># 如果title 字段有值, 那么就将 {...} 放到options字段中, 否则将空字典放到 options变量中</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">and</span> <span class="p">{</span><span class="s">'title'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">}</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="c"># HtmlFormatter() 方法将源代码转化成HTML 的格式</span>
        <span class="c"># 第一个参数是一个风格. 数据来自字段style(比如: friendly), 第二个字段确定是否显示行号</span>
        <span class="c"># full=True 表示显示所有代码.</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">HtmlFormatter</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">,</span> <span class="n">linenos</span><span class="o">=</span><span class="n">linenos</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="c"># 用highlight() 方法把 code 代码转换成高亮显示的代码, 并保存到highlighted 字段中</span>
        <span class="c"># 第一个参数是原代码, 第二个参数是词法分析器对象, 第三个参数是格式化的风格</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlighted</span> <span class="o">=</span> <span class="n">highlight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">lexer</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
        <span class="c"># 执行父类的保存</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Snippet</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p><em>进行数据迁移</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>python3.7 manage.py makemigrations

python3.7 manage.py migrate
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>创建 serializers.py 文件</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Snippet</span><span class="p">,</span> <span class="n">LANGUAGE_CHOICES</span><span class="p">,</span> <span class="n">STYLE_CHOICES</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="c"># view_name 是反向关联, 值需要在 urls.py 中同时设置</span>
    <span class="c"># HyperlinkedRelatedField 是生成外键关联的链接</span>
    <span class="n">snippets</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">view_name</span><span class="o">=</span><span class="s">'snippet-detail'</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="c"># 这里的 snippets 是在 models.py 中 owner = models.ForeignKey('auth.User', related_name='snippets' .... 定义的</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'snippets'</span><span class="p">,</span> <span class="p">)</span>


<span class="c"># 重构序列化代码</span>
<span class="c"># 这是第三种序列器 ModelSerializer, 其他两种是 Serializer, 和 HyperLinkedModelSerializer</span>
<span class="c"># HyperLinkedModelSerializer 比 ModelSerializer 多了一个 url 功能</span>
<span class="k">class</span> <span class="nc">SnippetSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="c"># owner 原本对应 owner_id. 下面这行代码让 owner_name 可以指定 是 user 表中的任意字段.</span>
    <span class="c"># ReadonlyField 设置了只能显示, 不能创建和修改.</span>
    <span class="n">owner_name</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ReadOnlyField</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="s">'owner.username'</span><span class="p">)</span>
    <span class="c"># highlight 并不是一个模型中的字段, 而是一个超链接, 链接到路由 snippet-highlight 中</span>
    <span class="c"># HyperlinkedIdentityField 是超链接字段.  Identity 说明要带一个ID</span>
    <span class="c"># HyperlinkedIdentityField 是生成由id生成的链接</span>
    <span class="c"># format='html' 表示要渲染成html</span>
    <span class="n">highlight</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">HyperlinkedIdentityField</span><span class="p">(</span><span class="n">view_name</span><span class="o">=</span><span class="s">'snippet-highlight'</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">'html'</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Snippet</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'title'</span><span class="p">,</span> <span class="s">'code'</span><span class="p">,</span> <span class="s">'highlighted'</span><span class="p">,</span> <span class="s">'linenos'</span><span class="p">,</span> <span class="s">'language'</span><span class="p">,</span> <span class="s">'style'</span><span class="p">,</span> <span class="s">'owner'</span><span class="p">,</span> <span class="s">'owner_name'</span><span class="p">,</span> <span class="s">'highlight'</span><span class="p">,)</span>




<span class="c"># # 这里的序列器继承自 Serializer , 这里的序列器基类和 HyperlinkedModelSerializer 类似, 只是更加基本</span>
<span class="c"># # 序列器中定义的每个字段都是和 models.py 中的模型中的字段是对应的. 定义字段的用处是为验证数据和数据转换</span>
<span class="c"># class SnippetSerializer(serializers.Serializer):</span>
<span class="c">#     id = serializers.IntegerField(read_only=True)</span>
<span class="c">#     title = serializers.CharField(required=False, allow_blank=True, max_length=100)</span>
<span class="c">#     # code 是字符串类型, 但是在模板中需要用 textarea 来展示, 并用 base_template</span>
<span class="c">#     # serializers 中没有Text 类型字段, 要用CharField</span>
<span class="c">#     code = serializers.CharField(style={'base_template': 'textarea.html'})</span>
<span class="c">#     # 行号</span>
<span class="c">#     linenos = serializers.BooleanField(required=False)</span>
<span class="c">#     language = serializers.ChoiceField(choices=LANGUAGE_CHOICES, default='python')</span>
<span class="c">#     style = serializers.ChoiceField(choices=STYLE_CHOICES, default='friendly')</span>
<span class="c">#</span>
<span class="c">#     # create 方法名是固定的, 继承自基类</span>
<span class="c">#     # self 和 validated_date 这两个参数也是固定的</span>
<span class="c">#     # validated_date 是一个字典, 内容是经过验证的合法数据, 数据内容就是上面定义的字段数据.</span>
<span class="c">#     def create(self, validated_date):</span>
<span class="c">#         """</span>
<span class="c">#         创建</span>
<span class="c">#         """</span>
<span class="c">#         # 将验证过的数据创建到 Snippet 表中, 并返回</span>
<span class="c">#         return Snippet.objects.create(**validated_date)</span>
<span class="c">#</span>
<span class="c">#     # update 名字是固定的.</span>
<span class="c">#     # instance 代表一个要被更新的 snippet 对象</span>
<span class="c">#     # validated_date 是对这个实例进行更新的数据</span>
<span class="c">#     def update(self, instance, validated_date):</span>
<span class="c">#         """</span>
<span class="c">#         更新</span>
<span class="c">#         """</span>
<span class="c">#         # 第一个参数'title' 是validated_date 中的 key 的名字</span>
<span class="c">#         # 第二个参数 instance.title 是默认值. 可以省略, 也可以设置成其他默认值, 比如 'abc'</span>
<span class="c">#         instance.title = validated_date.get('title', instance.title)</span>
<span class="c">#         instance.code = validated_date.get('code', instance.code)</span>
<span class="c">#         instance.linenos = validated_date.get('linenos', instance.linenos)</span>
<span class="c">#         instance.language = validated_date.get('language', instance.language)</span>
<span class="c">#         instance.style = validated_date.get('style', instance.style)</span>
<span class="c">#         instance.save()</span>
<span class="c">#         # 返回 instance 是固定用法</span>
<span class="c">#         return instance</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p><em>使用命令行模拟服务端的响应和客户端的请求的过程</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></td><td class="code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">snippetsapp.models</span> <span class="kn">import</span> <span class="n">Snippet</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">snippetsapp.serializers</span> <span class="kn">import</span> <span class="n">SnippetSerializer</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">rest_framework.renderers</span> <span class="kn">import</span> <span class="n">JSONRenderer</span>  <span class="c"># 引入一个JSON 渲染器, 用于将response 的JSON代码进行渲染. </span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">rest_framework.parsers</span> <span class="kn">import</span> <span class="n">JSONParser</span> <span class="c"># 引入一个JSON 解析器, 用于解析前端request 过来的JSON代码</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">snippet</span> <span class="o">=</span> <span class="n">Snippet</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s">'hello world'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">snippet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">snippet</span> <span class="o">=</span> <span class="n">Snippet</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s">'good bye'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">snippet</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c"># 模拟服务端response输出</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">snippet</span><span class="p">)</span> <span class="c"># 将数据对象传给序列器.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span> <span class="c"># 输出序列器的数据 -- 就是将数据对象翻译成了一个字典</span>
<span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'title'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span> <span class="s">'code'</span><span class="p">:</span> <span class="s">'good bye'</span><span class="p">,</span> <span class="s">'linenos'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'language'</span><span class="p">:</span> <span class="s">'python'</span><span class="p">,</span> <span class="s">'style'</span><span class="p">:</span> <span class="s">'friendly'</span><span class="p">}</span>  <span class="c"># 单引号, 表示输出的是字典</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">content</span> <span class="o">=</span> <span class="n">JSONRenderer</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="c"># 将字典传给渲染器进行渲染</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">content</span> <span class="c"># 是二进制JSON</span>
<span class="n">b</span><span class="s">'{"id":2,"title":"","code":"good bye","linenos":false,"language":"python","style":"friendly"}'</span>  <span class="c"># 双引号, 表示输出是二进制 JSON 数据 </span>


<span class="c"># 模拟客户端获取到数据, 然后转换成字典</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.utils.six</span> <span class="kn">import</span> <span class="n">BytesIO</span>  <span class="c"># six 用于模拟前端数据传输时的二进制数据</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>   <span class="c"># 前端获取到response 二进制数据</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">stream</span> 
<span class="o">&lt;</span><span class="n">_io</span><span class="o">.</span><span class="n">BytesIO</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x10f8942b0</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>  <span class="c"># 用 JSON解析器解析二进制代码,转换成字典</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span>
<span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'title'</span><span class="p">:</span> <span class="s">''</span><span class="p">,</span> <span class="s">'code'</span><span class="p">:</span> <span class="s">'good bye'</span><span class="p">,</span> <span class="s">'linenos'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'language'</span><span class="p">:</span> <span class="s">'python'</span><span class="p">,</span> <span class="s">'style'</span><span class="p">:</span> <span class="s">'friendly'</span><span class="p">}</span>

<span class="c"># 保存数据到数据库</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="c"># 将前端获取的到数据作为参数传给序列器</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span><span class="o">.</span><span class="n">is_valid</span><span class="p">()</span>  <span class="c"># 验证数据是否合法, 因为需要保存数据, 所以要先进行过验证.才能获得 validated_data 并 save() </span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span><span class="o">.</span><span class="n">validated_data</span>  <span class="c"># 获取经过验证的数据</span>
<span class="n">OrderedDict</span><span class="p">([(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">''</span><span class="p">),</span> <span class="p">(</span><span class="s">'code'</span><span class="p">,</span> <span class="s">'good bye'</span><span class="p">),</span> <span class="p">(</span><span class="s">'linenos'</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span> <span class="p">(</span><span class="s">'language'</span><span class="p">,</span> <span class="s">'python'</span><span class="p">),</span> <span class="p">(</span><span class="s">'style'</span><span class="p">,</span> <span class="s">'friendly'</span><span class="p">)])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c"># 保存数据</span>
<span class="o">&lt;</span><span class="n">Snippet</span><span class="p">:</span> <span class="n">Snippet</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span>

<span class="c"># 对比通过数据模型获取数据和 通过 虚话器获取数据</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>  <span class="c"># 获取数据模型中的所有数据</span>
<span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Snippet</span><span class="p">:</span> <span class="n">Snippet</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Snippet</span><span class="p">:</span> <span class="n">Snippet</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Snippet</span><span class="p">:</span> <span class="n">Snippet</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Snippet</span><span class="p">:</span> <span class="n">Snippet</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">(</span><span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">(),</span> <span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  <span class="c"># 获取序列器中的所有数据, many=True 是必须的参数</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span><span class="o">.</span><span class="n">data</span> <span class="c"># 获取序列化的数据</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>验证重构后的序列器是否还能输出之前的内容</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">snippetsapp.serializers</span> <span class="kn">import</span> <span class="n">SnippetSerializer</span> <span class="c"># 重新加载重构后的序列器</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">serializer</span> <span class="o">=</span> <span class="n">SnippetSerializer</span><span class="p">()</span> <span class="c"># 重新初始化序列器对象</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">serializer</span><span class="p">))</span>  <span class="c"># 打印序列器. repr 是呈现对象的函数</span>
<span class="n">SnippetSerializer</span><span class="p">():</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">allow_blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s">'base_template'</span><span class="p">:</span> <span class="s">'textarea.html'</span><span class="p">})</span>
    <span class="n">linenos</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">language</span> <span class="o">=</span> <span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">[(</span><span class="s">'abap'</span><span class="p">,</span> <span class="s">'ABAP'</span><span class="p">),</span> <span class="o">......</span><span class="p">,</span> <span class="p">(</span><span class="s">'zephir'</span><span class="p">,</span> <span class="s">'Zephir'</span><span class="p">)],</span> <span class="n">default</span><span class="o">=</span><span class="s">'python'</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">ChoiceField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="p">[(</span><span class="s">'abap'</span><span class="p">,</span> <span class="s">'abap'</span><span class="p">),</span> <span class="o">.......</span><span class="p">,</span> <span class="p">(</span><span class="s">'xcode'</span><span class="p">,</span> <span class="s">'xcode'</span><span class="p">)],</span> <span class="n">default</span><span class="o">=</span><span class="s">'friendly'</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>编写views.py 函数</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403</pre></td><td class="code"><pre><span class="c"># 第五级</span>

<span class="kn">from</span> <span class="nn">rest_framework.decorators</span> <span class="kn">import</span> <span class="n">detail_route</span><span class="p">,</span> <span class="n">api_view</span>
<span class="kn">from</span> <span class="nn">snippetsapp.models</span> <span class="kn">import</span> <span class="n">Snippet</span>
<span class="kn">from</span> <span class="nn">snippetsapp.serializers</span> <span class="kn">import</span> <span class="n">SnippetSerializer</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">generics</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">snippetsapp.serializers</span> <span class="kn">import</span> <span class="n">UserSerializer</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span><span class="p">,</span> <span class="n">renderers</span><span class="p">,</span> <span class="n">viewsets</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">rest_framework.reverse</span> <span class="kn">import</span> <span class="n">reverse</span>


<span class="k">class</span> <span class="nc">SnippetViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="s">"""
    这个 viewset 自动提供了 list, create, retrive, delete, update 方法
    这里需要和 urls.py 进行配合
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Snippet</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">SnippetSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">,)</span>

    <span class="c"># detail_route 是详情路由装饰器, 定义 detail 页面的时候可以被装饰</span>
    <span class="c"># 该装饰器指定该详情页需要用html 静态方式进行渲染.</span>
    <span class="c"># 该装饰器也可以在 urls.py 中进行定义, 效果相同</span>
    <span class="nd">@detail_route</span><span class="p">(</span><span class="n">renderer_classes</span><span class="o">=</span><span class="p">[</span><span class="n">renderers</span><span class="o">.</span><span class="n">StaticHTMLRenderer</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">highlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">snippet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_object</span><span class="p">()</span>
        <span class="c"># snippet.highlighted 是命名空间, 对应 urls.py 中的定义</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">snippet</span><span class="o">.</span><span class="n">highlighted</span><span class="p">)</span>

    <span class="c"># perform_create 方法继承自基类</span>
    <span class="c"># 该方法只有在新一条记录时才会被调用</span>
    <span class="k">def</span> <span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="c"># 强制将代码片段作者设置为当前登录用户</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserViewSet</span><span class="p">(</span><span class="n">viewsets</span><span class="o">.</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="s">"""
    This viewset automatically provides 'list' and 'detail' actions
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticatedOrReadOnly</span><span class="p">,)</span>


<span class="nd">@api_view</span><span class="p">([</span><span class="s">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">api_root</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">({</span>
        <span class="c"># 生成一个跳到users 的链接</span>
        <span class="c"># user-list 是views中的命名空间,</span>
        <span class="s">'users'</span><span class="p">:</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'user-list'</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">),</span>
        <span class="s">'snippets'</span><span class="p">:</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'snippet-list'</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">format</span><span class="p">)</span>
    <span class="p">})</span>



<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># # 第四级: 继承自generics 对应的几个类指定请求方法的基类</span>
<span class="c"># # 不再需要get, post 等方法.</span>
<span class="c">#</span>
<span class="c"># from snippetsapp.models import Snippet</span>
<span class="c"># from snippetsapp.serializers import SnippetSerializer</span>
<span class="c"># from rest_framework import generics</span>
<span class="c"># from django.contrib.auth.models import User</span>
<span class="c"># from snippetsapp.serializers import UserSerializer</span>
<span class="c"># from rest_framework import permissions</span>
<span class="c"># from rest_framework.decorators import api_view</span>
<span class="c"># from rest_framework.response import Response</span>
<span class="c"># from rest_framework.reverse import reverse</span>
<span class="c"># from rest_framework import renderers</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># class SnippetList(generics.ListCreateAPIView):</span>
<span class="c">#     queryset = Snippet.objects.all()</span>
<span class="c">#     serializer_class = SnippetSerializer</span>
<span class="c">#     # 这是权限控制, 如果没有登录, 就只可能查看, 不能做修改删除增加操作的显示界面.</span>
<span class="c">#     # permission_classes = (permissions.IsAuthenticated,)</span>
<span class="c">#     # IsAuthenticatedOrReadOnly 是没登录的话, 可以看, 但不能创建,修改,删除</span>
<span class="c">#     permission_classes = (permissions.IsAuthenticatedOrReadOnly, )</span>
<span class="c">#</span>
<span class="c">#     # 确保创建代码的用户就是作者本人. 不能伪造用户</span>
<span class="c">#     # 作用: 每次新创建一条记录的时候, 就会自动执行该方法, 创建作者就是登陆用户.</span>
<span class="c">#     # 这个方法名是固定用法, 继承自基类.</span>
<span class="c">#     def perform_create(self, serializer):</span>
<span class="c">#         serializer.save(owner=self.request.user)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># class SnippetDetail(generics.RetrieveUpdateDestroyAPIView):</span>
<span class="c">#     queryset = Snippet.objects.all()</span>
<span class="c">#     serializer_class = SnippetSerializer</span>
<span class="c">#     permission_classes = (permissions.IsAuthenticatedOrReadOnly,)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># class UserList(generics.ListCreateAPIView):</span>
<span class="c">#     queryset = User.objects.all()</span>
<span class="c">#     serializer_class = UserSerializer</span>
<span class="c">#     permission_classes = (permissions.IsAuthenticatedOrReadOnly,)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># class UserDetail(generics.RetrieveUpdateDestroyAPIView):</span>
<span class="c">#     queryset = User.objects.all()</span>
<span class="c">#     serializer_class = UserSerializer</span>
<span class="c">#     permission_classes = (permissions.IsAuthenticatedOrReadOnly,)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># @api_view(['GET'])</span>
<span class="c"># def api_root(request, format=None):</span>
<span class="c">#     return Response({</span>
<span class="c">#         # 生成一个跳到users 的链接</span>
<span class="c">#         # user-list 是views中的命名空间,</span>
<span class="c">#         'users': reverse('user-list', request=request, format=format),</span>
<span class="c">#         'snippets': reverse('snippet-list', request=request, format=format)</span>
<span class="c">#     })</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># # 一个自定义的类, 继承自通用视图类</span>
<span class="c"># class SnippetHighlight(generics.GenericAPIView):</span>
<span class="c">#     queryset = Snippet.objects.all()</span>
<span class="c">#     # 指定渲染器类为静态HTML 渲染器, 也可以指定其他渲染器.</span>
<span class="c">#     renderer_classes = (renderers.StaticHTMLRenderer,)</span>
<span class="c">#</span>
<span class="c">#     # 定义接收的是GET 方法, 继承自基类</span>
<span class="c">#     # 后面三个参数没用, 但是必须有, 否则报错</span>
<span class="c">#     def get(self, request, *args, **kwargs):</span>
<span class="c">#         # 默认返回当前对象 ( 通过pk )</span>
<span class="c">#         snippet = self.get_object()</span>
<span class="c">#         # 渲染的内容就是</span>
<span class="c">#         return Response(snippet.highlighted)</span>
<span class="c">#</span>

<span class="c"># # 第三点五级别: 使用Mixin类作为虚拟基类, 一般Mixin 不会直接用, 而是专门用来被继承的基类</span>
<span class="c"># # Mixin 分为list, create, retrieve, update, delete.</span>
<span class="c"># # 这一级别, UI 上的表单更加细化, 可以分项输入不同信息.</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># from snippetsapp.models import Snippet</span>
<span class="c"># from snippetsapp.serializers import SnippetSerializer</span>
<span class="c"># from rest_framework import mixins</span>
<span class="c"># from rest_framework import generics</span>
<span class="c">#</span>
<span class="c"># class SnippetList(mixins.ListModelMixin,</span>
<span class="c">#                   mixins.CreateModelMixin,</span>
<span class="c">#                   generics.GenericAPIView):</span>
<span class="c">#     queryset = Snippet.objects.all()</span>
<span class="c">#     serializer_class = SnippetSerializer</span>
<span class="c">#</span>
<span class="c">#     def get(self, request, *args, **kwargs):</span>
<span class="c">#         # self.list 是ListModelMixin 的方法, 同时实线了 Response 方法.</span>
<span class="c">#         return self.list(request, *args, **kwargs)</span>
<span class="c">#</span>
<span class="c">#     def post(self, request, *args, **kwargs):</span>
<span class="c">#         # self.create 是 CreateModelMixin 的方法, 同时实线了 Response 方法.</span>
<span class="c">#         return self.create(request, *args, **kwargs)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># class SnippetDetail(mixins.RetrieveModelMixin,</span>
<span class="c">#                     mixins.UpdateModelMixin,</span>
<span class="c">#                     mixins.DestroyModelMixin,</span>
<span class="c">#                     generics.GenericAPIView):</span>
<span class="c">#     queryset = Snippet.objects.all()</span>
<span class="c">#     serializer_class = SnippetSerializer</span>
<span class="c">#</span>
<span class="c">#     def get(self, request, *args, **kwargs):</span>
<span class="c">#         # retrieve 是 继承自 RetrieveModelMixin</span>
<span class="c">#         return self.retrieve(request, *args, **kwargs)</span>
<span class="c">#</span>
<span class="c">#     def put(self, request, *args, **kwargs):</span>
<span class="c">#         # update 继承自 UpdateModelMixin</span>
<span class="c">#         return self.update(request, *args, **kwargs)</span>
<span class="c">#</span>
<span class="c">#     def delete(self, request, *args, **kwargs):</span>
<span class="c">#         # destroy 继承自 DestroyModelMixin</span>
<span class="c">#         return self.destroy(request, *args, **kwargs)</span>
<span class="c">#</span>








<span class="c">#</span>
<span class="c"># # 第三级 面向对象: 继承自django 的 APIView</span>
<span class="c"># # 不再需要对不同method 进行判断.</span>
<span class="c"># # 对应不同类型请求, 创建相对名字的方法.</span>
<span class="c">#</span>
<span class="c"># from snippetsapp.models import Snippet</span>
<span class="c"># from snippetsapp.serializers import SnippetSerializer</span>
<span class="c"># from django.http import Http404</span>
<span class="c"># from rest_framework.views import APIView</span>
<span class="c"># from rest_framework.response import Response</span>
<span class="c"># from rest_framework import status</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># # APIView 是 rest 框架中的最基本的 view 基类</span>
<span class="c"># class SnippetList(APIView):</span>
<span class="c">#     """</span>
<span class="c">#     LC</span>
<span class="c">#     """</span>
<span class="c">#     # 如果是GET 方法, 就会执行get 方法. 如果是POST 方法, 就执行 post 方法</span>
<span class="c">#     # format=None 的作用是可以在url 后面加个点(比如:http://127.0.0.1:8000/snippets.json  .api ) . 这个需要和 urls.py 中的 urlpatterns = format_suffix_patterns(urlpatterns) 配合使用</span>
<span class="c">#     def get(self, request, format=None):</span>
<span class="c">#         snippets = Snippet.objects.all()</span>
<span class="c">#         serializer = SnippetSerializer(snippets, many=True)</span>
<span class="c">#         return Response(serializer.data)</span>
<span class="c">#</span>
<span class="c">#     def post(self, request, format=None):</span>
<span class="c">#         serializer = SnippetSerializer(data=request.data)</span>
<span class="c">#         if serializer.is_valid():</span>
<span class="c">#             serializer.save()</span>
<span class="c">#             return Response(serializer.data, status=status.HTTP_201_CREATED)</span>
<span class="c">#         return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># class SnippetDetail(APIView):</span>
<span class="c">#     """</span>
<span class="c">#     RUD</span>
<span class="c">#     """</span>
<span class="c">#     # get_object() 方法是必须的, 需要先获得需要进行操作的那条数据对象.</span>
<span class="c">#     # get_object() 方法会被后面三个方法调用</span>
<span class="c">#     def get_object(self, pk):</span>
<span class="c">#         try:</span>
<span class="c">#             return Snippet.objects.get(pk=pk)</span>
<span class="c">#         except Snippet.DoesNotExist:</span>
<span class="c">#             raise Http404</span>
<span class="c">#</span>
<span class="c">#     def get(self, request, pk, format=None):</span>
<span class="c">#         snippet = self.get_object(pk)</span>
<span class="c">#         serializer = SnippetSerializer(snippet)</span>
<span class="c">#         return Response(serializer.data)</span>
<span class="c">#</span>
<span class="c">#     def put(self, request, pk, format=None):</span>
<span class="c">#         snippet = self.get_object(pk)</span>
<span class="c">#         serializer = SnippetSerializer(snippet, data=request.data)</span>
<span class="c">#         if serializer.is_valid():</span>
<span class="c">#             serializer.save()</span>
<span class="c">#             return Response(serializer.data)</span>
<span class="c">#         return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span>
<span class="c">#</span>
<span class="c">#     def delete(self, request, pk, format=None):</span>
<span class="c">#         snippet = self.get_object(pk)</span>
<span class="c">#         snippet.delete()</span>
<span class="c">#         return Response(status=status.HTTP_204_NO_CONTENT)</span>
<span class="c">#</span>







<span class="c"># 第二级 仍然是函数: 用 django 自带的 Response 处理 json的响应</span>
<span class="c"># 第二级的代码好处是可以看到 漂亮的API 呈现UI界面, 可以在界面直接操作交互.</span>
<span class="c">#</span>
<span class="c"># from rest_framework import status</span>
<span class="c"># from rest_framework.decorators import api_view</span>
<span class="c"># from rest_framework.response import Response</span>
<span class="c"># from snippetsapp.models import Snippet</span>
<span class="c"># from snippetsapp.serializers import SnippetSerializer</span>
<span class="c">#</span>
<span class="c"># # api_view装饰器, 可以帮我们生成友好的 API 交互界面</span>
<span class="c"># # 参数 GET, POST 相当于开关, 如果删掉某一个, 就不能用该方法访问该函数.</span>
<span class="c"># @api_view(['GET', 'POST'])</span>
<span class="c"># def snippet_list(request, format=None):</span>
<span class="c">#     """</span>
<span class="c">#     LC</span>
<span class="c">#     """</span>
<span class="c">#     if request.method == 'GET':</span>
<span class="c">#         snippets = Snippet.objects.all()</span>
<span class="c">#         # 这里的get 是获取列表, 所以要传递snippets, 并且many=True是必须的</span>
<span class="c">#         serializer = SnippetSerializer(snippets, many=True)</span>
<span class="c">#         return Response(serializer.data)</span>
<span class="c">#</span>
<span class="c">#     elif request.method == 'POST':</span>
<span class="c">#         # 这里不再需要 JSONParser().parse(request) 方法做转化, 而是直接使用 SnippetSerializer 将发送过来的数据进行转化.</span>
<span class="c">#         # request.data 比 request.POST 更强大, 获取能多的信息, 可以直接获取各种Http 请求方法(GET, POST, PUT, DELETE).</span>
<span class="c">#         # 有了 request.data 就不需要 JSONParser()</span>
<span class="c">#         serializer = SnippetSerializer(data=request.data)</span>
<span class="c">#         if serializer.is_valid():</span>
<span class="c">#             serializer.save()</span>
<span class="c">#             # status=status.HTTP_201_CREATED 的好处是代码更清晰了, 更多的状态码可以在官网上查到.</span>
<span class="c">#             return Response(serializer.data, status=status.HTTP_201_CREATED)</span>
<span class="c">#		  # serializer.errors 将保存报错信息, 比如: 提交的字段信息超过规定长度, 会报错: 确保字段不超过100个字符</span>
<span class="c">#         return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># @api_view(['GET', 'PUT', 'DELETE'])</span>
<span class="c"># def snippet_detail(request, pk, format=None):</span>
<span class="c">#     """</span>
<span class="c">#     RUD</span>
<span class="c">#     """</span>
<span class="c">#     try:</span>
<span class="c">#         snippet = Snippet.objects.get(pk=pk)</span>
<span class="c">#     except Snippet.DoesNotExist:</span>
<span class="c">#         return Response(status=status.HTTP_404_NOT_FOUND)</span>
<span class="c">#     if request.method == 'GET':</span>
<span class="c">#         # 这里的get 是获取一条信息, 所以要传递snippet对象</span>
<span class="c">#         serializer = SnippetSerializer(snippet)</span>
<span class="c">#         return Response(serializer.data)</span>
<span class="c">#</span>
<span class="c">#     elif request.method == 'PUT':</span>
<span class="c">#         # 因为要更新数据, 所有需要传递两个参数, 第一个参数是被更新的数据, 第二个参数是新的数据.</span>
<span class="c">#         serializer = SnippetSerializer(snippet, data=request.data)</span>
<span class="c">#         if serializer.is_valid():</span>
<span class="c">#             serializer.save()</span>
<span class="c">#             return Response(serializer.data)</span>
<span class="c">#         return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)</span>
<span class="c">#</span>
<span class="c">#     elif request.method == 'DELETE':</span>
<span class="c">#         snippet.delete()</span>
<span class="c">#         return Response(status=status.HTTP_204_NO_CONTENT)</span>
<span class="c">#</span>








<span class="c"># 第一级: 最原始, 使用函数</span>
<span class="c"># 第一级只能看到 json 的 row data , 看不到漂亮的API 界面</span>
<span class="c"># 第一级只能用 http 命令行模拟处理交互动作</span>

<span class="c"># from django.http import HttpResponse, JsonResponse</span>
<span class="c"># # 获取视图模块装饰器模块的 跨域攻击免除模块, 就是不进行跨域保护检验</span>
<span class="c"># from django.views.decorators.csrf import csrf_exempt</span>
<span class="c"># from rest_framework.renderers import JSONRenderer</span>
<span class="c"># from rest_framework.parsers import JSONParser</span>
<span class="c"># from .models import Snippet</span>
<span class="c"># from .serializers import SnippetSerializer</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># # 跨域保护解除装饰器</span>
<span class="c"># # 实现列表和创建的功能</span>
<span class="c"># @csrf_exempt</span>
<span class="c"># def snippet_list(request):</span>
<span class="c">#     """</span>
<span class="c">#     LC: List all code snippets, or Create a new snippet.</span>
<span class="c">#     """</span>
<span class="c">#     # List</span>
<span class="c">#     if request.method == 'GET':</span>
<span class="c">#         snippets = Snippet.objects.all()</span>
<span class="c">#         # 现将数据对象进行序列化</span>
<span class="c">#         serializer = SnippetSerializer(snippets, many=True)</span>
<span class="c">#         # serializer.data 是字典格式数据, 经过 JsonResponse() 转换后,成为JSON格式</span>
<span class="c">#         return JsonResponse(serializer.data, safe=False)</span>
<span class="c">#     # Create</span>
<span class="c">#     elif request.method == "POST":</span>
<span class="c">#         # 将传递过来的对象转换成字典. data 的内容就是一个字典</span>
<span class="c">#         data = JSONParser().parse(request)</span>
<span class="c">#         serializer = SnippetSerializer(data=data)</span>
<span class="c">#         if serializer.is_valid():</span>
<span class="c">#             serializer.save()</span>
<span class="c">#             return JsonResponse(serializer.data, status=201)</span>
<span class="c">#         return JsonResponse(serializer.errors, status=400)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># # 实现获取详情, 更新详情, 删除详情的功能</span>
<span class="c"># @csrf_exempt</span>
<span class="c"># def snippet_detail(request, pk):</span>
<span class="c">#     """</span>
<span class="c">#     RUD: Retrieve, update or delete a code snippet.</span>
<span class="c">#     """</span>
<span class="c">#     try:</span>
<span class="c">#         snippet = Snippet.objects.get(pk=pk)</span>
<span class="c">#     except Snippet.DoesNotExist:</span>
<span class="c">#         return HttpResponse(status=404)</span>
<span class="c">#</span>
<span class="c">#     if request.method == 'GET':</span>
<span class="c">#         serializer = SnippetSerializer(snippet)</span>
<span class="c">#         # serializer.data 是字典格式数据, 经过 JsonResponse() 转换后,成为JSON格式</span>
<span class="c">#         return JsonResponse(serializer.data)</span>
<span class="c">#</span>
<span class="c">#     elif request.method == 'PUT':</span>
<span class="c">#         # 将传递过来的对象转换成字典. data 的内容就是一个字典</span>
<span class="c">#         data = JSONParser().parse(request)</span>
<span class="c">#         serializer = SnippetSerializer(snippet, data=data)</span>
<span class="c">#         if serializer.is_valid():</span>
<span class="c">#             serializer.save()</span>
<span class="c">#             return JsonResponse(serializer.data)</span>
<span class="c">#		  # serializer.errors 将保存报错信息, 比如: 提交的字段信息超过规定长度, 会报错: 确保字段不超过100个字符</span>
<span class="c">#         return JsonResponse(serializer.errors, status=400)</span>
<span class="c">#</span>
<span class="c">#     elif request.method == 'DELETE':</span>
<span class="c">#         snippet.delete()</span>
<span class="c">#         return HttpResponse(status=204)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>修改snippets/urls.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98</pre></td><td class="code"><pre><span class="c"># 第五级</span>
<span class="c"># 好处是代码少, 缺点是不够灵活, 所以一般不用. 也不用第五级预科</span>
<span class="c"># 所以最好的方法时用第四级</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">snippetsapp</span> <span class="kn">import</span> <span class="n">views</span>
<span class="kn">from</span> <span class="nn">rest_framework.routers</span> <span class="kn">import</span> <span class="n">DefaultRouter</span>

<span class="c"># 定义一个默认路由的对象</span>
<span class="n">router</span> <span class="o">=</span> <span class="n">DefaultRouter</span><span class="p">()</span>
<span class="c"># 将视图类注册到路由中</span>
<span class="c"># 第一个参数snippets 是定义的 url 路径名,</span>
<span class="c"># 第二个参数是 对应的视图类名</span>
<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">r'snippets'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">SnippetViewSet</span><span class="p">)</span>
<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">r'users'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserViewSet</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">router</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    <span class="c"># url(r'^api-auth/', include('rest_framework.urls', namespace='rest_framework')),</span>
<span class="p">]</span>




<span class="c"># 第五级预科</span>

<span class="c"># from .views import SnippetViewSet, UserViewSet, api_root</span>
<span class="c"># from rest_framework import renderers</span>
<span class="c"># from django.conf.urls import url</span>
<span class="c"># from rest_framework.urlpatterns import format_suffix_patterns</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># # 将一个字典参数传递给as_view() 方法</span>
<span class="c"># # 这种方法可以直接在 url 中定义了 ViewSet 可以支持的请求方法</span>
<span class="c"># snippet_list = SnippetViewSet.as_view({</span>
<span class="c">#     # 这里字典中的值是固定用法, 需要照着用就可以了.</span>
<span class="c">#     'get': 'list',</span>
<span class="c">#     'post': 'create',</span>
<span class="c"># })</span>
<span class="c"># # }, renderer_class=[renderers.StaticHTMLRenderer])</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># snippet_detail = SnippetViewSet.as_view({</span>
<span class="c">#     'get': 'retrieve',</span>
<span class="c">#     'put': 'update',</span>
<span class="c">#     'patch': 'partial_update',</span>
<span class="c">#     'delete': 'destroy',</span>
<span class="c"># })</span>
<span class="c">#</span>
<span class="c"># snippet_highlight = SnippetViewSet.as_view({</span>
<span class="c">#     'get': 'highlight',</span>
<span class="c"># })</span>
<span class="c">#</span>
<span class="c"># user_list = UserViewSet.as_view({</span>
<span class="c">#     'get': 'list',</span>
<span class="c">#     'post': 'create',</span>
<span class="c"># })</span>
<span class="c">#</span>
<span class="c"># user_detail = UserViewSet.as_view({</span>
<span class="c">#     'get': 'retrieve',</span>
<span class="c">#     'put': 'update',</span>
<span class="c">#     'patch': 'partial_update',</span>
<span class="c">#     'delete': 'destroy',</span>
<span class="c"># })</span>
<span class="c">#</span>
<span class="c"># urlpatterns = format_suffix_patterns([</span>
<span class="c">#     url(r'^$', api_root),</span>
<span class="c">#     url(r'^snippets/$', snippet_list, name='snippet-list'),</span>
<span class="c">#     url(r'^snippets/(?P&lt;pk&gt;[0-9]+)/$', snippet_detail, name='snippet-detail'),</span>
<span class="c">#     url(r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$', snippet_highlight, name='snippet-highlight'),</span>
<span class="c">#     url(r'^users/$', user_list, name='user-list'),</span>
<span class="c">#     url(r'^users/(?P&lt;pk&gt;[0-9]+)/$', user_detail, name='user-detail'),</span>
<span class="c"># ])</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>



<span class="c"># 第四级 urls.py</span>
<span class="c"># from django.conf.urls import url</span>
<span class="c"># from snippetsapp import views</span>
<span class="c"># from rest_framework.urlpatterns import format_suffix_patterns</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c"># urlpatterns = [</span>
<span class="c">#     # url(r'^snippets/$', views.snippet_list),</span>
<span class="c">#     url(r'^snippets/$', views.SnippetList.as_view(), name='snippet-list'),</span>
<span class="c">#     # url(r'^snippets/(?P&lt;pk&gt;[0-9]+)/$', views.snippet_detail),</span>
<span class="c">#     url(r'^snippets/(?P&lt;pk&gt;[0-9]+)/$', views.SnippetDetail.as_view(), name='snippet-detail'),</span>
<span class="c">#     url(r'^users/$', views.UserList.as_view(), name='user-list'),</span>
<span class="c">#     url(r'^users/(?P&lt;pk&gt;[0-9]+)/$', views.UserDetail.as_view(), name='user-detail'),</span>
<span class="c">#     url(r'^snippets/(?P&lt;pk&gt;[0-9]+)/highlight/$', views.SnippetHighlight.as_view(), name='snippet-highlight'),</span>
<span class="c">#     url(r'^$', views.api_root),</span>
<span class="c"># ]</span>
<span class="c">#</span>
<span class="c"># urlpatterns = format_suffix_patterns(urlpatterns)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>修改主项目的urls.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="c"># from rest_framework import routers</span>
<span class="c"># from quickstartapp import views</span>
<span class="c">#</span>
<span class="c"># router = routers.DefaultRouter()</span>
<span class="c"># router.register(r'users', views.UserViewSet)</span>
<span class="c"># router.register(r'groups', views.GroupViewSet)</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="c"># url(r'^', include(router.urls)),</span>
    <span class="c"># url(r'^', include('snippetsapp.urls')),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^helloworld/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'quickstartapp.urls'</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'snippetsapp.urls'</span><span class="p">)),</span>
    <span class="c"># 将登陆/登出 的请求转发到 rest_framework 的 urls进行处理</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api-auth/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'rest_framework.urls'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">'rest_framework'</span><span class="p">)),</span>

<span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>获取完整列表</em></p>

<ul>
  <li>浏览器访问 http://127.0.0.1:8000/snippets/</li>
  <li>或者通过 http 命令</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>http http://127.0.0.1:8000/snippets/
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>输出如下:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="p">[{</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="s">"code"</span><span class="p">:</span> <span class="s">"hello world"</span><span class="p">,</span> <span class="s">"linenos"</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"python"</span><span class="p">,</span> <span class="s">"style"</span><span class="p">:</span> <span class="s">"friendly"</span><span class="p">},</span> <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="s">"code"</span><span class="p">:</span> <span class="s">"good bye"</span><span class="p">,</span> <span class="s">"linenos"</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"python"</span><span class="p">,</span> <span class="s">"style"</span><span class="p">:</span> <span class="s">"friendly"</span><span class="p">},</span> <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="s">"code"</span><span class="p">:</span> <span class="s">"good bye"</span><span class="p">,</span> <span class="s">"linenos"</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"python"</span><span class="p">,</span> <span class="s">"style"</span><span class="p">:</span> <span class="s">"friendly"</span><span class="p">},</span> <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">"title"</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="s">"code"</span><span class="p">:</span> <span class="s">"good bye"</span><span class="p">,</span> <span class="s">"linenos"</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"python"</span><span class="p">,</span> <span class="s">"style"</span><span class="p">:</span> <span class="s">"friendly"</span><span class="p">}]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>创建一条数据</em></p>

<ul>
  <li>准备JSON 数据文件 <code class="language-plaintext highlighter-rouge">src.json</code> 如下</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>{
    "code": "http 创建的数据"
}
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>使用http 命令创建数据</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>http POST http://127.0.0.1:8000/snippets/ &lt; src.json &gt; output.html
<span class="c"># 如果参数比较少, 可以直接在命令行中加上要传递的参数</span>
http POST http://127.0.0.1:8000/snippets/ <span class="nv">code</span><span class="o">=</span>himan
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>获取某一条数据</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>http http://127.0.0.1:8000/snippets/2/
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>OUTPUT:</li>
</ul>

<pre><code class="language-JSON">TTP/1.1 200 OK
Content-Length: 115
Content-Type: application/json
Date: Tue, 30 Jan 2018 10:23:54 GMT
Server: WSGIServer/0.2 CPython/3.7.0a2
X-Frame-Options: SAMEORIGIN

{
    "code": "good bye",
    "id": 2,
    "language": "python",
    "linenos": false,
    "style": "friendly",
    "title": ""
}
</code></pre>

<p><em>更新一条数据</em></p>

<ul>
  <li>先准备一个json 文本 <code class="language-plaintext highlighter-rouge">update.json</code> 如下:</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"good morning"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"linenos"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"style"</span><span class="p">:</span><span class="w"> </span><span class="s2">"friendly"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my title"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>用 http 执行更新命令如下:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>http PUT http://127.0.0.1:8000/snippets/2/ &lt; update.json
<span class="c"># 如果数据简单, 那么可以直接在命令行中添加要更改的数据</span>
http PUT http://127.0.0.1:8000/snippets/2/ <span class="nv">code</span><span class="o">=</span>hi222 <span class="nv">title</span><span class="o">=</span>222
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>输出:</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="err">Content-Length:</span><span class="w"> </span><span class="mi">115</span><span class="w">
</span><span class="err">Content-Type:</span><span class="w"> </span><span class="err">application/json</span><span class="w">
</span><span class="err">Date:</span><span class="w"> </span><span class="err">Tue,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="err">Jan</span><span class="w"> </span><span class="mi">2018</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">18</span><span class="err">:</span><span class="mi">41</span><span class="w"> </span><span class="err">GMT</span><span class="w">
</span><span class="err">Server:</span><span class="w"> </span><span class="err">WSGIServer/</span><span class="mf">0.2</span><span class="w"> </span><span class="err">CPython/</span><span class="mf">3.7</span><span class="err">.</span><span class="mi">0</span><span class="err">a</span><span class="mi">2</span><span class="w">
</span><span class="err">X-Frame-Options:</span><span class="w"> </span><span class="err">SAMEORIGIN</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"good morning"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"linenos"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"style"</span><span class="p">:</span><span class="w"> </span><span class="s2">"friendly"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my title"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
</div>

<p><em>删除一条数据</em></p>

<ul>
  <li>用http 执行如下命令</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>http DELETE http://127.0.0.1:8000/snippets/3/
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>输出:</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="err">HTTP/</span><span class="mf">1.1</span><span class="w"> </span><span class="mi">204</span><span class="w"> </span><span class="err">No</span><span class="w"> </span><span class="err">Content</span><span class="w">
</span><span class="err">Content-Length:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="err">Content-Type:</span><span class="w"> </span><span class="err">text/html;</span><span class="w"> </span><span class="err">charset=utf</span><span class="mi">-8</span><span class="w">
</span><span class="err">Date:</span><span class="w"> </span><span class="err">Tue,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="err">Jan</span><span class="w"> </span><span class="mi">2018</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">22</span><span class="err">:</span><span class="mi">28</span><span class="w"> </span><span class="err">GMT</span><span class="w">
</span><span class="err">Server:</span><span class="w"> </span><span class="err">WSGIServer/</span><span class="mf">0.2</span><span class="w"> </span><span class="err">CPython/</span><span class="mf">3.7</span><span class="err">.</span><span class="mi">0</span><span class="err">a</span><span class="mi">2</span><span class="w">
</span><span class="err">X-Frame-Options:</span><span class="w"> </span><span class="err">SAMEORIGIN</span><span class="w">

</span></pre></td></tr></tbody></table>
</div>
</div>

<h3 id="前端代码">前端代码</h3>

<p>(1). settings.py 增加如下代码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
	<span class="o">...</span>
    <span class="s">'corsheaders'</span><span class="p">,</span>
	<span class="o">...</span>
<span class="p">]</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">...</span>
  <span class="s">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="p">,</span>
  <span class="s">'corsheaders.middleware.CorsMiddleware'</span><span class="p">,</span>
  <span class="o">...</span>
  
<span class="p">]</span>

<span class="n">CORS_ORIGIN_ALLOW_ALL</span> <span class="o">=</span> <span class="bp">True</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>(2). 将front 代码包放到任意目录下</p>

<p>(3). 设置 index.js 中的url地址和端口号, 对应到snippets 服务的url 和 端口</p>

<p>(4). 浏览器中打开 index.html 就可以看到snippet应用了.</p>

<h2 id="卖电脑的电商项目">卖电脑的电商项目</h2>

<p><em>创建 eshop 项目 和 computerapp</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>django-admin startproject eshop .
python3.7 manage.py startapp computerapp
python3.7 manage.py migrate
python3.7 manage.py createsuperuser
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>设置 settings.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
  	<span class="o">...</span>
    <span class="s">'rest_framework'</span><span class="p">,</span>
  	<span class="s">'corsheaders'</span><span class="p">,</span> <span class="c"># 跨域保护</span>
    <span class="s">'computerapp.apps.ComputerappConfig'</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
  <span class="o">...</span>
 	<span class="s">'corsheaders.middleware.CorsMiddleware'</span><span class="p">,</span> <span class="c"># 跨域保护 </span>
  <span class="o">...</span>
<span class="p">]</span>
<span class="c"># 任何人都可以访问我们的网站</span>
<span class="n">CORS_ORIGIN_ALLOW_ALL</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">'/media/'</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">),</span> <span class="s">'estore'</span><span class="p">,</span> <span class="s">'eshop'</span><span class="p">,</span> <span class="s">'media'</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>创建静态文件 目录 <code class="language-plaintext highlighter-rouge">estore/eshop/media</code></em></p>

<p><em>建模 <code class="language-plaintext highlighter-rouge">cumputerapp/models.py</code></em></p>

<ul>
  <li>分类</li>
  <li>厂商</li>
  <li>产品</li>
  <li>收货地址</li>
  <li>用户扩展</li>
  <li>订单</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="c"># Create your models here.</span>


<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    商品类别: 笔记本, 平板电脑, 一体机, 台式机, 服务器等
    """</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'类别名称'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'创建时间'</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'更新时间'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Manufacturer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    生产厂商
    """</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"厂商名称"</span><span class="p">)</span>
    <span class="n">description</span><span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'品牌描述'</span><span class="p">)</span>
    <span class="c"># ImageField 图片类型字段</span>
    <span class="c"># upload_to 表示要上传到的位置.</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">'manufacturer/uploads/</span><span class="si">%</span><span class="s">Y/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d/'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'品牌图标'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'创建时间'</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'更新时间'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    产品
    """</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品名称'</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品描述'</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">'product/uploads/</span><span class="si">%</span><span class="s">Y/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d/'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品图片'</span><span class="p">)</span>
    <span class="c"># DecimalField 带小数类型数字字段,</span>
    <span class="c"># max_digits = 12 表示小数点前后共12位.</span>
    <span class="c"># decimal_places = 2 小输掉保留两位</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品价格'</span><span class="p">)</span>
    <span class="c"># PositiveIntegerField 正整数类型字段</span>
    <span class="c"># sold 是销量</span>
    <span class="n">sold</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品销量'</span><span class="p">)</span>
    <span class="c"># product_in 表示产品属于 ... 类目</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'product_in'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品分类'</span><span class="p">)</span>
    <span class="c"># product_of 表示产品属于 ... 品牌</span>
    <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Manufacturer</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'product_of'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品生产厂商'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'创建时间'</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'更新时间'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>


<span class="k">class</span> <span class="nc">DeliveryAddress</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    收货地址
    """</span>
    <span class="c"># settings.AUTH_USER_MODEL 是认证用户模型, 推荐使用</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'delivery_address_of'</span><span class="p">)</span>
    <span class="n">contact_person</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">contact_mobile_phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">delivery_address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delivery_address</span>



<span class="k">class</span> <span class="nc">UserProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    用户扩展信息
    """</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'profile_of'</span><span class="p">)</span>
    <span class="n">mobile_phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">'user/uploads/</span><span class="si">%</span><span class="s">Y/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d/'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">delivery_address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'user_delivery_address'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    Order 订单
    """</span>
    <span class="c"># 订单状态</span>
    <span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">'0'</span><span class="p">,</span> <span class="s">'new'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'not paid'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'2'</span><span class="p">,</span> <span class="s">'paid'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'transport'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'4'</span><span class="p">,</span> <span class="s">'closed'</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'0'</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'order_of'</span><span class="p">,)</span>
    <span class="c"># 产品详情描述</span>
    <span class="n">remark</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Product</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'order_product'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'order_address'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'order of </span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>重新迁移</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>python3.7 manage.py makemigrations
python3.7 manage.py migrate
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>设置 <code class="language-plaintext highlighter-rouge">serializers.py</code> 文件</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">computerapp.models</span> <span class="kn">import</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Manufacturer</span><span class="p">,</span> <span class="n">UserProfile</span><span class="p">,</span> <span class="n">DeliveryAddress</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>


<span class="c"># 自定义的用户信息的序列器</span>
<span class="k">class</span> <span class="nc">UserProfileSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserProfile</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'mobile_phone'</span><span class="p">,</span> <span class="s">'nickname'</span><span class="p">,</span> <span class="s">'description'</span><span class="p">,</span> <span class="s">'icon'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,)</span>
        <span class="c"># 这里定义了user 字段是只读. 因为user 的属性是 OneToOneField</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'user'</span><span class="p">,</span> <span class="p">)</span>


<span class="c"># django 框架自带的用户信息的序列器</span>
<span class="k">class</span> <span class="nc">UserInfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="c"># 从自定义的用户信息序列器中获取自定义的用户信息, 然后合并到框架的用户信息中.</span>
    <span class="n">profile_of</span> <span class="o">=</span> <span class="n">UserProfileSerializer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="c"># 这里的 profile_of 是在 models.py 中定义了 user 字段的 related_name='profile_of'</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'first_name'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'date_joined'</span><span class="p">,</span> <span class="s">'profile_of'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">ProductListSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Product</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'model'</span><span class="p">,</span> <span class="s">'description'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,</span> <span class="s">'image'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">CategorySerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">ManufacturerSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Manufacturer</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">ProductRetrieveSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="c"># 下面两行可以注释掉, 但是产品详情就不会显示和产品相关的类目详细信息和厂商详细信息</span>
    <span class="c"># 下面梁行代码也可以通过 HyperLinkedIdentifiedField, HpyerLinkedRelatedField, 但是下面这种方法更好.</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">CategorySerializer</span><span class="p">()</span>
    <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">ManufacturerSerializer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Product</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'model'</span><span class="p">,</span> <span class="s">'description'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,</span> <span class="s">'image'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">DeliveryAddressSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">DeliveryAddress</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'contact_person'</span><span class="p">,</span> <span class="s">'contact_mobile_phone'</span><span class="p">,</span> <span class="s">'delivery_address'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,)</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'user'</span><span class="p">,)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>设置 views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">generics</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span>
<span class="kn">from</span> <span class="nn">rest_framework.filters</span> <span class="kn">import</span> <span class="n">OrderingFilter</span><span class="p">,</span> <span class="n">SearchFilter</span>
<span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">LimitOffsetPagination</span>
<span class="kn">from</span> <span class="nn">computerapp.models</span> <span class="kn">import</span> <span class="n">Product</span><span class="p">,</span> <span class="n">UserProfile</span><span class="p">,</span> <span class="n">DeliveryAddress</span>
<span class="kn">from</span> <span class="nn">computerapp.serializers</span> <span class="kn">import</span> <span class="n">ProductListSerializer</span><span class="p">,</span> <span class="n">ProductRetrieveSerializer</span><span class="p">,</span> <span class="n">UserInfoSerializer</span><span class="p">,</span> <span class="n">UserProfileSerializer</span><span class="p">,</span> <span class="n">DeliveryAddressSerializer</span>
<span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>


<span class="k">class</span> <span class="nc">ProductListView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品列表
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>
    <span class="c"># 可以过滤的后台, 第一个参数表示搜索功能, 第二个表示排序功能. 这两个参数是固定用法.</span>
    <span class="c"># 增加该字段后, API UI 出现一个 filters 功能</span>
    <span class="c"># 前端通过 GET /computer/product_list/?ordering=category&amp;search=%E5%B9%B3%E6%9D%BF 调用</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">OrderingFilter</span><span class="p">,)</span>
    <span class="c"># 这里是设置具体的可搜索字段.</span>
    <span class="c"># 如果不设置, 默认返回所有列表数据</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'description'</span><span class="p">,</span> <span class="s">'model'</span><span class="p">)</span>
    <span class="c"># 这里是设置具体的可排序字段</span>
    <span class="c"># 如果不设置, 那么默认所有字段都可以排序</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,)</span>
    <span class="c"># 设置默认排序是id</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,)</span>
    <span class="c"># 指定分页方式为 LimitOffsetPagination, 这种方式的</span>
    <span class="c"># 之前的另一种 方式 PageNumberPagination 也可以用</span>
    <span class="c"># PageNumberPagination 方式 是显示页码为数字的方式(每页显示的个数是配置文件中 PAGE_SIZE 设置死的),</span>
    <span class="c"># LimitOffsetPagination 可以灵活的, 客户端可以通过携带 ?limit=2&amp;offset=6 参数设置每页显示2条数据, 显示第4页</span>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">LimitOffsetPagination</span>


<span class="k">class</span> <span class="nc">ProductListByCategoryView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品按类别展示列表
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">OrderingFilter</span><span class="p">,)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'description'</span><span class="p">,)</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,</span> <span class="s">'stock'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,)</span>

    <span class="c"># 和 上面 ProductListView 类的区别就是用 get_queryset() 方法 代替了 queryset 属性, 重写了列表获取的条件</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 获取列表的条件是先获取 request 传递过来的 分类的的id</span>
        <span class="c"># query_params 表示查询参数. 前端可以通过GET 或者 POST 方式发送参数. 比如GET ?category=1 , 或者POST 过来的 category 的值</span>
        <span class="c"># 如果没有拿到值, 默认值是 None</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="c"># 如果传递过来的信息非空 就进行过滤, 否则全部显示</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">queryset</span>


<span class="k">class</span> <span class="nc">ProductListByCategoryManufacturerView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品按类别并按品牌展示列表
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">OrderingFilter</span><span class="p">,)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'description'</span><span class="p">,)</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,</span> <span class="s">'stock'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 先获取分类id 和 厂商id</span>
        <span class="c"># 调用方法例子GET: ?category=1&amp;manufacturer=1  或者 POST 传递这两个参数</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">manufacturer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'manufacturer'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">manufacturer</span><span class="o">=</span><span class="n">manufacturer</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">queryset</span>


<span class="k">class</span> <span class="nc">ProductRetrieveView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">RetrieveAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品详情
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductRetrieveSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">UserInfoView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="s">"""
    用户基本信息
    """</span>
    <span class="n">permissions_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="c"># 定义 GET 方法发送过来的数据的处理方法</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># 获取当前用户对象, 无法获取其他用户信息.</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">UserInfoSerializer</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserProfileRUView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">RetrieveUpdateAPIView</span><span class="p">):</span>
    <span class="s">"""
    用户其他信息更新获取
    """</span>
    <span class="c"># 不能用下一行代码, 因为会让API 直接访问到其他用户的信息, 而不是当前用户的信息. 比如: http://127.0.0.1:8001/computer/user_profile_ru/2/</span>
    <span class="c"># queryset = UserProfile.objects.all()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserProfileSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="c"># 下面方法是用来限制用户只能访问自己的信息.</span>
    <span class="c"># get_object 用来只返回一个对象</span>
    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 获取当前用户.</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="c"># 通过当前用户,获取当前用户档案</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">UserProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>


<span class="k">class</span> <span class="nc">DeliveryAddressLCView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListCreateAPIView</span><span class="p">):</span>
    <span class="s">"""
    收货地址LC
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">DeliveryAddressSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">DeliveryAddress</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span>

    <span class="k">def</span> <span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">profile_of</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">delivery_address</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p><em>设置两个<code class="language-plaintext highlighter-rouge">urls.py</code> 文件</em></p>

<p><code class="language-plaintext highlighter-rouge">eshop/urls.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">rest_framework.authtoken</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^computer/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'computerapp.urls'</span><span class="p">)),</span>
    <span class="c"># 让用户可以在API UI 上进行登录,登出</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api-auth'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'rest_framework.urls'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">'rest_framework'</span><span class="p">)),</span>
    <span class="c"># 让客户端可以通过API 的方式进行登录注册, 只能通过POST 方式提交</span>
    <span class="c"># 如果获取到token 信息, 就跳转</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api-token-auth'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">obtain_auth_token</span><span class="p">),</span>

<span class="p">]</span>

<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">computerapp/urls.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">rest_framework.urlpatterns</span> <span class="kn">import</span> <span class="n">format_suffix_patterns</span>
<span class="kn">from</span> <span class="nn">computerapp</span> <span class="kn">import</span> <span class="n">views</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^product_list/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ProductListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'product_list'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^product_retrieve/(?P&lt;pk&gt;[0-9]+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ProductRetrieveView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'product_retrieve'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^product_list_by_category/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ProductListByCategoryView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'product_list_by_category'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^product_list_by_category_manufacturer/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ProductListByCategoryManufacturerView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'product_list_by_category_manufacturer'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^user_info/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserInfoView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'user_info'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^user_profile_ru/(?P&lt;pk&gt;[0-9]+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">UserProfileRUView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'user_profile_ru'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^delivery_address_lc/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">DeliveryAddressLCView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'delivery_address_lc'</span><span class="p">),</span>

<span class="p">]</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">format_suffix_patterns</span><span class="p">(</span><span class="n">urlpatterns</span><span class="p">,</span> <span class="n">allowed</span><span class="o">=</span><span class="p">[</span><span class="s">'api'</span><span class="p">,</span> <span class="s">'json'</span><span class="p">,</span> <span class="p">])</span>



</pre></td></tr></tbody></table>
</div>
</div>

<p><em>再修改settings.py</em></p>

<ul>
  <li>增加翻页</li>
  <li>列表页的搜索过滤</li>
  <li>增加默认访问权限管理</li>
  <li>增加认证</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre>
<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
	<span class="o">...</span>
  	<span class="s">'django_filters'</span><span class="p">,</span> <span class="c"># 列表中用到的搜索排序功能</span>
    <span class="s">'rest_framework.authtoken'</span><span class="p">,</span> <span class="c"># 登录认证用的token</span>
  	<span class="o">...</span>
<span class="p">]</span>



<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'DEFAULT_PAGINATION_CLASS'</span><span class="p">:</span> <span class="s">'rest_framework.pagination.PageNumberPagination'</span><span class="p">,</span>
    <span class="s">'PAGE_SIZE'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s">'DEFAULT_PERMISSION_CLASSES'</span><span class="p">:</span> <span class="p">(</span>
        <span class="c"># 不写下面这一行, 默认也是 AllowAny</span>
        <span class="s">'rest_framework.permissions.AllowAny'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="p">:</span> <span class="p">(</span>
        <span class="s">'rest_framework.authentication.BasicAuthentication'</span><span class="p">,</span> <span class="c"># 最基本的验证方式</span>
        <span class="s">'rest_framework.authentication.SessionAuthentication'</span><span class="p">,</span> <span class="c"># Session 验证方式, 用于前后端一体的情况下使用</span>
        <span class="s">'rest_framework.authentication.TokenAuthentication'</span><span class="p">,</span> <span class="c"># Token验证方式, 用于前后端分离.</span>
    <span class="p">),</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>为token 功能重新迁移</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>python3.7 manage.py makemigrations
python3.7 manage.py migrate
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>数据库中会新建一个表 authtoken_token</li>
  <li>表中三个字段, key(token), created, user_id</li>
</ul>

<p><em>测试 token 功能</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>http POST http://127.0.0.1:8001/api-token-auth/ <span class="nv">username</span><span class="o">=</span>xiaolong <span class="nv">password</span><span class="o">=</span>password123
<span class="c"># 返回内容如下</span>
<span class="c"># {</span>
<span class="c">#     "token": "44a75a6fd2c35f5f4a62c031af1a790c1641b3ea"</span>
<span class="c"># }</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>启动服务, 前端代码要求是 8001 端口</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py runserver
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>将客户端用的js, html, css 代码包 <code class="language-plaintext highlighter-rouge">front</code> 拷贝到项目目录中</em></p>

<p>如果后台服务正常, 那么, 打开front/index.html 就应该可以直接连接到服务端了.</p>

<h3 id="最终代码">最终代码</h3>

<h4 id="eshopsettingspy">eshop/settings.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">os</span>

<span class="c"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span>
<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>


<span class="c"># Quick-start development settings - unsuitable for production</span>
<span class="c"># See https://docs.djangoproject.com/en/2.0/howto/deployment/checklist/</span>

<span class="c"># SECURITY WARNING: keep the secret key used in production secret!</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">'f7n$1*n!+v-fxhtibh=in6$</span><span class="si">%</span><span class="s">&amp;73=1$ugg#r1&amp;vvo&amp;b&amp;9=q+7cs'</span>

<span class="c"># SECURITY WARNING: don't run with debug turned on in production!</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>


<span class="c"># Application definition</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>
    <span class="s">'rest_framework'</span><span class="p">,</span>
    <span class="s">'rest_framework.authtoken'</span><span class="p">,</span> <span class="c"># 登录认证用的token</span>
    <span class="s">'django_filters'</span><span class="p">,</span>
    <span class="s">'corsheaders'</span><span class="p">,</span> <span class="c"># 跨域保护</span>
    <span class="s">'computerapp.apps.ComputerappConfig'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.middleware.security.SecurityMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="p">,</span>
    <span class="s">'corsheaders.middleware.CorsMiddleware'</span><span class="p">,</span> <span class="c"># 跨域保护</span>
    <span class="s">'django.middleware.common.CommonMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.csrf.CsrfViewMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.auth.middleware.AuthenticationMiddleware'</span><span class="p">,</span>
    <span class="s">'django.contrib.messages.middleware.MessageMiddleware'</span><span class="p">,</span>
    <span class="s">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s">'eshop.urls'</span>

<span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">'BACKEND'</span><span class="p">:</span> <span class="s">'django.template.backends.django.DjangoTemplates'</span><span class="p">,</span>
        <span class="s">'DIRS'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s">'APP_DIRS'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">'OPTIONS'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'context_processors'</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">'django.template.context_processors.debug'</span><span class="p">,</span>
                <span class="s">'django.template.context_processors.request'</span><span class="p">,</span>
                <span class="s">'django.contrib.auth.context_processors.auth'</span><span class="p">,</span>
                <span class="s">'django.contrib.messages.context_processors.messages'</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s">'eshop.wsgi.application'</span>


<span class="c"># Database</span>
<span class="c"># https://docs.djangoproject.com/en/2.0/ref/settings/#databases</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.sqlite3'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'db.sqlite3'</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c"># Password validation</span>
<span class="c"># https://docs.djangoproject.com/en/2.0/ref/settings/#auth-password-validators</span>

<span class="n">AUTH_PASSWORD_VALIDATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.MinimumLengthValidator'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.CommonPasswordValidator'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'django.contrib.auth.password_validation.NumericPasswordValidator'</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>


<span class="c"># Internationalization</span>
<span class="c"># https://docs.djangoproject.com/en/2.0/topics/i18n/</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">'en-us'</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">'Asia/Shanghai'</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">USE_TZ</span> <span class="o">=</span> <span class="bp">False</span>


<span class="c"># Static files (CSS, JavaScript, Images)</span>
<span class="c"># https://docs.djangoproject.com/en/2.0/howto/static-files/</span>

<span class="n">STATIC_URL</span> <span class="o">=</span> <span class="s">'/static/'</span>

<span class="n">CORS_ORIGIN_ALLOW_ALL</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">'/media/'</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">),</span> <span class="s">'estore'</span><span class="p">,</span> <span class="s">'eshop'</span><span class="p">,</span> <span class="s">'media'</span><span class="p">)</span>

<span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'DEFAULT_PAGINATION_CLASS'</span><span class="p">:</span> <span class="s">'rest_framework.pagination.PageNumberPagination'</span><span class="p">,</span>
    <span class="s">'PAGE_SIZE'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s">'DEFAULT_PERMISSION_CLASSES'</span><span class="p">:</span> <span class="p">(</span>
        <span class="c"># 不写下面这一行, 默认也是 AllowAny</span>
        <span class="s">'rest_framework.permissions.AllowAny'</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="p">:</span> <span class="p">(</span>
        <span class="s">'rest_framework.authentication.BasicAuthentication'</span><span class="p">,</span> <span class="c"># 最基本的验证方式</span>
        <span class="s">'rest_framework.authentication.SessionAuthentication'</span><span class="p">,</span> <span class="c"># Session 验证方式, 用于前后端一体的情况下使用</span>
        <span class="s">'rest_framework.authentication.TokenAuthentication'</span><span class="p">,</span> <span class="c"># Token验证方式, 用于前后端分离.</span>
    <span class="p">),</span>
    <span class="c"># 节流类 - 限制用户访问次数</span>
    <span class="s">'DEFAULT_THROTTLE_CLASSES'</span><span class="p">:</span> <span class="p">(</span>
        <span class="s">'rest_framework.throttling.AnonRateThrottle'</span><span class="p">,</span>  <span class="c"># 匿名用户节流类</span>
        <span class="s">'rest_framework.throttling.UserRateThrottle'</span>   <span class="c"># 登录用户节流类</span>
    <span class="p">),</span>
    <span class="s">'DEFAULT_THROTTLE_RATES'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'anon'</span><span class="p">:</span> <span class="s">'100/day'</span><span class="p">,</span> <span class="c"># 限制匿名用户每天访问次数不超过100次</span>
        <span class="s">'user'</span><span class="p">:</span> <span class="s">'1000/day'</span> <span class="c"># 登录用户同一个用户限制每天不超过1000次(所有页面)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="n">SEARCH_PARAM</span> <span class="o">=</span> <span class="s">'se222'</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="eshopurlspy">eshop/urls.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><pre><span class="s">"""eshop URL Configuration

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/2.0/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.conf.urls.static</span> <span class="kn">import</span> <span class="n">static</span>
<span class="kn">from</span> <span class="nn">rest_framework.authtoken</span> <span class="kn">import</span> <span class="n">views</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^computer/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'computerapp.urls'</span><span class="p">)),</span>
    <span class="c"># 让用户可以在API UI 上进行登录,登出</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api-auth'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'rest_framework.urls'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s">'rest_framework'</span><span class="p">)),</span>
    <span class="c"># 让客户端可以通过API 的方式进行登录注册, 只能通过POST 方式提交</span>
    <span class="c"># 如果获取到token 信息, 就跳转</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^api-token-auth'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">obtain_auth_token</span><span class="p">),</span>

<span class="p">]</span>

<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">static</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>



</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="computerappmodelspy">computerapp/models.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="c"># Create your models here.</span>


<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    商品类别: 笔记本, 平板电脑, 一体机, 台式机, 服务器等
    """</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'类别名称'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'创建时间'</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'更新时间'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Manufacturer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    生产厂商
    """</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"厂商名称"</span><span class="p">)</span>
    <span class="n">description</span><span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'品牌描述'</span><span class="p">)</span>
    <span class="c"># ImageField 图片类型字段</span>
    <span class="c"># upload_to 表示要上传到的位置.</span>
    <span class="n">logo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">'manufacturer/uploads/</span><span class="si">%</span><span class="s">Y/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d/'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'品牌图标'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'创建时间'</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'更新时间'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    产品
    """</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品名称'</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品描述'</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">'product/uploads/</span><span class="si">%</span><span class="s">Y/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d/'</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品图片'</span><span class="p">)</span>
    <span class="c"># DecimalField 带小数类型数字字段,</span>
    <span class="c"># max_digits = 12 表示小数点前后共12位.</span>
    <span class="c"># decimal_places = 2 小输掉保留两位</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品价格'</span><span class="p">)</span>
    <span class="c"># PositiveIntegerField 正整数类型字段</span>
    <span class="c"># sold 是销量</span>
    <span class="n">sold</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品销量'</span><span class="p">)</span>
    <span class="c"># product_in 表示产品属于 ... 类目</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'product_in'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品分类'</span><span class="p">)</span>
    <span class="c"># product_of 表示产品属于 ... 品牌</span>
    <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Manufacturer</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'product_of'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'产品生产厂商'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'创建时间'</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'更新时间'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>


<span class="k">class</span> <span class="nc">DeliveryAddress</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    收货地址
    """</span>
    <span class="c"># settings.AUTH_USER_MODEL 是认证用户模型, 推荐使用</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'delivery_address_of'</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">contact_person</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">contact_mobile_phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">delivery_address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delivery_address</span>


<span class="k">class</span> <span class="nc">UserProfile</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    用户扩展信息
    """</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'profile_of'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">mobile_phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">nickname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">upload_to</span><span class="o">=</span><span class="s">'user/uploads/</span><span class="si">%</span><span class="s">Y/</span><span class="si">%</span><span class="s">m/</span><span class="si">%</span><span class="s">d/'</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">delivery_address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'user_delivery_address'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="p">)</span>


<span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="s">"""
    Order 订单
    """</span>
    <span class="c"># 订单状态</span>
    <span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s">'0'</span><span class="p">,</span> <span class="s">'new'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'not paid'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'2'</span><span class="p">,</span> <span class="s">'paid'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'transport'</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'4'</span><span class="p">,</span> <span class="s">'closed'</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">'0'</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">AUTH_USER_MODEL</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'order_of'</span><span class="p">,)</span>
    <span class="c"># 产品详情描述</span>
    <span class="n">remark</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Product</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'order_product'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s">'order_address'</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DO_NOTHING</span><span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'order of </span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">,)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="computerappadminpy">computerapp/admin.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Manufacturer</span><span class="p">,</span> <span class="n">Product</span><span class="p">,</span> <span class="n">UserProfile</span><span class="p">,</span> <span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">Order</span>
<span class="c"># Register your models here.</span>


<span class="k">class</span> <span class="nc">CategoryAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,]</span>


<span class="k">class</span> <span class="nc">ManuFacturerAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,]</span>


<span class="k">class</span> <span class="nc">ProductAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'model'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,]</span>
    <span class="n">list_editable</span> <span class="o">=</span> <span class="p">[</span><span class="s">'price'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,</span> <span class="s">'category'</span><span class="p">,]</span>


<span class="k">class</span> <span class="nc">DeliveryAddressAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'contact_person'</span><span class="p">,</span> <span class="s">'contact_mobile_phone'</span><span class="p">,</span> <span class="s">'delivery_address'</span><span class="p">,]</span>


<span class="k">class</span> <span class="nc">UserProfileAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'mobile_phone'</span><span class="p">,</span> <span class="s">'nickname'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,]</span>


<span class="k">class</span> <span class="nc">OrderAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'status'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,]</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">CategoryAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Manufacturer</span><span class="p">,</span> <span class="n">ManuFacturerAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Product</span><span class="p">,</span> <span class="n">ProductAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">DeliveryAddressAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">UserProfile</span><span class="p">,</span> <span class="n">UserProfileAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Order</span><span class="p">,</span> <span class="n">OrderAdmin</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="computerappserializerspy">computerapp/serializers.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">computerapp.models</span> <span class="kn">import</span> <span class="n">Product</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Manufacturer</span><span class="p">,</span> <span class="n">UserProfile</span><span class="p">,</span> <span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">Order</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>


<span class="c"># 自定义的用户信息的序列器</span>
<span class="k">class</span> <span class="nc">UserProfileSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">UserProfile</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'mobile_phone'</span><span class="p">,</span> <span class="s">'nickname'</span><span class="p">,</span> <span class="s">'description'</span><span class="p">,</span> <span class="s">'icon'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,</span> <span class="s">'delivery_address'</span><span class="p">,)</span>
        <span class="c"># 这里定义了user 字段是只读. 因为user 的属性是 OneToOneField</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'user'</span><span class="p">,</span> <span class="p">)</span>


<span class="c"># django 框架自带的用户信息的序列器</span>
<span class="k">class</span> <span class="nc">UserInfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="c"># 从自定义的用户信息序列器中获取自定义的用户信息, 然后合并到框架的用户信息中.</span>
    <span class="n">profile_of</span> <span class="o">=</span> <span class="n">UserProfileSerializer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="c"># 这里的 profile_of 是在 models.py 中定义了 user 字段的 related_name='profile_of'</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'first_name'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'date_joined'</span><span class="p">,</span> <span class="s">'profile_of'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">UserSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">User</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'password'</span><span class="p">,</span> <span class="s">'last_name'</span><span class="p">,</span> <span class="s">'first_name'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="p">)</span>
        <span class="c"># extra_kwargs 定义 额外的关键词参数</span>
        <span class="c"># 目的是让 password 字段只能写, 但不是显示, 是专门为密码使用.</span>
        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">'password'</span><span class="p">:</span> <span class="p">{</span><span class="s">'write_only'</span><span class="p">:</span> <span class="bp">True</span><span class="p">}}</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>
        <span class="c"># 这里的set_password 是将传过来的密码进行加密, 然后再存入数据库</span>
        <span class="n">user</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="n">validated_data</span><span class="p">[</span><span class="s">'password'</span><span class="p">])</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="n">user_profile</span> <span class="o">=</span> <span class="n">UserProfile</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="n">user_profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">user</span>


<span class="k">class</span> <span class="nc">ProductListSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Product</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'model'</span><span class="p">,</span> <span class="s">'description'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,</span> <span class="s">'image'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">CategorySerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">ManufacturerSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Manufacturer</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">ProductRetrieveSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="c"># 下面两行可以注释掉, 但是产品详情就不会显示和产品相关的类目详细信息和厂商详细信息</span>
    <span class="c"># 下面梁行代码也可以通过 HyperLinkedIdentifiedField, HpyerLinkedRelatedField, 但是下面这种方法更好.</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">CategorySerializer</span><span class="p">()</span>
    <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">ManufacturerSerializer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Product</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'model'</span><span class="p">,</span> <span class="s">'description'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,</span> <span class="s">'image'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">DeliveryAddressSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">DeliveryAddress</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'contact_person'</span><span class="p">,</span> <span class="s">'contact_mobile_phone'</span><span class="p">,</span> <span class="s">'delivery_address'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,)</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'user'</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">OrderListSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">ProductListSerializer</span><span class="p">()</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">DeliveryAddressSerializer</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Order</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'status'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'product'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'quantity'</span><span class="p">,</span> <span class="s">'remark'</span><span class="p">,</span> <span class="s">'address'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,</span> <span class="p">)</span>


<span class="k">class</span> <span class="nc">OrderCreateSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Order</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user'</span><span class="p">,</span> <span class="s">'product'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'quantity'</span><span class="p">,</span> <span class="s">'remark'</span><span class="p">,</span> <span class="s">'address'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'updated'</span><span class="p">,)</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'user'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,</span> <span class="s">'address'</span><span class="p">,</span> <span class="p">)</span>


<span class="k">class</span> <span class="nc">OrderRUDSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Order</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,</span> <span class="p">)</span>


</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="computerappviewspy">computerapp/views.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">generics</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">permissions</span>
<span class="kn">from</span> <span class="nn">rest_framework.filters</span> <span class="kn">import</span> <span class="n">OrderingFilter</span><span class="p">,</span> <span class="n">SearchFilter</span>
<span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">LimitOffsetPagination</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">computerapp.models</span> <span class="kn">import</span> <span class="n">Product</span><span class="p">,</span> <span class="n">UserProfile</span><span class="p">,</span> <span class="n">DeliveryAddress</span><span class="p">,</span> <span class="n">Order</span>
<span class="kn">from</span> <span class="nn">computerapp.serializers</span> <span class="kn">import</span> <span class="n">ProductListSerializer</span><span class="p">,</span> <span class="n">ProductRetrieveSerializer</span><span class="p">,</span> <span class="n">UserInfoSerializer</span><span class="p">,</span> <span class="n">UserProfileSerializer</span><span class="p">,</span> <span class="n">UserSerializer</span><span class="p">,</span> <span class="n">DeliveryAddressSerializer</span><span class="p">,</span> <span class="n">OrderListSerializer</span><span class="p">,</span> <span class="n">OrderCreateSerializer</span><span class="p">,</span> <span class="n">OrderRUDSerializer</span>
<span class="kn">from</span> <span class="nn">rest_framework.views</span> <span class="kn">import</span> <span class="n">APIView</span>
<span class="kn">from</span> <span class="nn">rest_framework.response</span> <span class="kn">import</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">rest_framework.exceptions</span> <span class="kn">import</span> <span class="n">NotFound</span>
<span class="kn">from</span> <span class="nn">rest_framework.throttling</span> <span class="kn">import</span> <span class="n">AnonRateThrottle</span>


<span class="k">class</span> <span class="nc">ProductListView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品列表
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>
    <span class="c"># 可以过滤的后台, 第一个参数表示搜索功能, 第二个表示排序功能. 这两个参数是固定用法.</span>
    <span class="c"># 增加该字段后, API UI 出现一个 filters 功能</span>
    <span class="c"># 前端通过 GET /computer/product_list/?ordering=category&amp;search=%E5%B9%B3%E6%9D%BF 调用</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">OrderingFilter</span><span class="p">,)</span>
    <span class="c"># 这里是设置具体的可搜索字段.</span>
    <span class="c"># 如果不设置, 默认返回所有列表数据</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'description'</span><span class="p">,</span> <span class="s">'model'</span><span class="p">)</span>
    <span class="c"># 这里是设置具体的可排序字段</span>
    <span class="c"># 如果不设置, 那么默认所有字段都可以排序</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,)</span>
    <span class="c"># 设置默认排序是id</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,)</span>
    <span class="c"># 指定分页方式为 LimitOffsetPagination, 这种方式的</span>
    <span class="c"># 之前的另一种 方式 PageNumberPagination 也可以用</span>
    <span class="c"># PageNumberPagination 方式 是显示页码为数字的方式(每页显示的个数是配置文件中 PAGE_SIZE 设置死的),</span>
    <span class="c"># LimitOffsetPagination 可以灵活的, 客户端可以通过携带 ?limit=2&amp;offset=6 参数设置每页显示2条数据, 显示第4页</span>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">LimitOffsetPagination</span>


<span class="k">class</span> <span class="nc">ProductListByCategoryView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品按类别展示列表
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">OrderingFilter</span><span class="p">,)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'description'</span><span class="p">,)</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,</span> <span class="s">'stock'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,)</span>

    <span class="c"># 和 上面 ProductListView 类的区别就是用 get_queryset() 方法 代替了 queryset 属性, 重写了列表获取的条件</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 获取列表的条件是先获取 request 传递过来的 分类的的id</span>
        <span class="c"># query_params 表示查询参数. 前端可以通过GET 或者 POST 方式发送参数. 比如GET ?category=1 , 或者POST 过来的 category 的值</span>
        <span class="c"># 如果没有拿到值, 默认值是 None</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="c"># 如果传递过来的信息非空 就进行过滤, 否则全部显示</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">queryset</span>


<span class="k">class</span> <span class="nc">ProductListByCategoryManufacturerView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品按类别并按品牌展示列表
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>
    <span class="n">filter_backends</span> <span class="o">=</span> <span class="p">(</span><span class="n">SearchFilter</span><span class="p">,</span> <span class="n">OrderingFilter</span><span class="p">,)</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'description'</span><span class="p">,)</span>
    <span class="n">ordering_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="s">'manufacturer'</span><span class="p">,</span> <span class="s">'created'</span><span class="p">,</span> <span class="s">'sold'</span><span class="p">,</span> <span class="s">'stock'</span><span class="p">,</span> <span class="s">'price'</span><span class="p">,)</span>
    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s">'id'</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 先获取分类id 和 厂商id</span>
        <span class="c"># 调用方法例子GET: ?category=1&amp;manufacturer=1  或者 POST 传递这两个参数</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'category'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">manufacturer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'manufacturer'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">manufacturer</span><span class="o">=</span><span class="n">manufacturer</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">queryset</span>


<span class="k">class</span> <span class="nc">ProductRetrieveView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">RetrieveAPIView</span><span class="p">):</span>
    <span class="s">"""
    产品详情
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">ProductRetrieveSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">AllowAny</span><span class="p">,)</span>


<span class="k">class</span> <span class="nc">UserInfoView</span><span class="p">(</span><span class="n">APIView</span><span class="p">):</span>
    <span class="s">"""
    用户基本信息
    """</span>
    <span class="n">permissions_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="c"># 定义 GET 方法发送过来的数据的处理方法</span>
    <span class="c"># 在第三级的时候需要用 format=None 配合 urls.py中的format_suffix_patterns 进行content negotiation</span>
    <span class="c"># 第四级, 第五级就不用了</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># 获取当前用户对象, 无法获取其他用户信息.</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">serializer</span> <span class="o">=</span> <span class="n">UserInfoSerializer</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserProfileRUView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">RetrieveUpdateAPIView</span><span class="p">):</span>
    <span class="s">"""
    用户其他信息更新获取
    """</span>
    <span class="c"># 不能用下一行代码, 因为会让API 直接访问到其他用户的信息, 而不是当前用户的信息. 比如: http://127.0.0.1:8001/computer/user_profile_ru/2/</span>
    <span class="c"># queryset = UserProfile.objects.all()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserProfileSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="c"># 下面方法是用来限制用户只能访问自己的信息.</span>
    <span class="c"># get_object 用来只返回一个对象</span>
    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 获取当前用户.</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="c"># 通过当前用户,获取当前用户档案</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">UserProfile</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>


<span class="k">class</span> <span class="nc">UserCreateView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">CreateAPIView</span><span class="p">):</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">UserSerializer</span>



<span class="c"># class DeliveryAddressLCView(generics.ListCreateAPIView):</span>
<span class="c">#     """</span>
<span class="c">#     收货地址LC</span>
<span class="c">#     """</span>
<span class="c">#     serializer_class = DeliveryAddressSerializer</span>
<span class="c">#     permission_classes = (permissions.IsAuthenticated,)</span>
<span class="c">#</span>
<span class="c">#     def get_queryset(self):</span>
<span class="c">#         user = self.request.user</span>
<span class="c">#         # 获取当前用户的地址列表</span>
<span class="c">#         queryset = DeliveryAddress.objects.filter(user=user)</span>
<span class="c">#         return queryset</span>
<span class="c">#</span>
<span class="c">#     def perform_create(self, serializer):</span>
<span class="c">#         user = self.request.user</span>
<span class="c">#         # serializer 是上面 serializer_class = DeliveryAddressSerializer 定义的序列器</span>
<span class="c">#         # serializer.save 保存的是 models.py 中 定义的DeliveryAddress 表</span>
<span class="c">#         s = serializer.save(user=user)</span>
<span class="c">#         # 获取当前用户的档案</span>
<span class="c">#         # 更新当前用户的默认收货地址, 如果不想这么做, 就把下面三行注释掉</span>
<span class="c">#         profile = user.profile_of</span>
<span class="c">#         profile.delivery_address = s</span>
<span class="c">#         profile.save()</span>

<span class="k">class</span> <span class="nc">DeliveryAddressLCView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListCreateAPIView</span><span class="p">):</span>
    <span class="s">"""
    收货地址LC
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">DeliveryAddressSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>

        <span class="n">queryset</span> <span class="o">=</span> <span class="n">DeliveryAddress</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">queryset</span>

    <span class="k">def</span> <span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="p">)</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">profile_of</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">delivery_address</span> <span class="o">=</span> <span class="n">s</span>
        <span class="n">profile</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">DeliveryAddressRUDView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">RetrieveUpdateDestroyAPIView</span><span class="p">):</span>

    <span class="s">"""
    收货地址RUD
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">DeliveryAddressSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># 这里的 id=self.kwargs['pk'] 是获取前端url中传过来的关键字</span>
            <span class="c"># 为了安全, 不让当前用户看到其他用户的地址, 这里要传递两个参数绝对满足才能限制当前用户只能看到自己的地址.</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">DeliveryAddress</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'pk'</span><span class="p">],</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotFound</span><span class="p">(</span><span class="s">'not found'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>


<span class="k">class</span> <span class="nc">CartListView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    购物车列表
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">OrderListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s">'0'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">queryset</span>


<span class="k">class</span> <span class="nc">OrderListView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">ListAPIView</span><span class="p">):</span>
    <span class="s">"""
    订单列表
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">OrderListSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>
    <span class="c"># 设置节流限制</span>
    <span class="c"># throttle_classes = (AnonRateThrottle,)</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">status__in</span><span class="o">=</span><span class="p">[</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">,</span> <span class="s">'4'</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">queryset</span>


<span class="k">class</span> <span class="nc">OrderCreateView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">CreateAPIView</span><span class="p">):</span>
    <span class="s">"""
    Order Create
    """</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">OrderCreateSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">perform_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">product</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">validated_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'product'</span><span class="p">)</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="n">product</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">profile_of</span><span class="o">.</span><span class="n">delivery_address</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">OrderRUDView</span><span class="p">(</span><span class="n">generics</span><span class="o">.</span><span class="n">RetrieveUpdateDestroyAPIView</span><span class="p">):</span>
    <span class="s">"""
    订单查改删
    """</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">OrderRUDSerializer</span>
    <span class="n">permission_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">IsAuthenticated</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">[</span><span class="s">'pk'</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">perform_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serializer</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="n">serializer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s">'1'</span><span class="p">)</span>



</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="vue--django-rest-框架实现前后端分离的电商项目">VUE + django rest 框架实现前后端分离的电商项目</h2>

<p>预安装环境: mysql, navcat, python 虚拟环境, Vue.js</p>

<p><em>mysql 客户端连接方式</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>/Applications/XAMPP/xamppfiles/bin/mysql -uroot -p
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>navicat 连接方式</em></p>

<blockquote>
  <p>下载 navicat 客户端</p>

  <p>启动 XAMPP 的 mysql 服务</p>

  <p>创建MariaDB 连接, 并连接端口 3308, 用户名 root,</p>
</blockquote>

<p><em>虚拟环境配置</em></p>

<p>创建一个 ecom 目录, 并进入该目录创建虚拟环境</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>mkdir ecom
cd ecom
which python3.7
virtualenv -p /Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7 env
source env/bin/activate
deactivate
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>VUE.js 环境配置 Node.js + cnpm</em></p>

<p>因为 vue 依赖 node.js 所以需要安装配置 node.</p>

<p><a href="https://nodejs.org/en/">官网下载安装包</a></p>

<p>安装后提示如下:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>This package has installed:
	•	Node.js v9.5.0 to /usr/local/bin/node
	•	npm v5.6.0 to /usr/local/bin/npm
Make sure that /usr/local/bin is <span class="k">in </span>your <span class="nv">$PATH</span>.
</pre></td></tr></tbody></table>
</div>
</div>

<p>查看node 版本</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>node --version
v9.5.0
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>使用淘宝镜像 cnpm 代替 npm</em></p>

<p><a href="http://npm.taobao.org">cnpm 淘宝官网</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>sudo npm i -g npm
sudo npm install -g cnpm --registry<span class="o">=</span>https://registry.npm.taobao.org
<span class="c"># 安装包的使用方法</span>
cnpm install <span class="o">[</span>name]
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>准备前端代码和依赖包</em></p>

<blockquote>
  <p>将 online-store-master 前端代码目录拷贝到 ecom 目录中</p>

  <p>然后cd 到 online-store-master 安装cnpm 依赖包</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>cd online-store-master
cnpm install
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>安装完成后会产生一个node_modules 目录</li>
</ul>


            </div>

            <!-- Rating -->
            
            <div class="rating mb-4 d-flex align-items-center">
                <strong class="mr-1">Rating:</strong> <div class="rating-holder">
<div class="c-rating c-rating--regular" data-rating-value="4.5">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
</div>
</div>
            </div>
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2020-07-07">07 Jul 2020</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Django">Django</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#DjangoRest">DjangoRest</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Web-development">Web development</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//Django-In-Action/"> &laquo; Django In Action</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//Use-Numpy-Panda-And-Sklearn-for-Data-analytics-and-AI/">Use Numpy, Panda and Sklearn for Data Analytics and AI &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Thing",
    "name": "Django Rest From Zero to Hero"
  },
  "author": {
    "@type": "Person",
    "name": "Dalong"
  },
  "datePublished": "2020-07-07",
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": "4.5",
    "bestRating": "5"
  }
}
</script>

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Linux">Linux (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (16)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mysql">Mysql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Redis">Redis (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MongoDB">MongoDB (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Flask">Flask (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Django">Django (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DjangoRest">DjangoRest (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Web-development">Web development (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Numpy">Numpy (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Panda">Panda (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Sklearn">Sklearn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jupyter">Jupyter (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenCV">OpenCV (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AI">AI (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Science">Data Science (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Tensorflow">Tensorflow (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ML">ML (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Microservice">Microservice (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Docker">Docker (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Rest-API">Rest API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Container">Container (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#NLP">NLP (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS">AWS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture">Architecture (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Database">Database (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Storage">Storage (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DevOps">DevOps (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IAM">IAM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cloud">Cloud (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#API">API (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Migration">Data Migration (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Network">Network (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#YAML">YAML (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Security">Security (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#kubernetes">kubernetes (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Serverless">Serverless (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#CICD">CICD (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Agile">Agile (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Scrum">Scrum (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Design-Thinking">Design Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GCP">GCP (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Google-Cloud-Platform">Google Cloud Platform (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MLPS">MLPS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PIPL">PIPL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PII">PII (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GDPR">GDPR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Metaverse">Metaverse (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#VR">VR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AR">AR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#XR">XR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Togaf">Togaf (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture-Thinking">Architecture Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ChatGPT">ChatGPT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenAI">OpenAI (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#LLM">LLM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Prompt">Prompt (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DALL-E">DALL-E (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OCR">OCR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Face-API">Face API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Chat-Bot">Chat Bot (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Speech-Service">Speech Service (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Computer-Vision">Computer Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Custom-Vision">Custom Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Video-indexer">Video indexer (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Translator">Translator (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cognitive-Search">Cognitive Search (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Knowledge-Base">Knowledge Base (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ITIL">ITIL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IT">IT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Github">Github (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Liquid">Liquid (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Markdown">Markdown (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Node.js">Node.js (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Yarn">Yarn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Nest.JS">Nest.JS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Typescript">Typescript (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#javascript">javascript (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Restful-API">Restful API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Postman">Postman (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Postgresql">Postgresql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#TypeORM">TypeORM (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 Dalong's personal blog 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="#">Designed</a> by Dalong.work
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>

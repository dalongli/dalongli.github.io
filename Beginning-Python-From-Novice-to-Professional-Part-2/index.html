<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Learning Python From Scratch (Part2) | Dalong's personal blog</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Learning Python From Scratch (Part2) | Dalong’s personal blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Learning Python From Scratch (Part2)" />
<meta name="author" content="Dalong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Python编程语言可能是使用最广泛的语言之一，因此不断发展。如果一个人想充分发挥其潜力，同时又想在专业上保持竞争力，那么学习 Python 是必不可少的。本文是我很早之前学习 Python 基础时的笔记, 希望可以为那些不了解该Python的人提供了快速入门的必要信息." />
<meta property="og:description" content="Python编程语言可能是使用最广泛的语言之一，因此不断发展。如果一个人想充分发挥其潜力，同时又想在专业上保持竞争力，那么学习 Python 是必不可少的。本文是我很早之前学习 Python 基础时的笔记, 希望可以为那些不了解该Python的人提供了快速入门的必要信息." />
<link rel="canonical" href="http://localhost:4000/Beginning-Python-From-Novice-to-Professional-Part-2/" />
<meta property="og:url" content="http://localhost:4000/Beginning-Python-From-Novice-to-Professional-Part-2/" />
<meta property="og:site_name" content="Dalong’s personal blog" />
<meta property="og:image" content="http://localhost:4000/assets/images/python.jpeg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-05T00:00:00+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Learning Python From Scratch (Part2)","dateModified":"2017-11-05T00:00:00+08:00","datePublished":"2017-11-05T00:00:00+08:00","description":"Python编程语言可能是使用最广泛的语言之一，因此不断发展。如果一个人想充分发挥其潜力，同时又想在专业上保持竞争力，那么学习 Python 是必不可少的。本文是我很早之前学习 Python 基础时的笔记, 希望可以为那些不了解该Python的人提供了快速入门的必要信息.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Dalong"},"image":"http://localhost:4000/assets/images/python.jpeg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Beginning-Python-From-Novice-to-Professional-Part-2/"},"url":"http://localhost:4000/Beginning-Python-From-Novice-to-Professional-Part-2/","author":{"@type":"Person","name":"Dalong"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Carter+One&display=swap" rel="stylesheet">
    </noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Dalong's personal blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

<!-- 以后再加上相关链接

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>
-->
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/dalongli"><i class="fab fa-github"></i> Fork on Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Dalong's personal blog</h1>
    <p class="lead">
        Record the bits and pieces of the technology big bang.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Learning Python From Scratch (Part2)&url=http://localhost:4000/Beginning-Python-From-Novice-to-Professional-Part-2/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/Beginning-Python-From-Novice-to-Professional-Part-2/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/Beginning-Python-From-Novice-to-Professional-Part-2/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/avatar_dl.png" alt="Dalong">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://dalongli.github.io/about">Dalong</a><a target="_blank" href="https://dalongli.github.io." class="btn follow">Follow</a>
                        <span class="author-description">A profesional technical consultant and blogger.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Learning Python From Scratch (Part2)</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/python.jpeg" alt="Learning Python From Scratch (Part2)">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <h3 class="font-weight-bold">Summary</h3>
                        <ul>
  <li><a href="#python-高级">python 高级</a>
    <ul>
      <li><a href="#21面向对象-oop">2.1面向对象 OOP</a>
        <ul>
          <li><a href="#211创建和使用类">2.1.1创建和使用类</a>
            <ul>
              <li><a href="#成员方法"><strong>成员方法</strong></a></li>
              <li><a href="#成员属性"><strong>成员属性</strong></a></li>
              <li><a href="#_-or-__-私有属性-私有方法---保护属性和方法"><code class="language-plaintext highlighter-rouge">_</code> or <code class="language-plaintext highlighter-rouge">__</code> 私有属性, 私有方法   保护属性和方法</a></li>
              <li><a href="#类属性">类属性</a></li>
              <li><a href="#类方法和静态方法">类方法和静态方法</a></li>
              <li><a href="#静态方法-staticmethod">静态方法 <code class="language-plaintext highlighter-rouge">@staticmethod</code></a></li>
              <li><a href="#常用属性方法-__name__-__dict__--__bases__">常用属性方法 <code class="language-plaintext highlighter-rouge">__name__</code>, <code class="language-plaintext highlighter-rouge">__dict__</code> , <code class="language-plaintext highlighter-rouge">__bases__</code></a></li>
              <li><a href="#限制属性动态添加-__slots__">限制属性动态添加 <code class="language-plaintext highlighter-rouge">__slots__</code></a></li>
              <li><a href="#析构方法-__del__">析构方法 <code class="language-plaintext highlighter-rouge">__del__</code></a></li>
              <li><a href="#多态">多态</a></li>
              <li><a href="#序列化-反序列化-pickle">序列化, 反序列化 Pickle</a></li>
              <li><a href="#property-可管理的属性">@property 可管理的属性</a></li>
              <li><a href="#构造方法"><strong>构造方法</strong></a></li>
              <li><a href="#__str__--打印对象"><strong><code class="language-plaintext highlighter-rouge">__str__</code>  打印对象</strong></a></li>
              <li><a href="#__repr__-和--__str__-类似-只是更面向程序员友好"><strong><code class="language-plaintext highlighter-rouge">__repr__</code> 和  <code class="language-plaintext highlighter-rouge">__str__</code> 类似, 只是更面向程序员友好</strong></a></li>
              <li><a href="#with-语句"><strong>with 语句</strong></a></li>
              <li><a href="#__enter__-和-__exit__-方法"><strong><code class="language-plaintext highlighter-rouge">__enter__</code> 和 <code class="language-plaintext highlighter-rouge">__exit__</code> 方法</strong></a></li>
              <li><a href="#把对象当参数进行传递"><strong>把对象当参数进行传递</strong></a></li>
            </ul>
          </li>
          <li><a href="#212继承">2.1.2继承</a></li>
          <li><a href="#213重写">2.1.3重写</a></li>
          <li><a href="#215-interface-接口">2.15 Interface 接口</a></li>
        </ul>
      </li>
      <li><a href="#22-异常处理">2.2 异常处理</a>
        <ul>
          <li><a href="#捕获异常"><strong>捕获异常</strong></a></li>
          <li><a href="#打印捕获到的异常对象内容"><strong>打印捕获到的异常对象内容</strong></a></li>
          <li><a href="#多个异常捕获"><strong>多个异常捕获</strong></a></li>
          <li><a href="#合并捕获"><strong>合并捕获</strong></a></li>
          <li><a href="#else"><strong>else</strong></a></li>
          <li><a href="#finally"><strong>finally</strong></a></li>
          <li><a href="#自定义异常"><strong>自定义异常</strong></a></li>
        </ul>
      </li>
      <li><a href="#23正则表达式">2.3正则表达式</a>
        <ul>
          <li><a href="#231概念-regular-expression">2.3.1概念: regular expression</a></li>
          <li><a href="#232-re-模块的几个方法">2.3.2 re 模块的几个方法</a>
            <ul>
              <li><a href="#常用的一些匹配模式">常用的一些匹配模式</a></li>
              <li><a href="#match">match()</a></li>
              <li><a href="#search">search()</a></li>
              <li><a href="#findall">findall()</a></li>
              <li><a href="#compile">compile()</a></li>
              <li><a href="#finditer">finditer()</a></li>
            </ul>
          </li>
          <li><a href="#233-正则表达式的规则">2.3.3 正则表达式的<strong>规则</strong></a>
            <ul>
              <li><a href="#单字符匹配---d-d-w-w-s-s">单字符匹配 <code class="language-plaintext highlighter-rouge">. [] \d \D \w \W \s \S</code></a></li>
              <li><a href="#原始正则-r">原始正则 <code class="language-plaintext highlighter-rouge">r</code></a></li>
              <li><a href="#数量词----">数量词 <code class="language-plaintext highlighter-rouge">* + ? {}</code></a></li>
              <li><a href="#边界修饰符--词边界---b-b">边界修饰符 , 词边界 <code class="language-plaintext highlighter-rouge">^ $ \b \B</code></a></li>
              <li><a href="#或-">或 <code class="language-plaintext highlighter-rouge">|</code></a></li>
              <li><a href="#子模式-num">子模式 <code class="language-plaintext highlighter-rouge">\num</code></a></li>
              <li><a href="#贪婪和非贪婪">贪婪和非贪婪</a></li>
              <li><a href="#模式修正">模式修正</a></li>
              <li><a href="#正则替换-sub">正则替换 <code class="language-plaintext highlighter-rouge">sub</code></a></li>
              <li><a href="#正则切割-split">正则切割 <code class="language-plaintext highlighter-rouge">split</code></a></li>
              <li><a href="#look-around-环顾模式">Look Around 环顾模式</a></li>
              <li><a href="#几道练习题">几道练习题</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#24-web-数据爬取">2.4 Web 数据爬取</a>
        <ul>
          <li><a href="#urllib---网页内容抓取">urllib - 网页内容抓取</a>
            <ul>
              <li><a href="#获取http-状态码-和-url-地址"><strong>获取http 状态码 和 URL 地址</strong></a></li>
              <li><a href="#异常捕获--timeout"><strong>异常捕获- timeout</strong></a></li>
              <li><a href="#url-的-解码"><strong>URL 的 解码</strong></a></li>
              <li><a href="#get-post-请求url-地址的拼接"><strong>GET POST 请求URL 地址的拼接</strong></a></li>
              <li><a href="#urlretrieve-图片下载"><code class="language-plaintext highlighter-rouge">urlretrieve()</code> 图片下载</a></li>
              <li><a href="#练习">练习:</a></li>
            </ul>
          </li>
          <li><a href="#requests-模块-获取网页内容">requests 模块 获取网页内容</a></li>
          <li><a href="#用-beautifulsoup-模块-配合-requests-模块-解析-html">用 BeautifulSoup 模块 配合 requests 模块, 解析 HTML</a></li>
          <li><a href="#webbrowser--打开操作系统默认浏览器">webbrowser – 打开操作系统默认浏览器</a></li>
          <li><a href="#用-selenium-模块控制浏览器">用 selenium 模块控制浏览器</a>
            <ul>
              <li><a href="#启动-selenium-控制的浏览器">启动 selenium 控制的浏览器</a></li>
              <li><a href="#寻找html-元素">寻找html 元素</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#25-线程-进程-协程">2.5 线程 进程 协程</a>
        <ul>
          <li><a href="#线程">线程</a>
            <ul>
              <li><a href="#线程概念"><strong>线程概念</strong></a></li>
              <li><a href="#threading-创建线程">threading 创建线程</a></li>
              <li><a href="#_thread-模块创建线程"><code class="language-plaintext highlighter-rouge">_thread</code> 模块创建线程</a></li>
              <li><a href="#threadingthread创建线程-函数调用法基本法"><strong><code class="language-plaintext highlighter-rouge">threading.Thread</code>创建线程 函数调用法(基本法)</strong></a></li>
              <li><a href="#threadingsemaphore2-信号量"><code class="language-plaintext highlighter-rouge">threading.Semaphore(2)</code> <strong>信号量</strong></a></li>
              <li><a href="#创建线程-继承法"><strong>创建线程 继承法</strong></a></li>
              <li><a href="#为线程传递参数">为线程传递参数</a></li>
              <li><a href="#线程等待-线程对象join">线程等待: <code class="language-plaintext highlighter-rouge">线程对象.join()</code></a></li>
              <li><a href="#threadingrlock-和-threadinglock-线程锁"><strong><code class="language-plaintext highlighter-rouge">threading.RLock()</code> 和 <code class="language-plaintext highlighter-rouge">threading.Lock()</code> 线程锁</strong></a></li>
              <li><a href="#threadingevent线程间通信"><strong><code class="language-plaintext highlighter-rouge">threading.Event()</code>线程间通信</strong></a></li>
              <li><a href="#threadingcondition--线程同步---线程的切换"><code class="language-plaintext highlighter-rouge">threading.Condition()</code>  线程同步 /  线程的切换</a></li>
              <li><a href="#threadingtimer-定时执行"><code class="language-plaintext highlighter-rouge">threading.Timer</code> 定时执行</a></li>
              <li><a href="#queuequeue-线程间通信"><code class="language-plaintext highlighter-rouge">queue.Queue</code> 线程间通信</a></li>
              <li><a href="#线程池">线程池</a>
                <ul>
                  <li><a href="#线程池使用方式">线程池使用方式:</a></li>
                  <li><a href="#queue-和-用queue-设计-生产者消费者模式"><strong>Queue 和 用Queue 设计 生产者/消费者模式:</strong></a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#协程----使用生成器代替线程">协程: -  使用生成器代替线程</a>
            <ul>
              <li><a href="#定义-协作完成"><strong>定义</strong>: 协作完成</a></li>
              <li><a href="#协程的买家卖家模式---生产者消费者模式">协程的买家卖家模式 - 生产者消费者模式</a></li>
            </ul>
          </li>
          <li><a href="#进程">进程</a>
            <ul>
              <li><a href="#进程间通信概念">进程间通信概念</a></li>
              <li><a href="#pipe-管道方式通信">Pipe 管道方式通信</a></li>
              <li><a href="#queue-队列方式通信">Queue 队列方式通信</a></li>
              <li><a href="#进程间字典列表共享">进程间字典列表共享</a></li>
              <li><a href="#进程池">进程池</a></li>
              <li><a href="#并行计算---将多个工作平均分配给每个-cpu-做-map-reduce-计算">并行计算 - 将多个工作平均分配给每个 CPU, 做 map-reduce 计算</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#26-socket">2.6 Socket</a>
        <ul>
          <li><a href="#建立-udp-服务端课客户端">建立 UDP 服务端课客户端</a></li>
          <li><a href="#建立-tcp-连接-服务端和客户端">建立 TCP 连接, 服务端和客户端</a></li>
          <li><a href="#通过-socket-远程访问网站并获取源代码">通过 Socket 远程访问网站并获取源代码</a></li>
          <li><a href="#socket-发送飞秋消息">Socket 发送飞秋消息</a></li>
          <li><a href="#用-python-玩微信">用 Python 玩微信</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>Python编程语言可能是使用最广泛的语言之一，因此不断发展。如果一个人想充分发挥其潜力，同时又想在专业上保持竞争力，那么学习 Python 是必不可少的。本文是我很早之前学习 Python 基础时的笔记, 希望可以为那些不了解该Python的人提供了快速入门的必要信息.</p>

<h1 id="python-高级">python 高级</h1>

<p>[TOC]</p>

<p><strong>查看一个对象的所有内置方法 / 查看一个类的所有内置方法</strong></p>
<ul>
  <li>先进入python 命令行</li>
  <li>然后创建一个类, 并将类实例化.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="gp">&gt;&gt;&gt; </span>class A:
...     def AA<span class="o">(</span>self<span class="o">)</span>:
...             pass
... 
<span class="gp">&gt;&gt;&gt; </span>
<span class="gp">&gt;&gt;&gt; </span>a <span class="o">=</span> A<span class="o">()</span> 
</pre></td></tr></tbody></table>
</div>
</div>
<ul>
  <li>查看对象所有内置方法: 命令行输入 <code class="language-plaintext highlighter-rouge">a.__</code> 然后双击 tab</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="gp">&gt;&gt;&gt; </span>a.__
a.__class__<span class="o">(</span>         a.__ge__<span class="o">(</span>            a.__lt__<span class="o">(</span>            a.__setattr__<span class="o">(</span>      
a.__delattr__<span class="o">(</span>       a.__getattribute__<span class="o">(</span>  a.__module__         a.__sizeof__<span class="o">(</span>       
a.__dict__           a.__gt__<span class="o">(</span>            a.__ne__<span class="o">(</span>            a.__str__<span class="o">(</span>          
a.__dir__<span class="o">(</span>           a.__hash__<span class="o">(</span>          a.__new__<span class="o">(</span>           a.__subclasshook__<span class="o">(</span> 
a.__doc__            a.__init__<span class="o">(</span>          a.__reduce__<span class="o">(</span>        a.__weakref__       
a.__eq__<span class="o">(</span>            a.__init_subclass__<span class="o">(</span> a.__reduce_ex__<span class="o">(</span>    
a.__format__<span class="o">(</span>        a.__le__<span class="o">(</span>            a.__repr__<span class="o">(</span>     
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>查看类所有的内置方法: 命令行输入 <code class="language-plaintext highlighter-rouge">A.__</code> 然后双击 tab</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="gp">&gt;&gt;&gt; </span>A.__
A.__abstractmethods__ A.__eq__<span class="o">(</span>             A.__le__<span class="o">(</span>             A.__repr__<span class="o">(</span>          
A.__base__<span class="o">(</span>           A.__flags__           A.__lt__<span class="o">(</span>             A.__setattr__<span class="o">(</span>       
A.__bases__           A.__format__<span class="o">(</span>         A.__module__          A.__sizeof__<span class="o">(</span>        
A.__basicsize__       A.__ge__<span class="o">(</span>             A.__mro__             A.__str__<span class="o">(</span>           
A.__call__<span class="o">(</span>           A.__getattribute__<span class="o">(</span>   A.__name__            A.__subclasscheck__<span class="o">(</span> 
A.__class__<span class="o">(</span>          A.__gt__<span class="o">(</span>             A.__ne__<span class="o">(</span>             A.__subclasses__<span class="o">(</span>    
A.__delattr__<span class="o">(</span>        A.__hash__<span class="o">(</span>           A.__new__<span class="o">(</span>            A.__subclasshook__<span class="o">(</span>  
A.__dict__            A.__init__<span class="o">(</span>           A.__prepare__<span class="o">(</span>        A.__text_signature__ 
A.__dictoffset__      A.__init_subclass__<span class="o">(</span>  A.__qualname__        A.__weakref__        
A.__dir__<span class="o">(</span>            A.__instancecheck__<span class="o">(</span>  A.__reduce__<span class="o">(</span>         A.__weakrefoffset__  
A.__doc__             A.__itemsize__        A.__reduce_ex__<span class="o">(</span>     
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="21面向对象-oop">2.1面向对象 OOP</h2>

<p>OOP 是一种思想, 面向过程也是一种思想
通过面向对象思想, 抽象一个类, 通过这个类,创建对应的对象,让对象执行类里面的方法</p>

<p>生活角度解释面向对象</p>
<blockquote>
  <p>类: 一群拥有相识特点的事物集合, 是概念 , 人类, 汽车, 水杯, 手机等 
 对象: 精确到某一个事物, 我手里的 iphoneX, 涛哥
 面向过程是数学逻辑的映射
 面向对象是生活逻辑的映射
 以后写 python 都要用面向对象的思想. 多个对象协同工作完成你的功能.</p>
  <ul>
    <li>面向过程: 买砖, 打地基, 封顶, 装修, 买家具
      <ul>
        <li>面向对象: 包工头搞定</li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>官方的 类和对象的概念</p>
<blockquote>
  <p>类: 对象的抽象
对象: 类的具象</p>
</blockquote>

<p>面向对象和函数,属性</p>
<blockquote>
  <p>函数是向面向对象思想的靠拢
面向对象是在函数的基础上, 对多个函数进行封装, 更抽象
还有属性,( 可以是变量,字典等 )</p>
</blockquote>

<p>面向对象语言三大特点:</p>
<ul>
  <li>封装: 将特定的函数,属性封装到类中, 并可以<strong>控制权限</strong></li>
  <li>继承: 如果想使用其他类的一些方法,属性,可以直接继承过来</li>
  <li>多态: 多种形态, 不同的对象调用同一个函数接口, 得到的响应是不同的.</li>
</ul>

<h3 id="211创建和使用类">2.1.1创建和使用类</h3>

<p><strong>类名</strong></p>
<ul>
  <li>用 <code class="language-plaintext highlighter-rouge">class</code> 关键字定义类</li>
  <li>类名的首字母大写</li>
  <li>类名后面的小括号<code class="language-plaintext highlighter-rouge">()</code> 用来作为<strong>继承</strong>使用, 如果不需要继承, 小括号可以省略</li>
  <li>小括号中可以放多个父类, 称之为多继承, 只放一个父类称之为单继承</li>
</ul>

<p><strong>self</strong></p>
<ul>
  <li>成员方法必须有一个参数, 这个参数我们一般命名为 <code class="language-plaintext highlighter-rouge">self</code>, 当然写成别的名字, 比如 a 也可以, 这个 self 就是创建的对象.</li>
  <li>self 地址就是当前对象的地址. 哪个对象调用这个成员方法, 那么 self 就代表谁,   目的是可以让实例化的对象可以访问自己内部的变量和方法</li>
  <li>self 放在参数第一个位置, 其他参数需要放在 self 后面</li>
</ul>

<p><strong>实例化的过程: 小明, 老王为例</strong></p>
<ul>
  <li>创建小明 - 先在内存中创建一个小明对象空间, 然后再创建一个叫小明的变量指针指向小明实例化对象空间</li>
  <li>创建老王 - 先在内存中创建一个新的老王对象空间, 然后再创建一个叫老王的变量指针指向老王实例化对象空间</li>
  <li>实例化一个类和实例化一个自定义函数一样, 通过第一个字母的大小写区分是类还是函数</li>
  <li><code class="language-plaintext highlighter-rouge">.</code> 可以让实例化的对象访问类中的属性(attribute)和方法(method)</li>
</ul>

<h4 id="成员方法"><strong>成员方法</strong></h4>

<ul>
  <li>和普通函数的定义没有区别, 只是必须把 self 参数放在最前面</li>
  <li><code class="language-plaintext highlighter-rouge">_前缀</code>: 在成员方法和属性的名字前面加上下划线 表示是私有属性或方法</li>
  <li>在类中调用成员方法 需要 用 self 关键字 <code class="language-plaintext highlighter-rouge">self.wangwang()</code></li>
  <li><code class="language-plaintext highlighter-rouge">self.__init__()</code> 也可以work, 含义是需要重新初始化信息. 但是这并不常见, 一般都是在初始化类时自动初始化. 不进行人工调用.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">People</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">food</span> <span class="o">=</span> <span class="s">'酸菜鱼'</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我爱吃'</span> <span class="o">+</span> <span class="n">food</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我喜欢跑步'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">xiaoming</span> <span class="o">=</span> <span class="n">People</span><span class="p">()</span>
    <span class="n">laowang</span> <span class="o">=</span> <span class="n">People</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">xiaoming</span><span class="p">))</span>
    <span class="n">xiaoming</span><span class="o">.</span><span class="n">eat</span><span class="p">(</span><span class="s">'糖醋排骨'</span><span class="p">)</span>
    <span class="n">laowang</span><span class="o">.</span><span class="n">eat</span><span class="p">()</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="成员属性"><strong>成员属性</strong></h4>

<ul>
  <li>成员属性可以动态添加, 刚开始没有在类中定义, 对象直接动态添加了几个属性.</li>
  <li><code class="language-plaintext highlighter-rouge">_前缀</code>: 在成员方法和属性的名字前面加上下划线 表示是私有属性或方法</li>
  <li><code class="language-plaintext highlighter-rouge">后缀_</code>: 在成员属性的后面加上下划线, 表示避免和某个保留关键字冲突</li>
  <li>定义方法: <code class="language-plaintext highlighter-rouge">self.属性名 = 属性值</code> 属性名可以是任意类型变量, 包括实例化的对象</li>
  <li>如果不用 self. 添加属性, 那么实例化对象就不能访问到这个属性, 类中的其他方法也不能访问这个变量.</li>
  <li>类内调用方法: <code class="language-plaintext highlighter-rouge">self.属性名</code></li>
  <li>对象调用方法: <code class="language-plaintext highlighter-rouge">对象名.属性名</code></li>
  <li>动态添加属性不好. 当创建一个类时, 最好可以直接把属性定义到类中.</li>
</ul>

<h4 id="_-or-__-私有属性-私有方法---保护属性和方法"><code class="language-plaintext highlighter-rouge">_</code> or <code class="language-plaintext highlighter-rouge">__</code> 私有属性, 私有方法   保护属性和方法</h4>
<ul>
  <li>python 语法中比较鸡肋, 基本上不用这玩意. 因为 python 没有访问控制符的概念, 所以也就不存在什么 私有, 公开, 受保护的 控制符.</li>
  <li>python 中, 类的属性和方法时可以在外部随意访问的, 一般不做限制.</li>
  <li>如果使用<strong>单下划线</strong>作为前缀, 可以告诉别人这个属性或者方法时内部使用的, 但只是命名约定,不做强制限制</li>
  <li>如果使用 <strong>双下划线</strong> 作为前缀, 外部是不能访问的. 需要通过定义方法来调用双下划线开头的属性或者方法, 这类的方法名定义一般叫做 set_xxx, get_xxx</li>
  <li><code class="language-plaintext highlighter-rouge">__dict__</code> 可以用于访问类中的成员属性 ,</li>
  <li><code class="language-plaintext highlighter-rouge">print(a.__dict__)</code>  可以打印出如下内容<code class="language-plaintext highlighter-rouge">{'_internal': '私有变量', 'public': '公有变量', '_A__private': '新的隐私'}</code> , 所以可以用 <code class="language-plaintext highlighter-rouge">print(a._A__private)</code> 访问<code class="language-plaintext highlighter-rouge">__private</code> 属性</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_internal</span> <span class="o">=</span> <span class="s">'私有变量'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">public</span> <span class="o">=</span> <span class="s">'公有变量'</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__private</span> <span class="o">=</span> <span class="s">'隐私'</span>

    <span class="k">def</span> <span class="nf">_internal_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'私有方法'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">public_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'公有方法'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__private_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__private</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_private</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__private_method</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_private</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__private</span> <span class="o">=</span> <span class="n">value</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_internal</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">public</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_internal_method</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">public_method</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_private</span><span class="p">())</span>
<span class="n">a</span><span class="o">.</span><span class="n">set_private</span><span class="p">(</span><span class="s">'新的隐私'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get_private</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="类属性">类属性</h4>
<ul>
  <li>直接在类中, 方法的外面定义的属性,成为类属性</li>
  <li>调用方式是   <code class="language-plaintext highlighter-rouge">类名.属性名</code> , 也可以使用 <code class="language-plaintext highlighter-rouge">对象名.属性名</code> 但只推荐第一种方式</li>
  <li>当类属性和对象属性同名时, 用  <code class="language-plaintext highlighter-rouge">对象名.属性名</code> 方式会优先调用对象属性名</li>
  <li>类属性和对象属性可以同时存在(访问, 添加, 修改), 互不影响.</li>
  <li>最后一句话: 哥们, 用类名调用类属性,  用对象名调用对象属性, 别乱套</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Wolf</span><span class="p">:</span>
    <span class="c"># 写到这里的叫做类属性, 类属性的意思是这个属性不是属于某个对象的,而是属于整个类的, 它的调用方式是通过 类名.属性名, 当然也可以通过 对象名.属性名</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c"># 写在 self. 后面的属性, 称之为成员属性, 或者对象属性, 实例属性</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="n">lang</span> <span class="o">=</span> <span class="n">Wolf</span><span class="p">(</span><span class="s">'小灰灰'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">Wolf</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="n">Wolf</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">lang</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">80</span>
<span class="k">print</span><span class="p">(</span><span class="n">Wolf</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">lang</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="类方法和静态方法">类方法和静态方法</h4>

<ul>
  <li>类方法: 在方法前面定义了装饰器  <code class="language-plaintext highlighter-rouge">@classmethod</code> 的方法叫做类方法. 类方法可以通过 <code class="language-plaintext highlighter-rouge">类名.类方法()</code> 调用</li>
  <li>类方法定义时, 需要用 <code class="language-plaintext highlighter-rouge">def heng(cls):</code> 来定义 , 类方法必须有一个参数 <code class="language-plaintext highlighter-rouge">cls</code> 是用来代表类自己.</li>
  <li>类方法中禁止出现 <code class="language-plaintext highlighter-rouge">self</code> 关键字,  因为类方法是通过类名进行调用的. 对象是实例化后的东西, 类方法是对类的操作</li>
  <li>在类方法中直接通过 cls. 直接调用类属性和类方法</li>
  <li>在类方法中可以通过 cls. 创建对象, 并封装一层, 最终通过类方法给外部提供简洁的借口</li>
  <li>最好不要在一个类中定义同名的类方法和对象方法, 如果一定要这样做, 那么把对象方法的定义放在类方法的前面</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><pre><span class="c">#类方法</span>
<span class="k">class</span> <span class="nc">Pig</span><span class="p">:</span>
    <span class="c"># 这种事对象方法, 或成员方法, 通过对象地址调用</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">gong</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'喜欢拱又白又嫩的白菜'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">heng</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'对象方法的哼哼'</span><span class="p">)</span>

    <span class="c"># 看见这个装饰器, 代表下面的方法时类方法. 要通过类名调用</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">heng</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>   <span class="c"># 这里的 cls 代表类本身, cls 也可以换成其他的名字, 但是一般都写成 cls</span>

        <span class="k">print</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="s">'净坛使者'</span><span class="p">)</span>   <span class="c"># 类方法创建了一个自己的实例对象</span>
        <span class="n">p</span><span class="o">.</span><span class="n">gong</span><span class="p">()</span>             <span class="c"># 新建的对象调用了对象方法</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'类方法的哼哼'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>             <span class="c"># 并将对象返回</span>



<span class="n">bajie</span> <span class="o">=</span> <span class="n">Pig</span><span class="p">(</span><span class="s">'八戒'</span><span class="p">)</span>
<span class="c"># bajie.gong()</span>
<span class="c"># bajie.heng()</span>
<span class="n">Pig</span><span class="o">.</span><span class="n">heng</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">Pig</span><span class="o">.</span><span class="n">heng</span><span class="p">())</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="静态方法-staticmethod">静态方法 <code class="language-plaintext highlighter-rouge">@staticmethod</code></h4>
<p>静态方法和类方法基本一致, 只是定义静态方法时不需要cls 和 self</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Pig</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">jingtai</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'这是静态方法'</span><span class="p">)</span>

<span class="n">Pig</span><span class="o">.</span><span class="n">jingtai</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="常用属性方法-__name__-__dict__--__bases__">常用属性方法 <code class="language-plaintext highlighter-rouge">__name__</code>, <code class="language-plaintext highlighter-rouge">__dict__</code> , <code class="language-plaintext highlighter-rouge">__bases__</code></h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">__name__</code> : 通过类名调用, 获取类名字符串</li>
  <li>通过<code class="language-plaintext highlighter-rouge">类名.__dict__</code>查看当前类的信息, 包含类属性,类方法,静态方法等</li>
  <li>通过<code class="language-plaintext highlighter-rouge">对象名.__dict__</code> 获取所有对象的属性</li>
  <li>通过 <code class="language-plaintext highlighter-rouge">self.__dict__</code> 和通过对象名调用一样</li>
  <li>通过 <code class="language-plaintext highlighter-rouge">类名.__bases__</code> 查看所有的父类, <strong>注意</strong> , <code class="language-plaintext highlighter-rouge">__bases__</code> 只能显示上一级的父类, 不能显示更高层的父类</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Tiger</span><span class="p">:</span>
    <span class="n">age</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">haha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">leifangfa</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">jingtai</span><span class="p">():</span>
        <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="n">Tiger</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>  <span class="c">#</span>
<span class="k">print</span><span class="p">(</span><span class="n">Tiger</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>  <span class="c"># 通过类名.__dict__查看当前类的信息, 包含类属性,类方法,静态方法等</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Tiger</span><span class="p">(</span><span class="s">"狗"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>      <span class="c"># 通过对象名.__dict__ 获取所有对象的属性</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">print</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">__bases__</span><span class="p">)</span>   <span class="c"># 输出 (&lt;class '__main__.A'&gt;, &lt;class '__main__.B'&gt;)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="限制属性动态添加-__slots__">限制属性动态添加 <code class="language-plaintext highlighter-rouge">__slots__</code></h4>
<p>指出了可以添加的属性,其他的不能加. 包含构造方法也不例外</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="c">#限制属性动态添加</span>

<span class="k">class</span> <span class="nc">Shikelang</span><span class="p">:</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'age'</span> <span class="p">,</span> <span class="s">'height'</span><span class="p">)</span>  <span class="c"># 指出了可以添加的属性,其他的不能加. 包含构造方法也不例外</span>

<span class="n">xiaoqiang</span> <span class="o">=</span> <span class="n">Shikelang</span><span class="p">()</span>
<span class="n">xiaoqiang</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'小强'</span>
<span class="n">xiaoqiang</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">xiaoqiang</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mf">0.1</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="析构方法-__del__">析构方法 <code class="language-plaintext highlighter-rouge">__del__</code></h4>

<ul>
  <li>和构造方法相反</li>
  <li>当对象的内存被销毁的时候自动调用</li>
  <li>当对象的内存的空间被释放的时候, 就会自动调用 <code class="language-plaintext highlighter-rouge">__del__</code> 方法</li>
  <li><code class="language-plaintext highlighter-rouge">__del__</code> 方法中经常放一些清理工作, 比如关闭文件, 关闭数据库等</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Pig</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c"># 当内存中的空间被释放的时候,就会调用 __del__ 方法</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'这头猪被宰了'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Pig</span><span class="p">(</span><span class="s">'八戒'</span><span class="p">)</span>      <span class="c"># 开辟了内存空间, 并将 p 指向了这个内存空间</span>
<span class="n">ershixiong</span> <span class="o">=</span> <span class="n">Pig</span><span class="p">(</span><span class="s">'小八戒'</span><span class="p">)</span>  <span class="c"># 第二个对象指向了同一个内存空间</span>
<span class="n">p</span> <span class="o">=</span> <span class="s">'hello'</span>         <span class="c"># 对象 p 被赋予了新的值</span>
<span class="k">del</span> <span class="n">ershixiong</span>      <span class="c"># 销毁了二师兄对象,同时也释放了内存</span>
<span class="k">print</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="多态">多态</h4>

<ul>
  <li>多态, 就是多种形态, 在 python 也是鸡肋</li>
  <li>重写就是一种多态</li>
  <li>多态的定义: 当调用对象的同一个方法, 得到不同的结果的形态叫做多态</li>
  <li>多态的本质是给某对象的同一个方法传递不同的对象, 这些不同的对象拥有同一个对象方法(继承自同一个父类), 被传递的不同对象的方法会在某方法中被调用,从而得到不同的结果</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="c"># 多态</span>
<span class="c"># 例子: 豆豆殴打小动物</span>
<span class="k">class</span> <span class="nc">Animal</span><span class="p">:</span>  <span class="c"># 这是一个父类</span>
    <span class="k">def</span> <span class="nf">bebeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c">#这是一个接口方法, 所有继承 Animal 的类都会自动有 bebeat 方法</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Pig</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bebeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'猪哼哼两声跑向了白菜地'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bebeat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'狗朝你旺旺两声, 开始攻击你'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">beat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">animal</span><span class="p">:</span> <span class="s">'Annimal'</span><span class="p">):</span>  <span class="c">#这里的第二个参数要限制必须是 Annimal 类的对象</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'豆豆正在殴打小动物'</span><span class="p">)</span>
        <span class="n">animal</span><span class="o">.</span><span class="n">bebeat</span><span class="p">()</span>

<span class="n">doudou</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s">'王豆豆'</span><span class="p">)</span>
<span class="n">bajie</span> <span class="o">=</span> <span class="n">Pig</span><span class="p">()</span>
<span class="n">doudou</span><span class="o">.</span><span class="n">beat</span><span class="p">(</span><span class="n">bajie</span><span class="p">)</span>
<span class="n">wangwang</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">()</span>
<span class="n">doudou</span><span class="o">.</span><span class="n">beat</span><span class="p">(</span><span class="n">wangwang</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="序列化-反序列化-pickle">序列化, 反序列化 Pickle</h4>
<ul>
  <li>在内存中, 程序运行结束后, 对象就销毁了.</li>
  <li><code class="language-plaintext highlighter-rouge">pickle</code> 模块可以帮助我们对 python 对象进行序列化</li>
  <li>python 中 一切都是对象</li>
  <li>将对象写到文件中, 或者写到数据库中的行为, 叫做持久化保存, 下次当需要继续使用对象时, 可以再把对象从文件或者数据库中读出来.</li>
  <li>作用: 将对象序列化, 这里的对象指的是所有的对象, 包括列表, 字典, 集合, 自定义对象</li>
  <li>序列化只能保存对象的属性, 不会保存对象的方法</li>
  <li>如果要使用反序列化的对象调用属性或者方法, 必须要把该对象用到的类import 到当前文件</li>
  <li><code class="language-plaintext highlighter-rouge">pickle.dump( data, f)</code> 函数将内容序列化, 并放到<strong>文件中</strong> , 打开文件必须加上 <strong><code class="language-plaintext highlighter-rouge">b</code></strong></li>
  <li><code class="language-plaintext highlighter-rouge">pickle.dumps( data )</code> 函数将内容序列化, 并转到<strong>字符串中</strong></li>
  <li><code class="language-plaintext highlighter-rouge">pickle.load(f)</code> 从文件中读取序列化内容, 并进行反序列化, <strong>并自动执行</strong> ( 反-</li>
  <li><code class="language-plaintext highlighter-rouge">pickle.loads(s)</code> 从字符串反序列化</li>
  <li>序列化的可以是 <strong>类, 函数, 接口, 变量</strong>  等等 ) , 所以, 是有风险的, 千万不要对任何来路不明的序列化文件做 <code class="language-plaintext highlighter-rouge">load()</code> 操作</li>
  <li>如果需要保存多个对象, 可以把多个对象放到列表中或者字典中,然后进行序列化</li>
  <li>可以顺序的把需要序列化的内容存到文件中, 读取时也是顺序的读取, 如果取出的次数大于放入的次数, 会报错<code class="language-plaintext highlighter-rouge">EOFError: Ran out of input</code> , 因为已经读到文件最底部了,没有能够在读取序列化内容了</li>
</ul>

<p><strong>对字符串, 列表,字典进行序列化</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./somedata'</span><span class="p">,</span> <span class="s">'wb'</span> <span class="p">)</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">f</span><span class="p">)</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s">'hello'</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span><span class="s">'Apple'</span><span class="p">,</span> <span class="s">'Pear'</span><span class="p">,</span> <span class="s">'Banana'</span><span class="p">},</span> <span class="n">f</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'somedata'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="c"># [1, 2, 3, 4]</span>
<span class="k">print</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="c">#'hello'</span>
<span class="k">print</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="c"># {'Apple', 'Pear', 'Banana'}</span>
<span class="k">print</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="c"># 会报错 EOFError: Ran out of input , 因为已经读到文件最底部了,没有能够在读取序列化内容了</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>对对象进行序列化</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="c"># 序列化对象</span>

<span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">class</span> <span class="nc">GirlFriend</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>

    <span class="k">def</span> <span class="nf">wash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我喜欢给你洗衣服'</span><span class="p">)</span>

<span class="c"># 序列化</span>
<span class="c"># 如果需要保存多个对象, 那就需要把多个对象放到列表中或者字典中,然后进行序列化</span>
<span class="c"># fen = GirlFriend('刘淑芬', 16, 162, 50)</span>
<span class="c"># fp = open('./fen.txt', 'wb')</span>
<span class="c"># pickle.dump(fen, fp)</span>

<span class="c"># 反序列化</span>
<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./fen.txt'</span> <span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
<span class="c"># 如果要使用反序列化的对象调用属性或者方法, 必须要把该对象用到的类import 到当前文件中</span>
<span class="n">fen</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">fen</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
<span class="n">fen</span><span class="o">.</span><span class="n">wash</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="property-可管理的属性">@property 可管理的属性</h4>
<ul>
  <li>如果想管理一个属性的访问权限, 就使用 @property 的方式</li>
  <li>对于私有属性, 我们一般需要通过 set, get 方法来对属性进行访问</li>
  <li>我们也可以通过 python 官方提供的 装饰器 <code class="language-plaintext highlighter-rouge">@property</code> 和 <code class="language-plaintext highlighter-rouge">@age.setter</code> 来实现两个方法, 可以模拟访问正常属性的格式</li>
  <li>先定义一个属性, 再为这个属性定义三个名子相同的方法
    <ul>
      <li>getter ,获取属性值</li>
      <li>setter ,设置属性值</li>
      <li>deleter, 删除属性值</li>
    </ul>
  </li>
  <li>三个方法的前面都需要加上装饰器
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@property</code></li>
      <li><code class="language-plaintext highlighter-rouge">@属性名.setter</code></li>
      <li><code class="language-plaintext highlighter-rouge">@属性名.deleter</code></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Cat</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__age</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__weight</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c"># def get_age(self):</span>
    <span class="c">#     return self.__age</span>
    <span class="c">#</span>
    <span class="c"># def set_age(self,age):</span>
    <span class="c">#     self.__age = age</span>

    <span class="nd">@property</span>       <span class="c"># 用了 property, 那么下面的方法就可以当做属性来调用</span>
    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__age</span>

    <span class="nd">@age.setter</span>     <span class="c"># 用类名</span>
    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__age</span> <span class="o">=</span> <span class="n">age</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__weight</span>

    <span class="nd">@weight.setter</span>
    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__weight</span> <span class="o">=</span> <span class="n">weight</span>

<span class="n">cat</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">(</span><span class="s">'多多'</span><span class="p">)</span>
<span class="n">cat</span><span class="o">.</span><span class="n">age</span><span class="o">=</span><span class="mi">100</span>
<span class="k">print</span><span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="c"># print(cat.get_age())</span>
<span class="c"># cat.set_age(5)</span>
<span class="c"># print(cat.get_age())</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>deleter 方法</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="s">'大龙'</span>

    <span class="c"># Getter function</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__name</span>

    <span class="c"># Setter function</span>
    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="s">'需要一个字符串名字'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c"># Deleter function (optional)</span>
    <span class="nd">@name.deleter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">AttributeError</span><span class="p">(</span><span class="s">"名字不允许被删除"</span><span class="p">)</span>

<span class="n">dalong</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">dalong</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">dalong</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s">'小龙'</span>
<span class="k">print</span><span class="p">(</span><span class="n">dalong</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="k">del</span> <span class="n">dalong</span><span class="o">.</span><span class="n">name</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="构造方法"><strong>构造方法</strong></h4>

<ul>
  <li>创建对象时被调用的方法称为构造方法.</li>
  <li>构造方法的功能就是对属性进行初始化, 以及对象创建成功后的初始化方法的执行.</li>
  <li><code class="language-plaintext highlighter-rouge">__init__</code> 是初始化方法, 实例化对象时会被自动执行.</li>
  <li>构造方法不能写 return 任何东西, 只能返回 None</li>
  <li>构造方法中有一个隐藏的 return , 初始化类时,返回对象本身.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">GirlFriends</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我被调用了'</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">dilireba</span> <span class="o">=</span> <span class="n">GirlFriends</span><span class="p">()</span>
    <span class="n">dilireba</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'迪丽热巴'</span>
    <span class="n">dilireba</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dilireba</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dilireba</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>

    <span class="n">yuanyuan</span> <span class="o">=</span> <span class="n">GirlFriends</span><span class="p">()</span>
    <span class="n">yuanyuan</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">'高圆圆'</span>
    <span class="n">yuanyuan</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">165</span>
    <span class="k">print</span><span class="p">(</span><span class="n">yuanyuan</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">yuanyuan</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="__str__--打印对象"><strong><code class="language-plaintext highlighter-rouge">__str__</code>  打印对象</strong></h4>

<ul>
  <li>当 print 一个对象时, 默认是打印这个对象的内存地址 <code class="language-plaintext highlighter-rouge">&lt;__main__.Dog object at 0x104818828&gt;</code></li>
  <li>可以用定义一个 <code class="language-plaintext highlighter-rouge">__str__(self):</code> 方法, 并返回一个字符串, 来代替默认返回的内存地址.</li>
  <li><code class="language-plaintext highlighter-rouge">__str__(self):</code> 方法只有在 <code class="language-plaintext highlighter-rouge">print(对象)</code> 的时候才会被调用, 类内的其他方法调用<code class="language-plaintext highlighter-rouge">__ str__</code> 方法不会生效.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"这个是print(对象) 时返回的信息"</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="__repr__-和--__str__-类似-只是更面向程序员友好"><strong><code class="language-plaintext highlighter-rouge">__repr__</code> 和  <code class="language-plaintext highlighter-rouge">__str__</code> 类似, 只是更面向程序员友好</strong></h4>

<ul>
  <li>当使用 <code class="language-plaintext highlighter-rouge">__repr__(self):</code>  方法, 返回一个字符串, 二返回的内容在 python 交互命令行中输入对象名可以直接显示 <code class="language-plaintext highlighter-rouge">__repr__</code> 定义的返回内容</li>
  <li>下面的例子打印出类的实例化使用方法
    <div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="s">'RunningCar(total_distance:num ,speed: num) -&gt; None :'</span>
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
</ul>

<h4 id="with-语句"><strong>with 语句</strong></h4>

<ul>
  <li>打开文件有异常, 需要关闭文件等. 这样比较麻烦, 所以 with 可以很方便的帮助打开和关闭内容.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'fen.txt'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="__enter__-和-__exit__-方法"><strong><code class="language-plaintext highlighter-rouge">__enter__</code> 和 <code class="language-plaintext highlighter-rouge">__exit__</code> 方法</strong></h4>

<ul>
  <li>有一些任务，可能事先需要设置，事后做清理工作.</li>
  <li>这种时候需要用到 <code class="language-plaintext highlighter-rouge">with</code> 进行处理.</li>
  <li>with 的工作原理就是:
    <ul>
      <li>在执行对象方法之前会先调用 <code class="language-plaintext highlighter-rouge">__enter__</code> 方法, 并将<code class="language-plaintext highlighter-rouge">__ enter__</code> 返回的值赋给 <code class="language-plaintext highlighter-rouge">as</code> 后面的变量</li>
      <li>with 语句块里面的代码开始执行, 执行完毕后再调用 <code class="language-plaintext highlighter-rouge">__exit__</code> 方法</li>
      <li>就算 with 语句块的代码发生异常, enter 和 exit 方法内的代码也会执行.</li>
    </ul>
  </li>
  <li>那我们需要做的就是为类来创建 <code class="language-plaintext highlighter-rouge">__enter__</code> 和 <code class="language-plaintext highlighter-rouge">__exit__</code> 方法来做事先设置和事后的清理工作</li>
  <li><strong>例子</strong>: 我们每次想把执行代码的 log 记录在一个log 日志中, 就可以考虑在执行前打开 log 日志, 运行完代码后, 写入日志文件并关闭日志文件.</li>
</ul>

<p>伪代码</p>
<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="k">with</span> <span class="err">对象</span><span class="p">()</span> <span class="k">as</span> <span class="err">变量</span><span class="p">:</span>
	<span class="err">变量</span><span class="o">.</span><span class="err">方法</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>
<p>一段包含<code class="language-plaintext highlighter-rouge">__ enter__</code>, <code class="language-plaintext highlighter-rouge">__exit__</code> 的完整代码</p>
<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">TestforEnterAndExit</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">logfile</span><span class="o">=</span><span class="s">'./test.txt'</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'a+'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span> <span class="o">=</span> <span class="n">logfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"__enter__:Open </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fp</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"__exit__:Close </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">logfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">with</span> <span class="n">TestforEnterAndExit</span><span class="p">()</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">'随便写一些日志 </span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'End'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="把对象当参数进行传递"><strong>把对象当参数进行传递</strong></h4>

<ul>
  <li>老王开车
    <ul>
      <li>对象: 老王, 老王的车, 借的车</li>
      <li>动作: 开, 跑</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">car</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">car</span> <span class="o">=</span> <span class="n">car</span>
    <span class="k">def</span> <span class="nf">travel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">social</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">car</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s要出没了, 女孩们要注意'</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c"># 在这里做了个判断, 如果老王借到宝马,就开宝马去, 如果没有借到, 就开自己的车去</span>
        <span class="k">if</span> <span class="n">car</span><span class="p">:</span>
            <span class="n">car</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">car</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Car</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">brand</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brand</span> <span class="o">=</span> <span class="n">brand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s</span><span class="si">%</span><span class="s">s汽车在奔跑, 该车价格</span><span class="si">%</span><span class="s">s!'</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brand</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">price</span><span class="p">))</span>

<span class="n">laowang_car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">(</span><span class="s">"普桑"</span><span class="p">,</span> <span class="s">'黑色'</span><span class="p">,</span> <span class="s">'1万'</span><span class="p">)</span>
<span class="n">borrow_car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">(</span><span class="s">"BMW"</span><span class="p">,</span> <span class="s">'骚粉'</span><span class="p">,</span> <span class="s">'100万'</span><span class="p">)</span>
<span class="n">laowang</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s">'老王'</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="n">laowang_car</span><span class="p">)</span>
<span class="n">laowang</span><span class="o">.</span><span class="n">social</span><span class="p">()</span>
<span class="n">laowang</span><span class="o">.</span><span class="n">social</span><span class="p">(</span><span class="n">borrow_car</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>练习: 小明与牌</strong>
题目:</p>
<ul>
  <li>小明手里有两张牌, 左手是♣️K, 右手是♦️A</li>
  <li>小明交换了手里的两张牌, 左手是♦️A, 右手是♣️K</li>
</ul>

<p>分析:</p>
<ul>
  <li>5个对象, 一个人, 两个手, 两张牌</li>
  <li>3个类: 人, 手, 牌</li>
</ul>

<p>设计:</p>
<ul>
  <li>牌类
    <ul>
      <li>属性: 花色, 大小</li>
      <li>方法: 无</li>
    </ul>
  </li>
  <li>手类
    <ul>
      <li>属性: 牌</li>
      <li>方法: 拿牌</li>
    </ul>
  </li>
  <li>人类
    <ul>
      <li>属性: 姓名, 左手(对象), 右手(对象)</li>
      <li>方法: 换牌, 看牌, 抓牌</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Poker</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number</span> <span class="o">=</span> <span class="n">number</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'</span><span class="si">%</span><span class="s">s</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Hand</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poker</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poker</span> <span class="o">=</span> <span class="n">poker</span>

    <span class="k">def</span> <span class="nf">hold_poker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poker</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poker</span> <span class="o">=</span> <span class="n">poker</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">lhand</span><span class="p">,</span> <span class="n">rhand</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lhand</span> <span class="o">=</span> <span class="n">lhand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhand</span> <span class="o">=</span><span class="n">rhand</span>
    <span class="k">def</span> <span class="nf">catch_poker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poker1</span><span class="p">,</span> <span class="n">poker2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lhand</span><span class="o">.</span><span class="n">hold_poker</span><span class="p">(</span><span class="n">poker1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhand</span><span class="o">.</span><span class="n">hold_poker</span><span class="p">(</span><span class="n">poker2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我的左手</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">lhand</span><span class="o">.</span><span class="n">poker</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我的右手</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">rhand</span><span class="o">.</span><span class="n">poker</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exchange_poker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lhand</span><span class="o">.</span><span class="n">poker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhand</span><span class="o">.</span><span class="n">poker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhand</span><span class="o">.</span><span class="n">poker</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lhand</span><span class="o">.</span><span class="n">poker</span>


<span class="n">poker1</span> <span class="o">=</span> <span class="n">Poker</span><span class="p">(</span><span class="s">'♣️'</span><span class="p">,</span> <span class="s">'K'</span><span class="p">)</span>
<span class="n">poker2</span> <span class="o">=</span> <span class="n">Poker</span><span class="p">(</span><span class="s">'♦️'</span><span class="p">,</span> <span class="s">'A'</span><span class="p">)</span>

<span class="n">lhand</span> <span class="o">=</span> <span class="n">Hand</span><span class="p">()</span>
<span class="n">rhand</span> <span class="o">=</span> <span class="n">Hand</span><span class="p">()</span>

<span class="n">xiaoming</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s">'小明'</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">lhand</span><span class="p">,</span><span class="n">rhand</span><span class="p">)</span>
<span class="n">xiaoming</span><span class="o">.</span><span class="n">catch_poker</span><span class="p">(</span><span class="n">poker1</span><span class="p">,</span><span class="n">poker2</span><span class="p">)</span>
<span class="n">xiaoming</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'*'</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
<span class="n">xiaoming</span><span class="o">.</span><span class="n">exchange_poker</span><span class="p">()</span>
<span class="n">xiaoming</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="212继承">2.1.2继承</h3>

<p><strong>基本概念</strong></p>

<ul>
  <li>一般情况系父子类是直接归属关系, 当然也可以有多层的父子关系</li>
  <li>子类属性大于等于父类的属性和方法</li>
  <li>基本概念
    <ul>
      <li>父子类其他叫法: 基类(父类), 派生类(子类), 超类(父类)</li>
      <li>继承: 从子类的角度说, 子类继承了父类. 动物继承自生物</li>
      <li>派生: 从父类的角度说, 父类派生了子类. 生物派生出动物</li>
      <li>单继承: 子类只能有一个父类, python 支持多继承, 但一般情况只使用单继承.</li>
      <li>多继承: 子类有多个父类, 多继承会出现混乱情况, 所以不建议使用</li>
    </ul>
  </li>
</ul>

<p><strong>父子类关系</strong></p>
<ul>
  <li>只要子类继承了父类,就拥有了父类的所有属性和方法</li>
  <li>创建子类时，父类必须包含在当前文件中，且位于子类前面</li>
  <li>定义子类时，必须在子类的括号内指定父类的 名称</li>
  <li>所有的类的基类是 <code class="language-plaintext highlighter-rouge">object</code> , 如果一个类不写父类, 那么默认继承自 <code class="language-plaintext highlighter-rouge">object</code> 基类</li>
  <li>一个子类如果没写构造方法, 就会直接继承父类的构造方法, 如果父类的构造方法要求必须要传递参数, 子类的实例就必须传递参数 ;</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Animal</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'动物都喜欢睡觉'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

    <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'人都喜欢吃饭'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GirlFriend</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">xiaoli</span> <span class="o">=</span> <span class="n">GirlFriend</span><span class="p">(</span><span class="s">'小丽'</span><span class="p">,</span><span class="mi">28</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">xiaoli</span><span class="o">.</span><span class="n">eat</span><span class="p">())</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">super()</code> 是一个特殊函数，帮助子类和父类关联起来</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">People</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'平民'</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span><span class="s">'被调用了'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">drink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">'在喝水'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Police</span><span class="p">(</span><span class="n">People</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">gun</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gun</span> <span class="o">=</span> <span class="n">gun</span>
    <span class="k">def</span> <span class="nf">shooting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s在用</span><span class="si">%</span><span class="s">s开枪'</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gun</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">xiaoming</span> <span class="o">=</span> <span class="n">People</span><span class="p">(</span><span class="s">'小明'</span><span class="p">)</span>
    <span class="n">laowang</span> <span class="o">=</span> <span class="n">Police</span><span class="p">(</span><span class="s">'老王'</span><span class="p">,</span><span class="s">'沙漠之鹰'</span><span class="p">)</span>
    <span class="n">laowang</span><span class="o">.</span><span class="n">drink</span><span class="p">()</span>
    <span class="n">laowang</span><span class="o">.</span><span class="n">shooting</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="213重写">2.1.3重写</h3>

<ul>
  <li>子类可以继承父类的所有方法和属性, 但是如果子类发现继承来的内容不适合自己, 子类可以修改, 这时需要子类重写一遍父类的属性和方法.</li>
  <li><strong>完全重写</strong>: 子类将父类的方法推翻了, 自己重新写了一个和父类方法名一样的方法 ( 参数名和个数可以完全不同) , 子类对象调用的是子类的新重写的方法</li>
  <li><strong>增加功能重写(增量重写)</strong>: 父类的方法对于子类不是完全没用, 子类需要在父类方法的基础上再增加一定的功能. 需要用 <code class="language-plaintext highlighter-rouge">super()</code> 关键字调用父类原来的方法.
    <ul>
      <li>增量重写时, 尽量保持子类和父类的参数名和参数个数保持一致</li>
      <li>调用父类方法的三种格式
        <ul>
          <li><code class="language-plaintext highlighter-rouge">super().work()</code>  # python3 推荐</li>
          <li><code class="language-plaintext highlighter-rouge">super(Son, self).work()</code>  # python2 的方式</li>
          <li><code class="language-plaintext highlighter-rouge">Father.work(self)</code> #特殊情况使用</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Father</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我每天辛苦工作14个小时'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">jump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我能跳</span><span class="si">%.2</span><span class="s">f米'</span> <span class="o">%</span><span class="n">num</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Son</span><span class="p">(</span><span class="n">Father</span><span class="p">):</span>
    <span class="c">#完全重写</span>
    <span class="k">def</span> <span class="nf">jump</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我能跳3米'</span><span class="p">)</span>

    <span class="c">#增量重写</span>
    <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#调用父类的方法</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>          <span class="c"># 最推荐的调用父类方法的方式</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Son</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>  <span class="c"># 功能同上,不推荐</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我在工作之余, 和旁边的妹子建立了深切的革命友谊'</span><span class="p">)</span>


<span class="c"># mingba = Father()</span>
<span class="c"># mingba.jump(5)</span>
<span class="n">xiaoming</span> <span class="o">=</span> <span class="n">Son</span><span class="p">()</span>
<span class="n">xiaoming</span><span class="o">.</span><span class="n">jump</span><span class="p">()</span>
<span class="n">xiaoming</span><span class="o">.</span><span class="n">work</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>构造方法的重写</strong></p>
<ul>
  <li>如果子类中有一部分属性是父类初始化过的, 子类自己还需要做另外一些属性的初始化,</li>
  <li>那么子类可以直接调用父类的初始化构造方法</li>
  <li>好的习惯是在写初始化的构造方法时, 调用父类的构造方法
```python
class Father:
  def <strong>init</strong>(self,name, age):
      self.name = name
      self.age = age</li>
</ul>

<p>class Son(Father):
    def <strong>init</strong>(self, name, age, height, weight):
        # 父类会对 name, age 初始化,所以子类就调用父类的初始化就可以了
        super().<strong>init</strong>(name, age)<br />
        self.height = height
        self.weight = weight</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></td><td class="code"><pre>
### 2.1.4多继承

骡子和马驴的关系的例子
- 继承时,需要把多个父类写到新类的括号中, 逗号隔开
- 如果多个父类中有同一个方法被子类继承, 那么子类查找顺序就是继承顺顺序, 先找到哪个父类,先继承哪个父类的方法. 
- 对多个父类的构造方法的继承的优先顺序和上面一样
- 子类如果完全重写一个方法, 就会覆盖多个父类的方法
- 如果子类需要对指定的某个父类的方法进增量重写, 需要用 `某个父类名.方法名(self)` 的方式调用这个父类的方法     
- 多层增量继承时, 不要用  `某个父类名.方法名(self)` , 因为这会造成顶层父类的方法会被多次执行. 
  - 比如 A,B 分别继承了 Base, 而 C 同时继承了 A和B, 那么执行 C 的某个方法时可能会执两次 Base 类中的方法. 
  - 所以多层增量继承时, 使用 `super().方法名()` 可以避免此类问题.
- 通过  `print(子类名.__mro__)` 可以看到子类对多个父类的继承优先级顺序 , 输出内容类似于: `(&lt;class '__main__.Mule'&gt;, &lt;class '__main__.Horse'&gt;, &lt;class '__main__.Donkey'&gt;, &lt;class 'object'&gt;)` 
  - Python 会在 MRO 列表上从左到右开始查找基类，直到找到第一 个匹配这个属性的类为止。
    - 子类会先于父类被检查
    - 多个父类会根据它们在列表中的顺序被检查
    - 如果存在多个合法的选择，选择第一个父类

```python
#驴
class Donkey:
    def __init__(self, name, age):
        self.name = name
        self.age = age

    def power(self):
        print('推磨能推三天三夜不嫌累, 喝口红牛接着干')

    def eat(self):
        print('喜欢吃胡萝卜')


#马
class Horse:
    def __init__(self, height):
        self.height = height

    def baofa(self):
        print('百米起步只需要2.3秒')

    def eat(self):
        print('喜欢吃青青草')


#骡子
class Mule(Horse, Donkey):
    def eat(self):
        Donkey.eat(self)     #1
        print('骡子还喜欢吃大米')

xiaoluo = Mule(180)
xiaoluo.power()
xiaoluo.baofa()
xiaoluo.eat()  # 子类优先继承括号中最前面的父类的方法
print(Mule.__mro__)  # __mro__

#1 这里如果使用 super().eat() 会按照 MRO 列表中的优先顺序而使用  Hourse 的 eat 方法. 所以这里指定了要继承Donkey 的 eat 方法. 

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="215-interface-接口">2.15 Interface 接口</h3>

<p>父类中定义了必须让继承的子类必须重写的方法</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Animal</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="nb">NotImplementedError</span><span class="p">(</span><span class="s">"Not implemented ple add an anamal sound"</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">Cat</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="k">pass</span>
  
<span class="n">henry</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">()</span>
<span class="n">henry</span><span class="o">.</span><span class="n">speak</span><span class="p">()</span>  <span class="c"># 因为没有重写speak 方法， 所以会报NotImplementedError错误</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="22-异常处理">2.2 异常处理</h2>

<p><a href="http://www.runoob.com/python/python-exceptions.html">常见异常类型</a></p>

<ul>
  <li>什么是错误: 在代码运行之前 有语法错误, 叫做错误. 比如, 语法格式, 缩进, 小括号等低级错误</li>
  <li>什么是异常: 在代码运行过程中出现的错, 叫做异常. 比如, NameError, ZeroDivisionError 异常,</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="s">'a'</span><span class="p">)</span>
<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'xxx.txt'</span> <span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="捕获异常"><strong>捕获异常</strong></h3>

<ul>
  <li>将有可能出现的异常代码块放到 <code class="language-plaintext highlighter-rouge">try</code> 中</li>
  <li><code class="language-plaintext highlighter-rouge">try</code> 的 语法结构: <code class="language-plaintext highlighter-rouge">try ... except ...</code></li>
  <li>一个 <code class="language-plaintext highlighter-rouge">try</code> 至少对应 一个 <code class="language-plaintext highlighter-rouge">except</code></li>
  <li>一旦捕获到异常, 那么这行后面的 try 块就不再执行了, 而是直接跳到 except 块中的代码</li>
  <li>except 后面如果不指定错误类型,那么 except 捕获所有类型异常</li>
  <li><code class="language-plaintext highlighter-rouge">except Exception:</code> 就等于 <code class="language-plaintext highlighter-rouge">except:</code></li>
  <li>except 可以指定需要捕获的类型, 一旦指定, 那么只会捕获指定类型的 error 类型的错误</li>
  <li>python 里面有一个官方异常类的基类, 名字是 <code class="language-plaintext highlighter-rouge">Exception</code> , 所有类型的error 都是 Exception 的子类</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'君不见黄河之水天上来'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c"># 一旦捕获到异常, 那么这行后面的 try 块就不再执行了, 而是直接跳到 except 块中的代码</span>
    <span class="k">print</span><span class="p">(</span><span class="s">' 奔流到海不复回'</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'这个异常捕获了'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="打印捕获到的异常对象内容"><strong>打印捕获到的异常对象内容</strong></h3>

<ul>
  <li>用 <code class="language-plaintext highlighter-rouge">as</code> 来把异常捕获到的异常对象保存到一个变量中, 一般用 <code class="language-plaintext highlighter-rouge">e</code>
    <div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">try</span><span class="p">:</span>
  <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> 
<span class="k">except</span> <span class="nb">NameError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c"># 将异常对象保存下来放到变量 e 中</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'这个异常捕获了'</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
</ul>

<h3 id="多个异常捕获"><strong>多个异常捕获</strong></h3>

<ul>
  <li>一个 try 可以跟多个 except , 但只能有一个 except 捕获到异常.</li>
  <li>一旦第一个异常被捕获, 其他的异常就不会再被捕获了</li>
  <li>多个 except 中, 要把 <code class="language-plaintext highlighter-rouge">except Exception:</code> or  <code class="language-plaintext highlighter-rouge">except :</code> 放在最后, 因为它是模糊捕获, 精确捕获要放在前面</li>
</ul>

<p>多个 except</p>
<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">a</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="s">'a'</span>

<span class="k">except</span> <span class="nb">NameError</span> <span class="k">as</span> <span class="n">e</span> <span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">ZeroDivisionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'报错了'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="合并捕获"><strong>合并捕获</strong></h3>

<ul>
  <li>也可以将多个精确捕获放在一个元祖中,合并捕获</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">a</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="s">'a'</span>

<span class="k">except</span> <span class="p">(</span><span class="nb">NameError</span><span class="p">,</span> <span class="nb">ZeroDivisionError</span><span class="p">):</span> <span class="c"># 将</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'命名错误 或者是 被除数为0错误'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="else"><strong>else</strong></h3>

<ul>
  <li>try中的语句, 如果有异常, 进入 except 块, 如果 try中没有异常, 那么try执行完毕后,就会执行 else 块</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="mi">100</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>       <span class="c">#  try中的语句, 如果有异常, 进入 except 块, 如果 try中没有异常, 那么try执行完毕后,就会执行 else 块</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'这是 else 语句'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="finally"><strong>finally</strong></h3>

<ul>
  <li>异常捕获中的 <code class="language-plaintext highlighter-rouge">finally</code>: 无论有没有异常,都会执行finally. finally 一般用来做清理工作, 比如关闭文件, 关闭数据库等, 释放内存, 释放锁等</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">try</span><span class="p">:</span>
    <span class="n">a</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>    <span class="c">#无论有没有异常,都会执行</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Finally 在这里'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>raise 语句</strong></p>
<ul>
  <li>可以自主的抛出异常</li>
  <li>语法: <code class="language-plaintext highlighter-rouge">raise 错误类型('描述错误')</code> 一般错误类型指定 <code class="language-plaintext highlighter-rouge">Exception</code></li>
  <li>如果 raise 放在 except 块中, 那么意味着再次抛出异常给系统
```python
try:
  print(100)
  raise NameError(‘这是一个 name 错误’)
  print(200)
except Exception as e:
  # raise
  print(e)</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre>
### **异常嵌套**

- try中可以嵌套 try
- except 中可以接着 try
- 异常可以提高我们程序的健壮性, 你可以直接处理这个异常, 你也可以记录日志,将日常- - 记录下来等等, 提高代码健壮性操作


```python
print('我要去拉萨')
try:
    print('我准备坐飞机去')
    raise Exception('由于大雾, 飞机不能起飞了')
    print('我倒拉萨了, 真漂亮')
except Exception as e:
    print(e)
    try:
        print('我准备坐火车过去了')
        raise Exception('由于修路, 火车停运24小时')
        print('我倒拉萨了')
    except Exception as e:
        print(e)
        print('我骑自行车过去')
        print('我倒拉萨啦')
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="自定义异常"><strong>自定义异常</strong></h3>

<ul>
  <li>要创建一个新的类来继承自官方的 Exception 异常类</li>
  <li>写构造方法时需要初始化父类的构造函数</li>
  <li>需要写一个<code class="language-plaintext highlighter-rouge">__str__()</code> 方法 打印异常信息</li>
  <li>可以写一些方法可以对异常信息做一些处理</li>
  <li><strong>注意</strong>, 自定义异常只能用 <code class="language-plaintext highlighter-rouge">raise</code> 关键字抛出异常 ,</li>
  <li>raise 语法是: <code class="language-plaintext highlighter-rouge">raise 自定义异常类的名字('错误描述')</code></li>
  <li>except 语法是: <code class="language-plaintext highlighter-rouge">except 自定义异常类的名字 as e:</code></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">MyException</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyException</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'出现异常的处理函数, 处理掉了'</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>

    <span class="k">print</span><span class="p">(</span><span class="s">'代码开始执行'</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">MyException</span><span class="p">(</span><span class="s">'这里报错了'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'代码结束'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">MyException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">handle</span><span class="p">())</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="23正则表达式">2.3正则表达式</h2>
<p><a href="http://www.runoob.com/python3/python3-reg-expressions.html">文档</a>
<a href="https://docs.python.org/3.7/howto/regex.html#more-metacharacters">官方文档</a></p>

<p>http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/20130515113723855.png<img src="./1511514604730.png" alt="Alt text" /></p>

<h3 id="231概念-regular-expression">2.3.1概念: regular expression</h3>

<blockquote>
  <ul>
    <li>通过写一个规则, 让规则在目标文本中匹配一类字符串的方法. 这一类字符串都会通过规则被找到并处理.</li>
    <li>根据不同的需求, 需要设计不同的正则表达式, 所以在不清楚别人的需求之前不要去看懂别人的正则表达式</li>
    <li>世界最难看懂的三样东西: 医生的处方, 道士的符, <strong>程序员的正则</strong></li>
    <li><strong>使用原则:</strong> 如果能使用官方字符串函数搞定的, 尽量不用正则, 因为正则的效率不是很高.</li>
  </ul>
</blockquote>

<p><strong>使用场景举例:</strong></p>
<blockquote>
  <ul>
    <li>匹配邮箱, url,</li>
    <li>爬虫获取网页指定内容,</li>
    <li>nginx 的配置文件</li>
  </ul>
</blockquote>

<h3 id="232-re-模块的几个方法">2.3.2 re 模块的几个方法</h3>

<blockquote>
  <p>需要 <code class="language-plaintext highlighter-rouge">import re</code> 模块</p>
</blockquote>

<h4 id="常用的一些匹配模式">常用的一些匹配模式</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>r'&lt;.*?&gt;' # 常用来匹配一个 html 标签 
r'^(?![a-zA-z]+$)(?!\d+$)(?![!@#$%^&amp;*]+$)(?![a-zA-z\d]+$)(?![a-zA-z!@#$%^&amp;*]+$)(?![\d!@#$%^&amp;*]+$)[a-zA-Z\d!@#$%^&amp;*]+$' # 包含字母,数字,特殊字符的强密码
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="match">match()</h4>
<blockquote>
  <ul>
    <li>如果找到了, 返回匹配到的对象, 如果没找到,返回 None</li>
    <li>match 默认用 <code class="language-plaintext highlighter-rouge">^</code> 号</li>
    <li>通过<code class="language-plaintext highlighter-rouge">对象.group()</code> 获取匹配到的对象</li>
    <li>通过 <code class="language-plaintext highlighter-rouge">对象.span()</code> 获取匹配到的对象在目标文本中的位置, 是一个元组</li>
    <li>match 函数是从目标文本的第一个字符串开始超找匹配的, 如果查找内容不在目标文本第一个位置, 那么就找不到.</li>
    <li>返回正则对象
      <div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">zm</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'love'</span><span class="p">,</span><span class="s">'love you baby'</span><span class="p">)</span>  <span class="c"># 如果找到了, 返回匹配到的对象, 如果没找到,返回 None</span>
<span class="k">print</span><span class="p">(</span><span class="n">zm</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">zm</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">zm</span><span class="o">.</span><span class="n">span</span><span class="p">())</span>
</pre></td></tr></tbody></table>
</div>
      </div>
    </li>
  </ul>
</blockquote>

<h4 id="search">search()</h4>

<blockquote>
  <ul>
    <li>从目标文本中任何位置进行查找, 找不到返回 None, 找到返回匹配找到的字符串</li>
    <li>只能查找到匹配到的第一个符合规则的字符串</li>
    <li>返回正则对象</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">rm</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'love'</span><span class="p">,</span><span class="s">' love you baby, do you love me'</span><span class="p">)</span>  
<span class="k">print</span><span class="p">(</span><span class="n">rm</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rm</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">rm</span><span class="o">.</span><span class="n">span</span><span class="p">())</span> 
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="findall">findall()</h4>

<blockquote>
  <ul>
    <li>从目标文本中任意位置查找符合规则的所有匹配到的文本, 并将所有找到的内容通过列表返回.</li>
    <li>findall 返回的不是对象,而是一个 list</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">rm</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'love'</span><span class="p">,</span><span class="s">' love you baby, do you love me'</span><span class="p">)</span>  
<span class="k">print</span><span class="p">(</span><span class="n">rm</span><span class="p">)</span> 
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d-</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d-</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'Cell: 415-555-9999 Work: 212-555-0000'</span><span class="p">)</span>  <span class="c"># 返回列表['415-555-9999', '212-555-0000']</span>

<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d)-(</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d)-(</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">d)'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'Cell: 415-555-9999 Work: 212-555-0000'</span><span class="p">)</span>  <span class="c"># 返回 列表元组 [('415', '555', '9999'), ('212', '555', '0000')]</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="compile">compile()</h4>

<blockquote>
  <ul>
    <li>先建立一个正则的规则对象,然后再用这个对象去使用 <code class="language-plaintext highlighter-rouge">match()</code>, <code class="language-plaintext highlighter-rouge">search()</code>, <code class="language-plaintext highlighter-rouge">findall()</code> 来操作目标文本
<code class="language-plaintext highlighter-rouge">compile()</code> 中的表达式不能随便加空格</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">pt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'love'</span><span class="p">)</span>
<span class="n">rm</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">' love you baby, do you love me'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">rm</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="finditer">finditer()</h4>

<blockquote>
  <ul>
    <li></li>
  </ul>
</blockquote>

<h3 id="233-正则表达式的规则">2.3.3 正则表达式的<strong>规则</strong></h3>

<h4 id="单字符匹配---d-d-w-w-s-s">单字符匹配 <code class="language-plaintext highlighter-rouge">. [] \d \D \w \W \s \S</code></h4>

<blockquote>
  <ul>
    <li>一个字母, 一个汉字都是单字符</li>
  </ul>
</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">.</code> 能匹配换行符\n 之外的任意单个字符</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'...'</span><span class="p">)</span>  <span class="c"># . 能匹配换行符\n 之外的**任意**单个字符</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'l你ove you very much好'</span><span class="p">)</span> <span class="c">#  match 通过.匹配目标文本的第一个字符</span>
<span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong><code class="language-plaintext highlighter-rouge">[abcdefghijklmnopqrstuvwxyz]</code>可以匹配到任意</strong>指定的<strong>集合内的单个字符</strong></p>
<blockquote>
  <ul>
    <li>如果中间用 <code class="language-plaintext highlighter-rouge">-</code> , 必须在 <code class="language-plaintext highlighter-rouge">-</code> 两边放置的是连续的 ascii 字符区间</li>
    <li><code class="language-plaintext highlighter-rouge">'[][][]'</code> 代表的是三个单个指定集合的单个字符串</li>
    <li><code class="language-plaintext highlighter-rouge">[^abc]</code> : 取非中括号中的内容, 取反</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'[aol][xo][你]'</span><span class="p">)</span>  <span class="c"># . 能匹配换行符\n 之外的任意单个字符</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'lo你ve you very much好'</span><span class="p">)</span> <span class="c">#  match 通过.匹配目标文本的第一个字符</span>
<span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="s">'[aol][xo][你]'</span> <span class="c"># 匹配前三个字符</span>
<span class="s">'[a-z]'</span> <span class="c"># 匹配任意小写字母 , </span>
<span class="s">'[A-Z]'</span> <span class="c"># 大写</span>
<span class="s">'[0-9]'</span> <span class="c"># 数字</span>
<span class="s">'[0-9a-zA-Z-_]'</span> <span class="c"># 所有数字,字母,中划线,下划线</span>
<span class="s">'[</span><span class="se">\n</span><span class="s">]'</span> <span class="c"># 匹配换行符</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;div&gt;([^</span><span class="err">\</span><span class="s">da-z]*)&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'&lt;html&gt;&lt;body&gt;&lt;div&gt;abasdfasd&lt;/div&gt;&lt;div&gt;123456&lt;/div&gt;&lt;div&gt;&amp;^</span><span class="si">%</span><span class="s">$* _(())&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;'</span><span class="p">)</span>  <span class="c"># 返回 ['&amp;^%$* _(())']</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">\d</code>  代表 匹配0-9的单个字符  相当于 <code class="language-plaintext highlighter-rouge">[0-9]</code></strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">\D</code>   代表小d 的取反, 就是除0-9 数字意外的单个字符  相当于<code class="language-plaintext highlighter-rouge">[^\d]</code></strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">\s</code>   代表空白字符, 包括空格, \t, \n table 等键 的单个字符 ,相当于 <code class="language-plaintext highlighter-rouge">[ \t\r\n\f\v]</code> 这段前面有个空格</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">\S</code> 小 s 的取反,  代表除了空白字符之外的所有单个字符 相当于<code class="language-plaintext highlighter-rouge">[^\s]</code></strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">\w</code> 所有中英文字母, 数字, 下划线_, 的单个字符  相当于<code class="language-plaintext highlighter-rouge">[A-Za-z0-9_]</code></strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">\W</code> 小 w的取反, 空格, 中划线-, 各种符号等的单个字符 相当于<code class="language-plaintext highlighter-rouge">[^\w]</code></strong></li>
</ul>

<h4 id="原始正则-r">原始正则 <code class="language-plaintext highlighter-rouge">r</code></h4>

<blockquote>
  <ul>
    <li>如果原始文本中有 \d , \n 等符号,我们需要在普通的正在 \d 前加二根斜线 或三根斜线 <code class="language-plaintext highlighter-rouge">'\\\\n'</code> 才能匹配到</li>
    <li>可以在普通正在前面加 <code class="language-plaintext highlighter-rouge">r</code> 就可以用一根斜线进行转义 \d 了</li>
    <li><code class="language-plaintext highlighter-rouge">r</code>，可以将该字符串标记为原始字符串，它不包括转义字符</li>
    <li>正则前面加 r 和 普通字符串前面加 r 是不一样的, 普通字符串前面加 r 是让字符串中的特殊字符失去意义. 但在正则前面加 r 的意思是帮我们省略了几个转义斜线.</li>
    <li>只要写正则的 patten, 需要习惯写上 <code class="language-plaintext highlighter-rouge">r</code></li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="se">\\</span><span class="s">d'</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'1lo你ve</span><span class="err">\</span><span class="s">d you very much好'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
<span class="c">#另一种</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="err">\</span><span class="s">d'</span><span class="p">)</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'1lo你ve</span><span class="err">\</span><span class="s">d you very much好'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="数量词----">数量词 <code class="language-plaintext highlighter-rouge">* + ? {}</code></h4>

<blockquote>
  <ul>
    <li>数量词用来修饰前面的单个字符可以出现多少次</li>
    <li><code class="language-plaintext highlighter-rouge">()</code> 组在正则中也可以被数量词来修饰</li>
  </ul>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">{}</code> : 来定义{}前面的单个字符的匹配次数 , 大括号里面填数字表示匹配次数</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d{3}'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'123love you'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">())</span> <span class="c"># 指定三个连续的数字</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">w{3}'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'lov-e you'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>  <span class="c"># 指定三个连续的文字</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">{m,}</code> : 定义{}前面的单个字符的匹配次数大于等于m次</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>re.compile(r'[a-z]{4,}').search('abcd love').group()
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">{,n}</code> : 定义{}前面的字符的匹配次数是0-n 次, 不太实用,所以不用记</p>

<p><code class="language-plaintext highlighter-rouge">{m,n}</code> : 定义{}前面的单个字符的匹配次数大于等于m次小于等于n次</p>
<blockquote>
  <ul>
    <li>能多则多原则,</li>
  </ul>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>re.compile(r'[a-z]{4,6}').search('abcd love').group() # 返回 abcdef
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">?</code> : 用来表示前面的单个字符或者组是可选的 , 表示0次或1次</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'n(um)?b'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'My number nb is 415-555-4242'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回 numb</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d?'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'12ddd345abcdef love'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回1</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d+[a-z]?</span><span class="err">\</span><span class="s">w?'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'12ddd345abcdef love'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回12dd</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d*[a-z]?[</span><span class="err">\</span><span class="s">w-]*'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'12ddd34-5ab-cd_f love'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回 12ddd34-5ab-cd_f</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">*</code> :用来表示前面的单个字符或者组是0次到无数次</p>
<blockquote>
  <ul>
    <li>相当于{0,}</li>
    <li>这里要注意的是 0 次, 既没有匹配到不会报错, 而是返回空,</li>
    <li>能多则多原则
      <div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d*'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'12345abcdef love'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c">#返回 12345</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d{3}[a-z]*'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'12345abcdef love'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c"># 返回123</span>
</pre></td></tr></tbody></table>
</div>
      </div>
    </li>
  </ul>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">+</code> :用来表示前面的单个字符或者组是1次或无数次</p>
<blockquote>
  <ul>
    <li>这里要记得, 需要最少要有一次.</li>
    <li>等同于 <code class="language-plaintext highlighter-rouge">{1,}</code></li>
    <li>能多则多原则</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d*[a-z ]+'</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'12ddd345abcdef love'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c">#返回 12ddd</span>

<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'[a-z]{2}</span><span class="err">\</span><span class="s">d+'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'love you100 baby'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c">#返回 ou100</span>

<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'[</span><span class="err">\</span><span class="s">sa-z]{2,}</span><span class="err">\</span><span class="s">d+'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'_ou=100 d-angou a</span><span class="se">\t</span><span class="s">ou100 baby'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回angou a\tou100</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="边界修饰符--词边界---b-b">边界修饰符 , 词边界 <code class="language-plaintext highlighter-rouge">^ $ \b \B</code></h4>
<p><code class="language-plaintext highlighter-rouge">^</code> :  用你写的正则表达式 匹配字符串的开头,  如果多行模式 <code class="language-plaintext highlighter-rouge">re.M</code> 时, 匹配每一行的开头</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'^love'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'love u baby'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c"># 返回 love, 这个和 match</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'^</span><span class="err">\</span><span class="s">s[a-z]{2}</span><span class="err">\</span><span class="s">d+'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'</span><span class="se">\t</span><span class="s">ou100 baby'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回 \tou100</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">$</code> : 用你写的正则表达式 匹配字符串的末尾,  如果多行模式 <code class="language-plaintext highlighter-rouge">re.M</code> 时, 匹配每一行的末尾</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'[</span><span class="err">\</span><span class="s">sa-z]{2,}</span><span class="err">\</span><span class="s">d+$'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'_ou=100 d-angou a</span><span class="se">\t</span><span class="s">ou100'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c"># 返回 angou a\tou100</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">^$</code> : 同时使用 , 这种模式就是全字符串匹配, 必须完整匹配</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'^[</span><span class="err">\</span><span class="s">sa-z]{2,}</span><span class="err">\</span><span class="s">d+$'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'ouydangouaou100'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回'ouydangouaou100'</span>

<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'^[</span><span class="err">\</span><span class="s">sa-z]{2,}</span><span class="err">\</span><span class="s">d+$'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'ouydan100gouaou100'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 报错, 因为没有办法匹配到中间的100</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">\b \B</code> :  词边界, 分割单词的边界 , 用的很少</p>
<blockquote>
  <ul>
    <li>词边界: 除了 \w 都是词边界(\W 等于是词边界)</li>
    <li><code class="language-plaintext highlighter-rouge">\b</code> : 词边界</li>
    <li><code class="language-plaintext highlighter-rouge">\B</code> : 非词边界</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">bis</span><span class="err">\</span><span class="s">b'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'izslaisnd  is isi s island'</span><span class="p">)</span> <span class="c"># 词边界, 返回 两边是空白(词边界)</span>

<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">Bis</span><span class="err">\</span><span class="s">B'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'izslaisnd  is isi s island'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 非词边界, 返回两边是字母的那个 is </span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="或-">或 <code class="language-plaintext highlighter-rouge">|</code></h4>

<blockquote>
  <ul>
    <li>
      <table>
        <tbody>
          <tr>
            <td>通过管道符</td>
            <td>可以在两个选项中匹配最先找到的对象</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li>管道符总是从最左边的规则开始去匹配, 一旦匹配到了就跳过其他右边的表达式</li>
    <li>管道符如果在() 中出现, 那么只在()中有效</li>
    <li>如果相匹配到真正的管道符, 就需要用 <code class="language-plaintext highlighter-rouge">\|</code> 来匹配了
```python
re.compile(r’555|415|4242’).search(‘My number is 415-555-4242’).group() # 返回415 ,</li>
  </ul>
</blockquote>

<table>
  <tbody>
    <tr>
      <td>re.compile(r’\d+</td>
      <td>[a-z]+’).search(‘abc123’).group() # 返回 abc</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>re.compile(r’ab123</td>
      <td>456de’).search(‘ab456de’).group() # 返回 456de</td>
    </tr>
  </tbody>
</table>

<p>re.compile(r’ab(123|456)de’).search(‘ab456de’).group() # 返回 ab456de</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre>
#### 分组 `()`

&gt; - 如果希望匹配到的内容可以分组, 就会用到分组方法
&gt; - 小括号的内部视为一个整体, 后面有修饰次数或者跟着边界符, 是对这个括号的修饰
- 正则表达式字符串中的第一对括号是第 1 组。第二对括号是第 2 组
- 向 `group()` 方法传入参数 1 或 2，就可以取得匹配文本的不同部分
- 向 `group()`方法传 入 0 或不传入参数，将返回整个匹配的文本
- 用 `groups()` 可以返回匹配到的多个对象的一个元组集合

```python
re.compile(r'([a-z]\d)+\w+').search('abc123llaa__--==$$aa').group() # 返回 c123llaa__
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{4})'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'My number is 415-555-4242'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回415-555-4242</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{4})'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'My number is 415-555-4242'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 返回415</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{4})'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'My number is 415-555-4242'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># 返回555</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{4})'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'My number is 415-555-4242'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c"># 返回4242</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">(正则1|正则2)+</code> :  分组或, 意思是前面的分组可以是 正则1, 也可以是2,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>re.compile(r'([a-z]\d|[-=#]-)+\w+').search('abc123llaa__--==$$aa').group()  # 返回 c123llaa__
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <ul>
    <li>将多个返回的匹配对象同时赋值</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{3})-(</span><span class="err">\</span><span class="s">d{4})'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'My number is 415-555-4242'</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="子模式-num">子模式 <code class="language-plaintext highlighter-rouge">\num</code></h4>

<ul>
  <li>正则表达式的小括号的第一个意思是它是一个整体</li>
  <li>第二个意思, 如果正则表达式中出现了小括号, 且匹配成功了, 那么第一个小括号匹配到的内容用 <code class="language-plaintext highlighter-rouge">\1</code> 表示, 第二个小括号匹配到的内容用 <code class="language-plaintext highlighter-rouge">\2</code> 表示. 如果不一样就会报错</li>
  <li>子模式可以用 <code class="language-plaintext highlighter-rouge">group(num)</code> 函数来显示匹配到的每个小括号中的内容, 参数1 代表第一个小括号匹配到的内容, 参数2 表示第二个小括号中的内容</li>
  <li><code class="language-plaintext highlighter-rouge">group()</code> 表示匹配到的整个内容</li>
  <li>没有子模式, 如果用 group(num) 就报错了</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d)(.*)(</span><span class="err">\</span><span class="s">d)'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'a1ca1c'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(</span><span class="err">\</span><span class="s">d)(.*)</span><span class="err">\</span><span class="s">1'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'a1ca1c'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c">#1</span>

<span class="c">#1 上面两行代码的执行结果类似, 第二种只有两个 group , 第一种有三个 group, 估计这就是区别, 可以少写很多括号和冗余正则表达式</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;([a-z]+)&gt;&lt;(</span><span class="err">\</span><span class="s">w+)&gt;</span><span class="err">\</span><span class="s">w+&lt;/</span><span class="err">\</span><span class="s">2&gt;&lt;/</span><span class="err">\</span><span class="s">1&gt;'</span><span class="p">)</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'hahaha&lt;div&gt;&lt;span&gt;今天学习的正则表达式很简答啊&lt;/span&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c"># 返回 &lt;div&gt;&lt;span&gt;今天学习的正则表达式很简答啊&lt;/span&gt;&lt;/div&gt;</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'hahaha&lt;div&gt;&lt;span&gt;今天学习的正则表达式很简答啊&lt;/span&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 返回 div</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'hahaha&lt;div&gt;&lt;span&gt;今天学习的正则表达式很简答啊&lt;/span&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># 返回 span</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">(?P&lt;goudan&gt;正则)</code>  和 <code class="language-plaintext highlighter-rouge">(?P=goudan)</code>: 和上面的子模式一个意思, 就是给小括号起个名字,</p>
<ul>
  <li>不过还是推荐用 <code class="language-plaintext highlighter-rouge">\1</code>, <code class="language-plaintext highlighter-rouge">\2</code>, 不推荐使用这种方式,因为看起来比较乱</li>
  <li>下面的代码和上面的代码相同
    <div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;(?P&lt;goudan&gt;[a-z]+)&gt;&lt;(?P&lt;dan&gt;</span><span class="err">\</span><span class="s">w+)&gt;</span><span class="err">\</span><span class="s">w+&lt;/(?P=dan)&gt;&lt;/(?P=goudan)&gt;'</span><span class="p">)</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'hahaha&lt;div&gt;&lt;span&gt;今天学习的正则表达式很简答啊&lt;/span&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'hahaha&lt;div&gt;&lt;span&gt;今天学习的正则表达式很简答啊&lt;/span&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">re</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'hahaha&lt;div&gt;&lt;span&gt;今天学习的正则表达式很简答啊&lt;/span&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
</ul>

<h4 id="贪婪和非贪婪">贪婪和非贪婪</h4>

<ul>
  <li>正则表达式默认都是贪婪模式, 指的是数量修饰词 <code class="language-plaintext highlighter-rouge">+ * {2,6}</code> , 能多匹配就多匹配</li>
  <li>不希望用贪婪模式的时候需要在数量词的后面用<code class="language-plaintext highlighter-rouge">?</code> 表示取消贪婪
    <ul>
      <li><code class="language-plaintext highlighter-rouge">*? +? ?? {m,n}?</code></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;div&gt;(.*)&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'&lt;div&gt;狗带最漂亮&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># 贪婪模式 返回 '狗带最漂亮&lt;/div&gt;&lt;/div&gt;'</span>

<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;div&gt;(.+?)&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'&lt;div&gt;狗带最漂亮&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 取消贪婪 , 返回 '狗带最漂亮'</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="模式修正">模式修正</h4>

<blockquote>
  <p>compile 有两个参数, 第一个参数是正则表达式, 第二个参数就是对第一个参数的修正, 下面是一些常用的修正符</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">re.I</code> : 忽略大小写</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'LOVE'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'I love you very much'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回 love</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">re.M</code> : 多行匹配模式</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="n">string</span> <span class="o">=</span> <span class="s">'''Iove you
love she
love he
'''</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'^love'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c"># 返回 love</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">re.S</code> : 单行模式, 把目标文本都放到一行里面,然后用正则表达式来匹配</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="n">string</span> <span class="o">=</span> <span class="s">'''&lt;div&gt;i
love
you
&lt;/div&gt;
'''</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;div&gt;(.*?)&lt;/div&gt;'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="c"># 返回 '&lt;div&gt;i\nlove\nyou\n&lt;/div&gt;'</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">re.DOTALL</code> : 让 <code class="language-plaintext highlighter-rouge">.</code> 可以匹配到换行符, 这种一般都是 <code class="language-plaintext highlighter-rouge">.*</code> 一起用</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'.*'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">'Serve the public trust.</span><span class="se">\n</span><span class="s">Protect the innocent. </span><span class="se">\n</span><span class="s">Uphold the law'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>  <span class="c"># 返回整个字符串; 如果不用 re.DOTALL, 则只能返回第一个换行符前面的部分.</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">re.VERBOSE</code> : 让你的正则容易看懂</p>
<blockquote>
  <p>注意,这里需要用 <code class="language-plaintext highlighter-rouge">''' '''</code> 来把正则表达式扩上, 这样就可以使用多行来表示了.</p>
  <div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">phoneRegex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'''(
(</span><span class="err">\</span><span class="s">d{3}|</span><span class="err">\</span><span class="s">(</span><span class="err">\</span><span class="s">d{3}</span><span class="err">\</span><span class="s">))?              # area code 
(</span><span class="err">\</span><span class="s">s|-|</span><span class="err">\</span><span class="s">.)?                      # separator
</span><span class="err">\</span><span class="s">d{3}                           # first 3 digits
(</span><span class="err">\</span><span class="s">s|-|</span><span class="err">\</span><span class="s">.)                       # separator
</span><span class="err">\</span><span class="s">d{4}                           # last 4 digits
(</span><span class="err">\</span><span class="s">s*(ext|x|ext.)</span><span class="err">\</span><span class="s">s*</span><span class="err">\</span><span class="s">d{2,5})?    # extension
)'''</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
  </div>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">|</code> 让多个修正符一起用</p>
<blockquote>
  <p>compile 只允许有两个参数, 当我们需要用到多个修正符的时候, 就需要用管道符来帮忙了
可以使用管道字符<code class="language-plaintext highlighter-rouge">|</code>将变量组合起来，从而绕过这个限 制</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">someRegexValue</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'foo'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="正则替换-sub">正则替换 <code class="language-plaintext highlighter-rouge">sub</code></h4>

<p><code class="language-plaintext highlighter-rouge">pattern.sub()</code> : 将正则匹配到的内容用字符串进行替换</p>
<ul>
  <li>第一个参数可以是替换的字符, 也可以是一个函数, 该函数的返回值必须是一个字符串</li>
  <li>如果使用函数作为参数, 那么函数的返回值需要是 string 类型, 如果不是, 则需要通过 str() 函数来转换</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d+'</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'35'</span><span class="p">,</span><span class="s">'python 班级里面的学生是34人'</span><span class="p">)</span>  <span class="c"># 返回 python 班级里面的学生是35人</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>用分组的数字 <code class="language-plaintext highlighter-rouge">\1 \2</code> 进行替换 , 例子是替换间谍名字</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'Agent </span><span class="err">\</span><span class="s">w*'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'Agent Alice told Agent Carol that Agent Eve knew Agent Bob was a double agent.'</span><span class="p">)</span>  <span class="c"># 返回 list ['Agent Alice', 'Agent Carol', 'Agent Eve', 'Agent Bob']</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'Agent (</span><span class="err">\</span><span class="s">w)</span><span class="err">\</span><span class="s">w*'</span><span class="p">)</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">1****'</span><span class="p">,</span><span class="s">'Agent Alice told Agent Carol that Agent Eve knew Agent Bob was a double agent.'</span><span class="p">)</span> <span class="c"># 返回 字符串 'A**** told C**** that E**** knew B**** was a double agent.'</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>使用函数作为参数例子1:  单纯的返回一个替换内容, 和 inline 方式一致
```python
import re</li>
</ul>

<p>def fn(a):			# 参数a 是默认传递进方法的参数, 是用search()匹配到的对象
    return “200”</p>

<p>ret = re.compile(r’\d+’).sub(fn, ‘python 班级里学生为100人’)
print(ret)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre>- 使用函数作为参数例子2:  将正则表达式匹配到的内容做处理后再替换

```python
import re		
str
def fn(a):		# 参数a 是默认传递进方法的参数, 是用search()匹配到的对象
    return str(int(a.group())+1)    # 将正则表达式匹配到的内容'100'做整型转换后加一后再返回

ret = re.compile(r'\d+').sub(fn, 'python 班级里学生为100人')
print(ret)
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="正则切割-split">正则切割 <code class="language-plaintext highlighter-rouge">split</code></h4>

<p><code class="language-plaintext highlighter-rouge">pattern.split()</code> : 按照正则进行匹配, 并用匹配到的内容对元字符串进行切分, 返回一个数组</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">d'</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'python 1班级里2面的学3生是3人'</span><span class="p">)</span>  <span class="c"># 返回['python ', '班级里', '面的学', '生是', '人']</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="look-around-环顾模式">Look Around 环顾模式</h4>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">xxx</code>可以是单个字符, 也可以是一个分组
以某个模式 <strong>xxx</strong> 为中心, 分为四种:</p>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">xxx(?=pattern)</code> :positive look ahead: xxx右是,  匹配到的内容不占空间</li>
    <li><code class="language-plaintext highlighter-rouge">xxx(?!pattern)</code> :negative look ahead xxx右非,  匹配到的内容不占空间</li>
    <li><code class="language-plaintext highlighter-rouge">(?&lt;=pattern)xxx</code> :positive look behind xxx左是,  匹配到的内容不占空间</li>
    <li><code class="language-plaintext highlighter-rouge">(?&lt;!pattern)xxx</code> :negative look behind xxx左非,  匹配到的内容不占空间</li>
    <li>括号内的算是子模式</li>
  </ul>
</blockquote>

<p><strong><code class="language-plaintext highlighter-rouge">xxx(?=pattern)</code>Look Ahead 右是</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">w+,'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'Serve the, public, trust'</span><span class="p">)</span>  <span class="c"># 匹配多个字母和一个逗号的连续 . 返回 ['the,', 'public,']</span>
<span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">w+(?=,)'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'Serve the, public, trust'</span><span class="p">)</span> <span class="c"># 和上一个一样, 只是不占用逗号. 返回 ['the', 'public']</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong><code class="language-plaintext highlighter-rouge">xxx(?!pattern)</code>Look Ahead 右非</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'</span><span class="err">\</span><span class="s">w+(?!,)'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'Serve the, public, trust'</span><span class="p">)</span> <span class="c"># 捕获连续字符,但字符右侧不是逗号的所有匹配. 返回 ['Serve', 'th', 'publi', 'trust']</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'Jahn(?!</span><span class="err">\</span><span class="s">sBmith)'</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s">'I shall rather out go out with Jahn McLume than with Jahn Bmith or Jahn Con Movi'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
	<span class="k">print</span> <span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">i</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>

<span class="c">#31 35  # 第一个 Jahn 的起始位置</span>
<span class="c">#67 71  # 第二个 Jahn 的起始位置</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong><code class="language-plaintext highlighter-rouge">(?&lt;=pattern)xxx</code> 左是</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>re.compile(r'(?&lt;=Jahn\s)McLume').findall('I shall rather out go out with Jahn McLume than with Jahn Bmith McLume or Jahn Con Movi') # 返回左边是 Jahn 的那个 McLume  # 返回 ['McLume']
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong><code class="language-plaintext highlighter-rouge">(?&lt;!pattern)xxx</code> 左非</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'(?&lt;!Jahn</span><span class="err">\</span><span class="s">s)Boe'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'Jahn Boe, Calvin Boe, Hobbey Boe'</span><span class="p">)</span> <span class="c"># 返回Boe 的左边不是 Jahn 的 Boe,  返回两个['Boe', 'Boe']</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>一个强密码的例子: 包含字母,数字特殊字符的密码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'''(
^(?![a-zA-z]+$)         # 从目标文本开头开始,到末尾, 右侧不能仅仅是大小写字母
(?!</span><span class="err">\</span><span class="s">d+$)                # 从目标文本开始到结束, 右侧不能仅仅是数字
(?![!@#$</span><span class="si">%</span><span class="s">^&amp;*]+$)        # .. 不能仅仅是特殊字符
(?![a-zA-z</span><span class="err">\</span><span class="s">d]+$)        # .. 不能仅仅是字母和数字
(?![a-zA-z!@#$</span><span class="si">%</span><span class="s">^&amp;*]+$)  # .. 不能仅仅是字母和特殊字符
(?![</span><span class="err">\</span><span class="s">d!@#$</span><span class="si">%</span><span class="s">^&amp;*]+$)      # .. 不能仅仅是数字和特殊字符
[a-zA-Z</span><span class="err">\</span><span class="s">d!@#$</span><span class="si">%</span><span class="s">^&amp;*]+$    # 的 包含字母,数字和特殊字符的多个, 直到末尾
)'''</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'''
Satoshi Nakamoto
x21#$
Alice Nakamoto
RoboCop Nakamoto
'''</span><span class="p">))</span>
<span class="c"># 返回 x21#$</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="几道练习题">几道练习题</h4>

<blockquote>
  <p>写一个正则表达式，匹配每 3 位就有一个逗号的数字?它必须匹配以
下数字:
‘42’
‘1,234’
‘6,368,745’
但不会匹配:
‘12,34,567’ (逗号之间只有两位数字) 
‘1234’ (缺少逗号)</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'''(
^</span><span class="err">\</span><span class="s">d{1,3}		#1
(,</span><span class="err">\</span><span class="s">d{3})*$		 #2
)'''</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">'6,368,745'</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">())</span> 

<span class="c">#1 用^$来全字符串匹配,防止只匹配到部分数字的情况; 第一个逗号左边的三位数可以是1-3位</span>
<span class="c">#2 逗号和后面位数字是一个整体,会一起出现,且是0次到无数次</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>如何写一个正则表达式，匹配姓 Nakamoto 的完整姓名?你可以假定名字 总是出现在姓前面，是一个大写字母开头的单词。该正则表达式必须匹配:
 ‘Satoshi Nakamoto’
 ‘Alice Nakamoto’
 ‘RoboCop Nakamoto’
 但不匹配:
 ‘satoshi Nakamoto’(名字没有大写首字母)
 ‘Mr. Nakamoto’(前面的单词包含非字母字符)
 ‘Nakamoto’ (没有名字)
 ‘Satoshi nakamoto’(姓没有首字母大写)</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'''(
^[A-Z][A-Za-z]+
</span><span class="err">\</span><span class="s">s
Nakamoto$
)'''</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'''
Satoshi Nakamoto
Alice Nakamoto
RoboCop Nakamoto
satoshi Nakamoto
Mr. Nakamoto
Nakamoto
Satoshi nakamoto
'''</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>如何编写一个正则表达式匹配一个句子，它的第一个词是 Alice、Bob 或
Carol，第二个词是 eats、pets 或 throws，第三个词是 apples、cats 或 baseballs。
该句 子以句点结束。这个正则表达式应该不区分大小写。它必须匹配:
‘Alice eats apples.’
‘Bob pets cats.’
‘Carol throws baseballs.’
‘Alice throws Apples.’
‘BOB EATS CATS.’
但不匹配:
‘RoboCop eats apples.’
‘ALICE THROWS FOOTBALLS.’
‘Carol eats 7 cats.’</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'''(
^(Alice|Bob|Carol)</span><span class="err">\</span><span class="s">s+
(eats|pets|throws)</span><span class="err">\</span><span class="s">s+
(apples|cats|baseballs)</span><span class="err">\</span><span class="s">.$
)'''</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'''
Alice eats apples.
Bob pets cats.
Carol throws baseballs.
Alice throws Apples.
BOB EATS CATS.
RoboCop eats apples.
ALICE THROWS FOOTBALLS.
Carol eats 7 cats.
'''</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p><strong>强密码</strong>: 写一个函数，它使用正则表达式，确保传入的口令字符串是强口令。强口令的 定义是:长度不少于 8 个字符，同时包含大写和小写字符，至少有一位数字。你可 能需要用多个正则表达式来测试该字符串，以保证它的强度。</p>
</blockquote>

<h2 id="24-web-数据爬取">2.4 Web 数据爬取</h2>

<h3 id="urllib---网页内容抓取">urllib - 网页内容抓取</h3>

<ul>
  <li>需要导入 urllib 模块  <code class="language-plaintext highlighter-rouge">from urllib import request</code> or <code class="language-plaintext highlighter-rouge">import urllib.request</code></li>
  <li>然后再用正则来过滤数据,  <code class="language-plaintext highlighter-rouge">import re</code> , 这里面最常用正则函数是 findall()</li>
  <li><strong>urllib 与 MAC 电脑:</strong>  因为证书问题, 打开 https 会报错, 需要加入下面的代码来防止这个问题</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>####<strong>urlopen的基本使用方法</strong></p>
<ul>
  <li>注意: 当读取的数据是进制形式, 那么需要用 decode() 函数取解码, 网页用什么进行的编码, 那么就要用什么去解码.  网页上的编码在 HTML 中 <code class="language-plaintext highlighter-rouge">&lt;meta charset='utf-8'&gt;</code></li>
</ul>

<h4 id="获取http-状态码-和-url-地址"><strong>获取http 状态码 和 URL 地址</strong></h4>

<p>http请求传递给web 服务器后，web服务器会返回给我们一个状态码<code class="language-plaintext highlighter-rouge">&lt;meta charset='utf-8'&gt;</code></p>

<p>200s: 成功 消息
300s: 跳转消息
400s: 客户端错误消息
500s: 服务器端错误消息</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'http://bbs.tianya.cn/m/post-140-393974-6.shtml'</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># 返回一个 URL open 对象</span>
<span class="c">#print(response.read().decode('utf-8')) #  默认是 rb 形式读取, 需要指定 读取的code 编码</span>

<span class="c">#读取数据</span>

<span class="c"># response.read()               # 读取全部数据</span>
<span class="c"># response.readline()           # 读取一行数据</span>
<span class="c"># data = response.readlines()     # 读取全部数据,返回一个列表</span>
<span class="c"># for line in data:</span>
<span class="c">#     print(line.decode('utf-8')) # 遍历返回装有数据的列表并进行解码</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getcode</span><span class="p">())</span>       <span class="c"># 获取返回的 http 状态码</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">geturl</span><span class="p">())</span>        <span class="c"># 获取 url 地址 .</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="异常捕获--timeout"><strong>异常捕获- timeout</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># 返回一个 URL 对象 , 如果在 timeout 规定时间内没有返回, 就报错</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'我们都知道你有异常了'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="url-的-解码"><strong>URL 的 解码</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'https://image.baidu.com/search/index?tn=baiduimage&amp;ct=201326592&amp;lm=-1&amp;cl=2&amp;ie=gbk&amp;word=</span><span class="si">%</span><span class="s">C3</span><span class="si">%</span><span class="s">C0</span><span class="si">%</span><span class="s">C5</span><span class="si">%</span><span class="s">AE&amp;fr=ala&amp;ala=1&amp;alatpl=adress&amp;pos=0&amp;hs=2&amp;xthttps=111111'</span>

<span class="n">myUrl</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">request</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">myUrl</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">myUrl</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="get-post-请求url-地址的拼接"><strong>GET POST 请求URL 地址的拼接</strong></h4>
<p>域名 + 路径 + ? 参数名 = 参数值 &amp; 参数名 = 参数值 ….</p>

<p><strong>GET</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">parse</span> <span class="c"># Base URL being accessed</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'http://httpbin.org/get'</span>
<span class="c"># Dictionary of query parameters (if any)</span>
<span class="n">parms</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name1'</span> <span class="p">:</span> <span class="s">'value1'</span><span class="p">,</span> <span class="s">'name2'</span> <span class="p">:</span> <span class="s">'value2'</span><span class="p">}</span>
<span class="c"># Encode the query string</span>
<span class="n">querystring</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">parms</span><span class="p">)</span>  <span class="c"># 处理get 需要传递的参数</span>

<span class="c"># Make a GET request and read the response</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="o">+</span><span class="s">'?'</span> <span class="o">+</span> <span class="n">querystring</span><span class="p">)</span> <span class="c"># 拼接参数</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>POST</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">parse</span> <span class="c"># Base URL being accessed</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">'http://httpbin.org/post'</span>
<span class="c"># Dictionary of query parameters (if any)</span>
<span class="n">parms</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name1'</span> <span class="p">:</span> <span class="s">'value1'</span><span class="p">,</span> <span class="s">'name2'</span> <span class="p">:</span> <span class="s">'value2'</span><span class="p">}</span>
<span class="c"># Encode the query string</span>
<span class="n">querystring</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">parms</span><span class="p">)</span>  <span class="c"># 处理post 需要传递的参数</span>

<span class="c"># Make a GET request and read the response</span>
<span class="c"># u = request.urlopen(url+'?' + querystring) # 拼接参数</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">querystring</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="urlretrieve-图片下载"><code class="language-plaintext highlighter-rouge">urlretrieve()</code> 图片下载</h4>
<p>通过函数下载图片
url 是图片网址
path 是文件保存路径</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="练习">练习:</h4>
<p><strong>1. 匹配手机, 邮箱, QQ号</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://bbs.tianya.cn/m/post-140-393974-6.shtml'</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="c">#匹配手机号</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'[1][3-8][0-9]{9}'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="c">#匹配邮箱</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'</span><span class="err">\</span><span class="s">w+@</span><span class="err">\</span><span class="s">w+</span><span class="err">\</span><span class="s">.</span><span class="err">\</span><span class="s">w+'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="c">#匹配 QQ号</span>
<span class="k">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'(qq:|QQ:)([1-9]</span><span class="err">\</span><span class="s">d{5,10})'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>2. 匹配图书的 书名 和 封面的图片, 并写入到新的 html 文件中</strong></p>
<blockquote>
  <p>网页爬取技巧:</p>
  <ul>
    <li>如果可能,先把需要爬取的目标 网页的源代码通过 <code class="language-plaintext highlighter-rouge">data = request.urlopen(url).read().decode('utf-8')</code> 打印出来,然后存到一个临时的文件中.</li>
    <li>先找到要匹配的html内容的 samples , 如果是重复的, 那就多找个, 放在代码中注释掉, 这样比较方便进行观察, 写出对应的正则表达式</li>
    <li>把 sample 直接放到正则表达式的 compile 中.</li>
    <li>通过 pycharm 高亮可以看到需要把正则表达式中的什么字符进行转义.</li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'https://book.douban.com/latest?icn=index-latesbook-all'</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="c"># print(data)</span>

<span class="c">#书名的</span>
<span class="s">'''
&lt;a href="https://book.douban.com/subject/27156672/"&gt;梁光正的光&lt;/a&gt;
&lt;a href="https://book.douban.com/subject/27115000/"&gt;高效能阅读&lt;/a&gt;
&lt;a href="https://book.douban.com/subject/27156306/"&gt;现实不似你所见&lt;/a&gt;
'''</span>

<span class="n">booknames</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;a href="https://book</span><span class="err">\</span><span class="s">.douban</span><span class="err">\</span><span class="s">.com/subject/</span><span class="err">\</span><span class="s">d+/"&gt;.*&lt;/a&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">booknames</span><span class="p">)</span>
<span class="c">#图片的标签</span>
<span class="s">'''
&lt;img src="https://img3.doubanio.com/mpic/s29610044.jpg"/&gt;
&lt;img src="https://img3.doubanio.com/mpic/s29563532.jpg"/&gt;
&lt;img src="https://img3.doubanio.com/mpic/s29560886.jpg"/&gt;
'''</span>
<span class="k">print</span><span class="p">(</span><span class="s">'#'</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">imgs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;img src="https://img</span><span class="err">\</span><span class="s">d</span><span class="err">\</span><span class="s">.doubanio</span><span class="err">\</span><span class="s">.com/mpic/s</span><span class="err">\</span><span class="s">d+</span><span class="err">\</span><span class="s">.jpg"/&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">'./books.html'</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">imgs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">booknames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>3. 股票信息抓取</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="c">#股票抓取</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
<span class="c"># 多页抓取 1 - 46页</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[</span> <span class="s">'http://quote.stockstar.com/stock/sha_3_1_'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">'.html'</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">46</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>

    <span class="n">rowdata</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'gb2312'</span><span class="p">)</span>
    <span class="n">htmlData</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;tbody class="tbody_right" id="datalist"&gt;(.*?)&lt;/tbody&gt;'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">rowdata</span><span class="p">)</span>
    <span class="n">stockData</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&gt;(.*?)&lt;'</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">htmlData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">while</span> <span class="s">''</span> <span class="ow">in</span> <span class="n">stockData</span><span class="p">:</span>
        <span class="n">stockData</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">stockData</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">stockData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">=</span> <span class="s">","</span><span class="p">)</span>
        <span class="n">stockData</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">stockData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="mi">12</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>4. 图片下载</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="c"># 图片下载</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'https://book.douban.com/latest?icn=index-latesbook-all'</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">imgData</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">r'&lt;img src="(https://img3</span><span class="err">\</span><span class="s">.doubanio</span><span class="err">\</span><span class="s">.com/mpic/s</span><span class="err">\</span><span class="s">d+</span><span class="err">\</span><span class="s">.jpg)"/&gt;'</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">imgData</span><span class="p">)</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">'./downloadImgs'</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">imgData</span><span class="p">:</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'/'</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">newFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">newFile</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>模拟浏览器请求</strong></p>
<blockquote>
  <ul>
    <li>有的时候我们去爬取一些数据, 发现网页会返回错误: 403 forbidden ,  如果加上 User -Agent 参数, 就可以正常访问了.</li>
    <li>查看浏览器 User-Agent 的方式
      <blockquote>
        <ul>
          <li>Safari: 进入 Develop 菜单, 查看 User Agent</li>
        </ul>
      </blockquote>
    </li>
  </ul>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="c"># 模拟 Safari 的 User Agent 去访问网页</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">ssl</span>
<span class="n">ssl</span><span class="o">.</span><span class="n">_create_default_https_context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">_create_unverified_context</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://www.webometrics.info/en/Asia'</span>
<span class="n">myAgent</span> <span class="o">=</span> <span class="p">{</span><span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_1) AppleWebKit/604.3.5 (KHTML, like Gecko) Version/11.0.1 Safari/604.3.5'</span><span class="p">}</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">myAgent</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="requests-模块-获取网页内容">requests 模块 获取网页内容</h3>
<ul>
  <li>和 urllib 模块的 request 类似, 都可以用来抓取网页</li>
  <li>好处是对于 mac 电脑, 不会遇到ssl 报错, 也不需要 import ssl 了</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="c"># 打开网页, 获取内容,并写入到文件中</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://bbs.tianya.cn/m/post-140-393974-6.shtml'</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span>
<span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">250</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="s">'./temp1.txt'</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>    <span class="c"># 文件需要以二进制形式写入</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>  <span class="c"># iter_content 是一个迭代器,可以按块返回二进制形式网页内容</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="用-beautifulsoup-模块-配合-requests-模块-解析-html">用 BeautifulSoup 模块 配合 requests 模块, 解析 HTML</h3>
<ul>
  <li>beautifulsoup 模块是用来快速提取 html 标签中的信息的, 可以降低复杂的正则表达式来匹配数据的工作量</li>
  <li>简称 bs4</li>
  <li>该模块需要通过 pip 进行安装扩展后才能通过  <code class="language-plaintext highlighter-rouge">import bs4</code> 在代码中导入</li>
  <li>bs4 的 select() 方法使用范例</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">选择器</th>
      <th style="text-align: left">将匹配</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">soup.select(‘div’)</td>
      <td style="text-align: left">所有名为<code class="language-plaintext highlighter-rouge">&lt;div&gt;</code>的元素</td>
    </tr>
    <tr>
      <td style="text-align: left">soup.select(‘#author’)</td>
      <td style="text-align: left">带有 id 属性为 author 的元素</td>
    </tr>
    <tr>
      <td style="text-align: left">soup.select(‘.notice’)</td>
      <td style="text-align: left">所有使用 CSS class 属性名为 notice 的元素</td>
    </tr>
    <tr>
      <td style="text-align: left">soup.select(‘div span’)</td>
      <td style="text-align: left">所有在<code class="language-plaintext highlighter-rouge">&lt;div&gt;</code>元素之内的<code class="language-plaintext highlighter-rouge">&lt;span&gt;</code>元素</td>
    </tr>
    <tr>
      <td style="text-align: left">soup.select(‘div &gt; span’)</td>
      <td style="text-align: left">所有直接在<code class="language-plaintext highlighter-rouge">&lt;div&gt;</code>元素之内的<code class="language-plaintext highlighter-rouge">&lt;span&gt;</code>元素，中间没有其他元素</td>
    </tr>
    <tr>
      <td style="text-align: left">soup.select(‘input[name]’)</td>
      <td style="text-align: left">所有名为<code class="language-plaintext highlighter-rouge">&lt;input&gt;</code>，并有一个 name 属性，其值无所谓的元素</td>
    </tr>
    <tr>
      <td style="text-align: left">soup.select(‘input[type=”button”]’)</td>
      <td style="text-align: left">所有名为<code class="language-plaintext highlighter-rouge">&lt;input&gt;</code>，并有一个 type 属性，其值为 button 的元素</td>
    </tr>
  </tbody>
</table>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>pip3.7 install beautifulsoup4
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">bs4</span><span class="o">,</span> <span class="nn">requests</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'https://book.douban.com/latest?icn=index-latesbook-all'</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">res</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="s">"html.parser"</span><span class="p">)</span>
<span class="c">#获取书名</span>
<span class="n">booknames</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">'.detail-frame &gt; h2 &gt; a'</span><span class="p">)</span>
<span class="c">#获取书的图片</span>
<span class="n">bookimgs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">'.cover &gt; img'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">booknames</span><span class="p">)</span>  <span class="c"># 返回一个list 每个元素都类似于 &lt;a href="https://book.douban.com/subject/27156672/"&gt;梁光正的光&lt;/a&gt;</span>
<span class="k">print</span><span class="p">(</span><span class="n">bookimgs</span><span class="p">)</span>   <span class="c"># 返回一个list, 每个元素都类似于  &lt;img src="https://img3.doubanio.com/mpic/s29563532.jpg"/&gt;</span>
<span class="k">print</span><span class="p">(</span><span class="s">'#'</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">booknames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getText</span><span class="p">())</span>  <span class="c"># 获取第一个书元素的文本信息, 返回 梁光正的光</span>
<span class="k">print</span><span class="p">(</span><span class="n">bookimgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>   <span class="c"># 获取第一个书元素的属性信息, 返回字典 {'src': 'https://img3.doubanio.com/mpic/s29596185.jpg'}</span>
<span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">booknames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="c"># 将 html 元素对象转换成字符串对象 返回 &lt;a href="https://book.douban.com/subject/27156672/"&gt;梁光正的光&lt;/a&gt;</span>
<span class="k">print</span><span class="p">(</span><span class="n">bookimgs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'src'</span><span class="p">))</span> <span class="c"># 获取一个元素的属性值 , 返回 https://img3.doubanio.com/mpic/s29596185.jpg</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="webbrowser--打开操作系统默认浏览器">webbrowser – 打开操作系统默认浏览器</h3>
<p><a href="https://docs.python.org/3.7/library/webbrowser.html">官方文档</a></p>

<blockquote>
  <p>这个模块，可以方便地调用系统默认浏览器，并打开/刷新页面
如果使用shell 命令行调用webbrowser 需要确认 pip 是否安装了这个模块 
<code class="language-plaintext highlighter-rouge">pip3.7 install webbrowser</code></p>
</blockquote>

<ul>
  <li>命令行调用webbrowser 的方法</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python -m webbrowser -t <span class="s2">"http://www.python.org"</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码中使用</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">webbrowser</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'http://docs.python.org/'</span>

<span class="c"># Open URL in a new tab, if a browser window is already open.</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c"># Open URL in new window, raising the window if possible.</span>
<span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="用-selenium-模块控制浏览器">用 selenium 模块控制浏览器</h3>
<p><a href="http://selenium-python.readthedocs.io">官方网址</a></p>

<blockquote>
  <p><strong>selenium 可以配合其他爬虫模块(urllib, requests 等)爬取哪些需要登录认证的页面.</strong></p>

  <ul>
    <li>selenium 模块让 Python 直接控制浏览器，实际点击链接，填写登录信息，几乎 就像是有一个人类用户在与页面交互. 与 Requests 和 Beautiful Soup 相比，Selenium 允许你用高级得多的方式与网页交互。</li>
    <li>selenium 对 firefox 浏览器比较友好, 建议使用 selenium 操作 firefox</li>
    <li>需要提前安装 selenium 并下载 mozilla/geckodriver 驱动( 否则会报 selenium.common.exceptions.WebDriverException: Message: ‘geckodriver’ executable needs to be in PATH 错误 )</li>
  </ul>

</blockquote>

<ul>
  <li>需要先通过 pip 安装 selenium 模块</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>pip3.7 install selenium
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>下载mozilla/geckodriver 驱动</li>
  <li>下载 geckodriverckod   地址： <a href="https://github.com/mozilla/geckodriver/releases">mozilla/geckodriver</a>解压后将geckodriverckod 存放至 /usr/local/bin/ 路径下即可sudo mv ～/Downloads/geckodriver /usr/local/bin/</li>
</ul>

<h4 id="启动-selenium-控制的浏览器">启动 selenium 控制的浏览器</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">browser</span><span class="p">))</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://inventwithpython.com'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="寻找html-元素">寻找html 元素</h4>

<blockquote>
  <p>WebDriver 对象有好几种方法，用于在页面中寻找元素。它们被分成 <code class="language-plaintext highlighter-rouge">find_element_*</code>和 <code class="language-plaintext highlighter-rouge">find_elements_*</code>方法。<code class="language-plaintext highlighter-rouge">find_element_*</code>方法返回一个 WebElement 对象，代表页面中 匹配查询的第一个元素。<code class="language-plaintext highlighter-rouge">find_elements_*</code>方法返回 <code class="language-plaintext highlighter-rouge">WebElement_*</code>对象的列表，包含 页面中所有匹配的元素。</p>
</blockquote>

<p><strong>表 11-3 selenium 的 WebDriver 方法，用于寻找元素</strong></p>

<table>
  <thead>
    <tr>
      <th>方法名</th>
      <th>返回的 WebElement 对象/列表</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>browser.find_element_by_class_name(name)</td>
      <td>使用 CSS 类 name 的元素</td>
    </tr>
    <tr>
      <td>browser.find_elements_by_class_name(name)</td>
      <td> </td>
    </tr>
    <tr>
      <td>browser.find_element_by_css_selector(selector)</td>
      <td>匹配 CSS selector 的元素</td>
    </tr>
    <tr>
      <td>browser.find_elements_by_css_selector(selector)</td>
      <td> </td>
    </tr>
    <tr>
      <td>browser.find_element_by_id(id)</td>
      <td>匹配 id 属性值的元素</td>
    </tr>
    <tr>
      <td>browser.find_elements_by_id(id)</td>
      <td> </td>
    </tr>
    <tr>
      <td>browser.find_element_by_link_text(text)</td>
      <td>完全匹配提供的 text 的<code class="language-plaintext highlighter-rouge">&lt;a&gt;</code>元素</td>
    </tr>
    <tr>
      <td>browser.find_elements_by_link_text(text)</td>
      <td> </td>
    </tr>
    <tr>
      <td>browser.find_element_by_partial_link_text(text)</td>
      <td>包含提供的 text 的<code class="language-plaintext highlighter-rouge">&lt;a&gt;</code>元素</td>
    </tr>
    <tr>
      <td>browser.find_elements_by_partial_link_text(text)</td>
      <td> </td>
    </tr>
    <tr>
      <td>browser.find_element_by_name(name)</td>
      <td>匹配 name 属性值的元素</td>
    </tr>
    <tr>
      <td>browser.find_elements_by_name(name)</td>
      <td> </td>
    </tr>
    <tr>
      <td>browser.find_element_by_tag_name(name)</td>
      <td>匹配标签 name 的元素 (大小写无关，<code class="language-plaintext highlighter-rouge">&lt;a&gt;</code>元素匹配<code class="language-plaintext highlighter-rouge">'a'</code>和<code class="language-plaintext highlighter-rouge">'A'</code>)</td>
    </tr>
    <tr>
      <td>browser.find_elements_by_tag_name(name)</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<blockquote>
  <ul>
    <li>除了*_by_tag_name()方法，所有方法的参数都是区分大小写的。如果页面上没 有元素匹配该方法要查找的元素，selenium 模块就会抛出 NoSuchElement 异常。如 果你不希望这个异常让程序崩溃，就在代码中添加 try 和 except 语句。</li>
    <li>一旦有了 WebElement 对象，就可以读取表 11-4 中的属性，或调用其中的方法， 了解它的更多功能。</li>
  </ul>
</blockquote>

<p><strong>表 11-4 WebElement 的属性和方法</strong></p>

<table>
  <thead>
    <tr>
      <th>属性或方法</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>tag_name</td>
      <td>标签名，例如 ‘a’表示<code class="language-plaintext highlighter-rouge">&lt;a&gt;</code>元素</td>
    </tr>
    <tr>
      <td>get_attribute(name)</td>
      <td>该元素 name 属性的值</td>
    </tr>
    <tr>
      <td>text</td>
      <td>该元素内的文本，例如<code class="language-plaintext highlighter-rouge">&lt;span&gt;</code>hello<code class="language-plaintext highlighter-rouge">&lt;/span&gt;</code>中的’hello’</td>
    </tr>
    <tr>
      <td>clear()</td>
      <td>对于文本字段或文本区域元素，清除其中输入的文本</td>
    </tr>
    <tr>
      <td>is_displayed()</td>
      <td>如果该元素可见，返回 True，否则返回 False</td>
    </tr>
    <tr>
      <td>is_enabled()</td>
      <td>对于输入元素，如果该元素启用，返回 True，否则返回 False</td>
    </tr>
    <tr>
      <td>is_selected()</td>
      <td>对于复选框或单选框元素，如果该元素被选中，选择 True，否则返回 False</td>
    </tr>
    <tr>
      <td>location</td>
      <td>一个字典，包含键’x’和’y’，表示该元素在页面上的位置</td>
    </tr>
  </tbody>
</table>

<p><strong>在网页中找到链接, 并点击链接</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://book.douban.com/latest?icn=index-latesbook-all'</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="s">'梁光正的光'</span><span class="p">)</span>  <span class="c"># 根据一个链接文本,获取到链接元素</span>
    <span class="k">print</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">tag_name</span><span class="p">)</span>
    <span class="n">elem</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>    <span class="c"># 找到书后点击这本书</span>

<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'没有找到需要找的 html 元素'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>填写 form 表单并提交</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="n">browser</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
<span class="n">browser</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://cn.bing.com'</span><span class="p">)</span>
<span class="n">searchbox</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="n">find_element_by_id</span><span class="p">(</span><span class="s">'sb_form_q'</span><span class="p">)</span>
<span class="n">searchbox</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s">'python'</span><span class="p">)</span>
<span class="n">searchbox</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="25-线程-进程-协程">2.5 线程 进程 协程</h2>

<p><a href="https://www.cnblogs.com/suoning/p/5599030.html">参考文档</a></p>

<p><a href="https://docs.python.org/3.7/library/threading">官方线程文档</a></p>

<p><a href="http://blog.csdn.net/u014745194/article/details/70833003">进程和线程的对比总结</a></p>

<p><strong>多任务</strong></p>

<p>操作系统都可以执行多任务</p>

<p><strong>单核 CPU如何执行多任务?</strong></p>

<p>一秒=1000毫秒, 一毫秒=1000微妙</p>

<blockquote>
  <p>操作系统轮流让各个任务交替执行, 但任务量远远超过 CPU 的核心数量, 所以操作系统会让每个任务轮流执行. 因为 cpu调度速度快, 所以看起来是同时执行的</p>
</blockquote>

<p><strong>多核 CPU执行任务</strong></p>

<p>还是 CPU 轮训调度</p>

<ol>
  <li>并发: 看上去是一起执行的, 但其实当任务多于核心数时,还是轮训执行的</li>
  <li>并行: 只有当任务数少于核心数时,才是真正的并行执行, 同时执行任务.</li>
  <li>并发是逻辑上的同时执行, 并行是物理上的同时执行.</li>
</ol>

<p><strong>进程的概念</strong></p>

<p>对于操作系统而言, 一个任务就是一个进程</p>

<p>(1). 单任务</p>

<p>​	需要等待当前代码执行完毕后,再执行下一段代码</p>

<p>(2). 多任务(多进程)</p>

<p>​</p>

<h3 id="线程">线程</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">help</span><span class="p">()</span>

<span class="n">threading</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="线程概念"><strong>线程概念</strong></h4>

<blockquote>
  <ul>
    <li>如果是需要大量请求网络的工作, 尽量用多线程.你完全可以放心的创建几千个 Python 线程，现代操作系统运行这么多线程没有任何压力，没啥可担心的.</li>
    <li>依赖于 CPU 进行大量计算的工作, 尽量用多进程来分散计算量, 并行计算后可加快输出结果.</li>
    <li>在一个进程的内部想干多件事情, 就需要同时运行多个子任务, 我们把每个子任务成为线程</li>
    <li>一个进程的多个线程是共享内存空间的</li>
    <li>线程是应用程序中工作的最小单元，它被包含在进程之中，是进程中的实际运作单位。</li>
    <li>一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。</li>
    <li>主线程概念:
      <ul>
        <li>任何进程都有一个默认的主线程, 如果主线程死掉, 子线程也同时死掉, 所以子线程依赖于主线程</li>
        <li>对比看, 主进程死掉,子进程不会死掉</li>
      </ul>
    </li>
    <li>线程模块
      <ul>
        <li><code class="language-plaintext highlighter-rouge">_thread</code> : 老版本的低级模块</li>
        <li><code class="language-plaintext highlighter-rouge">threading</code> : 高级模块, 对_thread 进行了封装, 用的较多</li>
      </ul>
    </li>
  </ul>
</blockquote>

<p><strong>python 使用线程</strong></p>

<blockquote>
  <p>需要导入 threading 模块</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">threading</span><span class="o">.</span>
<span class="n">threading</span><span class="o">.</span><span class="n">active_count</span><span class="p">(</span>       <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">(</span>              
<span class="n">threading</span><span class="o">.</span><span class="n">activeCount</span><span class="p">(</span>        <span class="n">threading</span><span class="o">.</span><span class="n">main_thread</span><span class="p">(</span>       
<span class="n">threading</span><span class="o">.</span><span class="n">Barrier</span><span class="p">(</span>            <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">(</span>             
<span class="n">threading</span><span class="o">.</span><span class="n">BoundedSemaphore</span><span class="p">(</span>   <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span>         
<span class="n">threading</span><span class="o">.</span><span class="n">BrokenBarrierError</span><span class="p">(</span> <span class="n">threading</span><span class="o">.</span><span class="n">setprofile</span><span class="p">(</span>        
<span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">(</span>          <span class="n">threading</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span>          
<span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">(</span>     <span class="n">threading</span><span class="o">.</span><span class="n">stack_size</span><span class="p">(</span>        
<span class="n">threading</span><span class="o">.</span><span class="n">currentThread</span><span class="p">(</span>      <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>            
<span class="n">threading</span><span class="o">.</span><span class="nb">enumerate</span><span class="p">(</span>          <span class="n">threading</span><span class="o">.</span><span class="n">ThreadError</span><span class="p">(</span>       
<span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span>              <span class="n">threading</span><span class="o">.</span><span class="n">TIMEOUT_MAX</span>        
<span class="n">threading</span><span class="o">.</span><span class="n">get_ident</span><span class="p">(</span>          <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span>             
<span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">(</span>              <span class="n">threading</span><span class="o">.</span><span class="n">WeakSet</span><span class="p">(</span> 
    
<span class="o">&gt;&gt;&gt;</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">daemon</span>     <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">mro</span><span class="p">(</span>      
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">getName</span><span class="p">(</span>   <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">name</span>      
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">ident</span>      <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>      
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">is_alive</span><span class="p">(</span>  <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">(</span>   <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span>  
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">isDaemon</span><span class="p">(</span>  <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">start</span><span class="p">(</span>    
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>   
</pre></td></tr></tbody></table>
</div>
</div>

<p>thread方法：</p>

<ul>
  <li>t.start() : 激活线程</li>
  <li>t.getName() : 获取线程的名称</li>
  <li>t.setName() ： 设置线程的名称</li>
  <li>t.name : 获取或设置线程的名称</li>
  <li>t.is_alive() ： 判断线程是否为激活状态</li>
  <li>t.isAlive() ：判断线程是否为激活状态</li>
  <li>t.setDaemon() 设置为后台线程或前台线程（默认：False）;通过一个布尔值设置线程是否为守护线程，必须在执行start()方法之前才可以使用。如果是后台线程，主线程执行过程中，后台线程也在进行，主线程执行完毕后，后台线程不论成功与否，均停止；如果是前台线程，主线程执行过程中，前台线程也在进行，主线程执行完毕后，等待前台线程也执行完成后，程序停止</li>
  <li>t.isDaemon() ： 判断是否为守护线程</li>
  <li>t.ident ：获取线程的标识符。线程标识符是一个非零整数，只有在调用了start()方法之后该属性才有效，否则它只返回None</li>
  <li>t.join() ：逐个执行每个线程，执行完毕后继续往下执行，该方法使得多线程变得无意义</li>
  <li>t.run() ：线程被cpu调度后自动执行线程对象的run方法</li>
</ul>

<h4 id="threading-创建线程">threading 创建线程</h4>

<p>有三种方法, (1) 老版本方法 , (2) 函数调用法 , (3) 类继承法</p>

<p><strong>线程总结</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></td><td class="code"><pre><span class="c">#=====================</span>
<span class="c"># 总结创建线程的方法</span>


<span class="c">#=====================</span>
<span class="c"># 比较原始的线程创建方法</span>
<span class="kn">import</span> <span class="nn">_thread</span>
<span class="n">_thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span><span class="err">函数名</span><span class="p">,(</span><span class="err">参数</span><span class="p">,))</span>
<span class="c">#注意:就算不传递参数,也需要写一个空 tuple 占位</span>

<span class="c">#=====================</span>
<span class="c"># 通过类的继承创建线程</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arg</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
    <span class="c"># 对于父类的方法的重写 当start() 调用run() 方法</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span> <span class="c"># 输入传进来的参数, 当前线程名称</span>
        
<span class="c"># 线程实例化</span>
<span class="n">mythread</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="s">'参数'</span><span class="p">)</span>
<span class="n">mythread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="c"># mythread.join() # 让线程是否等待, 如果不等待,为并发 . 等待就是依次执行</span>

<span class="c">#=====================</span>
<span class="c"># 通过实例化 threading.Thread 类来进行线程开启</span>
<span class="n">mythread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="err">函数名</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="err">参数</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s">'线程名'</span><span class="p">)</span>
<span class="n">mythread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">mythread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="_thread-模块创建线程"><code class="language-plaintext highlighter-rouge">_thread</code> 模块创建线程</h4>

<ul>
  <li>是老版本的低级模块</li>
  <li><code class="language-plaintext highlighter-rouge">import _thread</code> : 导入模块 _thread</li>
  <li><code class="language-plaintext highlighter-rouge">_thread.start_new_thread(函数名, 参数)</code> : 开启线程.
    <ul>
      <li>参数为元祖类型</li>
      <li>如果线程不需要传递参数, 也需要传递一个空元祖</li>
      <li>如果主线程执行完毕, 子线程就会死掉</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">_thread</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span> <span class="c"># 循环执行10秒</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c"># 做5次循环, 创建5个线程, 共10秒结束(5个 fun() 同时执行)</span>

    <span class="n">_thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span><span class="n">fun</span><span class="p">,())</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c"># 截停10秒, 这个循环是为了让主线程不结束, 这样子线程才能继续执行完毕</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>因为线程共享数据,所以同时对同一个变量进行操作会出现意想不到的问题</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">_thread</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">mySum</span><span class="p">():</span>
    <span class="c"># print(num)</span>
    <span class="k">global</span> <span class="n">num</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100001</span><span class="p">):</span>
        <span class="n">num</span><span class="o">+=</span><span class="n">i</span>

    <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c"># 循环5次累加1到100 (5050 * 5 = 25250)</span>
    <span class="n">_thread</span><span class="o">.</span><span class="n">start_new_thread</span><span class="p">(</span><span class="n">mySum</span><span class="p">,</span> <span class="p">())</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="threadingthread创建线程-函数调用法基本法"><strong><code class="language-plaintext highlighter-rouge">threading.Thread</code>创建线程 函数调用法(基本法)</strong></h4>

<ul>
  <li>threading 库可以在单独的线程中执行任何的在 Python 中可以调用的对象。</li>
  <li>当你创建好一个线程对象后，该对象并不会立即执行，除非你调用它的 start() 方法</li>
  <li>当你调用 start() 方法时，它会调用你传递进来的函数，并把你传递进来的参 数传递给该函数</li>
  <li>Python 中的线程会在一个单独的系统级线程中执行(比如说一个 POSIX 线程或者一个 Windows 线程)，这些线程将由操作系统来全权管理。线程一旦 启动，将独立执行直到目标函数返回</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="n">num</span><span class="p">):</span> <span class="c"># 睡一秒, 打印传递进来的数字</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">return</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>  <span class="c"># 分出10个线程</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s">"t.</span><span class="si">%</span><span class="s">d"</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>   <span class="c"># 调用 worker, 把 i 作为参数传递给 worker, 为线程起名为 t.1, t.2 .... t.10. 返回线程对象t </span>
    <span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>   <span class="c"># 循环打印线程对象, 输出 &lt;Thread(t.0, initial)&gt;</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c"># 启动线程</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">t.is_alive</code>你可以查询一个线程对象的状态，看它是否还 在执行:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span> 
    <span class="k">print</span><span class="p">(</span><span class="s">'Still running'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span> 
    <span class="k">print</span><span class="p">(</span><span class="s">'Completed'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">daemon=True</code> Python 解释器在所有线程都终止后才继续执行代码剩余的部分。对于需要长时间运行的线程或者需要一直运行的后台任务，你应当考虑使用后台线程。例如:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">countdown</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,),</span> <span class="n">daemon</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="threadingsemaphore2-信号量"><code class="language-plaintext highlighter-rouge">threading.Semaphore(2)</code> <strong>信号量</strong></h4>

<p>信号量 : 限制了线程的并发数, 超过规定个数, 就让其他的线程阻塞住</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sem.acquire()</code> : 子线程每次执行到 <code class="language-plaintext highlighter-rouge">acquire()</code> 会把当前的计数器的值减一</li>
  <li><code class="language-plaintext highlighter-rouge">sem.release()</code> : 子线程每次执行到 <code class="language-plaintext highlighter-rouge">release()</code> 会把当前的计数器的值加一</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="c"># 信号量</span>
<span class="c"># 信号量</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">sem</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># 创建两个并发线程通道对象</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'当前的{}线程在等待'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>  <span class="c"># 获取在等待的线程</span>
    <span class="n">sem</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>  <span class="c"># 并发通道计数器减2 (两个线程分别执行到这一行,所以通道数减为0)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="n">sem</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>  <span class="c"># 睡2秒后两个通道被释放, 恢复到2个</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>  <span class="c"># 创建5个并发线程</span>
    <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><code class="language-plaintext highlighter-rouge">with sem:</code> 信号量简写(和上面的逻辑一致)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="c"># 信号量</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">sem</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c"># 创建两个并发线程通道对象</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'当前的{}线程在等待'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>  <span class="c"># 获取在等待的线程</span>
    <span class="k">with</span> <span class="n">sem</span><span class="p">:</span> <span class="c"># 信号量简写的方法</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>  <span class="c"># 创建5个并发线程</span>
    <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="c"># 信号量</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">sem</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># 表示只有两个线程可以并发执行.</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">sem</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span> <span class="c"># 开启五个子线程</span>
    <span class="n">mythread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'mythread='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">mythread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="创建线程-继承法"><strong>创建线程 继承法</strong></h4>

<p><strong>通过父类 <code class="language-plaintext highlighter-rouge">run()</code> 方法开启线程 <code class="language-plaintext highlighter-rouge">对象.start</code></strong></p>

<ul>
  <li>获取当前线程名称 <code class="language-plaintext highlighter-rouge">self.name</code></li>
  <li>注意: 不需要在代码结束处添加截停代码, 主线程会在子线程执行完毕后再继续执行</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># run方法必须重写</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'我是 threading 模块创建的线程'</span><span class="p">)</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">mythread</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">()</span> <span class="c"># 初始化一个线程对象</span>
    <span class="n">mythread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c"># 开启线程, start() 会自动调用 类的 run() 方法</span>

<span class="k">print</span><span class="p">(</span><span class="s">'xxx'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="为线程传递参数">为线程传递参数</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre>
<span class="c"># 为线程传递参数</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c"># 调用父类初始化方法</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">'参数是'</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="c"># 使用参数</span>

<span class="n">mythread</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># 为线程传递一个参数</span>
<span class="n">mythread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">mythread</span><span class="p">)</span>
<span class="c"># 输出如下</span>
<span class="c"># Thread-1 参数是 1</span>
<span class="c"># &lt;MyThread(Thread-1, stopped 123145414057984)&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="线程等待-线程对象join">线程等待: <code class="language-plaintext highlighter-rouge">线程对象.join()</code></h4>

<p>让每个子线程执行完毕后再让下一个线程执行. 如果没有<code class="language-plaintext highlighter-rouge">join()</code>,5个线程瞬间执行完毕</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="c"># 线程等待</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">my</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">()</span>
    <span class="n">my</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">my</span><span class="o">.</span><span class="n">join</span><span class="p">()</span> <span class="c"># , 让每个子线程等待主线程. 如果没有这一行,5个线程瞬间执行完毕</span>


<span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="threadingrlock-和-threadinglock-线程锁"><strong><code class="language-plaintext highlighter-rouge">threading.RLock()</code> 和 <code class="language-plaintext highlighter-rouge">threading.Lock()</code> 线程锁</strong></h4>

<blockquote>
  <ul>
    <li>我们使用线程对数据进行操作的时候，如果多个线程同时修改某个数据，可能会出现不可预料的结果，为了保证数据的准确性，引入了锁的概念。</li>
    <li>在一个函数的开始和结束的位置加线程锁, 那么线程就不会同时执行这个函数</li>
  </ul>
</blockquote>

<p><strong>threading.RLock和threading.Lock 的区别</strong></p>

<blockquote>
  <ul>
    <li>从 <code class="language-plaintext highlighter-rouge">lock.acquire()</code> 到 <code class="language-plaintext highlighter-rouge">lock.release()</code> 之间的代码在同一时刻只能有一个线程执行通过, 其他线程需要排队.</li>
    <li>RLock允许在同一线程中被多次 <code class="language-plaintext highlighter-rouge">acquire()</code>。而Lock却不允许这种情况。 如果使用RLock，那么 <code class="language-plaintext highlighter-rouge">acquire()</code> 和 <code class="language-plaintext highlighter-rouge">release()</code> 必须成对出现，即调用了n次acquire，必须调用n次的release才能真正释放所占用的锁。</li>
    <li>所以尽量用 Rlock</li>
  </ul>
</blockquote>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Luck</code>  线程锁</li>
  <li>为了避免线程间对数据的处理冲突,需要加入线程锁</li>
  <li>一旦线程到了线程锁位置, 需要等待前面的线程执行完,解锁后才能进入.</li>
  <li>加锁 <code class="language-plaintext highlighter-rouge">lock.acquire()</code> 和 解锁 <code class="language-plaintext highlighter-rouge">lock.release()</code> 必须成对出现. 如果没有成对出现, 那么就会造成多加一次锁或者多解一次锁的意想不到的问题</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="c"># 创建一个锁对象</span>

<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">num</span>
        <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="c"># print(lock.acquire())  # 打印 True</span>
        <span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span> <span class="c"># 加锁</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
            <span class="n">num</span><span class="o">+=</span><span class="n">i</span>
        <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>         <span class="c"># 解锁</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>  <span class="c"># 循环5次进行累加, 会返现</span>
    <span class="n">mythread</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>两把锁的锁定问题</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">())</span> <span class="c"># 前一个锁没有被解锁, 那么执行第二次锁定就会线程阻塞, 不会执行后面的打印代码</span>


<span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>线程锁的 with 写法</strong></p>

<ul>
  <li>with lock:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="c"># 创建一个锁对象</span>

<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">num</span>
        <span class="c"># print(num)</span>
        <span class="c"># print(lock.acquire())  # 打印 True</span>
        <span class="k">with</span> <span class="n">lock</span><span class="p">:</span> <span class="c"># 加锁</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
                <span class="n">num</span><span class="o">+=</span><span class="n">i</span>
            <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>  <span class="c"># 循环5次进行累加, 会返现</span>
    <span class="n">mythread</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">()</span>
    <span class="n">mythread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Lock 的例子</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="c"># import threading</span>
<span class="c">#</span>
<span class="c"># lock = threading.Lock()</span>
<span class="c"># lock.acquire()</span>
<span class="c"># lock.acquire()  # 产生死锁</span>
<span class="c"># lock.release()</span>
<span class="c"># lock.release()</span>

<span class="kn">import</span> <span class="nn">threading</span>

<span class="n">rlock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
<span class="n">rlock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
<span class="n">rlock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>  <span class="c"># 在同一线程内，程序不会堵塞。</span>
<span class="n">rlock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="n">rlock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">"end."</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>死锁: 加了锁之后不解锁,就会卡住</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="n">boylock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="n">girllock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Boy</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">boylock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'男孩生气了'</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">girllock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'气死了'</span><span class="p">)</span>
        <span class="n">girllock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">boylock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Girl</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">girllock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'女孩也生气了'</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">boylock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'好像进不来了'</span><span class="p">)</span>
        <span class="n">boylock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">girllock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="n">boy</span> <span class="o">=</span> <span class="n">Boy</span><span class="p">()</span>
<span class="n">girl</span> <span class="o">=</span> <span class="n">Girl</span><span class="p">()</span>
<span class="n">boy</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">girl</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Rlock</code>, 可以解决死锁问题
    <ul>
      <li>RLock允许在同一线程中被多次acquire。而Lock却不允许这种情况。注意：如果使用RLock，那么acquire和release必须成对出现，即调用了n次acquire，必须调用n次的release才能真正释放所占用的琐。</li>
      <li>简写 with RLock:</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c"># lock = threading.Lock() # 用 Luck, 在这个代码中会造成死锁</span>
<span class="n">rlock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span> <span class="c"># 用 RLock 代替 Luck 可以避免解锁</span>
<span class="c"># Rlock 单线程可以重复锁定, 但是锁几次就要开几次</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">num</span>
        <span class="n">rlock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">rlock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="n">num</span><span class="o">+=</span><span class="mi">100</span>
        <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="c"># rlock.release()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">mythread</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">()</span>
    <span class="n">mythread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># mythread.join()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'程序执行完成'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>Rlock 的例子</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">rlock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>  <span class="c"># 实例化锁类</span>

<span class="k">def</span> <span class="nf">work</span><span class="p">():</span>

    <span class="k">with</span> <span class="n">rlock</span><span class="p">:</span>  <span class="c"># 在一个函数的开始和结束的位置加线程锁, 那么线程就不会同时执行这个函数</span>
        <span class="k">global</span> <span class="n">num</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c"># 如果没有 lock有这行 sleep, 10个线程就会打印出10个10</span>
        <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="c"># 解锁. 从 lock.acquire() 到 lock.release() 之间的代码在同一时刻只能有一个线程执行, 其他线程需要排队.</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">work</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="threadingevent线程间通信"><strong><code class="language-plaintext highlighter-rouge">threading.Event()</code>线程间通信</strong></h4>

<p>线程的一个关键特性是每个线程都是独立运行且状态不可预测。如果程序中的其 他线程需要通过判断某个线程的状态来确定自己下一步的操作，这时线程同步问题就 会变得非常棘手。为了解决这些问题，我们需要使用 threading 库中的 Event 对象。 Event 对象包含一个可由线程设置的信号标志，它允许线程等待某些事件的发生。在 初始情况下，event 对象中的信号标志被设置为假。如果有线程等待一个 event 对象， 而这个 event 对象的标志为假，那么这个线程将会被一直阻塞直至该标志为真。一个 线程如果将一个 event 对象的信号标志设置为真，它将唤醒所有等待这个 event 对象的 线程。如果一个线程等待一个已经被设置为真的 event 对象，那么它将忽略这个事件， 继续执行。</p>

<ul>
  <li>一个线程发送一个event信号，其他的线程则等待这个信号, 用于主线程控制其他线程的执行。</li>
  <li>Events 管理一个flag，
    <ul>
      <li>这个flag可以使用 <code class="language-plaintext highlighter-rouge">set()</code>设置成<code class="language-plaintext highlighter-rouge">True</code>或者使用 <code class="language-plaintext highlighter-rouge">clear()</code>重置为<code class="language-plaintext highlighter-rouge">False</code>，</li>
      <li><code class="language-plaintext highlighter-rouge">wait()</code>则用于阻塞 Block until the internal flag is true.</li>
      <li>在 flag为 True之前。flag默认为 False。</li>
    </ul>
  </li>
  <li>Event.wait([timeout]) ： 堵塞线程，直到Event对象内部标识位被设为True或超时（如果提供了参数timeout）</li>
  <li>Event.set() ：将标识位设为Ture</li>
  <li>Event.clear() ： 将标识伴设为False</li>
  <li>Event.isSet() ：判断标识位是否为Ture</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span> <span class="c"># 创建一个 Event 对象</span>
<span class="k">def</span> <span class="nf">go</span><span class="p">():</span>
    <span class="n">e</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># wait() 只能被 set 解开</span>
    <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">go</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="nb">set</span><span class="p">()</span> <span class="c"># 使用 set 方法取消所有线程的wait() 等待.</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">e.clear()</code> Reset the internal flag to false</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">rlock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>  <span class="c"># 实例化锁类</span>

<span class="kn">import</span> <span class="nn">threading</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span> <span class="c"># 创建一个 Event 对象</span>
<span class="k">def</span> <span class="nf">go</span><span class="p">():</span>
    <span class="n">e</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># wait() 只能被 set 解开, set 设置 flag 为 true</span>
    <span class="n">e</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c"># 再次将 flag 设置为 false</span>
    <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">go</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">e</span><span class="o">.</span><span class="nb">set</span><span class="p">()</span> <span class="c"># 使用 set 方法取消所有线程的wait() 等待.</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>


<span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'start'</span><span class="p">)</span>
    <span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>    <span class="c"># 堵塞线程，直到Event对象内部标识位被设为True或超时（如果提供了参数timeout）, 才会执行后面的代码. </span>
    <span class="k">print</span><span class="p">(</span><span class="s">'execute'</span><span class="p">)</span>


<span class="n">event_obj</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>  <span class="c"># 创建一个 event 对象</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">do</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">event_obj</span><span class="p">,))</span>  <span class="c"># 建立十个线程分别执行 do(), 每个线程都会被阻塞, 直到 input 给出 true 的信号.</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="n">event_obj</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">inp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'input:'</span><span class="p">)</span>
<span class="k">if</span> <span class="n">inp</span> <span class="o">==</span> <span class="s">'true'</span><span class="p">:</span>  <span class="c"># 输入 ture 后,event 接收到 信号,设置flag 为 true</span>
    <span class="n">event_obj</span><span class="o">.</span><span class="nb">set</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="threadingcondition--线程同步---线程的切换"><code class="language-plaintext highlighter-rouge">threading.Condition()</code>  线程同步 /  线程的切换</h4>

<blockquote>
  <ul>
    <li>Python提供的Condition对象提供了对复杂线程同步问题的支持。</li>
    <li>Condition被称为条件变量，除了提供与Lock类似的acquire和release方法外，还提供了wait和notify方法。</li>
    <li>线程首先acquire一个条件变量，然后判断一些条件。如果条件不满足则wait；如果条件满足，进行一些处理改变条件后，通过notify方法通知其他线程，其他处于wait状态的线程接到通知后会重新判断条件。不断的重复这一过程，从而解决复杂的同步问题。</li>
    <li><code class="language-plaintext highlighter-rouge">notify</code>: Wake up one or more threads waiting on this condition, if any</li>
    <li><code class="language-plaintext highlighter-rouge">notifyAll</code>: Wake up all threads waiting on this condition</li>
  </ul>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="gp">&gt;&gt;&gt; </span>threading.Condition.
threading.Condition.mro<span class="o">(</span>        threading.Condition.notifyAll<span class="o">(</span> 
threading.Condition.notify<span class="o">(</span>     threading.Condition.wait<span class="o">(</span>      
threading.Condition.notify_all<span class="o">(</span> threading.Condition.wait_for<span class="o">(</span>  
</pre></td></tr></tbody></table>
</div>
</div>

<p>两个线程交替执行</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">fun1</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">cond</span><span class="p">:</span>      <span class="c"># 1 </span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">cond</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># 2 </span>


<span class="k">def</span> <span class="nf">fun2</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">cond</span><span class="p">:</span>  <span class="c"># 1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span> <span class="c"># 3 </span>


<span class="n">cond</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun1</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun2</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c"># 1有了 with condition, 那么两个线程就不会并行执行,而是会有先后顺序的一个一个执行每个线程</span>
<span class="c"># 2当执行完四个循环后, 让线程1的任务开始等待, 后面的线程开始启动</span>
<span class="c"># 3当第二个线程执行完毕, 通知所有等待线程继续工作.</span>
<span class="c"># 输出</span>
<span class="c"># Thread-1 0</span>
<span class="c"># Thread-1 1</span>
<span class="c"># Thread-1 2</span>
<span class="c"># Thread-1 3</span>
<span class="c"># Thread-1 4</span>
<span class="c"># Thread-2 0</span>
<span class="c"># Thread-2 1</span>
<span class="c"># Thread-2 2</span>
<span class="c"># Thread-2 3</span>
<span class="c"># Thread-2 4</span>
<span class="c"># Thread-2 5</span>
<span class="c"># Thread-2 6</span>
<span class="c"># Thread-2 7</span>
<span class="c"># Thread-2 8</span>
<span class="c"># Thread-2 9</span>
<span class="c"># Thread-1 5</span>
<span class="c"># Thread-1 6</span>
<span class="c"># Thread-1 7</span>
<span class="c"># Thread-1 8</span>
<span class="c"># Thread-1 9</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>三个线程交替执行</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">fun1</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">cond</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># 1</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span> <span class="c"># 5</span>

<span class="k">def</span> <span class="nf">fun2</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">cond</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># 2</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span> <span class="c"># </span>

<span class="k">def</span> <span class="nf">fun3</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">cond</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span> <span class="c"># 3</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># 4</span>



<span class="n">cond</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun1</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun2</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">fun3</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c"># 1 第一个线程执行一个循环开始等待, 后续线程自动开始继续</span>
<span class="c"># 2 第二个线程执行一个循环开始等待, 后续线程自动开始继续</span>
<span class="c"># 3 第三个线程开始工作,并通知其他暂停的线程开始工作</span>
<span class="c"># 4 第三个线程开始等待</span>
<span class="c"># 5 第一个线程由暂停状态恢复, 通知其他线程暂停的线程继续工作,并继续自己下一个循环</span>

</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>多个线程等一个线程的指令</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">cond</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"consumer before wait"</span><span class="p">)</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"consumer after wait"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">cond</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"producer before notifyAll"</span><span class="p">)</span>
        <span class="n">cond</span><span class="o">.</span><span class="n">notifyAll</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"producer after notifyAll"</span><span class="p">)</span>


<span class="n">condition</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Condition</span><span class="p">()</span>  <span class="c"># 获取 Condition 对象</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"c1"</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">condition</span><span class="p">,))</span>    <span class="c"># 创建一个c1 线程对象, 执行 consumer 函数并将 condition 对象作为参数传递进去</span>
<span class="n">c1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"c2"</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">condition</span><span class="p">,))</span>    <span class="c"># 创建一个c2 线程对象.</span>
<span class="n">c2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="c"># 两个 consumer 线程都已经被阻塞住了, 等待 notifyAll() 通知大家继续.</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"p"</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">producer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">condition</span><span class="p">,))</span>      <span class="c"># 创建另一个 p 线程对象, 执行 notifyAll() 方法</span>
<span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c"># consumer()线程要等待producer()设置了Condition之后才能继续。</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="threadingtimer-定时执行"><code class="language-plaintext highlighter-rouge">threading.Timer</code> 定时执行</h4>

<ul>
  <li>对线程定时执行</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threading</span>
<span class="k">def</span> <span class="nf">go</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'我走了'</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">go</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'主线程结束了'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="queuequeue-线程间通信"><code class="language-plaintext highlighter-rouge">queue.Queue</code> 线程间通信</h4>

<blockquote>
  <p>适用于多线程编程的先进先出数据结构，可以用来安全的在多个线程间传递信息。</p>

  <p>创建一个被多个线程共享的 Queue 对象，这些线程通过使用 put() 和 get() 操作 来向队列中添加或者删除元素</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="gp">&gt;&gt;&gt; </span>queue.
queue.deque<span class="o">(</span>         queue.heappush<span class="o">(</span>      queue.threading     
queue.Empty<span class="o">(</span>         queue.LifoQueue<span class="o">(</span>     queue.time<span class="o">(</span>         
queue.Full<span class="o">(</span>          queue.PriorityQueue<span class="o">(</span>
queue.heappop<span class="o">(</span>       queue.Queue<span class="o">(</span>        
<span class="gp">&gt;&gt;&gt; </span>queue.Queue.
queue.Queue.empty<span class="o">(</span>      queue.Queue.join<span class="o">(</span>       queue.Queue.qsize<span class="o">(</span>     
queue.Queue.full<span class="o">(</span>       queue.Queue.mro<span class="o">(</span>        queue.Queue.task_done<span class="o">(</span> 
queue.Queue.get<span class="o">(</span>        queue.Queue.put<span class="o">(</span>       
queue.Queue.get_nowait<span class="o">(</span> queue.Queue.put_nowait<span class="o">(</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>queue.Queue 方法：</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">q = queue.Queue(maxsize=0)</code> # 构造一个先进先出队列，maxsize指定队列长度，为0 时，表示队列长度无限制。</li>
  <li><code class="language-plaintext highlighter-rouge">q.join()</code> 　　# 等到队列为空的时候，在执行别的操作</li>
  <li><code class="language-plaintext highlighter-rouge">q.qsize()</code> 　 # 返回队列的大小 （不可靠）</li>
  <li><code class="language-plaintext highlighter-rouge">q.empty()</code>    # 当队列为空的时候，返回True 否则返回False （不可靠）</li>
  <li><code class="language-plaintext highlighter-rouge">q.full()</code>     # 当队列满的时候，返回True，否则返回False （不可靠）</li>
  <li><code class="language-plaintext highlighter-rouge">q.put(item, block=True, timeout=None)</code> #
    <ul>
      <li>将<code class="language-plaintext highlighter-rouge">item</code>放入Queue尾部，item必须存在</li>
      <li>可选参数<code class="language-plaintext highlighter-rouge">block</code>默认为True,表示当队列满时，会等待队列给出可用位置，为False时为非阻塞，此时如果队列已满，会引发queue.Full 异常。</li>
      <li>可选参数<code class="language-plaintext highlighter-rouge">timeout</code>，表示 设置阻塞超时的时间，如果队列无法在规定时间内给出放入item的位置，则引发 queue.Full 异常</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">q.get(block=True, timeout=None)</code> #
    <ul>
      <li>移除并返回队列头部的一个值</li>
      <li>可选参数<code class="language-plaintext highlighter-rouge">block</code>默认为True，表示获取值的时候，如果队列为空，则阻塞，为False时，不阻塞，若此时队列为空，则引发 queue.Empty异常。</li>
      <li>可选参数<code class="language-plaintext highlighter-rouge">timeout</code>，设置阻塞的超时时间，超时后，如果队列仍然为空，则引发Empty异常。</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">q.put_nowait(item)</code> # 等效于 put(item,block=False)</li>
  <li><code class="language-plaintext highlighter-rouge">q.get_nowait()</code>     # 等效于 get(item,block=False)</li>
</ul>

<p><strong>多个线程从一个 Queue中读写数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="n">que</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c"># 创建一个10个位置的队列</span>

<span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">que</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c"># print("size:", que.qsize())</span>

<span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">que</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"get:"</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>  <span class="c"># 循环创建13个线程 , 每个线程都将一个数字放入到 queue 中</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>  <span class="c"># 循环创建11个线程, 每个线程都从将数字从 queue 中取出一个数字</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"size:"</span><span class="p">,</span> <span class="n">que</span><span class="o">.</span><span class="n">qsize</span><span class="p">())</span>  <span class="c"># 打印 queue 中还剩下的 2个数字</span>

<span class="c"># 输出结果：</span>
<span class="c"># get: 1</span>
<span class="c"># get: 2</span>
<span class="c"># get: 3</span>
<span class="c"># get: 4</span>
<span class="c"># get: 5</span>
<span class="c"># get: 6</span>
<span class="c"># get: 7</span>
<span class="c"># get: 8</span>
<span class="c"># get: 9</span>
<span class="c"># get: 10</span>
<span class="c"># size: 2</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>两个进程单向收发信息</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="c"># A thread that produces data</span>
<span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">out_q</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="c"># Produce some data...</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">'hello there...'</span>
        <span class="n">out_q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># A thread that consumes data</span>
<span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">in_q</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c"># Get some data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">in_q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>   <span class="c"># Process the data ...</span>
        <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c"># Create the shared queue and launch both threads</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">producer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,))</span>
<span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>停止信号</strong>: 当使用队列时，协调生产者和消费者的关闭问题可能会有一些麻烦。一个通用的 解决方法是在队列中放置一个特殊的只，当消费者读到这个值的时候，终止执行。</p>

<p>本例中有一个特殊的地方:消费者在读到这个特殊值之后立即又把它放回到队列 中，将之传递下去。这样，所有监听这个队列的消费者线程就可以全部关闭了。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c"># Object that signals shutdown 创建一个对象作为特殊信号用来停止监听线程</span>
<span class="n">_sentinel</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>

<span class="c"># A thread that produces data</span>
<span class="k">def</span> <span class="nf">producer</span><span class="p">(</span><span class="n">out_q</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="c"># Produce some data...</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">'hello there...'</span>
        <span class="n">out_q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># Put the sentinel on the queue to indicate completion</span>
    <span class="n">out_q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">_sentinel</span><span class="p">)</span> <span class="c"># 当工作结束了,就发送特殊信号给监听这,告诉他们可以结束了</span>

<span class="c"># A thread that consumes data</span>
<span class="k">def</span> <span class="nf">consumer</span><span class="p">(</span><span class="n">in_q</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c"># Get some data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">in_q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>   <span class="c"># Process the data ...</span>
        <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c"># Check for termination</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">_sentinel</span><span class="p">:</span> <span class="c"># 一旦接到停止信号, 退出监听循环</span>
            <span class="n">in_q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">_sentinel</span><span class="p">)</span>
            <span class="k">break</span>


<span class="c"># Create the shared queue and launch both threads</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">consumer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,))</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">producer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,))</span>
<span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">t2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="线程池">线程池</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>pip3.7 install threadpool
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="线程池使用方式">线程池使用方式:</h5>

<ol>
  <li>引入线程池模块:  <code class="language-plaintext highlighter-rouge">import threadpool</code></li>
  <li>定义线程函数: <code class="language-plaintext highlighter-rouge">def 任务函数():</code></li>
  <li>创建线程池:<code class="language-plaintext highlighter-rouge">threadpool.ThreadPool(线程并发数)</code></li>
  <li>创建线程池需要的任务: <code class="language-plaintext highlighter-rouge">tasks = threadpool.makeRequests(func, nameList)</code></li>
  <li>把创建的多个任务放入线程池: <code class="language-plaintext highlighter-rouge">[pool.putRequest(i) for i in tasks]</code></li>
  <li>等待所有线程: pool.wait()</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threadpool</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">myStr</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'hello{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">myStr</span><span class="p">))</span>

<span class="n">pool</span> <span class="o">=</span> <span class="n">threadpool</span><span class="o">.</span><span class="n">ThreadPool</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">nameList</span> <span class="o">=</span> <span class="p">[</span><span class="s">'宋辉'</span><span class="p">,</span> <span class="s">'李红强'</span> <span class="p">,</span> <span class="s">'凤姐'</span><span class="p">]</span>
<span class="n">reqs</span> <span class="o">=</span> <span class="n">threadpool</span><span class="o">.</span><span class="n">makeRequests</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">nameList</span><span class="p">)</span> <span class="c"># 创建三个任务对象</span>
<span class="c"># print(request) # [&lt;threadpool.WorkRequest object at 0x106092e80&gt;, &lt;threadpool.WorkRequest object at 0x106092eb8&gt;, &lt;threadpool.WorkRequest object at 0x106092ef0&gt;]</span>
<span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">putRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">reqs</span><span class="p">]</span>
<span class="n">pool</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>     <span class="c"># wait 必须等待所有线程完成. 和其他方法的 p.join() 一个效果</span>
<span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>当函数有多个参数的情况，函数调用时第一个解包list，第二个解包dict，所以可以这样</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">threadpool</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"m = </span><span class="si">%</span><span class="s">s, n = </span><span class="si">%</span><span class="s">s, o = </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># 方法1</span>
    <span class="n">lst_vars_1</span> <span class="o">=</span> <span class="p">[</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">]</span>
    <span class="n">lst_vars_2</span> <span class="o">=</span> <span class="p">[</span><span class="s">'4'</span><span class="p">,</span> <span class="s">'5'</span><span class="p">,</span> <span class="s">'6'</span><span class="p">]</span>
    <span class="n">func_var</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lst_vars_1</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="p">(</span><span class="n">lst_vars_2</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span>
    <span class="c"># 方法2</span>
    <span class="n">dict_vars_1</span> <span class="o">=</span> <span class="p">{</span><span class="s">'m'</span><span class="p">:</span> <span class="s">'1'</span><span class="p">,</span> <span class="s">'n'</span><span class="p">:</span> <span class="s">'2'</span><span class="p">,</span> <span class="s">'o'</span><span class="p">:</span> <span class="s">'3'</span><span class="p">}</span>
    <span class="n">dict_vars_2</span> <span class="o">=</span> <span class="p">{</span><span class="s">'m'</span><span class="p">:</span> <span class="s">'4'</span><span class="p">,</span> <span class="s">'n'</span><span class="p">:</span> <span class="s">'5'</span><span class="p">,</span> <span class="s">'o'</span><span class="p">:</span> <span class="s">'6'</span><span class="p">}</span>
    <span class="n">func_var</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dict_vars_1</span><span class="p">),</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">dict_vars_2</span><span class="p">)]</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">threadpool</span><span class="o">.</span><span class="n">ThreadPool</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">requests</span> <span class="o">=</span> <span class="n">threadpool</span><span class="o">.</span><span class="n">makeRequests</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span> <span class="n">func_var</span><span class="p">)</span>
    <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">putRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">]</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="queue-和-用queue-设计-生产者消费者模式"><strong>Queue 和 用Queue 设计 生产者/消费者模式:</strong></h5>

<p>概述:</p>

<ul>
  <li>queue 是 python 线程模块中线程安全的队列, 提供了一个多线程先进先出的数据结构. 用来在生产者和消费者线程之间的信息传递.</li>
  <li>创建两个线程, 一个线程用于产生线程往里塞, 另一个线程用于将工作结果往外取</li>
</ul>

<p>使用方法:</p>

<ol>
  <li>导入队列模块: import queue</li>
  <li>创建队列: <code class="language-plaintext highlighter-rouge">que=queue.Queue(maxsize=0)</code>
    <ol>
      <li>如果 maxsize 是一个正整数, 代表当前对列存储对象的最大值. 如果超出最大值, 会造成队列阻塞(卡了)</li>
      <li>0 代表没有大小限制</li>
    </ol>
  </li>
</ol>

<p>函数:</p>

<ul>
  <li>put : 压入数据, 如果压入数据超出队列最大数, 会阻塞</li>
  <li>get: 从队列中获取数据,如果没有数据了会阻塞</li>
  <li>empty: 判断队列是否为空, 空 True, 非空 False</li>
</ul>

<p><strong>Queue 的使用</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">queue</span>

<span class="c"># 创建队列</span>
<span class="n">que</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c"># print(que)</span>

<span class="n">que</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
<span class="n">que</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'b'</span><span class="p">)</span>
<span class="n">que</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'c'</span><span class="p">)</span>
<span class="n">que</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'d'</span><span class="p">)</span>
<span class="c"># que.put('e') # 超出 Queue 最大值, 队列阻塞, 程序卡住了</span>

<span class="c"># 获取数据</span>
<span class="k">print</span><span class="p">(</span><span class="n">que</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">que</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">que</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">que</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
<span class="c"># print(que.get())</span>

<span class="c"># empty</span>
<span class="k">print</span><span class="p">(</span><span class="n">que</span><span class="o">.</span><span class="n">empty</span><span class="p">())</span> <span class="c"># 判断queue 是否为空</span>

<span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>无穷大队列的 Queue</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">queue</span>

<span class="n">que</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">que</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    
<span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>用 Queue 创建生产者消费者模式</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">queue</span><span class="o">,</span> <span class="nn">random</span>

<span class="c"># 生产者</span>
<span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">que</span><span class="p">):</span>

        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span> <span class="c"># 当前生产的用户</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">que</span> <span class="o">=</span> <span class="n">que</span>   <span class="c"># 将生产出来的数据存放到队列中</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100000</span><span class="p">)</span> <span class="c"># 返回一个随机整数</span>
            <span class="n">mystr</span> <span class="o">=</span> <span class="s">'当前生产者{} 生产了一个娃娃, 编号为 {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">que</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="n">mystr</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Consumer</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">buyer</span><span class="p">,</span> <span class="n">que</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buyer</span> <span class="o">=</span> <span class="n">buyer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">que</span> <span class="o">=</span> <span class="n">que</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">que</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buyer</span><span class="p">,</span> <span class="s">'买到了'</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>



<span class="n">que</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c">#</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">que</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">Consumer</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">que</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>另一种写法</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">queue</span><span class="o">,</span> <span class="nn">random</span>


<span class="k">def</span> <span class="nf">seller</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">q</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="s">"苹果"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">buyer</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">q</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">prod</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="n">prod</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="n">q</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">seller</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span>
    <span class="n">s</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">buyer</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">j</span><span class="p">,))</span>
    <span class="n">b</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="协程----使用生成器代替线程">协程: -  使用生成器代替线程</h3>

<h4 id="定义-协作完成"><strong>定义</strong>: 协作完成</h4>

<blockquote>
  <ul>
    <li>从技术的角度来说，“协程就是你可以暂停执行的函数”</li>
    <li>协程 是基于生成器的。</li>
    <li>线程和进程的操作是由程序触发系统接口，最后的执行者是系统；</li>
    <li>协程的操作则是程序员。</li>
  </ul>

</blockquote>

<p><strong>协程存在的意义：</strong></p>

<blockquote>
  <ul>
    <li>
      <p>对于多线程应用，CPU通过切片的方式来切换线程间的执行，线程切换时需要耗时（保存状态，下次继续）。</p>
    </li>
    <li>
      <p>协程，则只使用一个线程，在一个线程中规定某个代码块执行顺序。</p>
    </li>
  </ul>
</blockquote>

<p><strong>协程的适用场景：</strong></p>

<blockquote>
  <p>当程序中存在大量不需要CPU的操作时（IO），适用于协程。</p>
</blockquote>

<p><strong>复习生成器的概念</strong></p>

<ul>
  <li>有 <code class="language-plaintext highlighter-rouge">yield</code> 返回的函数的实例化对象是生成器 <code class="language-plaintext highlighter-rouge">&lt;generator object a at 0x1041a0f68&gt;</code></li>
  <li><code class="language-plaintext highlighter-rouge">next</code> 相当于 event 事件的 set触发, yield 相当于 wait</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">fun</span><span class="p">():</span>
    <span class="k">yield</span> <span class="s">'abc'</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">fun</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">send</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>


<span class="c"># 输出如下:</span>
<span class="c"># abc</span>
<span class="c"># &lt;generator object fun at 0x10418b1a8&gt;</span>
<span class="c"># send(arg) -&gt; send 'arg' into generator,</span>
<span class="c"># return next yielded value or raise StopIteration.</span>

<span class="c">#next 的概念如下</span>
<span class="nb">next</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">[,</span> <span class="n">default</span><span class="p">])</span>
    
    <span class="n">Return</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">item</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nn">iterator.</span> <span class="nn">If</span> <span class="nn">default</span> <span class="nn">is</span> <span class="nn">given</span> <span class="nn">and</span> <span class="nn">the</span> <span class="nn">iterator</span><span class="err">
</span>    <span class="nn">is</span> <span class="nn">exhausted</span><span class="err">,</span> <span class="nn">it</span> <span class="nn">is</span> <span class="nn">returned</span> <span class="nn">instead</span> <span class="nn">of</span> <span class="nn">raising</span> <span class="nn">StopIteration.</span><span class="err">
</span></pre></td></tr></tbody></table>
</div>
</div>

<h4 id="协程的买家卖家模式---生产者消费者模式">协程的买家卖家模式 - 生产者消费者模式</h4>

<ul>
  <li>买家卖家模式(生产者和消费者), 使用协程更好</li>
  <li>不需要使用多线程 可以达到和 Condition 一样的效果</li>
  <li>通过生成器 <code class="language-plaintext highlighter-rouge">yield</code> 和 <code class="language-plaintext highlighter-rouge">send</code> 在两个任务中进行切换</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="c"># 生产者和消费者的雏形</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s">'苹果'</span>
    <span class="n">r</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">data</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'传递过来的指令是:'</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">data</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'传递过来的指令是:'</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">data</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">run</span><span class="p">()</span>
<span class="c"># print(r)</span>
<span class="c"># print(next(x))</span>
<span class="c"># print(next(x))</span>
<span class="n">x</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c"># 第一次必须传递 None</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'a'</span><span class="p">))</span>  <span class="c"># 相当于把a 给了 变量 r</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'b'</span><span class="p">))</span>
<span class="c"># 输出</span>
<span class="c"># 传递过来的指令是: a</span>
<span class="c"># 苹果</span>
<span class="c"># 传递过来的指令是: b</span>
<span class="c"># 苹果</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre><span class="c"># 一个生成器雏形, 可以返回 data</span>
<span class="k">def</span> <span class="nf">cus</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">data</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'走到我了'</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="s">'OK 200'</span>


<span class="k">def</span> <span class="nf">product</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'a'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'b'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'c'</span><span class="p">))</span>

<span class="c"># print(cus())</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">cus</span><span class="p">()</span> <span class="c"># 先生成一个卖家</span>
<span class="n">product</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="c"># 再将这个卖家传给买家, 让买家向卖家发送购买指令</span>

<span class="c"># 输出如下:</span>
<span class="c"># 走到我了</span>
<span class="c"># OK 200</span>
<span class="c"># 走到我了</span>
<span class="c"># OK 200</span>
<span class="c"># 走到我了</span>
<span class="c"># OK 200</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>最终的代码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">seller</span><span class="p">():</span> <span class="c"># 生产者 - 生成器 - 卖家</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="s">''</span> <span class="c"># 第一个生产出来的东西要提前定义, 可以是任何字符串</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">prod</span> <span class="c"># 1 </span>
        <span class="k">print</span><span class="p">(</span><span class="s">'卖家收到购买编号 '</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">prod</span> <span class="o">=</span> <span class="s">'西红柿'</span>


<span class="k">def</span> <span class="nf">buyer</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="c"># 消费者 - 买家</span>
    <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>  <span class="c"># 要买的第一个东西必须是None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'消费者发送购买编号: '</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>    <span class="c"># 2 </span>
        <span class="k">print</span><span class="p">(</span><span class="s">'消费者买到了产品:'</span><span class="p">,</span><span class="n">resp</span><span class="p">)</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">seller</span><span class="p">()</span>
<span class="n">buyer</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c"># 1 yield 挂起,直到收到 send()指令后, 将send()的参数赋给 i, 并将 yield 后面的 value 让 send() 带回去. 然后继续 yield 下面的代码,直到再次碰到 yield 挂起.</span>

<span class="c"># 2 向卖家发送了指令i, 并获取到返回购买的产品</span>

<span class="c"># 输出如下:</span>
<span class="c"># 消费者发送购买编号:  0</span>
<span class="c"># 卖家收到购买编号  0</span>
<span class="c"># 消费者买到了产品: 西红柿</span>
<span class="c"># 消费者发送购买编号:  1</span>
<span class="c"># 卖家收到购买编号  1</span>
<span class="c"># 消费者买到了产品: 西红柿</span>
<span class="c"># 消费者发送购买编号:  2</span>
<span class="c"># 卖家收到购买编号  2</span>
<span class="c"># 消费者买到了产品: 西红柿</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="进程">进程</h3>

<blockquote>
  <p>依赖于 CPU 进行大量计算的工作, 尽量用多进程来分散计算量, 并行计算后可加快输出结果. 如果是需要大量请求网络的工作, 尽量用多线程.你完全可以放心的创建几千个 Python 线程，现代操作系统运行这么多线程没有任何压力，没啥可担心的</p>

  <p>进程是正在运行的程序的一个实例.</p>

  <p>在多核处理器的计算机上,多进程要比多线程获得更好的效率</p>

  <p>进程可以通过文件或者数据库进行通信</p>
</blockquote>

<ul>
  <li>可以通过系统监视器查看系统上多了两个 python 的进程,每个进程都有自己的 PID</li>
  <li>导入进程模块 <code class="language-plaintext highlighter-rouge">from multiprocessing import Process</code></li>
  <li>创建子进程 <code class="language-plaintext highlighter-rouge">p = Process(target=函数名, args = (参数,)</code> 参数是元祖类型</li>
  <li>启动子进程 <code class="language-plaintext highlighter-rouge">p.start()</code></li>
  <li>默认情况下主进程不等待子进程完成,会继续执行</li>
  <li>让主进程等待子进程完成: <code class="language-plaintext highlighter-rouge">p.join()</code>, 这样可以让主进程的每个子进程轮流干活</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'两个人相亲, 女的问男的你有车吗, 有房吗? 男的说没有, 你见过狗喝水吗?'</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># func()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">)</span> <span class="c"># 如果没有开启子进程, "我是下面代码" 是不会显示的</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>  <span class="c"># p.join() 会让主进程等待子进程执行完毕后再往下走.</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'我是下面的代码'</span><span class="p">)</span> 
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>获取当前进程和父进程编号</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span> <span class="c"># 获取当前进程编号</span>
<span class="n">os</span><span class="o">.</span><span class="n">getppid</span><span class="p">()</span> <span class="c"># 获取当前进程的父进程编号</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="c"># 进程</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>

<span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Hello, </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">work</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s">"One"</span><span class="p">,))</span> <span class="c"># 创建新的进程调用了wrok 函数</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">work</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="s">"Two"</span><span class="p">,))</span> <span class="c"># 创建新的进程调用了wrok 函数</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>       <span class="c"># p1 进程对象创建了,但是还没启动,没有 pid</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>       <span class="c"># p1 进程启动,创建 pid</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>用多进程拷贝文件的例子</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">mycopy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">desc</span><span class="p">):</span>

    <span class="k">print</span><span class="p">(</span><span class="s">'当前进程{}, 父进程{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">getppid</span><span class="p">()))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">rf</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">desc</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">wf</span><span class="p">:</span>
            <span class="n">wf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">srcpath</span> <span class="o">=</span> <span class="s">'./testfolder'</span>
    <span class="n">descpath</span> <span class="o">=</span> <span class="s">'./testfolder2'</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">srcpath</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">srcpath</span><span class="p">,</span> <span class="n">name</span><span class="p">))]</span>
    <span class="n">myList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">oldfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">srcpath</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">newfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">descpath</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">mycopy</span> <span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">oldfile</span><span class="p">,</span><span class="n">newfile</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">myList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">myList</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">'拷贝完成'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="进程间通信概念">进程间通信概念</h4>

<p><strong>进程变量共享问题</strong></p>

<ul>
  <li>子进程在启动之后就无法再拿到主进程的数据了</li>
  <li>主进程也拿不到子进程的变量,所以无法共享数据</li>
  <li>只有通过管道 <code class="language-plaintext highlighter-rouge">Pipe()</code>, <code class="language-plaintext highlighter-rouge">Queue()</code>, <code class="language-plaintext highlighter-rouge">Manager()</code> 共享列表/字典, <code class="language-plaintext highlighter-rouge">Pool()</code>进程池的方式才能实现共享</li>
</ul>

<p><strong>无法共享的例子</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="c"># 进程的变量共享</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span>

<span class="c"># num = 10</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">num</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'子进程获取主进程的变量'</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'子进程尝试更新主进程的 变量'</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># func()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c"># 子进程只有在 start() 之前可以读取到主进程的 global 变量</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">9</span> <span class="c"># 启动后就无法获取主进程的任何变量了</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'主进程变量还是'</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
    
<span class="c"># 输出</span>
<span class="c"># 2  # 子进程尝试将2赋值到追进程的 global 变量中</span>
<span class="c"># 10 # 但主进程还是10</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="pipe-管道方式通信">Pipe 管道方式通信</h4>

<p><strong>性能</strong>: Pipe 的性能要强于 Queue</p>

<p><strong>使用场景</strong>: 有通信速度和性能要求, 并且只需要两个口进行通信的情况下推荐使用 Pipe</p>

<p><code class="language-plaintext highlighter-rouge">from multiprocessing import Process, Pipe</code></p>

<p>一个管道分两头, 每头都需要定义一个对象.</p>

<p>创建管道: <code class="language-plaintext highlighter-rouge">con_a, con_b = Pipe()</code> # Pipe() 返回两个管道口对象, 两个对象一模一样 <code class="language-plaintext highlighter-rouge">(&lt;multiprocessing.connection.Connection object at 0x10423df60&gt;, &lt;multiprocessing.connection.Connection object at 0x10423df98&gt;)</code>.</p>

<p>创建进程: <code class="language-plaintext highlighter-rouge">p = Process(target=func , args=(con_b,))</code> 将一头传递给子进程, 主进程自己留另外一头</p>

<p>从管道向子进程发送数据: <code class="language-plaintext highlighter-rouge">con_a.send([1,2,3,4])</code></p>

<p>从管道接收数据: <code class="language-plaintext highlighter-rouge">con_b.recv()</code></p>

<p><strong>在子进程接受主进程的数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="c"># 通过管道让进程间进行通信</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Pipe</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">con</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'在子进程接受主进程的数据'</span><span class="p">,</span><span class="n">con</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="n">Pipe</span><span class="p">())</span>
    <span class="n">con_a</span><span class="p">,</span> <span class="n">con_b</span> <span class="o">=</span> <span class="n">Pipe</span><span class="p">()</span> <span class="c"># 创建管道, Pipe() 返回管道的两个口</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span> <span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">con_b</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">con_a</span><span class="o">.</span><span class="n">send</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="c"># 向管道中发送一个数组</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>循环向子进程发送数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="c"># 通过管道让进程间进行通信</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Pipe</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">con</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'在子进程接受主进程的数据'</span><span class="p">,</span><span class="n">con</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="n">Pipe</span><span class="p">())</span>
    <span class="n">con_a</span><span class="p">,</span> <span class="n">con_b</span> <span class="o">=</span> <span class="n">Pipe</span><span class="p">()</span> <span class="c"># 创建管道, Pipe() 返回管道的两个口</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span> <span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">con_b</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"请输入向管道传送的数据: "</span><span class="p">)</span>
        <span class="n">con_a</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="c"># 向管道中发送数据</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>在主进程接受子进程的数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="c"># 通过管道让进程间进行通信</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Pipe</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">con</span><span class="p">):</span>
    <span class="n">con</span><span class="o">.</span><span class="n">send</span><span class="p">([</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">])</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">con_a</span><span class="p">,</span> <span class="n">con_b</span> <span class="o">=</span> <span class="n">Pipe</span><span class="p">()</span> <span class="c"># 创建管道, Pipe() 返回管道的两个口</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span> <span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">con_b</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'在主进程接受子进程的数据'</span><span class="p">,</span><span class="n">con_a</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>循环向主进程发送数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Pipe</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">con</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">con</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'aaa'</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">con_a</span><span class="p">,</span> <span class="n">con_b</span> <span class="o">=</span> <span class="n">Pipe</span><span class="p">()</span> <span class="c"># 创建管道, Pipe() 返回管道的两个口</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span> <span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">con_b</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'在主进程接受子进程的数据'</span><span class="p">,</span><span class="n">con_a</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>双向循环传输数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Pipe</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">con</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">con</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'aaa'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'在主进程接受子进程的数据'</span><span class="p">,</span> <span class="n">con</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">con_a</span><span class="p">,</span> <span class="n">con_b</span> <span class="o">=</span> <span class="n">Pipe</span><span class="p">()</span> <span class="c"># 创建管道, Pipe() 返回管道的两个口</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span> <span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">con_b</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'在主进程接受子进程的数据'</span><span class="p">,</span><span class="n">con_a</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="n">con_a</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">'bbb'</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="queue-队列方式通信">Queue 队列方式通信</h4>

<p>性能: 没有 Pipe 好</p>

<p>使用场景: 可以在需要多于两个口进行通信的情况下使用.</p>

<p>Queue 不需要像 Pipe 一样创建两个口子对象.</p>

<p><code class="language-plaintext highlighter-rouge">from multiprocessing import Process, Queue</code></p>

<p><code class="language-plaintext highlighter-rouge">queue = Queue()</code>  创建队列</p>

<p><code class="language-plaintext highlighter-rouge">queue.put(['a','b','c'])</code>  压入数据, 每次向管道一次压入一个对象</p>

<p><code class="language-plaintext highlighter-rouge">q.get()</code>  获取数据</p>

<p>Queue 特点: 先进先出</p>

<p>作业: 两个子进程, 一个进程压入数据, 另一个进程 get数据. 意义:多个子进程是否可以通信</p>

<p><strong>从主进程向子进程传递数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>  <span class="c"># 创建队列</span>
    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">([</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">])</span> <span class="c"># 压入数据</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>从子进程向主进程传递数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">([</span><span class="s">'a'</span><span class="p">,</span><span class="s">'b'</span><span class="p">,</span><span class="s">'c'</span><span class="p">])</span> <span class="c"># 压入数据</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>  <span class="c"># 创建队列</span>
    <span class="c"># queue.put(['a','b','c']) # 压入数据</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">queue</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>子进程间的数据通信</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="s">'1'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'子进程{}: 开始压入数据'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'b'</span><span class="p">)</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'c'</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="s">'2'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'子进程{}: 开始接收数据'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>



<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="s">'1'</span><span class="p">))</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="s">'2'</span><span class="p">))</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'子进程间通信结束'</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>一个主进程和多个子进程间的多点通信</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'子进程{}获得数据:{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span> <span class="c"># 接收其他子进程发送的数据</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'子进程{}在呼叫'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>  <span class="c"># 向其他子进程发送自己的数据</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>  <span class="c"># 创建queue 对象</span>

    <span class="n">p1</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="c"># p3 = Process(target=func, args=(queue,3))</span>
    <span class="n">p1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c"># p3.start()</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s">'主进程在呼叫所有子进程'</span><span class="p">)</span>  <span class="c"># 压入数据</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'主进程获得子进程数据:{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="进程间字典列表共享">进程间字典列表共享</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">multiprocessing</span>

<span class="k">def</span> <span class="nf">setList</span><span class="p">(</span><span class="n">myList</span><span class="p">):</span>
    <span class="n">myList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'x'</span><span class="p">)</span>
    <span class="n">myList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'y'</span><span class="p">)</span>
    <span class="n">myList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'z'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'当前子进程的方法里面的值为'</span><span class="p">,</span><span class="n">myList</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setDict</span><span class="p">(</span><span class="n">myDict</span><span class="p">):</span>
    <span class="n">myDict</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">myDict</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'当前子进程的方法里面的值为'</span><span class="p">,</span> <span class="n">myDict</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># Manager 是一个进程间高级通信的方法, 支持 python 的字典和列表的数据类型</span>
    <span class="n">myList</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span><span class="o">.</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="c"># 创建一个列表对象,并提供一个初始列表</span>
    <span class="n">myDict</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span><span class="o">.</span><span class="nb">dict</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span> <span class="c"># 创建一个字典对象, 并提供一个初始字典</span>
    <span class="k">print</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">myDict</span><span class="p">)</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">setList</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">myList</span><span class="p">,))</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="n">pd</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">setDict</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">myDict</span><span class="p">,))</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

<span class="c"># 输出为:</span>
<span class="c"># [0, 1, 2, 3, 4]</span>
<span class="c"># {1: 1, 2: 2}</span>
<span class="c"># 当前子进程的方法里面的值为 [0, 1, 2, 3, 4, 'x', 'y', 'z']</span>
<span class="c"># 当前子进程的方法里面的值为 {1: 1, 2: 2, 3: 3, 4: 4}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="进程池">进程池</h4>

<ol>
  <li>创建进程池: <code class="language-plaintext highlighter-rouge">p=Pool(进程池可容纳进程的个数)</code> Pool 的参数设定进程池可同时执行的进程数. 不填参数默认使用系统的 cpu个数</li>
  <li>将进程放入进程池(异步): <code class="language-plaintext highlighter-rouge">p.apply_async(fun, args=(i,))</code></li>
  <li>关闭进程池: <code class="language-plaintext highlighter-rouge">p.close()</code></li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="c"># 进程池方便多个进程统一管理.</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'进程'</span><span class="p">,</span><span class="n">arg</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>  <span class="c"># 参数设定进程池可同时执行的进程数. 不填参数默认使用系统的 cpu个数</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,))</span> <span class="c"># 为进程池添加一个进程</span>

    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># 关闭进程池</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'执行完毕'</span><span class="p">)</span> 
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>多进程抓取数据</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">request</span>

<span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
    <span class="n">dataList</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'[1-9]</span><span class="err">\</span><span class="s">d{5,10}'</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dataList</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">'https://www.douban.com/group/topic/41011762/?start=0'</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>
    <span class="n">page</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">nowPage</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c"># print(newPath)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">getData</span><span class="p">,</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">newPath</span><span class="p">,))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>多进程统计 csv 中的数据并进行汇总计算</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">myList</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">total</span><span class="o">+=</span><span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">num</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"平均值"</span><span class="p">,</span><span class="n">total</span><span class="o">/</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">myList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total</span><span class="o">/</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>
    <span class="c">#创建列表</span>
    <span class="n">myList</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span><span class="o">.</span><span class="nb">list</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s">r"./csvfiles"</span>
    <span class="n">fileList</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">fileList</span><span class="p">:</span>
        <span class="n">newPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="nb">file</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">newPath</span><span class="p">,</span><span class="n">myList</span><span class="p">))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"结束"</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>多进程在文件中搜索数据</strong></p>

<ul>
  <li>Pool 比 Process 好用, 尽量用 Pool</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Manager</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mlist</span><span class="p">,</span><span class="n">uname</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'子进程{}: 开始搜索数据'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">uname</span> <span class="ow">in</span> <span class="n">mlist</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mlist</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">path</span> <span class="o">=</span> <span class="s">'./kaifanglist.txt'</span>
    <span class="n">uname</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入你要搜索的名字'</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">mlist</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="c"># print(mlist)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">()</span><span class="o">.</span><span class="nb">list</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mlist</span><span class="p">),</span><span class="mi">100</span><span class="p">):</span>
        <span class="c"># print(i)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">search</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">mlist</span><span class="p">,</span><span class="n">uname</span><span class="p">))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'搜索结果,{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="并行计算---将多个工作平均分配给每个-cpu-做-map-reduce-计算">并行计算 - 将多个工作平均分配给每个 CPU, 做 map-reduce 计算</h4>

<p>你有个程序要执行 CPU 密集型工作，你想让他利用多核 CPU 的优势来运行的快 一点。</p>

<p><code class="language-plaintext highlighter-rouge">concurrent.futures</code> 库提供了一个 <code class="language-plaintext highlighter-rouge">ProcessPoolExecutor</code> 类，可被用来在一个单 独的 Python 解释器中执行计算密集型函数。不过，要使用它，你首先要有一些计算密 集型的任务。我们通过一个简单而实际的例子来演示它。假定你有个 Apache web 服务 器日志目录的 gzip 压缩包</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><pre><span class="c"># findrobots.py</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">glob</span>  <span class="c"># 用来找文件的模块, 可以使用正则</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>
<span class="k">def</span> <span class="nf">find_robots</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="s">'''
    Find all of the hosts that access robots.txt in a single log file
    '''</span>
    <span class="n">robots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'ascii'</span><span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">'/robots.txt'</span><span class="p">:</span>
                <span class="n">robots</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">robots</span>

<span class="k">def</span> <span class="nf">find_all_robots</span><span class="p">(</span><span class="n">logdir</span><span class="p">):</span>
    <span class="s">'''
    Find all hosts across and entire sequence of files
    '''</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">logdir</span><span class="o">+</span><span class="s">'/*.log.gz'</span><span class="p">)</span>  <span class="c"># Return a list of paths matching a pathname pattern.</span>
    <span class="n">all_robots</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>  <span class="c"># 创建一个并发池</span>
        <span class="k">for</span> <span class="n">robots</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">find_robots</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span> <span class="c"># 给池中放置需要并发的任务, 以及任务要执行的一系列工作. 原理相当于 map() 函数</span>
            <span class="n">all_robots</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">robots</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_robots</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">robots</span> <span class="o">=</span> <span class="n">find_all_robots</span><span class="p">(</span><span class="s">'logs'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ipaddr</span> <span class="ow">in</span> <span class="n">robots</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">ipaddr</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="26-socket">2.6 Socket</h2>

<p><strong>TCP 协议</strong></p>

<blockquote>
  <p>有请求有相应, 是面向链接的协议.</p>

  <p>在收数据和发数据的时候必须建立一个可靠的连接</p>

  <p>一个 TCP连接必须经过三次对话才能建立起来, 俗称三次握手</p>
</blockquote>

<p><strong>UDP 协议</strong></p>

<blockquote>
  <p>UDP 协议是一个非链接的协议.</p>

  <p>传输数据是不需要在两端建立起链接</p>
</blockquote>

<p><strong>Socket</strong></p>

<blockquote>
  <p>Socket 俗称套接字, 是计算机最底层的通信模块</p>

  <p>一台计算机多个进程之间的通信, 或者是和服务器之间的通信</p>
</blockquote>

<p><strong>使用 Socket</strong></p>

<ol>
  <li>导入 Socket 模块: <code class="language-plaintext highlighter-rouge">import socket</code></li>
  <li>创建 Socket: <code class="language-plaintext highlighter-rouge">s = socket.socket()</code></li>
  <li>端口号范围: 0 - 65535 . 我们在自定义端口号时, 最好是定义在1024以上的号码</li>
</ol>

<table>
  <thead>
    <tr>
      <th>参数</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>AF_INET</td>
      <td>使用 IPV4协议(IP地址)</td>
    </tr>
    <tr>
      <td>SOCK_STREAM</td>
      <td>TCP 连接</td>
    </tr>
    <tr>
      <td>SOCK_DGRAM</td>
      <td>UDP</td>
    </tr>
  </tbody>
</table>

<h3 id="建立-udp-服务端课客户端">建立 UDP 服务端课客户端</h3>

<p><strong>服务端</strong></p>

<p>用到的函数:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">s.bind(('127.0.0.1',8088))</code> # 绑定你当前服务端的 IP地址和端口号. 客户端可以通过这个地址进行访问</li>
  <li><code class="language-plaintext highlighter-rouge">s.recvfrom(1024)</code> # 接收从客户端传递的数据. 一次最多接受1024字节</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>  <span class="c"># 创建 UDP 服务端</span>
<span class="c"># print(s) # &lt;socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_DGRAM, proto=0, laddr=('0.0.0.0', 0)&gt;</span>

<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span><span class="mi">9058</span><span class="p">))</span>  <span class="c"># 设置 IP地址和端口号</span>
<span class="n">data</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>  <span class="c"># recvfrom 是 udp 接受客户端请求的数据的函数, 一次最多能接收1024 字节</span>
<span class="c"># print(date, addr)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'来自{}的消息是:'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'消息为: '</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>客户端</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">c.sendto(data.encode('utf-8'),('127.0.0.1',9058))</code> # 发送信息给服务端</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"说你想对UDP服务器端说的话"</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">),(</span><span class="s">'127.0.0.1'</span><span class="p">,</span><span class="mi">9058</span><span class="p">))</span>
<span class="c"># 发送 udp 数据, 第一个参数是数据, 第二个参数是服务端地址(ip+端口)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="建立-tcp-连接-服务端和客户端">建立 TCP 连接, 服务端和客户端</h3>

<p><strong>服务端</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span><span class="nn">time</span>

<span class="c"># 创建 TCP服务端</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="c"># print(s) # &lt;socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 0)&gt;</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="mi">9069</span><span class="p">))</span>

<span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c"># 设置最大连接数, 超出5个等待</span>
<span class="n">cSocket</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span> <span class="c"># 被动接收 tcp 客户端的连接, 阻塞式等待</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">cSocket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>  <span class="c"># 最大接受数为1024字节</span>
    <span class="k">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d </span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S'</span><span class="p">),</span> <span class="s">'接收到的消息为: '</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
    <span class="n">mydata</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'输入回复信息:'</span><span class="p">)</span>
    <span class="n">cSocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">mydata</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>客户端</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">time</span>

<span class="c"># 建立 socket tcp 连接</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="c"># 连接服务端地址</span>
<span class="n">c</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="mi">9069</span><span class="p">))</span>  <span class="c"># 连接 tcp 服务端</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'输入内容'</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
    <span class="n">mydata</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d </span><span class="si">%</span><span class="s">H:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">S'</span><span class="p">),</span><span class="s">' 收到服务端的信息是'</span><span class="p">,</span> <span class="n">mydata</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>简单的TCP 客户端认证连接</strong></p>

<p>服务端和客户端通过一个预先定义好的字符串来进行认证,认证通过才能进行数据的连接和交互</p>

<p>hmac 认证算法基于哈希函数如 MD5 和 SHA-1</p>

<p>还有一点需要强调的是连接认证和加密是两码事。认证成功之后的通信消息是以明 文形式发送的，任何人只要想监听这个连接线路都能看到消息(尽管双方的密钥不会 被传输)</p>

<p>基本原理是当连接建立后，服务器给客户端发送一个随机的字节消息(这里例子中 使用了 os.urandom() 返回值)。客户端和服务器同时利用 hmac 和一个只有双方知道 的密钥来计算出一个加密哈希值。然后客户端将它计算出的摘要发送给服务器，服务 器通过比较这个值和自己计算的是否一致来决定接受或拒绝连接。摘要的比较需要使 用 hmac.compare digest() 函数。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">socket</span><span class="p">,</span> <span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span>

<span class="k">def</span> <span class="nf">client_authenticate</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
    <span class="s">'''
    Authenticate client to a remote service.
    connection represents a network connection. secret_key is a key known only to both client/server.
    '''</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">digest</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">server_authenticate</span><span class="p">(</span><span class="n">connection</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
    <span class="s">'''
    Request client authentication.
    '''</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="nb">hash</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">secret_key</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="nb">hash</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">digest</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">digest</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

<span class="n">secret_key</span> <span class="o">=</span> <span class="n">b</span><span class="s">'peekaboo'</span>
<span class="k">def</span> <span class="nf">echo_handler</span><span class="p">(</span><span class="n">client_sock</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">server_authenticate</span><span class="p">(</span><span class="n">client_sock</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
        <span class="n">client_sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">client_sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">client_sock</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        
<span class="k">def</span> <span class="nf">echo_server</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">)</span> <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">c</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="n">echo_handler</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        

<span class="n">echo_server</span><span class="p">((</span><span class="s">''</span><span class="p">,</span> <span class="mi">18000</span><span class="p">))</span>

<span class="c"># ===========================================</span>
<span class="c"># Within a client, you would do this:</span>
<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="n">socket</span><span class="p">,</span> <span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span> 

<span class="n">secret_key</span> <span class="o">=</span> <span class="n">b</span><span class="s">'peekaboo'</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">)</span> 
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">18000</span><span class="p">))</span> 
<span class="n">client_authenticate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">'Hello World'</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="通过-socket-远程访问网站并获取源代码">通过 Socket 远程访问网站并获取源代码</h3>

<p>获取百度首页代码,并写成 html文件</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">c</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'www.baidu.com'</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">b</span><span class="s">'GET / HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host:www.baidu.com</span><span class="se">\r\n</span><span class="s">Connection: close</span><span class="se">\r\n\r\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">myList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">myList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span> <span class="k">break</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">myList</span><span class="p">)</span> 
<span class="n">header</span><span class="p">,</span> <span class="n">html</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">b</span><span class="s">'</span><span class="se">\r\n\r\n</span><span class="s">'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./xxx.html'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="socket-发送飞秋消息">Socket 发送飞秋消息</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">socket</span>


<span class="n">c</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span> <span class="c"># 用 UDP 协议发送</span>
<span class="n">mystr</span> <span class="o">=</span> <span class="s">'你好妹子'</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
    <span class="n">c</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">'10.11.56.'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">2425</span><span class="p">))</span>
    <span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">mystr</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'gbk'</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="用-python-玩微信">用 Python 玩微信</h3>

<p><a href="https://zhuanlan.zhihu.com/p/26514576?group_id=839173221667446784">用PYTHON玩微信</a></p>


            </div>

            <!-- Rating -->
            
            <div class="rating mb-4 d-flex align-items-center">
                <strong class="mr-1">Rating:</strong> <div class="rating-holder">
<div class="c-rating c-rating--regular" data-rating-value="4.5">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
</div>
</div>
            </div>
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2017-11-05">05 Nov 2017</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//Beginning-Python-From-Novice-to-Professional-Part-1/"> &laquo; Learning Python From Scratch (Part1)</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//Connect-DataBases-with-Python/">Python and Databases(Mysql, Redia, MongoDB) Basic &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Thing",
    "name": "Learning Python From Scratch (Part2)"
  },
  "author": {
    "@type": "Person",
    "name": "Dalong"
  },
  "datePublished": "2017-11-05",
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": "4.5",
    "bestRating": "5"
  }
}
</script>

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Linux">Linux (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (16)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mysql">Mysql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Redis">Redis (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MongoDB">MongoDB (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Flask">Flask (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Django">Django (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DjangoRest">DjangoRest (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Numpy">Numpy (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Panda">Panda (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Sklearn">Sklearn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jupyter">Jupyter (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenCV">OpenCV (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AI">AI (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Tensorflow">Tensorflow (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Microservice">Microservice (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Docker">Docker (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#NLP">NLP (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS">AWS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture">Architecture (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Agile">Agile (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Scrum">Scrum (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MLPS">MLPS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PIPL">PIPL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Metaverse">Metaverse (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ChatGPT">ChatGPT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenAI">OpenAI (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#LLM">LLM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Science">Data Science (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ITIL">ITIL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Github">Github (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Liquid">Liquid (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Markdown">Markdown (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 Dalong's personal blog 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="#">Designed</a> by Dalong.work
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>

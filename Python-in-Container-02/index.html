<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Python in Container Part Two | Dalong's personal blog</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Python in Container Part Two | Dalong’s personal blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Python in Container Part Two" />
<meta name="author" content="Dalong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="在本教程中，您将学习如何创建描述简单 Python 容器的 Dockerfile 文件。 使用容器创建 Web 服务器、数据库构建、运行和验证 Django、Flask 并通用 Python 应用实现程序的功能. 最后还会学习调试在容器中运行的应用程序。" />
<meta property="og:description" content="在本教程中，您将学习如何创建描述简单 Python 容器的 Dockerfile 文件。 使用容器创建 Web 服务器、数据库构建、运行和验证 Django、Flask 并通用 Python 应用实现程序的功能. 最后还会学习调试在容器中运行的应用程序。" />
<link rel="canonical" href="http://localhost:4000/Python-in-Container-02/" />
<meta property="og:url" content="http://localhost:4000/Python-in-Container-02/" />
<meta property="og:site_name" content="Dalong’s personal blog" />
<meta property="og:image" content="http://localhost:4000/assets/images/container.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-26T00:00:00+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Python in Container Part Two","dateModified":"2021-07-26T00:00:00+08:00","datePublished":"2021-07-26T00:00:00+08:00","description":"在本教程中，您将学习如何创建描述简单 Python 容器的 Dockerfile 文件。 使用容器创建 Web 服务器、数据库构建、运行和验证 Django、Flask 并通用 Python 应用实现程序的功能. 最后还会学习调试在容器中运行的应用程序。","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Dalong"},"image":"http://localhost:4000/assets/images/container.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Python-in-Container-02/"},"url":"http://localhost:4000/Python-in-Container-02/","author":{"@type":"Person","name":"Dalong"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Carter+One&display=swap" rel="stylesheet">
    </noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Dalong's personal blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

<!-- 以后再加上相关链接

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>
-->
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/dalongli"><i class="fab fa-github"></i> Fork on Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Dalong's personal blog</h1>
    <p class="lead">
        Record the bits and pieces of the technology big bang.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Python in Container Part Two&url=http://localhost:4000/Python-in-Container-02/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/Python-in-Container-02/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/Python-in-Container-02/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/avatar_dl.png" alt="Dalong">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://dalongli.github.io/about">Dalong</a><a target="_blank" href="https://dalongli.github.io." class="btn follow">Follow</a>
                        <span class="author-description">A profesional technical consultant and blogger.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Python in Container Part Two</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/container.jpg" alt="Python in Container Part Two">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <h3 class="font-weight-bold">Summary</h3>
                        <ul>
  <li><a href="#python-in-container">Python in Container</a>
    <ul>
      <li><a href="#build-container-image">Build Container Image</a>
        <ul>
          <li><a href="#dockerizing-pytest-and-pdb---例子">Dockerizing PyTest and Pdb - 例子</a>
            <ul>
              <li><a href="#使用-pytest-进行单元测试">使用 PyTest 进行单元测试</a></li>
              <li><a href="#使用-pdb-对-python-进行-debug">使用 PDB 对 python 进行 debug</a></li>
            </ul>
          </li>
          <li><a href="#django-的容器化---开发">Django 的容器化 - 开发</a></li>
          <li><a href="#django-的容器化---生产">Django 的容器化 - 生产</a>
            <ul>
              <li><a href="#python-容器的架构设计">Python 容器的架构设计</a></li>
              <li><a href="#示例代码---投票-demo1">示例代码 - 投票 demo1</a></li>
              <li><a href="#创建管理员用户">创建管理员用户</a>
                <ul>
                  <li><a href="#手动创建管理员用户准备进行-demo2">手动创建管理员用户，准备进行 demo2</a></li>
                  <li><a href="#自动创建---导出床架好的数据放在初始化数据中">自动创建 - 导出床架好的数据放在初始化数据中</a></li>
                  <li><a href="#自动创建---在-dockerfile-中将需要创建的数据用-python-命令执行">自动创建 - 在 Dockerfile 中将需要创建的数据用 python 命令执行</a></li>
                  <li><a href="#对创建的容器进行单元测试">对创建的容器进行单元测试</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#运行-django-和-flask-的-应用服务器">运行 Django 和 Flask 的 应用服务器</a>
            <ul>
              <li><a href="#gunicorn-的使用">Gunicorn 的使用</a>
                <ul>
                  <li><a href="#先创建-base-image">先创建 base image</a></li>
                </ul>
              </li>
              <li><a href="#uwsgi">uWSGI</a></li>
            </ul>
          </li>
          <li><a href="#生产级别的数据库---postgresql">生产级别的数据库 - PostgreSQL</a>
            <ul>
              <li><a href="#介绍">介绍</a></li>
              <li><a href="#创建数据库所需的网络-和-posgresql-容器">创建数据库所需的网络 和 posgresql 容器</a></li>
              <li><a href="#创建需要连接-postgre-的django应用镜像和容器">创建需要连接 postgre 的Django应用镜像和容器</a></li>
              <li><a href="#创建-pgadmin-用来管理数据">创建 PGAdmin 用来管理数据</a></li>
              <li><a href="#删除数据库容器的步骤">删除数据库容器的步骤</a></li>
            </ul>
          </li>
          <li><a href="#生产级别的数据库---mariadb">生产级别的数据库 - MariaDB</a>
            <ul>
              <li><a href="#快速创建一个-mariadb-容器">快速创建一个 MariaDB 容器</a></li>
              <li><a href="#创建链接-mariadb-的-django-镜像和容器">创建链接 Mariadb 的 django 镜像和容器</a></li>
              <li><a href="#使用-dj-database-url-来为-django-建立一个适应多个数据库的方案">使用 dj-database-url 来为 Django 建立一个适应多个数据库的方案</a></li>
            </ul>
          </li>
          <li><a href="#生产级别的-web-proxy-server">生产级别的 web proxy server</a>
            <ul>
              <li><a href="#先建立postgresql数据库容器">先建立postgresql数据库容器</a></li>
              <li><a href="#建立-应用的-镜像和容器">建立 应用的 镜像和容器</a></li>
              <li><a href="#建立-nginx-镜像和容器">建立 Nginx 镜像和容器</a></li>
              <li><a href="#建立-带-ssl-的-nginx-镜像和容器">建立 带 SSL 的 Nginx 镜像和容器</a></li>
              <li><a href="#用-nginx-做负载均衡">用 Nginx 做负载均衡</a></li>
            </ul>
          </li>
          <li><a href="#自动化的需求">自动化的需求</a></li>
        </ul>
      </li>
      <li><a href="#shipping-container-容器的运输">Shipping Container 容器的运输</a>
        <ul>
          <li><a href="#shipping-image--镜像运输">Shipping Image  镜像运输</a>
            <ul>
              <li><a href="#利用-docker-export-和-docker-import-在-vm-中建立镜像和容器">利用 docker export 和 docker import 在 vm 中建立镜像和容器</a></li>
              <li><a href="#练习-docker-save--docker-load">练习 docker save , docker load</a></li>
            </ul>
          </li>
          <li><a href="#image-registries-and-repositories">Image Registries and Repositories</a>
            <ul>
              <li><a href="#一些概念">一些概念</a>
                <ul>
                  <li><a href="#imange-name">Imange name</a></li>
                  <li><a href="#image-repository--就是仓库里我们自己创建的镜像的名字">Image Repository , 就是仓库里我们自己创建的镜像的名字</a></li>
                  <li><a href="#image-registry">Image Registry</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="#review-of-key-cloud-registries-公有云提供的镜像仓库">Review of Key Cloud Registries 公有云提供的镜像仓库</a></li>
          <li><a href="#review-of-local-registry-技术-了解本地镜像仓库技术">Review of Local Registry 技术 了解本地镜像仓库技术</a>
            <ul>
              <li><a href="#本地镜像仓库的优势">本地镜像仓库的优势</a></li>
              <li><a href="#docker-local-registry">Docker Local Registry</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>在本教程中，您将学习如何创建描述简单 Python 容器的 Dockerfile 文件。 使用容器创建 Web 服务器、数据库构建、运行和验证 Django、Flask 并通用 Python 应用实现程序的功能. 最后还会学习调试在容器中运行的应用程序。</p>

<h1 id="python-in-container">Python in Container</h1>

<p>[TOC]</p>

<h2 id="build-container-image">Build Container Image</h2>

<p>继续 Python in Container 01 的笔记</p>

<h3 id="dockerizing-pytest-and-pdb---例子">Dockerizing PyTest and Pdb - 例子</h3>

<p>Python 的测试分为几种</p>

<ul>
  <li>Static Tests - Pylint , etc,
    <ul>
      <li>提供静态测试，</li>
      <li>就是看看代码，分析代码，但不运行代码,</li>
      <li>IDE 就可以进行静态代码的检查</li>
      <li>和容器无关</li>
    </ul>
  </li>
  <li>Unit Tests - PyTest, Unittest, etc, 提供单元测试
    <ul>
      <li>非常适合用容器进行单元测试</li>
      <li>生产环境应该是越干净，越小越好</li>
    </ul>
  </li>
  <li>Black Box Tests,
    <ul>
      <li>模拟用户行为，</li>
      <li>创建内容，查看功能，</li>
      <li>比如 selenimum</li>
    </ul>
  </li>
</ul>

<h4 id="使用-pytest-进行单元测试">使用 PyTest 进行单元测试</h4>

<p>下载 multistage 的示例代码</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>git clone https://github.com/pythonincontainers/multistage
<span class="nb">cd </span>multistage
docker build -t factors_flask:cython-multi -f Dockerfile.cython-multi .

</pre></td></tr></tbody></table>
</div>
</div>

<p>下载测试用例的代码</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">cd</span> ..
git clone https://github.com/pythonincontainers/simpletests
<span class="nb">cd </span>simpletests
</pre></td></tr></tbody></table>
</div>
</div>

<p>创建测试镜像 并 生成容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="c"># 用上面的镜像作为基础镜像</span>
docker build -t factors_flask:tester -f Dockerfile.tester --build-arg <span class="nv">BaseImage</span><span class="o">=</span>factors_flask:cython-multi .

<span class="c"># 创建容器，创建过程中就自动执行了测试脚本，并输出结果，并在当前目录下生成 html 版本的报告</span>
docker run -it --rm -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/data factors_flask:tester

</pre></td></tr></tbody></table>
</div>
</div>

<p>浏览器打开目录中的静态 HTML 文件查看结果</p>

<h4 id="使用-pdb-对-python-进行-debug">使用 PDB 对 python 进行 debug</h4>

<p>https://docs.python.org/3/library/pdb.html</p>

<p>pdb 的使用方法是 <code class="language-plaintext highlighter-rouge">python -m pdb xxx.py</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="c"># 创建基于 pdb 的镜像</span>
docker build -t factors_flask:debug -f Dockerfile.debug --build-arg <span class="nv">BaseImage</span><span class="o">=</span>factors_flask:cython-multi .
<span class="c"># 创建基于 pdb 的容器，并进入酵母模式</span>
docker run -it --rm -p 5000:5000 factors_flask:debug
<span class="c"># 进入 Python 的 debug 模式</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="django-的容器化---开发">Django 的容器化 - 开发</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre>git clone https://github.com/pythonincontainers/djangoimage
<span class="nb">cd </span>djangoimage
<span class="c"># 查看 Dockerfile.mydjango</span>
<span class="c"># ARG BaseImage=python</span>
<span class="c"># ARG ImageTag=3.7.3</span>
<span class="c"># FROM $BaseImage:$ImageTag</span>
<span class="c"># ENV PYTHONUNBUFFERED 1</span>
<span class="c"># ARG DjangoVersion=2.2.1</span>
<span class="c"># RUN pip install Django==$DjangoVersion</span>
<span class="c"># WORKDIR /code</span>
<span class="nb">cd </span>base_image
docker build -t mydjango:2.2-3.7.3 -f Dockerfile.mydjango .
<span class="nb">cd</span> ..
<span class="c"># 测试一下镜像是否可以正常创建容器</span>
docker run -it --rm mydjango:2.2-3.7.3 django-admin --version
<span class="c"># 输出 django 版本 2.2.1</span>

<span class="c"># 给 镜像起个别名</span>
docker tag mydjango:2.2-3.7.3 django

<span class="c">#创建容器并启动 django 项目, 会在本地目录创建一个 myproject 的目录</span>
<span class="c"># 就算容器运行后 --rm 删掉了， 但是本机的目录和文件还在</span>
docker run -it --rm -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/code django django-admin startproject myproject
<span class="c"># 再次创建容器，并设置端口映射，进入交互模式</span>
docker run -it --rm -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/code -p 8000:8000 django bash
<span class="c"># 进入容器</span>
<span class="nb">cd </span>myproject/
<span class="c"># 启动项目</span>
python manage.py startapp myapp
<span class="nb">exit</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>通过 Powershell 定义一个佳作 dj 的 function</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="c"># 下面这个命令是通过 powershell 定义 一个 function, 方便后面的命令执行，但是 mac 不知道怎么定义</span>
<span class="c"># Function dj {docker run -it --rm -p 8000:8000 -v ${PWD}:/code django $args}</span>
<span class="c"># 进行数据迁移</span>
docker run -it --rm -p 8000:8000 -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/code django python manage.py migrate
docker run -it --rm -p 8000:8000 -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>:/code django python manage.py runserver 0:8000
</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000 可以看到 django 界面</p>

<p>修改view.py 增加</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="c"># Create your views here.</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"hello, world."</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>修改 urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">myapp</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s">'admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s">''</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span> 
<span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>重启服务器，访问 http://localhost:8000  可以看到 hello, world</p>

<h3 id="django-的容器化---生产">Django 的容器化 - 生产</h3>

<p>Django 应用需要支持</p>

<ul>
  <li>支持技术包括应用服务器，数据库，缓存，Proxy 服务器</li>
  <li>运行时环境架构</li>
  <li>应用生命周期</li>
  <li>更新和升级</li>
  <li>缩放</li>
  <li>服务质量</li>
  <li>安全</li>
  <li>高可用</li>
</ul>

<p>Django 应用的准备流程</p>

<ol>
  <li>django-admin startproject django-polls   创建项目</li>
  <li>python manage.py startapp polls   创建项目的应用</li>
  <li>Create the source code  写代码</li>
  <li>python manage.py makemigrations polls   数据库初始化</li>
  <li>python manage.py migrate   数据库迁移（创建）</li>
  <li>python manage.py createsuperuser  创建超级用户</li>
  <li>python manage.py loaddata …   读取json数据到数据库中</li>
  <li>python manage.py collectstatic   统计所有的状态，并放到一个目录下</li>
  <li>python manage.py runserver …  启动 web 服务</li>
</ol>

<h4 id="python-容器的架构设计">Python 容器的架构设计</h4>

<p>开发架构</p>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gpzggm440zj30ig0betaq.jpg" alt="" /></p>

<p>测试架构</p>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gpzghc6irkj30jo0biwhx.jpg" alt="" /></p>

<p>生产架构</p>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gpzgrfaq5wj30kl0e83zg.jpg" alt="" /></p>

<h4 id="示例代码---投票-demo1">示例代码 - 投票 demo1</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>git clone https://github.com/pythonincontainers/django-polls
cd django-polls
</pre></td></tr></tbody></table>
</div>
</div>

<p>查看几个文件</p>

<ul>
  <li>Dockerfile.demo1   Dockerfile 文件</li>
  <li>Mysite/settings.py  配置文件</li>
  <li>Initial_data.json  初始化的数据</li>
</ul>

<pre><code class="language-dockerfile">ARG BaseImage
FROM $BaseImage
ENV PYTHONUNBUFFERED 1
WORKDIR /code
COPY . .
EXPOSE 8000
RUN python manage.py makemigrations polls &amp;&amp; \
    python manage.py migrate &amp;&amp; \
    python manage.py loaddata initial_data.json &amp;&amp; \
    python manage.py collectstatic
ENTRYPOINT ["python", "manage.py"]
CMD ["runserver", "0:8000"]
</code></pre>

<p>创建镜像 demo1 , 并运行容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>docker build -t django-polls:demo1 -f Dockerfile.demo1 --build-arg <span class="nv">BaseImage</span><span class="o">=</span>django .
docker run -d --name polls-demo -p 8000:8000 django-polls:demo1


</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000/polls/ 查看投票</p>

<h4 id="创建管理员用户">创建管理员用户</h4>

<p>三种方法</p>

<h5 id="手动创建管理员用户准备进行-demo2">手动创建管理员用户，准备进行 demo2</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>docker <span class="nb">exec</span> -it polls-demo python manage.py createsuperuser
<span class="c"># 输入 admin , admin@example.com, admin, admin</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000/admin/ 登录后台</p>

<h5 id="自动创建---导出床架好的数据放在初始化数据中">自动创建 - 导出床架好的数据放在初始化数据中</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>docker <span class="nb">exec</span> -it polls-demo python manage.py dumpdata auth.user --indent 4
<span class="c"># 将以下为输出追加保存到 initial_data.json 文件中</span>
docker rm -f polls-demo
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="p">{</span><span class="w">
    </span><span class="nt">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"auth.user"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"pk"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pbkdf2_sha256$150000$nQfMOKShamoF$8ox6PWBZSlaxDDxzHOD0zhe4XcEYVEqARglRWuhUkCg="</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last_login"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-04-28T14:32:47.694Z"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"is_superuser"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin@example.com"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"is_staff"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"is_active"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"date_joined"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-04-28T14:31:38.717Z"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"groups"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nt">"user_permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></pre></td></tr></tbody></table>
</div>
</div>

<p>重新 build 镜像并 run</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>docker build -t django-polls:demo1 -f Dockerfile.demo1 --build-arg <span class="nv">BaseImage</span><span class="o">=</span>django .
docker run -d --name polls-demo -p 8000:8000 django-polls:demo1

</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000/admin/ 登录后台 , 不需要手动创建超级用户</p>

<h5 id="自动创建---在-dockerfile-中将需要创建的数据用-python-命令执行">自动创建 - 在 Dockerfile 中将需要创建的数据用 python 命令执行</h5>

<p>看Dockerfile.demo2, 多了一行</p>

<pre><code class="language-dockerfile">RUN echo "from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@example.com', 'admin')" | python manage.py shell
# 以上命令就是把 echo 出来的内容作为参数，让 python manage.py shell 来执行

</code></pre>

<p>删掉刚才加到 initial_data.json 中数据，用 Dockerfile.demo2 建立镜像并运行容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="c"># 删掉容器</span>
docker rm -f polls-demo

docker build -t django-polls:demo2 -f Dockerfile.demo2 --build-arg <span class="nv">BaseImage</span><span class="o">=</span>django .
docker run -it --rm -p 8000:8000 django-polls:demo2


</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000/admin/ 登录后台 , 不需要手动创建超级用户， 已经在 build 和 run 的阶段就做好了</p>

<h5 id="对创建的容器进行单元测试">对创建的容器进行单元测试</h5>

<p>因为示例代码中有polls/tests.py ，用于进行单元测试</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre>docker run -it --rm django-polls:demo2 <span class="nb">test</span>
<span class="c"># 输出为</span>
<span class="c"># Creating test database for alias 'default'...</span>
<span class="c"># System check identified no issues (0 silenced).</span>
<span class="c">#........</span>
<span class="c">#----------------------------------------------------------------------</span>
<span class="c"># Ran 8 tests in 0.090s</span>

<span class="c"># OK</span>
<span class="c"># Destroying test database for alias 'default'...</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="运行-django-和-flask-的-应用服务器">运行 Django 和 Flask 的 应用服务器</h3>

<p>Python 应用服务包括</p>

<ul>
  <li>Gunicorn (Green Unicorn)  绿色独角兽</li>
  <li>uWSGI   全称 Python Web Server Gateway Interface</li>
  <li>Mod_wsgi   为 apache 定制</li>
</ul>

<p>前两个可以和任何 web proxy server 工作，最后一个是用来和 apache 工作的</p>

<p>Django app 前端的进化</p>

<ul>
  <li>Django development server</li>
  <li>application server</li>
  <li>proxy server (比如 Nigix) + application server</li>
  <li>AWS Load Balancer + Application Server</li>
  <li>CDN Server + Applicaiton server</li>
  <li>Kubernetes Ingress + Application server</li>
  <li>Istio Service Mesh + Application Server</li>
</ul>

<h4 id="gunicorn-的使用">Gunicorn 的使用</h4>

<p><a href="https://www.oschina.net/p/gunicorn?hmsr=aladdin1e1">简单介绍</a></p>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gq0csoh91uj30me0aeacv.jpg" alt="" /></p>

<h5 id="先创建-base-image">先创建 base image</h5>

<p>查看 base_image/Dockerfile.mygunicorn</p>

<ul>
  <li>基于 python 安装好 django 和 gunicorn 的镜像</li>
</ul>

<pre><code class="language-dockerfile">ARG BaseImage=python
ARG ImageTag=3.7.3
FROM $BaseImage:$ImageTag
ENV PYTHONUNBUFFERED 1
ARG DjangoVersion=2.2.1
ARG GunicornVersion=19.9.0
RUN pip install Django==$DjangoVersion gunicorn==$GunicornVersion

</code></pre>

<p>创建 base image</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">cd </span>base_image
docker build -t gunicorn -f Dockerfile.mygunicorn .
<span class="nb">cd</span> ..
</pre></td></tr></tbody></table>
</div>
</div>

<p>查看 Dockerfile.gunicorn</p>

<pre><code class="language-dockerfile">ARG BaseImage
FROM $BaseImage
ENV PYTHONUNBUFFERED 1
WORKDIR /code
COPY . .
EXPOSE 8000
RUN python manage.py makemigrations polls &amp;&amp; \
    python manage.py migrate &amp;&amp; \
    python manage.py loaddata initial_data.json &amp;&amp; \
    python manage.py collectstatic &amp;&amp; \
    echo "from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@example.com', 'admin')" | python manage.py shell
CMD ["gunicorn", "-c", "gunicorn.ini", "mysite.wsgi"]  # 主要区别

</code></pre>

<p><code class="language-plaintext highlighter-rouge">gunicorn -c gunicorn.ini mysite.wsgi</code></p>

<p>查看 gunicorn.ini</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>bind = "0.0.0.0:8000"
workers = 2
worker_connections = 1000
timeout = 30
user = None
group = None

</pre></td></tr></tbody></table>
</div>
</div>

<p>创建 django 的 gunicorn 镜像, 并启动 容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>docker build -t django-polls:gunicorn -f Dockerfile.gunicorn --build-arg <span class="nv">BaseImage</span><span class="o">=</span>gunicorn .
docker run -it --rm -p 8000:8000 django-polls:gunicorn


</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000/polls/</p>

<h4 id="uwsgi">uWSGI</h4>

<p><a href="http://itpcb.com/a/191916">介绍</a></p>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gq0dm7odh9j30rs0na7eh.jpg" alt="" /></p>

<p>查看 base_image/Dockerfile.myuwsgi</p>

<ul>
  <li>基于 python 安装好 django 和 uwsgi 的镜像</li>
</ul>

<pre><code class="language-dockerfile">ARG BaseImage=python
ARG ImageTag=3.7.3
FROM $BaseImage:$ImageTag
ENV PYTHONUNBUFFERED 1
ARG DjangoVersion=2.2.1
ARG uWSGIVersion=2.0.18
RUN pip install Django==$DjangoVersion uwsgi==$uWSGIVersion  
</code></pre>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">cd </span>base_image
docker build -t uwsgi -f Dockerfile.myuwsgi .
<span class="nb">cd</span> ..
</pre></td></tr></tbody></table>
</div>
</div>

<p>查看 Dockerfile.uwsgi</p>

<pre><code class="language-dockerfile">ARG BaseImage
FROM $BaseImage
ENV PYTHONUNBUFFERED 1
WORKDIR /code
COPY . .
EXPOSE 8000
RUN python manage.py makemigrations polls &amp;&amp; \
    python manage.py migrate &amp;&amp; \
    python manage.py loaddata initial_data.json &amp;&amp; \
    python manage.py collectstatic &amp;&amp; \
    echo "from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@example.com', 'admin')" | python manage.py shell
CMD ["uwsgi", "uwsgi-http.ini"]  # 区别在这里，启动命令的变化

</code></pre>

<p>查看 uwsgi-http.ini</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>[uwsgi]
chdir = /code
module = mysite.wsgi:application
master = True
pidfile = /tmp/project-master.pid
vacuum = True
harakiri = 20
max-requests = 5000
http-socket = 0.0.0.0:8000
processes = 2

</pre></td></tr></tbody></table>
</div>
</div>

<p>创建 django 的 uwsgi 镜像, 并启动 容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>docker build -t django-polls:uwsgi -f Dockerfile.uwsgi --build-arg <span class="nv">BaseImage</span><span class="o">=</span>uwsgi .
docker run -it --rm -p 8000:8000 django-polls:uwsgi

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="生产级别的数据库---postgresql">生产级别的数据库 - PostgreSQL</h3>

<ul>
  <li>目的是创建两个独立的容器， 一个是 数据库，另一个是链接数据库的 django</li>
  <li>数据会独立于数据库存在于一个持久的存储上</li>
</ul>

<h4 id="介绍">介绍</h4>

<p>Python 对数据库的支持能力</p>

<ul>
  <li>Python Database API - PEP 249</li>
  <li>SQLAlchemy</li>
  <li>Object-relational Mappers (ORM): PeeWee, PonyORM, SQLObject, Tortois ORM, Storm</li>
  <li>Native DB Engine Drivers: Mysql, ProsgreSQL, MongoDB, CouchDB, Cassandra</li>
</ul>

<p>Django 的数据库驱动</p>

<ul>
  <li>SQLite3</li>
  <li>PostgreSQL</li>
  <li>Mysql and variants(MariaDB, etc,)</li>
  <li>Oracle Database Server</li>
</ul>

<p>数据库的设置主要在 settings.py 中</p>

<p><a href="https://docs.djangoproject.com/en/3.2/ref/settings/#databases">文档</a></p>

<p>下面是 对应的设置例子</p>

<ul>
  <li>ENGINE 需要提前设置好</li>
  <li>USER 需要提前就存在</li>
  <li>也可以通过环境变量来替换 hardcode 的配置信息</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre># SQLite3
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR,'db.sqlite3'),
    }
}
# PostgreSQL
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',  # 可以换成 mysql, sqlite2, oracle
        'NAME': 'pollsdb',
        'USER': 'pollsuser',
        'PASSWORD': 'pollspass',
        'HOST': 'db',
        'PORT': '5432',
    }
}
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="创建数据库所需的网络-和-posgresql-容器">创建数据库所需的网络 和 posgresql 容器</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>docker network create polls_net
<span class="c">#docker run -d --name db --network polls_net -e POSTGRES_PASSWORD=myprecious postgres</span>
<span class="c">#docker exec -it db psql -U postgres</span>
<span class="c"># docker run -it --rm --network polls_net postgres psql -h db -U postgres</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p>手动创建的话参考下面的 postgresql 命令</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">pollsuser</span> <span class="k">with</span> <span class="n">password</span> <span class="s1">'pollspass'</span> <span class="k">CReATEDB</span><span class="p">;</span>
<span class="k">Create</span> <span class="k">DATABASE</span> <span class="n">POLLSDB</span> <span class="k">WITH</span> <span class="k">OWNER</span> <span class="n">pollsuser</span><span class="p">;</span>
<span class="err">\</span><span class="n">l</span>
<span class="err">\</span><span class="n">du</span>
<span class="err">\</span><span class="n">q</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>创建数据库容器</p>

<ul>
  <li>-v 可以将数据独立于存储</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>
docker rm -f db
<span class="c"># docker run -d --name db --network polls_net -e POSTGRES_DB=pollsdb -e POSTGRES_USER=pollsuser -e POSTGRES_PASSWORD=pollspass postgres</span>
docker run -d --name db --network polls_net -v polls_vol:/var/lib/postgresql/data -e <span class="nv">POSTGRES_DB</span><span class="o">=</span>pollsdb -e <span class="nv">POSTGRES_USER</span><span class="o">=</span>pollsuser -e <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>pollspass postgres


</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="创建需要连接-postgre-的django应用镜像和容器">创建需要连接 postgre 的Django应用镜像和容器</h4>

<p>查看 Dockerfile.postgres</p>

<pre><code class="language-dockerfile">ARG BaseImage
FROM $BaseImage
ENV PYTHONUNBUFFERED 1
WORKDIR /code
COPY . .
EXPOSE 8000
RUN pip install psycopg2  # 是 postgresql 的 客户端
RUN python manage.py makemigrations polls &amp;&amp; python manage.py collectstatic
ARG DjangoSettings=mysite.settings_postgres
ENV DJANGO_SETTINGS_MODULE=$DjangoSettings
CMD ["gunicorn", "-c", "gunicorn.ini", "mysite.wsgi"]
</code></pre>

<p>查看 mysite3/settings_postgres.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.postgresql'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'pollsdb'</span><span class="p">,</span>
        <span class="s">'USER'</span><span class="p">:</span> <span class="s">'pollsuser'</span><span class="p">,</span>
        <span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">'pollspass'</span><span class="p">,</span>
        <span class="s">'HOST'</span><span class="p">:</span> <span class="s">'db'</span><span class="p">,</span>
        <span class="s">'PORT'</span><span class="p">:</span> <span class="s">'5432'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>创建镜像, 并启动容器，初始化数据并创建管理员用户</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre>docker images gunicorn
docker build -t django-polls:postgres -f Dockerfile.postgres --build-arg <span class="nv">BaseImage</span><span class="o">=</span>gunicorn .
<span class="c"># 初始化数据库</span>
docker run -it --rm --network polls_net django-polls:postgres python manage.py migrate
<span class="c"># 读取数据</span>
docker run -it --rm --network polls_net django-polls:postgres python manage.py loaddata initial_data.json
<span class="c"># 创建管理员 # 这里用 admin, admin@example.com, admin, admin</span>
docker run -it --rm --network polls_net django-polls:postgres python manage.py createsuperuser

<span class="c"># 启动web 服务</span>
docker run -it --rm --network polls_net -p 8000:8000 django-polls:postgres 

<span class="c"># 停止服务</span>
<span class="c"># 对容器进行单元测试</span>
docker run -it --rm --network polls_net -p 8000:8000 django-polls:postgres python manage.py <span class="nb">test</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="创建-pgadmin-用来管理数据">创建 PGAdmin 用来管理数据</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="c">#docker rm -f db</span>
<span class="c">#docker run -d --name db --network polls_net -v polls_vol:/var/lib/postgresql/data -e POSTGRES_DB=pollsdb -e POSTGRES_USER=pollsuser -e POSTGRES_PASSWORD=pollspass postgres</span>
docker run -d --name pgadmin --network polls_net -p 8080:80 -e <span class="nv">PGADMIN_DEFAULT_EMAIL</span><span class="o">=</span>admin@example.com -e <span class="nv">PGADMIN_DEFAULT_PASSWORD</span><span class="o">=</span>admin dpage/pgadmin4

</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8080/</p>

<ol>
  <li>登录用户名密码 admin@example.com  admin</li>
  <li>创建 数据库连接 db , db , pollsuser, pollspass</li>
  <li>查看数据， 查看用户和权限</li>
</ol>

<h4 id="删除数据库容器的步骤">删除数据库容器的步骤</h4>

<ul>
  <li>
    <p>数据库容器删除了， 但是数据会保存在存储上，重建容器后，应用可以照常访问数据库的数据</p>
  </li>
  <li>
    <p>数据库容器需要通过 kill 来删除， 确保数据可以有效的保存到存储中</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>docker <span class="nb">kill</span> -s SIGTERM db
docker rm db
docker rm -f db
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="生产级别的数据库---mariadb">生产级别的数据库 - MariaDB</h3>

<p>和 上一章的 postgresql 比较， 除了 setting.py 之外，其他 django 代码不需要做任何变化</p>

<p>MariaDB image 的<a href="https://hub.docker.com/_/mariadb">说明</a></p>

<p>创建一个持久的存储,</p>

<h4 id="快速创建一个-mariadb-容器">快速创建一个 MariaDB 容器</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>docker <span class="nb">kill</span> -s SIGTERM db
docker rm -f db
docker volume create maria_vol
docker run -d --name db --network polls_net -e <span class="nv">MYSQL_DATABASE</span><span class="o">=</span>pollsdb -e <span class="nv">MYSQL_USER</span><span class="o">=</span>pollsuser -e <span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>pollspass -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>myprecious -v maria_vol:/var/lib/mysql mariadb
<span class="c"># 默认的超级用户名是 root</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>查看 Dockerfile.mariadb</p>

<pre><code class="language-dockerfile">ARG BaseImage
FROM $BaseImage
ENV PYTHONUNBUFFERED 1
WORKDIR /code
COPY . .
EXPOSE 8000
RUN pip install mysqlclient  # 区别
RUN python manage.py makemigrations polls &amp;&amp; python manage.py collectstatic
ARG DjangoSettings=mysite.settings_mariadb  # 区别
ENV DJANGO_SETTINGS_MODULE=$DjangoSettings
CMD ["gunicorn", "-c", "gunicorn.ini", "mysite.wsgi"]

</code></pre>

<p>查看 mysite/settings_mariadb</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.mysql'</span><span class="p">,</span>  
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'pollsdb'</span><span class="p">,</span>
        <span class="s">'USER'</span><span class="p">:</span> <span class="s">'pollsuser'</span><span class="p">,</span>
        <span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">'pollspass'</span><span class="p">,</span>
        <span class="s">'HOST'</span><span class="p">:</span> <span class="s">'db'</span><span class="p">,</span>
        <span class="s">'PORT'</span><span class="p">:</span> <span class="s">'3306'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="创建链接-mariadb-的-django-镜像和容器">创建链接 Mariadb 的 django 镜像和容器</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>docker build -t django-polls:mariadb -f Dockerfile.mariadb --build-arg <span class="nv">BaseImage</span><span class="o">=</span>gunicorn .
docker run -it --rm --network polls_net django-polls:mariadb python manage.py migrate
docker run -it --rm --network polls_net django-polls:mariadb python manage.py loaddata initial_data.json
docker run -it --rm --network polls_net django-polls:mariadb python manage.py createsuperuser
<span class="c"># admin@example.com, admin, admin</span>

<span class="c"># 启动 web 服务</span>
docker run -it --rm --network polls_net -p 8000:8000 django-polls:mariadb
</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000/polls/</p>

<h4 id="使用-dj-database-url-来为-django-建立一个适应多个数据库的方案">使用 dj-database-url 来为 Django 建立一个适应多个数据库的方案</h4>

<p><a href="https://pypi.org/project/dj-database-url/">查看官方文档</a></p>

<ul>
  <li>Support currently exists for
    <ul>
      <li>PostgreSQL,</li>
      <li>PostGIS,</li>
      <li>MySQL,</li>
      <li>MySQL (GIS),</li>
      <li>Oracle,</li>
      <li>Oracle (GIS), and</li>
      <li>SQLite.</li>
    </ul>
  </li>
  <li>用了 dj-database-url 只要修改 settings.py 就可以了</li>
</ul>

<p>查看 mysite/settings_universal.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">dj_database_url</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="n">dj_database_url</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">'sqlite:////code/db.sqlite3'</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>查看 Dockerfile.db-universal</p>

<pre><code class="language-dockerfile">ARG BaseImage
FROM $BaseImage
ENV PYTHONUNBUFFERED 1
WORKDIR /code
COPY . .
EXPOSE 8000
# 下面一行是区别， 安装了所有可能使用的数据库的 python 客户端扩展，和 dj-database-url
RUN pip install psycopg2==2.8.2 mysqlclient==1.4.2 cx-Oracle==7.1.3 dj-database-url==0.5.0
RUN python manage.py makemigrations polls &amp;&amp; python manage.py collectstatic
ARG DjangoSettings=mysite.settings_universal  #区别在上面
ENV DJANGO_SETTINGS_MODULE=$DjangoSettings
CMD ["gunicorn", "-c", "gunicorn.ini", "mysite.wsgi"]

</code></pre>

<p>Database_URL</p>

<ul>
  <li><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gq0ryd2jsqj30nt0dk0ua.jpg" alt="" /></li>
</ul>

<p>创建能链接各种数据库的 django 镜像 和 容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>docker build -t django-polls:db-universal -f Dockerfile.db-universal --build-arg <span class="nv">BaseImage</span><span class="o">=</span>gunicorn .
<span class="c"># 假设我们用 mariadb</span>
docker run -it --rm --network polls_net -p 8000:8000 -e <span class="s2">"DATABASE_URL=mysql://pollsuser:pollspass@db/pollsdb"</span> django-polls:db-universal

</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8000/polls/</p>

<h3 id="生产级别的-web-proxy-server">生产级别的 web proxy server</h3>

<p>proxy server rationale 理由</p>

<ul>
  <li>强大和精密(sophisticated)的 web server</li>
  <li>支持 https</li>
  <li>提供负载均衡</li>
</ul>

<p>本章要设计的架构 - 三个独立的容器， db, app, proxy server</p>

<p>本章要做的事情</p>

<ol>
  <li>建立数据库容器</li>
  <li>建立应用</li>
  <li>建立基于 nginx 的 proxy server</li>
  <li>负载均衡练习</li>
</ol>

<h4 id="先建立postgresql数据库容器">先建立postgresql数据库容器</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>docker <span class="nb">kill</span> -s SIGTERM db
docker rm -f db
docker run -d --name db --network polls_net -e <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>myprecious -v polls_vol:/var/lib/postgresql/data postgres
docker logs db
<span class="c"># 看到 database system is ready to accept connections 就 OK 了</span>


</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="建立-应用的-镜像和容器">建立 应用的 镜像和容器</h4>

<p>查看 Dockerfile.uwsgi4nginx</p>

<ul>
  <li>这次用了 uwsgi 替换了 gunicorn （去链接 nginx） 作为 base image</li>
</ul>

<pre><code class="language-dockerfile">ARG BaseImage
FROM $BaseImage
ENV PYTHONUNBUFFERED 1
WORKDIR /code
COPY . .
EXPOSE 8000
RUN pip install psycopg2==2.8.2 mysqlclient==1.4.2 cx-Oracle==7.1.3 dj-database-url==0.5.0
RUN python manage.py makemigrations polls  # 区别， 并没有ython manage.py collectstatic
ARG DjangoSettings=mysite.settings_universal
ENV DJANGO_SETTINGS_MODULE=$DjangoSettings
CMD ["uwsgi", "uwsgi-nginx.ini"]  # 区别 用了 uwsgi 替换了 gunicorn 去链接 nginx
</code></pre>

<p>查看 uwsgi-nginx.ini</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>[uwsgi]
chdir = /code
module = mysite.wsgi:application
master = True
pidfile = /tmp/project-master.pid
vacuum = True
harakiri = 20
max-requests = 5000
socket = 0.0.0.0:8000
processes = 2

</pre></td></tr></tbody></table>
</div>
</div>

<p>创建 django 镜像，初始化数据， 创建超级用户</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="c"># uwsgi 是一个自建的 base image</span>
<span class="nb">cd </span>build_image
docker build -t uwsgi -f Dockerfile.myuwsgi .
<span class="nb">cd</span> ..
docker build -t django-polls:uwsgi4nginx -f Dockerfile.uwsgi4nginx --build-arg <span class="nv">BaseImage</span><span class="o">=</span>uwsgi .
docker run -it --rm --network polls_net -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> django-polls:uwsgi4nginx python manage.py migrate
docker run -it --rm --network polls_net -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> django-polls:uwsgi4nginx python manage.py loaddata initial_data.json
docker run -it --rm --network polls_net -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> django-polls:uwsgi4nginx python manage.py createsuperuser


</pre></td></tr></tbody></table>
</div>
</div>

<p>创建 app1 容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>docker run -d -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> --network polls_net --name app1 django-polls:uwsgi4nginx
docker logs app1

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="建立-nginx-镜像和容器">建立 Nginx 镜像和容器</h4>

<p>查看 Dockerfile.nginx</p>

<ul>
  <li>这里用了multi-stage build</li>
</ul>

<pre><code class="language-dockerfile">FROM django as dev
WORKDIR /code
COPY . .
RUN pip install dj-database-url==0.5.0
ARG DjangoSettings=mysite.settings_universal
ENV DJANGO_SETTINGS_MODULE=$DjangoSettings
RUN python manage.py collectstatic

FROM nginx:1.17.0
WORKDIR /code
COPY --from=dev /code/static /code/static
COPY mysite_nginx.conf /etc/nginx/conf.d/

</code></pre>

<p>查看 mysite_nginx.conf</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="c"># mysite_nginx.conf</span>

<span class="n">upstream</span> <span class="n">django</span> <span class="p">{</span>
    <span class="n">server</span> <span class="n">app1</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">server</span> <span class="p">{</span>
    <span class="n">listen</span>      <span class="mi">8000</span><span class="p">;</span>
    <span class="n">server_name</span> <span class="n">_</span><span class="p">;</span> <span class="c"># special "catch all" Server Name, please substitute with something appropriate</span>
    <span class="n">charset</span>     <span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">;</span>

    <span class="n">client_max_body_size</span> <span class="mi">75</span><span class="n">M</span><span class="p">;</span>   <span class="c"># adjust to taste</span>

    <span class="n">location</span> <span class="o">/</span><span class="n">media</span>  <span class="p">{</span>
        <span class="n">alias</span> <span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">media</span><span class="p">;</span>  <span class="c"># if Media Files are to be served</span>
    <span class="p">}</span>

    <span class="n">location</span> <span class="o">/</span><span class="n">static</span> <span class="p">{</span>
        <span class="n">alias</span> <span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">static</span><span class="p">;</span> <span class="c"># if Static Files are to be served</span>
    <span class="p">}</span>

    <span class="c"># Finally, send all non-media requests to the Django server.</span>
    <span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
        <span class="n">uwsgi_pass</span>  <span class="n">django</span><span class="p">;</span>
        <span class="n">include</span>     <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">uwsgi_params</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>创建 nginx 镜像, 运行容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>docker build -t mynginx -f Dockerfile.nginx .
docker run -it --rm --network polls_net -p 8000:8000 mynginx
<span class="c"># 或者</span>
docker run -d --network polls_net -p 8000:8000 mynginx
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="建立-带-ssl-的-nginx-镜像和容器">建立 带 SSL 的 Nginx 镜像和容器</h4>

<p>需要用多阶段的 build</p>

<p>先 build django, 然后 build ubuntu 做 SSL证书, 最后 build nginx</p>

<p>查看 Dockerfile.nginx-ssl</p>

<pre><code class="language-dockerfile">FROM django as dev
WORKDIR /code
COPY . .
RUN pip install dj-database-url==0.5.0
ARG DjangoSettings=mysite.settings_universal
ENV DJANGO_SETTINGS_MODULE=$DjangoSettings
RUN python manage.py collectstatic

FROM ubuntu:18.04 as ssl
RUN apt-get update &amp;&amp; apt-get install -y openssl
WORKDIR /ssl
RUN openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 \
    -keyout django-polls.key.pem -out django-polls.crt.pem \
    -subj "/CN=django-polls.example.com"

FROM nginx:1.17.0
WORKDIR /code
COPY --from=dev /code/static /code/static
COPY --from=ssl /ssl/django-polls.key.pem /ssl/django-polls.crt.pem /code/
COPY mysite_nginx_ssl.conf /etc/nginx/conf.d/

</code></pre>

<p>查看 mysite_nginx_ssl.conf</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="c"># mysite_nginx_ssl.conf</span>

<span class="n">upstream</span> <span class="n">django</span> <span class="p">{</span>
    <span class="n">server</span> <span class="n">app1</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">server</span> <span class="p">{</span>
    <span class="n">listen</span> <span class="mi">443</span> <span class="n">ssl</span><span class="p">;</span>
    <span class="n">ssl_certificate</span> <span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">django</span><span class="o">-</span><span class="n">polls</span><span class="o">.</span><span class="n">crt</span><span class="o">.</span><span class="n">pem</span><span class="p">;</span>
    <span class="n">ssl_certificate_key</span> <span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">django</span><span class="o">-</span><span class="n">polls</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">pem</span><span class="p">;</span>
    <span class="n">server_name</span> <span class="n">django</span><span class="o">-</span><span class="n">polls</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">;</span>

    <span class="n">charset</span>     <span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">;</span>
    <span class="n">client_max_body_size</span> <span class="mi">75</span><span class="n">M</span><span class="p">;</span>   <span class="c"># adjust to taste</span>

    <span class="n">location</span> <span class="o">/</span><span class="n">media</span>  <span class="p">{</span>
        <span class="n">alias</span> <span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">media</span><span class="p">;</span>  <span class="c"># if Media Files are to be served</span>
    <span class="p">}</span>

    <span class="n">location</span> <span class="o">/</span><span class="n">static</span> <span class="p">{</span>
        <span class="n">alias</span> <span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">static</span><span class="p">;</span> <span class="c"># if Static Files are to be served</span>
    <span class="p">}</span>

    <span class="c"># Finally, send all non-media requests to the Django server.</span>
    <span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
        <span class="n">uwsgi_pass</span>  <span class="n">django</span><span class="p">;</span>
        <span class="n">include</span>     <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">uwsgi_params</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>建立 ngins ssl 的镜像和容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>docker build -t mynginx:ssl -f Dockerfile.nginx-ssl .
docker run -it --rm --network polls_net -p 443:443 mynginx:ssl

</pre></td></tr></tbody></table>
</div>
</div>

<p>访问https  https://localhost/polls/</p>

<h4 id="用-nginx-做负载均衡">用 Nginx 做负载均衡</h4>

<p>先建立第二个 应用容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>docker run -d -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> --network polls_net --name app2 django-polls:uwsgi4nginx

</pre></td></tr></tbody></table>
</div>
</div>

<p>然后设置 mysite_nginx_ssl.conf ,添加 app2</p>

<p>修改部分如下</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="n">upstream</span> <span class="n">django</span> <span class="p">{</span>
  <span class="n">server</span> <span class="n">app1</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
  <span class="n">server</span> <span class="n">app2</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>重新 build nginx image , 并启动 nginx 容器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>docker build -t mynginx:lb -f Dockerfile.nginx-ssl .
docker run -d --name proxy --network polls_net -p 443:443 mynginx:lb
docker logs app1
docker logs app2
docker system prune

</pre></td></tr></tbody></table>
</div>
</div>

<p>打开 https://localhost/polls/  进行操作和刷新， 然后查看两个容器的日志， 会发现该有些访问走 app1, 有些走 app2</p>

<h3 id="自动化的需求">自动化的需求</h3>

<p>把之前做过的内容进行自动化，让其他程序员可以快速部署和我们一样的环境</p>

<p>组件的依赖关系</p>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gq3u6zx5fsj30s607u74u.jpg" alt="" /></p>

<p>需要建立的镜像和容器</p>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNgy1gq3uld57dyj30ie0iiacg.jpg" alt="" /></p>

<p>所需要执行的命令列表</p>

<ul>
  <li>如果把所有这些放到 shell 脚本也可以执行，但是并不是很友好的方法</li>
  <li>另一种方法是放到 k8s 中进行</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></td><td class="code"><pre><span class="c">#git clone https://github.com/pythonincontainers/base_image</span>
<span class="c">#cd base_image</span>
<span class="c">#docker build -t django -f Dockerfile.mydjango .</span>
<span class="c">#docker build -t uwsgi -f Dockerfile.myuwsgi .</span>

<span class="c">#建立 base images, django 和 uwsgi</span>
git clone https://github.com/pythonincontainers/djangoimage
<span class="nb">cd </span>djangoimage
<span class="nb">cd </span>base_image
docker build -t django -f Dockerfile.mydjango .
<span class="nb">cd</span> ../..
git clone https://github.com/pythonincontainers/django-polls
<span class="nb">cd </span>django-polls
<span class="nb">cd </span>base_image
docker build -t uwsgi -f Dockerfile.myuwsgi .
<span class="nb">cd</span> ..
<span class="c">#git clone https://github.com/pythonincontainers/django-polls</span>

<span class="c"># 建立代码镜像</span>
docker build -t django-polls:uwsgi4nginx -f Dockerfile.uwsgi4nginx --build-arg <span class="nv">BaseImage</span><span class="o">=</span>uwsgi .

<span class="c"># 建立存储和网络</span>
docker network create polls_net
docker volume rm polls_vol
docker volume create polls_vol

<span class="c"># 建立数据库容器</span>
docker <span class="nb">kill </span>db app1 app2 proxy
docker rm -f db app1 app2 proxy
docker run -d --network polls_net -e <span class="s2">"POSTGRES_USER=pollsuser"</span> -e <span class="s2">"POSTGRES_PASSWORD=pollspass"</span> -e <span class="s2">"POSTGRES_DB=pollsdb"</span> --name db -v polls_vol:/var/lib/postgresql/data postgres
docker logs db

docker run -it --rm --network polls_net -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> django-polls:uwsgi4nginx python manage.py migrate
docker run -it --rm --network polls_net -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> django-polls:uwsgi4nginx python manage.py loaddata initial_data.json
docker run -it --rm --network polls_net -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> django-polls:uwsgi4nginx python manage.py createsuperuser
docker run -d --name pgadmin --network polls_net -p 8080:80 -e <span class="nv">PGADMIN_DEFAULT_EMAIL</span><span class="o">=</span>admin@example.com -e <span class="nv">PGADMIN_DEFAULT_PASSWORD</span><span class="o">=</span>admin dpage/pgadmin4




<span class="c"># 创建 app1 , app2 的容器</span>
docker run -d -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> --network polls_net --name app1 django-polls:uwsgi4nginx
docker run -d -e <span class="s2">"DATABASE_URL=postgres://pollsuser:pollspass@db/pollsdb"</span> --network polls_net --name app2 django-polls:uwsgi4nginx

<span class="c"># 创建 Nginx proxy 的镜像</span>
docker build -t mynginx:ssl -f Dockerfile.nginx-ssl .
<span class="c"># 建立 proxy 容器</span>
docker run -d --name proxy --network polls_net -p 443:443 -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/mysite_nginx_ssl_lb.conf:/etc/nginx/conf.d/mysite_nginx_ssl.conf mynginx:ssl

</pre></td></tr></tbody></table>
</div>
</div>

<p>访问前端页面 https://localhost/polls/</p>

<p>访问管理后台 https://localhost/admin/ root admin</p>

<p>访问数据库管理界面 http://localhost:8080/</p>

<ol>
  <li>登录用户名密码 admin@example.com  admin</li>
  <li>创建 数据库连接 db , db , pollsuser, pollspass</li>
  <li>查看数据， 查看用户和权限</li>
</ol>

<h2 id="shipping-container-容器的运输">Shipping Container 容器的运输</h2>

<h3 id="shipping-image--镜像运输">Shipping Image  镜像运输</h3>

<p>Python 应用运输的方法</p>

<ul>
  <li>用 <code class="language-plaintext highlighter-rouge">docker export</code> 将容器导入到 tar 文件</li>
  <li>用 <code class="language-plaintext highlighter-rouge">docker save</code> 将镜像保存到tar 文件</li>
  <li>用 <code class="language-plaintext highlighter-rouge">docker load</code> 将tar 文件导入到 镜像中</li>
  <li>通 <code class="language-plaintext highlighter-rouge">docker push</code> 将本地镜像上传到  Docker Hub 上，为镜像进行注册</li>
  <li>用 <code class="language-plaintext highlighter-rouge">docker pull</code> 将镜像拉到本地 镜像库</li>
  <li>其他公有云的镜像仓库， Azure, AWS, Google,</li>
  <li>可以建立本地镜像仓库， 自己电脑上， 或者公司界别的镜像库</li>
</ul>

<h4 id="利用-docker-export-和-docker-import-在-vm-中建立镜像和容器">利用 docker export 和 docker import 在 vm 中建立镜像和容器</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></td><td class="code"><pre>git clone https://github.com/pythonincontainers/flask-hello
<span class="nb">cd </span>flask-hello
docker build -t flask-hello:alpine -f Dockerfile-alpine .
docker images flask-hello

<span class="c"># 创建一个 stop 的容器</span>
docker create --name flask-hello flask-hello:alpine  
<span class="c"># 从容器导出一个 tar 包</span>
docker <span class="nb">export</span> -o flask-hello.tar flask-hello
docker rm flask-hello

<span class="c"># 在 virtual box 上创建一个 叫 local 的 虚拟机</span>
docker-machine create <span class="nb">local
</span>docker-machine ls
docker-machine scp flask-hello.tar <span class="nb">local</span>:/tmp
docker-machine ssh <span class="nb">local</span>

<span class="c"># 进入虚机后</span>
docker images
docker import --change <span class="s2">"WORKDIR /myproject"</span> --change <span class="s2">"CMD python flask-hello.py"</span> /tmp/flask-hello.tar flask-hello:alpine   

docker images
<span class="c"># 已经有新的 image 了</span>
<span class="c"># 运行 local 上的容器</span>
docker run -it --rm -p 5000:5000 flask-hello:alpine

<span class="c"># 查看 虚机 local 的地址</span>
docker-machine ip <span class="nb">local</span>
<span class="c"># 输出 192.168.99.104</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://192.168.99.104:5000</p>

<h4 id="练习-docker-save--docker-load">练习 docker save , docker load</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="c"># 在 vm 中删除镜像，并删除.tar 文件</span>
docker rmi flask-hello:alpine
rm /tmp/flask-hello.tar
<span class="nb">exit</span>
<span class="c"># 回到主机</span>
docker images 
<span class="c"># REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span>
<span class="c"># postgres     latest    26c8bcd8b719   3 weeks ago   314MB</span>

<span class="c"># 将三个镜像打包到一个images.tar 文件中</span>
docker save -o images.tar postgres django-polls:uwsgi4nginx mynginx:ssl
docker-machine scp images.tar <span class="nb">local</span>:/tmp
docker-machine ssh <span class="nb">local</span>
<span class="c"># 进入 虚机</span>
docker images   <span class="c"># 空</span>
docker load -i /tmp/images.tar
docker images <span class="c"># 有三个镜像了</span>

<span class="c"># 清理战场</span>
<span class="nb">exit
</span>rm -f <span class="k">*</span>.tar
docker-machine rm <span class="nb">local</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="image-registries-and-repositories">Image Registries and Repositories</h3>

<h4 id="一些概念">一些概念</h4>

<ul>
  <li>
    <p>Repository：镜像仓库，用于存储具体的docker镜像，起到的是仓库存储作用，比如Tomcat下面有很多个版本的镜像，它们共同组成了Tomcat的Repository，我们通过tag来区分镜像版本</p>
  </li>
  <li>
    <p>Registry：注册服务器，管理镜像仓库，起到的是服务器的作用，比如官方的是Docker Hub，它是开源的，我们一般通过docker pull默认是拉取官方镜像仓库的镜像，当然我们也可以自己部署一个，拉取我们私有仓库镜像只需加上私有仓库IP+端口命令格式</p>
  </li>
  <li>
    <p>Registry上有很多的Repository，Redis、Tomcat、MySQL等等Repository组成了Registry。</p>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">docker pull &lt;registry&gt;:port/&lt;repository&gt;:&lt;tag&gt;</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>docker.io/pythonincontainers/simple-flask:v1.1
gcr.io/google-containers/python:3.5.1-slim
gitlab.com/pythonincontainers/section4/lesson1/example1:latest
registry.mycompany.com/project-zeta/serviceA:0.9.1
localhost:5001/django-polls:nginx-lb
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="imange-name">Imange name</h5>

<ul>
  <li>Offiial images - short names:
    <ul>
      <li>Python Post nginx</li>
    </ul>
  </li>
  <li>Official image - short name + tags
    <ul>
      <li>Python:3.7-slim python:2.7.16-alpine3.9</li>
    </ul>
  </li>
  <li>Docker hub images - full name + tags:
    <ul>
      <li>Pythonincontainers/flask-hello:1.0</li>
    </ul>
  </li>
</ul>

<h5 id="image-repository--就是仓库里我们自己创建的镜像的名字">Image Repository , 就是仓库里我们自己创建的镜像的名字</h5>

<p>下面，django-pools 就是 repository 的名字</p>

<p>所有镜像的名字都是一样的， 不用管 tag 的名字</p>

<ul>
  <li>Django-pools:uwsgi4nginx</li>
  <li>Django-pools:db-universal</li>
  <li>Django-pools:mariadb</li>
  <li>Django-pools:postgres</li>
  <li>Django-pools:uwsgi</li>
  <li>Django-pools:gunicorn</li>
</ul>

<h5 id="image-registry">Image Registry</h5>

<ul>
  <li>存储 image repositories 的地方 ， 比如 Docker Hub</li>
  <li>用来管理和发布镜像</li>
  <li>push image 到 registry</li>
  <li>从 registry pull 镜像</li>
  <li>云registry 和 本地 registry</li>
  <li>分为公有 registry 和私有 registry</li>
</ul>

<p>查找和使用 image 时的逻辑流程</p>

<ol>
  <li>分析image 的名字，分解出 registry, repository 和 tag</li>
  <li>检查 Docker 的 本地 image catch 是否有这个image, 如果有，跳到第四步</li>
  <li>从 registry 下载镜像到本地的 image cache</li>
  <li>使用本地镜像中的 image</li>
</ol>

<h3 id="review-of-key-cloud-registries-公有云提供的镜像仓库">Review of Key Cloud Registries 公有云提供的镜像仓库</h3>

<p>任何人或者组织都可以分享他们的 registries</p>

<p>一些知名的 Cloud Image Registries</p>

<ul>
  <li>docker hub</li>
  <li><a href="https://quay.io">Quay.io</a> 由 RedHat 维护， 是付费的镜像仓库</li>
  <li><a href="https://gitlab.com/gitlib">Gitlab container registry </a> 和 docker hub 很像， 知名的免费 镜像仓库， 可以集成 CICD pipeline</li>
  <li><a href="https://cloud.google.com/container-registry/">Google Container Registry</a> (GCR)</li>
  <li>Amazon Elastic Container Registry （ECR） <a href="https://docs.amazonaws.cn/aws/latest/userguide/ecr.html">文档</a> <a href="https://aws.amazon.com/ecr/">国际版</a></li>
  <li>Azure Container Registry</li>
</ul>

<h3 id="review-of-local-registry-技术-了解本地镜像仓库技术">Review of Local Registry 技术 了解本地镜像仓库技术</h3>

<p>有一些 image registry 软件可以在本地环境进行安装，用于管理镜像仓库</p>

<h4 id="本地镜像仓库的优势">本地镜像仓库的优势</h4>

<ul>
  <li>简单快速的分享镜像</li>
  <li>自主的访问控制</li>
  <li>高安全性</li>
  <li>灵活的存储后台配置</li>
  <li>灵活的整合能力，尤其是和企业内部的一些软件或者流程</li>
  <li>有仓库缓存选项</li>
</ul>

<h4 id="docker-local-registry">Docker Local Registry</h4>

<ul>
  <li>开源的 Docker Registry</li>
  <li>商业版本 Docker 新任的 Registry</li>
  <li>可以通过容器镜像提供</li>
</ul>

<p>可以在 github 中找到</p>

<p>https://github.com/distribution/distribution</p>

<p>运行一个 Docker Local Registry</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>git clone https://github.com/pythonincontainers/local-registry
<span class="nb">cd local</span>-registry/
docker run -d -p 5001:5000 --restart always --name registry-local registry:2
</pre></td></tr></tbody></table>
</div>
</div>

<p>还需要一个 Docker Registry 的 UI</p>

<ul>
  <li>一个个人开发的 Docker Registry UI, https://joxit.dev/docker-registry-ui/</li>
  <li>可以通过刚刚下载的Dockerfile.registry-gui 来生成镜像</li>
  <li>Dockerfile 会使用通过刚刚下载的 registry-gui.yml</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre>docker build -t myregistry:gui -f Dockerfile.registry-gui .   <span class="c"># 创建一个 gui 镜像</span>
docker rm -f registry-local  <span class="c"># 删掉原来的</span>
docker run -d --name registry-local --restart always -p 5551:5551 myregistry:gui <span class="c"># 创建一个本地镜像仓库的容器</span>
docker logs registry-local
<span class="c"># docker tag factors_flask:cython-multi localhost:5551/factors_flask:multi</span>
docker tag flask-hello:alpine localhost:5551/flask-hello:myversion  <span class="c"># 为我们本地缓存中的随便一个镜像打个标签</span>
docker push localhost:5551/flask-hello:myversion  <span class="c"># 将这个镜像 push 到 本地镜像仓库中</span>
<span class="c"># 创建一个 本地镜像管理界面的容器</span>
docker run -d --name registry-ui -p 8880:80 -e <span class="nv">URL</span><span class="o">=</span>http://localhost:5551 -e <span class="nv">DELETE_IMAGES</span><span class="o">=</span><span class="nb">true </span>joxit/docker-registry-ui:static  

</pre></td></tr></tbody></table>
</div>
</div>

<p>访问 http://localhost:8880</p>

<p>就可以看到刚才 push 的镜像了</p>

<p>在 VM 中创建一个 Docker 镜像的本地仓库</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre>docker build -t myregistry:cache -f Dockerfile.hub-mirror .
docker run -d --name registry-cache -p 5552:5552 --restart always myregistry:cache
docker logs registry-cache
docker-machine create --driver hyperv --engine-registry-mirror http://192.168.31.51:5552 --engine-insecure-registry http:192.168.31.51:5551 docker1
<span class="c"># 这里报错了， 说: Error with pre-create check: "Powershell was not found in the path"</span>
docker-machine env docker1

<span class="c"># 清理掉没用的镜像和容器</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>其他的本地镜像软件</p>

<p>Goharbor.io</p>

<p>jforg.com/artifactory/</p>


            </div>

            <!-- Rating -->
            
            <div class="rating mb-4 d-flex align-items-center">
                <strong class="mr-1">Rating:</strong> <div class="rating-holder">
<div class="c-rating c-rating--regular" data-rating-value="4.5">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
</div>
</div>
            </div>
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2021-07-26">26 Jul 2021</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Container">Container</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Docker">Docker</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Microservice">Microservice</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//Python-in-Container-01/"> &laquo; Python in Container Part One</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//Prepare-for-AWS-Certified-Solutions-Architect-Associate-Certification/">Step by Step for AWS Certified Solutions Architect Associate &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Thing",
    "name": "Python in Container Part Two"
  },
  "author": {
    "@type": "Person",
    "name": "Dalong"
  },
  "datePublished": "2021-07-26",
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": "4.5",
    "bestRating": "5"
  }
}
</script>

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Linux">Linux (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (16)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mysql">Mysql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Redis">Redis (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MongoDB">MongoDB (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Flask">Flask (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Django">Django (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DjangoRest">DjangoRest (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Web-development">Web development (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Numpy">Numpy (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Panda">Panda (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Sklearn">Sklearn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jupyter">Jupyter (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenCV">OpenCV (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AI">AI (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Science">Data Science (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Tensorflow">Tensorflow (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ML">ML (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Microservice">Microservice (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Docker">Docker (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Rest-API">Rest API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Container">Container (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#NLP">NLP (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS">AWS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture">Architecture (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Database">Database (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Storage">Storage (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DevOps">DevOps (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IAM">IAM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cloud">Cloud (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#API">API (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Migration">Data Migration (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Network">Network (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#YAML">YAML (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Security">Security (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#kubernetes">kubernetes (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Serverless">Serverless (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#CICD">CICD (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Agile">Agile (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Scrum">Scrum (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Design-Thinking">Design Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GCP">GCP (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Google-Cloud-Platform">Google Cloud Platform (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MLPS">MLPS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PIPL">PIPL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PII">PII (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GDPR">GDPR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Metaverse">Metaverse (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#VR">VR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AR">AR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#XR">XR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Togaf">Togaf (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture-Thinking">Architecture Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ChatGPT">ChatGPT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenAI">OpenAI (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#LLM">LLM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Prompt">Prompt (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DALL-E">DALL-E (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OCR">OCR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Face-API">Face API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Chat-Bot">Chat Bot (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Speech-Service">Speech Service (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Computer-Vision">Computer Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Custom-Vision">Custom Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Video-indexer">Video indexer (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Translator">Translator (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cognitive-Search">Cognitive Search (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Knowledge-Base">Knowledge Base (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ITIL">ITIL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IT">IT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Github">Github (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Liquid">Liquid (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Markdown">Markdown (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Node.js">Node.js (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Yarn">Yarn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Nest.JS">Nest.JS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Typescript">Typescript (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Restful-API">Restful API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Postman">Postman (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Postgresql">Postgresql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#TypeORM">TypeORM (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 Dalong's personal blog 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="#">Designed</a> by Dalong.work
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>

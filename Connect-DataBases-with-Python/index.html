<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Python and Databases(Mysql, Redia, MongoDB) Basic | Dalong's personal blog</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Python and Databases(Mysql, Redia, MongoDB) Basic | Dalong’s personal blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Python and Databases(Mysql, Redia, MongoDB) Basic" />
<meta name="author" content="Dalong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Python编程语言具有强大的数据库编程功能。Python支持各种数据库，如SQLite，MySQL，Redis, MongoDB, Oracle，Sybase，PostgreSQL等。本文是从几种常用的数据库的基本操作入手, 教大家如何对 Mysql, Redis, MongoDB 进行日常操作, 以及如何使用 Python 对他们进行基本的操作。" />
<meta property="og:description" content="Python编程语言具有强大的数据库编程功能。Python支持各种数据库，如SQLite，MySQL，Redis, MongoDB, Oracle，Sybase，PostgreSQL等。本文是从几种常用的数据库的基本操作入手, 教大家如何对 Mysql, Redis, MongoDB 进行日常操作, 以及如何使用 Python 对他们进行基本的操作。" />
<link rel="canonical" href="http://localhost:4000/Connect-DataBases-with-Python/" />
<meta property="og:url" content="http://localhost:4000/Connect-DataBases-with-Python/" />
<meta property="og:site_name" content="Dalong’s personal blog" />
<meta property="og:image" content="http://localhost:4000/assets/images/python-dbs.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-12T00:00:00+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Python and Databases(Mysql, Redia, MongoDB) Basic","dateModified":"2018-03-12T00:00:00+08:00","datePublished":"2018-03-12T00:00:00+08:00","description":"Python编程语言具有强大的数据库编程功能。Python支持各种数据库，如SQLite，MySQL，Redis, MongoDB, Oracle，Sybase，PostgreSQL等。本文是从几种常用的数据库的基本操作入手, 教大家如何对 Mysql, Redis, MongoDB 进行日常操作, 以及如何使用 Python 对他们进行基本的操作。","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Dalong"},"image":"http://localhost:4000/assets/images/python-dbs.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Connect-DataBases-with-Python/"},"url":"http://localhost:4000/Connect-DataBases-with-Python/","author":{"@type":"Person","name":"Dalong"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Carter+One&display=swap" rel="stylesheet">
    </noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Dalong's personal blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

<!-- 以后再加上相关链接

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>
-->
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/dalongli"><i class="fab fa-github"></i> Fork on Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Dalong's personal blog</h1>
    <p class="lead">
        Record the bits and pieces of the technology big bang.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Python and Databases(Mysql, Redia, MongoDB) Basic&url=http://localhost:4000/Connect-DataBases-with-Python/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/Connect-DataBases-with-Python/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/Connect-DataBases-with-Python/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/avatar_dl.png" alt="Dalong">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://dalongli.github.io/about">Dalong</a><a target="_blank" href="https://dalongli.github.io." class="btn follow">Follow</a>
                        <span class="author-description">A profesional technical consultant and blogger.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Python and Databases(Mysql, Redia, MongoDB) Basic</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/python-dbs.png" alt="Python and Databases(Mysql, Redia, MongoDB) Basic">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <h3 class="font-weight-bold">Summary</h3>
                        <ul>
  <li><a href="#python-与-数据库">Python 与 数据库</a>
    <ul>
      <li><a href="#关系型数据库">关系型数据库</a>
        <ul>
          <li><a href="#mysql数据库">Mysql数据库</a>
            <ul>
              <li><a href="#官方-mysql-dmg-包的下载和使用">官方 MySQL dmg 包的下载和使用</a></li>
              <li><a href="#xampp安装说明-推荐-因为安装的是-mariadb"><strong>XAMPP安装说明 (推荐! 因为安装的是 MariaDB)</strong></a></li>
              <li><a href="#mysql客户端-启动和连接命令"><strong>Mysql客户端 启动和连接命令</strong></a></li>
              <li><a href="#mysql-服务端-配置和命令"><strong>Mysql 服务端 配置和命令</strong></a></li>
              <li><a href="#基本命令"><strong>基本命令</strong></a>
                <ul>
                  <li><a href="#数字类型字段"><strong>数字类型字段</strong></a></li>
                  <li><a href="#日期和时间类型字段"><strong>日期和时间类型字段</strong></a></li>
                  <li><a href="#字符串类型字段"><strong>字符串类型字段</strong></a></li>
                  <li><a href="#字段约束"><strong>字段约束</strong></a></li>
                  <li><a href="#索引">索引</a></li>
                  <li><a href="#数据存储类型myisam-和-innodb以及位置">数据存储类型(MyISAM 和 InnoDB)以及位置</a></li>
                  <li><a href="#transaction-事物处理">transaction 事物处理</a></li>
                  <li><a href="#alter-对表结构的操作">alter 对表结构的操作</a></li>
                  <li><a href="#insert-添加数据">insert 添加数据</a></li>
                  <li><a href="#select-查询">select 查询</a></li>
                  <li><a href="#group-by-分组"><strong>group by 分组</strong></a></li>
                  <li><a href="#like-模糊查询"><strong>like 模糊查询</strong></a></li>
                  <li><a href="#delete-删除">delete 删除</a></li>
                  <li><a href="#update-更新数据">update 更新数据</a></li>
                  <li><a href="#join-的使用">join 的使用</a></li>
                  <li><a href="#mysql-的聚合函数">Mysql 的聚合函数</a></li>
                  <li><a href="#mysql-的导入和导出">mysql 的导入和导出</a></li>
                  <li><a href="#mysql的权限管理">mysql的权限管理</a></li>
                </ul>
              </li>
              <li><a href="#用-python-操作-mysql">用 python 操作 mysql</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#非关系数据库">非关系数据库</a>
        <ul>
          <li><a href="#redis-数据库">redis 数据库</a>
            <ul>
              <li><a href="#redis-数据库介绍">redis 数据库介绍</a></li>
              <li><a href="#redis-数据库的安装">redis 数据库的安装</a></li>
              <li><a href="#redis-数据结构">redis 数据结构</a>
                <ul>
                  <li><a href="#key-相关命令">Key 相关命令</a></li>
                  <li><a href="#string-字符串">string 字符串</a></li>
                  <li><a href="#set-集合">set 集合</a></li>
                </ul>
              </li>
              <li><a href="#zset-有序集合">zset 有序集合</a></li>
              <li><a href="#用-python-连接-redis">用 Python 连接 redis</a></li>
            </ul>
          </li>
          <li><a href="#mongodb-数据库">MongoDB 数据库</a>
            <ul>
              <li><a href="#了解-json">了解 JSON</a></li>
              <li><a href="#安装mongodb">安装MongoDB</a></li>
              <li><a href="#mongo-db-介绍">Mongo DB 介绍</a>
                <ul>
                  <li><a href="#mongo-存储的概念区别"><strong>mongo 存储的概念(区别)</strong></a></li>
                  <li><a href="#对库的操作">对库的操作</a></li>
                  <li><a href="#对于集合的操作">对于集合的操作</a></li>
                  <li><a href="#insertsave-文档的添加修改文档覆盖">INSERT/SAVE 文档的添加/修改(文档覆盖)</a></li>
                  <li><a href="#update-修改">Update 修改</a>
                    <ul>
                      <li><a href="#find-查找所有">find 查找所有</a></li>
                      <li><a href="#remove-删除">remove 删除</a></li>
                    </ul>
                  </li>
                  <li><a href="#数据库的备份和恢复">数据库的备份和恢复</a></li>
                </ul>
              </li>
              <li><a href="#为-python-安装-mongo-模块">为 python 安装 mongo 模块</a></li>
              <li><a href="#python-中使用-pymongo-模块">python 中使用 pymongo 模块</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>Python编程语言具有强大的数据库编程功能。Python支持各种数据库，如SQLite，MySQL，Redis, MongoDB, Oracle，Sybase，PostgreSQL等。本文是从几种常用的数据库的基本操作入手, 教大家如何对 Mysql, Redis, MongoDB 进行日常操作, 以及如何使用 Python 对他们进行基本的操作。</p>

<h1 id="python-与-数据库">Python 与 数据库</h1>

<p>[TOC]</p>

<blockquote>
  <p>数据库的概念: 数据库分为关系型数据库和非关系型数据库</p>
</blockquote>

<ol>
  <li>关系型数据库: 一般使用 mysql, mariaDB. 一般公司使用 mysql 配合 radis 一起使用</li>
  <li>非关系型数据库: radis 和 mongodb.</li>
</ol>

<h2 id="关系型数据库">关系型数据库</h2>

<ul>
  <li>优点:
    <ul>
      <li><strong>复杂查询</strong>: 可以使用 SQL 语句在一个或多个表之间进行复杂查询操作</li>
      <li><strong>事物处理支持</strong>: 可以对中断的事物进行回滚操作</li>
    </ul>
  </li>
</ul>

<h3 id="mysql数据库">Mysql数据库</h3>

<p><a href="https://www.cnblogs.com/zhangzhu/archive/2013/07/04/3172486.html">mysql 基本命令</a></p>

<p><a href="https://dev.mysql.com/doc/refman/8.0/en/tutorial.html">mysql 官方手册</a></p>

<p><a href="https://mariadb.com/kb/en/library/documentation/">mariaDB 官方手册</a></p>

<h4 id="官方-mysql-dmg-包的下载和使用">官方 MySQL dmg 包的下载和使用</h4>

<p>从官方下载 <a href="https://dev.mysql.com/downloads/mysql/">mysql</a></p>

<p>安装 dmg 包, 记住安装完毕时提示的密码</p>

<p>到 mac 的系统设置界面中启动 mysql</p>

<p>在终端命令行输入如下命令</p>

<p><code class="language-plaintext highlighter-rouge">/usr/local/mysql/bin/mysql -u root -pxxxxxx</code></p>

<p>进入数据库后修改 密码为自己熟悉的密码</p>

<p><code class="language-plaintext highlighter-rouge">set password for root@localhost = password('xxxxxx');</code></p>

<h4 id="xampp安装说明-推荐-因为安装的是-mariadb"><strong>XAMPP安装说明 (推荐! 因为安装的是 MariaDB)</strong></h4>

<ul>
  <li>
    <p>下载 <a href="https://www.apachefriends.org/index.html">xampp</a></p>
  </li>
  <li>
    <p>安装并启动数据库服务</p>
  </li>
  <li>
    <p>访问 mysql</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">cd</span> /Applications/XAMPP/xamppfiles/bin

./mysql -uroot -234567  <span class="c">#</span>
</pre></td></tr></tbody></table>
</div>
    </div>

    <p>​</p>
  </li>
</ul>

<h4 id="mysql客户端-启动和连接命令"><strong>Mysql客户端 启动和连接命令</strong></h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>mysql -h主机名orIP地址 -P端口号 -u用户名 -p密码 -Ssocket文件 -D指定数据库

/Applications/XAMPP/xamppfiles/bin/mysql -uroot -pxxxxx
<span class="c"># 如果访问的本机的 mysql, -h 参数可以不加</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="mysql-服务端-配置和命令"><strong>Mysql 服务端 配置和命令</strong></h4>

<ul>
  <li>配置文件</li>
</ul>

<blockquote>
  <p>配置文件 my.cnf</p>
</blockquote>

<ul>
  <li>查看Mysql 的运行服务, 以及数据文件存放位置, error log 日志位置, socket 文件位置 :
    <ul>
      <li>首先找到 mysqld 的执行进程 <code class="language-plaintext highlighter-rouge">ps aux|grep mysql</code> 如下</li>
      <li>–datadir 就是数据文件存放位置</li>
      <li>–log-error 是错误日志位置</li>
      <li>–socket 是 socket 文件位置</li>
    </ul>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>_mysql           26761   0.0  0.1  4574220  12404   ??  S     9:28AM   0:02.73 /Applications/XAMPP/xamppfiles/sbin/mysqld --basedir<span class="o">=</span>/Applications/XAMPP/xamppfiles --datadir<span class="o">=</span>/Applications/XAMPP/xamppfiles/var/mysql --plugin-dir<span class="o">=</span>/Applications/XAMPP/xamppfiles/lib/mysql/plugin/ --user<span class="o">=</span>mysql --log-error<span class="o">=</span>/Applications/XAMPP/xamppfiles/var/mysql/localhost.err --pid-file<span class="o">=</span>/Applications/XAMPP/xamppfiles/var/mysql/localhost.pid --socket<span class="o">=</span>/Applications/XAMPP/xamppfiles/var/mysql/mysql.sock --port<span class="o">=</span>3308
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="基本命令"><strong>基本命令</strong></h4>

<p><strong>技巧:</strong></p>

<ul>
  <li>在 mysql 命令行中要使用 HELP 接命令来了解不同的命令用法.</li>
  <li>在 mysql 命令行中写 sql 语句的时候, 用大写来写命令 , 这样就可以用双击 tab 来获取 mysql 的命令提示</li>
  <li>mysql 中的SQL是不区分大小写的, 但 数据库, 表名是大小写敏感的</li>
  <li>sql 命令需要用 <code class="language-plaintext highlighter-rouge">;</code> 结束. 如果不用<code class="language-plaintext highlighter-rouge">;</code>就回车, 就进入多行编辑模式</li>
  <li>mysql 中的每个数据库是以文件形式存在于磁盘上的</li>
  <li>字符集: 建库的时候就就要把charset 设置成 utf8, 这样建表,建字段的时候才会默认是 utf8</li>
  <li>开启不严谨报错: 默认 myql 的报错为严谨报错, 只要数据除了问题,就会报错, 开启不严谨报错后, 当数据超出范围后, 自动街区为最大值. 可以在 <code class="language-plaintext highlighter-rouge">mysql.ini</code> 文件中将原来的 <code class="language-plaintext highlighter-rouge">sql-mode</code> 注释掉,重启 mysql, 不严谨报错生效. <code class="language-plaintext highlighter-rouge">sql-mode="NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"</code></li>
</ul>

<pre><code class="language-mysql">##==================    系统命令   =================
help # \h 查看 mysql 的基本快捷命令 比如 \h 就是 help 的快捷命令. help 后面 可以再接需要了解的命令
status # \s 可以查看当前数据库的版本, socket, 当前用户, 启动时间, slow query 等
source # \. 可以执行一个外部的 sql 文件
system # \! 执行一个系统命令
clear # \c 作为当前sql语句的撤销动作
ego  # \G 发送命令, 并将结果垂直显示(不用表格来显示)
select version(), current_date, now(); # 查看版本和当前日期
select user(); # 查看 mysql 的用户
GRANT ALL ON menagerie.* TO 
'your_mysql_name'@'your_client_host'; # 给某用户可以访问某个数据库的所有权限. your_mysql_name 表示用户名, your_client_host 表示用户自己机器的 host ip 地址, menagerie 是一个数据库的名字
quit # \q or exit  都可以退出数据库
show warnings \G # 执行 sql 语句的时候偶尔会有警告,但是并不显示出来, 可以通过这个命令来查看. warnings只记录上一次执行的提示, 所以遇到后要马上看, 否则会被其他的 warning 覆盖掉
show errors \G # 查看报错信息

#===================  数据库操作命令  =================#

## 数据库操作命令,  数据库的名字是大小写敏感的
show databases; # 显示数据库
use test # 选择并进入 test 数据库
create database py1702 character set utf8; # 创建数据库并设置字符集
create database if not exists py1703; # 如果库不存在 就创建. 不存在的话,会创建成功. 存在的话, 也会成功, 但是会报一个 warning 
show create database py1702\G # 查看一个创建了的数据库
alter database py1702 charset latin1; # 修改字符集
drop database py1702; # 删除数据库
drop database if exists py1703; # 如果库存在就删. 存在会删除成功, 不存在也会成功, 但是会有一个 warning. 

#====================  表操作命令  ===================#

show tables; # 显示表列表
select database(); # 查看当前所在库是哪个库
show create table pet; # 查看创建的表
desc pet; # 查看表的字段信息 可以写 describe 表名
load data local infile '/Users/dalong/code/python1702/homework/pets.txt' into table pet; # 从本地文件中 load 数据到表中. 前提是需要创建一个文件, 每一行表示一条记录, 每行的单个数据需要用 tab 键隔开. 空值用 \N 代替. 可以用 LINES TERMINATED BY '\r\n' 来决定每行(每条记录)的分割符. 用fields terminated by ',' 决定字段的分割符
DROP user if exists; # 删表user,如果存在就删,否则也不会报错, 但有 warning  

</code></pre>

<h5 id="数字类型字段"><strong>数字类型字段</strong></h5>

<p>表1-1: 数字字段类型</p>

<table>
  <thead>
    <tr>
      <th>类型</th>
      <th style="text-align: left">大小</th>
      <th style="text-align: left">范围(有符号)</th>
      <th>范围(无符号)</th>
      <th>描述</th>
      <th>用途</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>tinyint</td>
      <td style="text-align: left">1字节</td>
      <td style="text-align: left">-128 到 +127</td>
      <td>0 到 255</td>
      <td>最小整数值</td>
      <td>可用于存储年龄</td>
    </tr>
    <tr>
      <td>int</td>
      <td style="text-align: left">4字节</td>
      <td style="text-align: left">-2147483648 到 +2147483647</td>
      <td>0 到 4294967295</td>
      <td>可以存10位数的10进制数字</td>
      <td> </td>
    </tr>
    <tr>
      <td>float</td>
      <td style="text-align: left">4字节</td>
      <td style="text-align: left">float</td>
      <td> </td>
      <td>单精度浮点数</td>
      <td>别存钱</td>
    </tr>
    <tr>
      <td>double</td>
      <td style="text-align: left">8字节</td>
      <td style="text-align: left"> </td>
      <td> </td>
      <td>双精度浮点值</td>
      <td>别存钱</td>
    </tr>
    <tr>
      <td>decimal</td>
      <td style="text-align: left">取决于你当前存储的值</td>
      <td style="text-align: left"> </td>
      <td> </td>
      <td>decimal 在 mysql 中其实是字符串类型存储</td>
      <td>可以用于存钱</td>
    </tr>
    <tr>
      <td> </td>
      <td style="text-align: left"> </td>
      <td style="text-align: left"> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<ul>
  <li>创建一个 mynumber 表, 把字段分别定义成 int 无符号, tinyint 无符号, tinyint 有符号, 浮点, 双精, decimal 的类型进行超出范围测试</li>
  <li>int(4), tinyint(2) 的时候并不能真正的去限制存储数据的长度, 只是会影响显示. 只有配合 zerofill的时候才有意义</li>
  <li>在有存储准确性要求的时候, 建议使用 deccimal 来存储数值</li>
</ul>

<pre><code class="language-mysql">CREATE TABLE `mynumber` (

  `id` int(10) unsigned DEFAULT NULL,

  `age` tinyint(3) unsigned DEFAULT NULL,

  `unage` tinyint(4) DEFAULT NULL,

  `money1` float(6,2) DEFAULT NULL,

  `money2` double(6,2) DEFAULT NULL,

  `money3` decimal(6,2) DEFAULT NULL

) ENGINE=InnoDB DEFAULT CHARSET=utf8; 
insert into mynumber(id) values(1234567891); #插入10位数,正常
insert into mynumber(id) values(12345678912); #插入11位数,保存10位最大数
insert into mynumber(age) values(255); #插入255, 正常
insert into mynumber(age) values(257); #插入大于255,保存最大值
insert into mynumber(unage) values(10000); # 超出范围保存最大值
insert into mynumber(money1, money2,money3) values(1,2,3); # 正常
insert into mynumber(money1, money2,money3) values(1234,1234,1234); # 正常
insert into mynumber(money1, money2,money3) values(12345,12345,12345);# 超出范围保存最大值
insert into mynumber(money1, money2,money3) values(1234.345,1234.345,1234.345); # 超出小数范围,四舍五入
insert into mynumber(money1, money2,money3) values(1234.523,1234.523,1234.525); # 超出小数范围,四舍五入
</code></pre>

<pre><code class="language-mysql">CREATE TABLE `aa` (

  `zerotime` int(5) unsigned DEFAULT NULL,

  `zerotime2` int(5) unsigned zerofill DEFAULT NULL

) ENGINE=InnoDB DEFAULT CHARSET=utf8; 
insert into aa(zerotime) value(123456); #正常
insert into aa(zerotime2) value(123456); #正常
insert into aa(zerotime2) value(1); # 用0填充

</code></pre>

<h5 id="日期和时间类型字段"><strong>日期和时间类型字段</strong></h5>

<p>表1-2: 时间字段类型</p>

<table>
  <thead>
    <tr>
      <th>类型</th>
      <th>大小</th>
      <th>范围</th>
      <th>格式</th>
      <th>用途</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>date</td>
      <td>3</td>
      <td>1000-01-01 到 9999-12-31</td>
      <td>YYYY-MM-DD</td>
      <td>存储日期</td>
    </tr>
    <tr>
      <td>time</td>
      <td>3</td>
      <td>-838:59:59 到 838:59:59</td>
      <td>HH:MM:SS</td>
      <td>时间值</td>
    </tr>
    <tr>
      <td>year</td>
      <td>1</td>
      <td>1901 到 2155</td>
      <td>YYYY</td>
      <td>年</td>
    </tr>
    <tr>
      <td>datetime</td>
      <td>8</td>
      <td>1000-01-01 00:00:00 到 9999-12-31 23:59:59</td>
      <td>YYYY-MM-DD HH:MM:SS</td>
      <td>年月日时分秒</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>创建一个时间字段的表, 并做实验</li>
  <li>注意: 在存储日期是, 可以用 int 型字段来存储时间戳, 这样方便时间的计算和转换.</li>
</ul>

<pre><code class="language-mysql">CREATE TABLE `mytime` (

  `mydate` date DEFAULT NULL,

  `mytime` time DEFAULT NULL,

  `myyear` year(4) DEFAULT NULL,

  `mydatetime` datetime DEFAULT NULL

) ENGINE=InnoDB DEFAULT CHARSET=utf8;
insert into mytime values("2017-11-28", "15:26:00","2017", now()); 

</code></pre>

<p><strong>TIMESTAMP 的使用</strong></p>

<pre><code class="language-mysql">CREATE TABLE t(
	id int,
	ts TIMESTAMP);  # 创建时间戳类型字段
  # 字段 Default CURRENT_TIMESTAMP
  # 字段 Extra on update CURRENT_TIMEST
insert into t(id) values(1),(2); # 插入数据后, 默认会在 ts 字段放入当前时间 2017-12-02 17:51:27
udpate t set id=5 where id=1; # 更新数据后时间也会变

create table t2(
	id int, 
	ts TIMESTAMP NULL ON UPDATE CURRENT_TIMESTAMP); # 如果建表时设置了 TIMESTAMP 类型字段,默认值是 NULL, 那么第一次插入数据是, ts 字段值为 null. 当被更新时, 该字段会被更新.

# 时间 - 时间戳转换

SELECT ts, UNIX_TIMESTAMP(ts) FROM t; 
+---------------------+--------------------+
| ts                  | UNIX_TIMESTAMP(ts) |
+---------------------+--------------------+
| 2013-07-22 12:50:05 |         1374490205 |
| 2013-07-22 12:50:05 |         1374490205 |
| 2013-07-22 12:51:56 |         1374490316 |
| 2001-07-22 12:12:12 |          995796732 |
+---------------------+--------------------+

</code></pre>

<h5 id="字符串类型字段"><strong>字符串类型字段</strong></h5>

<ul>
  <li>char 比 barchar 高效, varchar 比 char 更节省空间</li>
  <li>char和 varchar 存储的最大值的范围是0 - 255</li>
  <li>char 在插入数据小于指定长度时,会使用空格填补到指定的长度</li>
  <li>当存储的数据长度超出了指定的长度, 会截取(开启不严谨报错的前提下)</li>
</ul>

<table>
  <thead>
    <tr>
      <th>类型</th>
      <th>大小</th>
      <th>描述</th>
      <th>用途</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>char</td>
      <td>0 到 255字节</td>
      <td>定长字符串, 固定长度, 但效率高. 不够长度用空格占位</td>
      <td>手机号</td>
    </tr>
    <tr>
      <td>varchar</td>
      <td>0 到 65535字节</td>
      <td>可变长度字符串, 一旦超出限制, mysql 会自动转成 text 类型, 节省空间, 但效率低</td>
      <td> </td>
    </tr>
    <tr>
      <td>text</td>
      <td>0 到 65535字节</td>
      <td>长文本数据</td>
      <td>存储大块的文本</td>
    </tr>
    <tr>
      <td>enum(‘f’,’m’)</td>
      <td>65535个成员</td>
      <td>枚举类型, 提前固定好可选的选项成员, 每个成员的值都是字符串</td>
      <td> </td>
    </tr>
    <tr>
      <td>set(‘f’,’m’)</td>
      <td>64个成员</td>
      <td>集合类型, 可赋予多个集合成员, 多个成员用逗号隔开</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<pre><code class="language-mysql">CREATE TABLE `mystring` (

  `phone` char(11) DEFAULT NULL,

  `username` varchar(7) DEFAULT NULL,

  `sex` enum('w','m') DEFAULT NULL,

  `hoby` set('watchtv','coding','dota','lol','wz') DEFAULT NULL

) ENGINE=InnoDB DEFAULT CHARSET=utf8;
insert into mystring(phone) value(13061611151); # 正常插入
insert into mystring(phone) value(1306161115111); # 超出范围, 截取最大范围
insert into mystring(username) values(' 坚持到无能为力,拼搏到感动自己'); # 超出范围, 截取最大范围
insert into mystring(sex) values('w'); #正常插入
insert into mystring(sex) values('wm'); #错误插入, 值为空
insert into mystring(hoby) values('lol'); # 正常
insert into mystring(hoby) values('lol,wz,dota'); #正常
insert into mystring(hoby) values('lol,wz,lol,wz,dota'); # 自动去重, 和 python 的集合的特性一样
insert into mystring(hoby) values('lol,wangzhe'); #成功,但是只有 lol 存入, 因为 wangzhe没有在建表时被定义.
</code></pre>

<h5 id="字段约束"><strong>字段约束</strong></h5>

<table>
  <thead>
    <tr>
      <th>字段约束</th>
      <th>描述</th>
      <th>用法</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>unsigned</td>
      <td>无符号(正数)</td>
      <td>只能设置数值类型, 不允许负数出现, 最大存储长度会扩大一倍</td>
    </tr>
    <tr>
      <td>zerofill</td>
      <td>零填充</td>
      <td>只能用于设置数值类型, 当位数不够,用0在左侧填充</td>
    </tr>
    <tr>
      <td>auto_increment</td>
      <td>自增</td>
      <td>用于设置字段的自增属性,每增长一条数据, 该字段数值自动加一. delete 记录不会影响 <code class="language-plaintext highlighter-rouge">AUTO_INCREMENT=4</code> . drop table 才会将重置  <code class="language-plaintext highlighter-rouge">AUTO_INCREMENT=0</code></td>
    </tr>
    <tr>
      <td>default</td>
      <td>默认值</td>
      <td>可通过此属性来设置字段默认值. 如果未设置默认值, 默认值为 Null</td>
    </tr>
    <tr>
      <td>Null / Not Null</td>
      <td>可选/ 必选</td>
      <td>指定该字段是否是必填项或可选项, 但强行插入, 还是会成功, 但是会有 warning.</td>
    </tr>
  </tbody>
</table>

<p><strong>Null 注意事项</strong></p>

<ol>
  <li>null 意味着没有值或者未知值</li>
  <li>可以测试某个值是否为null, 要用 is null 进行测试</li>
  <li>对 null 进行算数运算, 结果还是 null</li>
</ol>

<pre><code class="language-mysql">CREATE TABLE `myfield` (

  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,

  `age` tinyint(3) unsigned zerofill DEFAULT NULL,

  `username` varchar(20) DEFAULT 'xxx',

  `hobby` varchar(20) NOT NULL DEFAULT 'play',

  PRIMARY KEY (`id`)

) ENGINE=InnoDB DEFAULT CHARSET=utf8;

insert into myfield values(null, 1, 'zhang san', 'coding');
insert into myfield(age) values(2);
alter table myfield add nn varchar(10) not null;
insert into myfield(age) values(3);

</code></pre>

<pre><code class="language-mysql">select 3+ 'a'; # 3
select 3+ '1a'; # 4
select 3 + 'a1'; # 3
select 3 + null; # null
select 3 * null; # null
</code></pre>

<h5 id="索引">索引</h5>

<pre><code class="language-mysql">HELP INDEX
</code></pre>

<p>索引分三种</p>

<ul>
  <li>主键索引 primary key</li>
  <li>唯一索引 unique</li>
  <li>常规索引 index</li>
  <li>全文索引 fulltext (了解), 以后全文索引都用第三方全文索引.</li>
</ul>

<p><strong>主键索引</strong></p>

<ul>
  <li>
    <p>是关系数据库中最常见的索引类型, 主要作用是记录表中每条数据的位置.</p>
  </li>
  <li>
    <p><strong>设置方法</strong>: 在字段后面添加 <code class="language-plaintext highlighter-rouge">primary key</code> 关键字</p>
  </li>
  <li>
    <p>一个字段如果被设置成 auto_increment, 那么这个字段会被设置成 主键</p>
  </li>
  <li>
    <p>最好为每个表设定主键, 但不是必须设定.</p>
  </li>
  <li>
    <p>每个表只能有一个主键</p>
  </li>
  <li>
    <p>主键可以有多个候选约束, not null, auto_increment</p>

    <p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 ADD PRIMARY KEY(NAME);</code></p>

    <p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 DROP PRIMARY KEY;</code> # 主键只有一个,所以不需要指定名字</p>
  </li>
</ul>

<p><strong>唯一索引</strong></p>

<ul>
  <li>
    <p>唯一索引保证该字段的数据是不重复的</p>
  </li>
  <li>
    <p>每个表中可以存在多个唯一索引</p>
  </li>
  <li>
    <p><strong>设置方法</strong>: 在字段后面添加 <code class="language-plaintext highlighter-rouge">unique</code> 关键字</p>

    <p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 ADD UNIQUE(AGE);</code></p>

    <p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 DROP INDEX AGE;</code> # 删除 unique 索引需要用 index 关键字</p>
  </li>
  <li>
    <p>给一个已有的表某个字段做 unique 设置时要先确保要字段已有数据没有重复, 否则会报错 类似于 <code class="language-plaintext highlighter-rouge">Duplicate entry '' for key 'job'</code></p>
  </li>
</ul>

<p><strong>常规索引</strong></p>

<ul>
  <li>
    <p>index 是关系数据库中查询最重要的技术.</p>
  </li>
  <li>
    <p>如果要提升数据库的性能,首先想到的是常规索引</p>
  </li>
  <li>
    <p>缺点: 1. 多占磁盘空间. 2. 减慢增删改的效率.</p>
  </li>
  <li>
    <p>索引的创建, 可以使用 index 或者 key 来创建常规索引</p>

    <p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 ADD INDEX(SEX);</code></p>

    <p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 DROP INDEX SEX;</code></p>
  </li>
</ul>

<pre><code class="language-mysql">create table myindex(  # 不起索引名的创建索引方式

username varchar(20),
sex tinyint unsigned,
 unique(username),  # 为 username 创建唯一索引
 index(sex) # 为 sex 创建普通索引, (没起名字)
 );

create table myindex2(	# 起索引名字的创建索引方式
 username varchar(20), 
 sex tinyint unsigned,
 unique uname (username), # 为 username 起索引名字 uname
 index isex(sex) # 为sex 创建普通索引, 名字是 isex
 );


desc myindex;

+----------+---------------------+------+-----+---------+-------+
| Field    | Type                | Null | Key | Default | Extra |
+----------+---------------------+------+-----+---------+-------+
| username | varchar(20)         | YES  | UNI | NULL    |       |
| sex      | tinyint(3) unsigned | YES  | MUL | NULL    |       |
+----------+---------------------+------+-----+---------+-------+

desc myindex2;

+----------+---------------------+------+-----+---------+-------+
| Field    | Type                | Null | Key | Default | Extra |
+----------+---------------------+------+-----+---------+-------+
| username | varchar(20)         | YES  | UNI | NULL    |       |
| sex      | tinyint(3) unsigned | YES  | MUL | NULL    |       |
+----------+---------------------+------+-----+---------+-------+

show create table myindex;
CREATE TABLE `myindex` (
  `username` varchar(20) DEFAULT NULL,
  `sex` tinyint(3) unsigned DEFAULT NULL,
  UNIQUE KEY `username` (`username`), # 如果设置 index 名字,默认使用字段名
  KEY `sex` (`sex`) # 如果设置 index 名字,默认使用字段名
) ENGINE=InnoDB DEFAULT CHARSET=utf8 

show create table myindex2;

CREATE TABLE `myindex2` (
  `username` varchar(20) DEFAULT NULL,
  `sex` tinyint(3) unsigned DEFAULT NULL,
  UNIQUE KEY `uname` (`username`), # 设置了自己的索引名
  KEY `isex` (`sex`) # 设置了自己的索引名
) ENGINE=InnoDB DEFAULT CHARSET=utf8

insert into myindex2 values('张三', 18); # 成功
insert into myindex2 values('张三', 18); # 失败 ERROR 1062 (23000): Duplicate entry '张三' for key 'uname'


</code></pre>

<h5 id="数据存储类型myisam-和-innodb以及位置">数据存储类型(MyISAM 和 InnoDB)以及位置</h5>

<ul>
  <li>myisam 不支持事物, innodb 支持</li>
  <li>myisam 引擎处理效率不高</li>
  <li>myisam 产生三个文件, innodb 两个</li>
  <li>myisam 不支持外键, innodb 支持</li>
  <li>存储区别: myisam 或者 innodb 都会产生一个叫 .frm 文件, 用来存储表结构框架</li>
  <li>innodb 存储文件用 .bd, 存储索引和表数据</li>
  <li>myisam 存储文件 .myd 存储表数据的文件; myi 存储表的索引的文件.</li>
</ul>

<pre><code class="language-mysql">alter table myindex2 engine = myisam;
alter table myindex2 engine=innodb;
</code></pre>

<h5 id="transaction-事物处理">transaction 事物处理</h5>

<pre><code class="language-mysql">HELP START TRANSACTION
</code></pre>

<p>如下步骤完成事物的处理</p>

<ol>
  <li>用 mysql 做事物之前,需要先确认所用的到表示 innodb 存储类型. <code class="language-plaintext highlighter-rouge">show create table myindex2;</code>  如果不是, 修改为 innodb. <code class="language-plaintext highlighter-rouge">alter table myindex2 engine=innodb;</code></li>
  <li>修改当前数据库的提交方式为手动提交. 查看方式 <code class="language-plaintext highlighter-rouge">select @@autocommit;</code>  1 为自动提交, 0 为手动提交 ; 自动提交的意思是当数据一旦更改, mysql 就自动将更改数据写到文件中 . 修改当前数据库的手动提交 <code class="language-plaintext highlighter-rouge">set autocommit=0;</code> <strong>经过测试,设置成0这个步骤应该是不需要的</strong></li>
  <li>开启事物: <code class="language-plaintext highlighter-rouge">begin;</code> 或者使用 <code class="language-plaintext highlighter-rouge">START TRANSACTION;</code></li>
  <li>写 sql 的操作</li>
  <li>提交 or 回滚: <code class="language-plaintext highlighter-rouge">commit;</code> 是提交 ; <code class="language-plaintext highlighter-rouge">rollback;</code> 是回滚</li>
</ol>

<pre><code class="language-mysql">begin;
insert into user values('zhangsan');
select * from user; # 看到了新增数据
rollback work; # 执行回滚操作, 取消新增数据
select * from user; # 新增数据消失
insert into user values('lisi'); 
commit work; # 手动提交数据 work 是可选的关键字
</code></pre>

<h5 id="alter-对表结构的操作">alter 对表结构的操作</h5>

<pre><code class="language-mysql">HELP ALTER TABLE
</code></pre>

<ul>
  <li>
    <p>增加字段: <code class="language-plaintext highlighter-rouge">add column</code></p>
  </li>
  <li>
    <p>增加索引: <code class="language-plaintext highlighter-rouge">add index()/primary key()/unique()</code></p>
  </li>
  <li>
    <p>修改表名: <code class="language-plaintext highlighter-rouge">rename</code></p>
  </li>
  <li>
    <p>修改字段名: <code class="language-plaintext highlighter-rouge">change</code> 也可以用于重新设置表的所有属性信息</p>
  </li>
  <li>
    <p>修改字段DEFAULT: <code class="language-plaintext highlighter-rouge">alter</code>,  基本只用来设置 default 值 or 删掉 default 值 set default , drop default</p>
  </li>
  <li>
    <p>修改字段TYPE 和 Null: <code class="language-plaintext highlighter-rouge">modify</code> , 需要同时设置 Type 和 Null</p>
  </li>
  <li>
    <p>删除字段 <code class="language-plaintext highlighter-rouge">drop column</code></p>
  </li>
  <li>
    <p>删除索引 <code class="language-plaintext highlighter-rouge">drop index/primary key</code></p>

    <p>​</p>
  </li>
</ul>

<blockquote>
  <p>修改表名</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX4 RENAME MYINDEX3;</code></p>

<blockquote>
  <p>修改字段名</p>
</blockquote>

<p>alter table 表名 change 原字段名 新字段名 约束条件</p>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 CHANGE COLUMN SEX SIX VARCHAR(3);</code> # 需要补充上字段的属性信息</p>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYNUM CHANGE COLUMN F2 F2 INT(4) ZEROFILL UNSIGNED NOT NULL DEFAULT 1 UNIQUE;</code> # change 基本上可以修改所有字段属性,还能添加索引. <strong>注意, not null 需要放在 zerofill 和 unsigned 属性的后面</strong></p>

<blockquote>
  <p>为表添加一个新的字段</p>
</blockquote>

<p>ALTER TABLE 表名 ADD 字段名 约束条件</p>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 ADD COLUMN SEX CHAR(3) NOT NULL;</code></p>

<blockquote>
  <p>为一个字段修改默认值</p>
</blockquote>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 ALTER NAME SET DEFAULT 1;</code></p>

<blockquote>
  <p>删除表字段</p>
</blockquote>

<p>alter table 表名 drop column 字段名</p>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 DROP COLUMN SEX;</code></p>

<blockquote>
  <p>修改表字段的数据类型</p>
</blockquote>

<ul>
  <li>如果想修改 not null, 需要把字段 type 也一起修改</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 MODIFY SIX VARCHAR(3) NOT NULL;</code></p>

<blockquote>
  <p>添加/删除索引</p>
</blockquote>

<p>alter table 表名 add 索引类型(索引字段) 索引名</p>

<p><code class="language-plaintext highlighter-rouge">ALTER TABLE MYINDEX3 ADD PRIMARY KEY(NAME);</code></p>

<p>alter table 表名 add 索引类型(索引字段)</p>

<p><code class="language-plaintext highlighter-rouge">alter table USERS2 add index(NAME);</code></p>

<p>alter table 表名 drop key 索引名</p>

<p><code class="language-plaintext highlighter-rouge">alter table USERS2 drop key NAME;</code></p>

<h5 id="insert-添加数据">insert 添加数据</h5>

<pre><code class="language-MYSQL">HELP INSERT
</code></pre>

<p>增<code class="language-plaintext highlighter-rouge">INSERT</code> 删<code class="language-plaintext highlighter-rouge">DELETE</code> 改<code class="language-plaintext highlighter-rouge">UPDATE</code> 查<code class="language-plaintext highlighter-rouge">SELECT</code></p>

<p>增:</p>

<ul>
  <li>
    <p>指定字段添加:</p>

    <p>insert into 表名(字段1,字段2…) values(‘值1’,’值2’…)</p>
  </li>
  <li>
    <p>不指定字段为表加数据:</p>

    <p>需要为表中的每个字段添加数据</p>

    <p>insert into 表名 values(‘值1’,’值2’…)</p>
  </li>
  <li>
    <p>插入多条记录</p>

    <p>insert into 表名 values(‘值1’,’值2’…),(‘值1’,’值2’…)</p>

    <p><code class="language-plaintext highlighter-rouge">insert into bb values('zs1',2),('ls',3),('ww',5);</code></p>
  </li>
  <li>
    <p>快速将一个表插入多条记录作为练习用.</p>

    <p><code class="language-plaintext highlighter-rouge">insert into bb select * from bb;</code></p>
  </li>
</ul>

<h5 id="select-查询">select 查询</h5>

<pre><code class="language-mysql">HELP SELECT
</code></pre>

<ul>
  <li>
    <p>不指定字段的查询(不建议)</p>

    <p>select * from 表名</p>
  </li>
  <li>
    <p>指定字段来查询数据</p>

    <p>select 字段1, 字段2 from 表名</p>
  </li>
  <li>
    <p>给字段起别名</p>

    <p>select 字段1 as 别名 from 表名</p>

    <p>select 字段1 别名 from 表名</p>
  </li>
</ul>

<p>#####where 条件</p>

<p><strong>比较运算符</strong>: <code class="language-plaintext highlighter-rouge">&gt;</code>, <code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">=</code>, <code class="language-plaintext highlighter-rouge">&gt;=</code>, <code class="language-plaintext highlighter-rouge">&lt;=</code>, <code class="language-plaintext highlighter-rouge">!=</code> or <code class="language-plaintext highlighter-rouge">&lt;&gt;</code>, <code class="language-plaintext highlighter-rouge">=</code></p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">update a set age = age-40 where id between 4 and 7;</code></p>

  <p><code class="language-plaintext highlighter-rouge">where age &gt;= 102</code></p>
</blockquote>

<p><strong>逻辑运算符</strong>: <code class="language-plaintext highlighter-rouge">and</code>, <code class="language-plaintext highlighter-rouge">or</code>, <code class="language-plaintext highlighter-rouge">between A and B</code>, <code class="language-plaintext highlighter-rouge">not between A and B</code>, <code class="language-plaintext highlighter-rouge">in</code>, <code class="language-plaintext highlighter-rouge">not in</code></p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">where ange &lt;=71 and sex = 'w'</code></p>

  <p><code class="language-plaintext highlighter-rouge">where age between 10 and 30</code> 取10 到 30之间的数据, 包含10 和 30 这两个数字</p>

  <p><code class="language-plaintext highlighter-rouge">where age not between 10 and 30</code> 取在10到30之外的数据.</p>

  <p><code class="language-plaintext highlighter-rouge">where age in (10,20,30)</code></p>

  <p><code class="language-plaintext highlighter-rouge">where age not in (10,20,30)</code></p>

  <p><code class="language-plaintext highlighter-rouge">where age &lt; 30 and classid in (1707,1708)</code></p>
</blockquote>

<p><strong>子查询</strong> 也就是 where 中也有 select 语句 (了解, 效率低)</p>

<blockquote>
  <p>select * from 表名, where name in (select name ….)</p>
</blockquote>

<p><strong>order by 排序</strong></p>

<blockquote>
  <p>默认为升序 <code class="language-plaintext highlighter-rouge">asc</code>, <code class="language-plaintext highlighter-rouge">desc</code> 为降序</p>

  <p>order by 字段1, 字段2</p>
</blockquote>

<p><strong>is, is not 与 NULL</strong></p>

<blockquote>
  <p>因为 null 是特殊字符,不能用 <code class="language-plaintext highlighter-rouge">=</code>, 只能用 <code class="language-plaintext highlighter-rouge">is</code> .</p>

  <p><code class="language-plaintext highlighter-rouge">is</code> 不能用于除了 null 之外的数据</p>

  <p><code class="language-plaintext highlighter-rouge">where 字段名 is null</code></p>

  <p><code class="language-plaintext highlighter-rouge">where 字段名 is not null</code></p>
</blockquote>

<p><strong>limit 限制返回条数</strong></p>

<blockquote>
  <p>limit 开始位(默认为0), 条数.</p>

  <p><code class="language-plaintext highlighter-rouge">select * from a order by age desc limit 1;</code></p>

  <p><code class="language-plaintext highlighter-rouge">select * from a order by id desc limit 5,5;</code> # 从第五条开始取5条</p>

  <p>分页公式: <code class="language-plaintext highlighter-rouge">limit (当前页-1)*每页条数, 每页条数</code></p>

  <p><code class="language-plaintext highlighter-rouge">where username is not null and age between 10 and 20 order by age desc limit 2.</code></p>
</blockquote>

<h5 id="group-by-分组"><strong>group by 分组</strong></h5>

<blockquote>
  <ul>
    <li>group by 什么字段, select 中也要有同一个字段</li>
    <li>group by 后面可接多个字段,逗号隔开. 比如先按班级分,再按那女分, 那么就会有 班级数*2条结果, 分别显示每个班男生数量和女生数量.</li>
    <li>group by 后面如果要接条件, 需要用 <code class="language-plaintext highlighter-rouge">having</code>, 不能用 <code class="language-plaintext highlighter-rouge">where</code></li>
  </ul>
</blockquote>

<pre><code class="language-mysql">select sex, count(*) as total from a group by sex; # 统计男女分别有多少人

select classid,count(*) as total from a group by classid; # 统计每班分别有多少人

select classid, sex, count(*) as total from a group by classid, sex; #统计每班和每班男女分别有多少人.

select classid, sex, count(*) as total from a group by classid, sex having total &gt; 10;  # 分组统计后, 只拿人数大于10的记录.

select classid, count(*) as t from a group by classid having classid in ('py1706','py1707') and t&gt;2; # 统计在1706, 1707两个班的学生人数, 只取 group by 后结果大于2人的数据.
</code></pre>

<h5 id="like-模糊查询"><strong>like 模糊查询</strong></h5>

<pre><code class="language-mysql">HELP LIKE
</code></pre>

<p>包含: like ‘%字符%’</p>

<p><code class="language-plaintext highlighter-rouge">where username like '%张%'</code></p>

<p>以.. 字符开头: like ‘张%’</p>

<p><code class="language-plaintext highlighter-rouge">where username like '张%'</code></p>

<p>以.. 字符结尾: like ‘%张’</p>

<p><code class="language-plaintext highlighter-rouge">where username like '%张'</code></p>

<p><code class="language-plaintext highlighter-rouge">_</code> 代表一个任意字符</p>

<p><code class="language-plaintext highlighter-rouge">where username like '李_龙'</code></p>

<p><code class="language-plaintext highlighter-rouge">where username like '___day'</code> # 可以匹配到 Monday, Friday Sunday</p>

<h5 id="delete-删除">delete 删除</h5>

<pre><code class="language-mysql">HELP DELETE
</code></pre>

<p>delete from 表名 where 条件</p>

<ul>
  <li>需要加 where 条件, 否则就清空表.</li>
  <li>删除之前,最好先 改成 select 看看有多少条数据会被删除.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">delete from a where username is null;</code></p>

<h5 id="update-更新数据">update 更新数据</h5>

<pre><code class="language-mysql">HELP UPDATE
</code></pre>

<p>update 表名 set 字段名=值, 字段名=值 where 条件</p>

<ul>
  <li>更新之前, 最好先 改成 select 看看有多少条数据会被更新.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">update a set age = age-10 where age &gt; 10;</code></p>

<h5 id="join-的使用">join 的使用</h5>

<p>注意:</p>

<ol>
  <li>隐式和显示内连接为同一链接, 只会把两个表关联起来的数据查出来, 未关联数据不会显示</li>
  <li>左连接以左表为主表,右表为辅表, 会把主表所有数据查出来, 辅表没有关联上的数据使用 NULL占位</li>
  <li>右连接以右表为主表,左表为辅表, 会把主表所有数据查出来, 辅表没有关联上的数据使用 NULL 占位</li>
</ol>

<pre><code class="language-mysql">select u.id t, u.username, g.goodname from user u, goods g where u.id = g.uid and u.id = 1;

select u.id t, u.username, g.goodname from user u inner join goods g on u.id = g.uid;

select * from user u inner join goods g on u.id = g.uid;

select * from user u left join goods g on u.id = g.uid and g.uid = 1;

select * from user u right join goods g on u.id = g.uid;
</code></pre>

<h5 id="mysql-的聚合函数">Mysql 的聚合函数</h5>

<p>max() 查询字段最大值</p>

<p>min() 查询字段最小值</p>

<p>avg() 查询字段平均值</p>

<p>sum() 求和</p>

<p><code class="language-plaintext highlighter-rouge">select max(age), min(age), count(*), sum(age), avg(age) from python.a;</code></p>

<h5 id="mysql-的导入和导出">mysql 的导入和导出</h5>

<p><strong>数据库的导出</strong></p>

<ul>
  <li>cd 到需要备份的目录</li>
  <li>执行命令 <code class="language-plaintext highlighter-rouge">mysqldump -uroot -234567 库名&gt; 文件名.sql</code></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>/Applications/XAMPP/xamppfiles/bin/mysqldump -uroot -234567 py1702&gt;py1702.sql
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>数据库的导入</strong></p>

<ul>
  <li>cd 到有 .sql 的备份文件对应的目录</li>
  <li>执行命令 <code class="language-plaintext highlighter-rouge">mysql -uroot -234567 库名&lt;p.sql</code></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>/Applications/XAMPP/xamppfiles/bin/mysql -uroot -234567 py1702&lt;py1702.sql
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="mysql的权限管理">mysql的权限管理</h5>

<p><a href="http://blog.csdn.net/wulantian/article/details/38230635">权限管理全面你介绍</a></p>

<p><img src="./2017-12-02_20-58-05.jpeg" alt="Alt text" /></p>

<p><strong>修改密码</strong></p>

<p>set password for 用户@localhost = password(‘新密码’)</p>

<p><code class="language-plaintext highlighter-rouge">set password for root@localhost = password('234567');</code> # 把 root 的用户的密码改成 234567</p>

<p><strong>创建用户</strong></p>

<ul>
  <li>新建用户如果不授予库操作权限</li>
</ul>

<ol>
  <li>使用 mysql 库: <code class="language-plaintext highlighter-rouge">use mysql</code></li>
  <li>查看当前库都有哪些用户: <code class="language-plaintext highlighter-rouge">select user from user</code></li>
  <li>创建用户: <code class="language-plaintext highlighter-rouge">create user dalong identified by '123456'</code> # identified by 指定了密码</li>
</ol>

<p><strong>授予权限</strong></p>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">grant all on py1702.* to dalong</code> #给大龙授予 py1702库的所有权限</p>

    <p>all: 代表增删改查所有权限</p>

    <p><code class="language-plaintext highlighter-rouge">grant all on *.* to 'mrldl'@'localhost';</code> 给大龙授予所有库的所有权限</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">revoke all on py1702.* from dalong</code></p>
  </li>
</ol>

<p><strong>查看某用户权限</strong></p>

<p><code class="language-plaintext highlighter-rouge">show grants for 'mrldl'@'localhost';</code></p>

<p><strong>删除用户</strong></p>

<p><code class="language-plaintext highlighter-rouge">drop user dalong;</code> # 删除用户后, 被删用户需要在下次进入 mysql 客户端后才会被禁止进入</p>

<p><strong>刷新权限</strong></p>

<p><code class="language-plaintext highlighter-rouge">flush privileges;</code> # 刷新权限后, 之前对权限的修改可以立即生效</p>

<h4 id="用-python-操作-mysql">用 python 操作 mysql</h4>

<ul>
  <li>使用 pymysql 模块 来操作 mysql 数据库</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>pip3.7 install pymysql
</pre></td></tr></tbody></table>
</div>
</div>

<p>步骤:</p>

<ol>
  <li>
    <p>设置连接 <code class="language-plaintext highlighter-rouge">db = pymysql.connect(主机名,用户名,密码,数据库)</code></p>
  </li>
  <li>
    <p>设置字符集: <code class="language-plaintext highlighter-rouge">db.set_charset('utf8')</code></p>
  </li>
  <li>
    <p>创建 cursor 对象, 对数据进行增删改查操作: <code class="language-plaintext highlighter-rouge">cursor = db.cursor()</code></p>

    <p><strong>注意</strong>: 一旦创建了游标对象的时候就开启了事物, 对于数据的任何修改操作, 最后都要 commit() 或者 rollback() 进行操作</p>
  </li>
  <li>
    <p>准备 sql 语句: <code class="language-plaintext highlighter-rouge">sql = '...'</code></p>
  </li>
  <li>
    <p>执行语句: <code class="language-plaintext highlighter-rouge">cursor.execute(sql)</code></p>
  </li>
  <li>
    <p>处理结果集: <code class="language-plaintext highlighter-rouge">cursor.fetchall() ; cursor.fetchone()</code></p>
  </li>
  <li>
    <p>获取当前sql语句所影响的行数: <code class="language-plaintext highlighter-rouge">cursor.rowcount()</code></p>
  </li>
  <li>
    <p>关闭数据库连接: <code class="language-plaintext highlighter-rouge">cursor.close()</code></p>
  </li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre><span class="c"># mysql 连接</span>

<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="c"># 打开数据库连接</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span>
                    <span class="n">unix_socket</span><span class="o">=</span><span class="s">'/Applications/XAMPP/xamppfiles/var/mysql/mysql.sock'</span><span class="p">,</span>
                    <span class="n">user</span><span class="o">=</span><span class="s">'root'</span><span class="p">,</span>
                    <span class="n">passwd</span><span class="o">=</span><span class="s">'234567'</span><span class="p">,</span>
                    <span class="n">db</span><span class="o">=</span><span class="s">'py1702'</span><span class="p">,</span>
                    <span class="n">charset</span><span class="o">=</span><span class="s">'utf8'</span><span class="p">)</span>
<span class="c"># 使用 cursor() 方法创建一个游标对象 cursor</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s">'select now()'</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="c"># db.commit()</span>
    <span class="c"># 使用 fetchone() 方法获取单条数据.</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">"Error: unable to get time data ### SQL :"</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="c"># 获取数据库对象</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span>
                    <span class="n">unix_socket</span><span class="o">=</span><span class="s">'/Applications/XAMPP/xamppfiles/var/mysql/mysql.sock'</span><span class="p">,</span>
                    <span class="n">user</span><span class="o">=</span><span class="s">'root'</span><span class="p">,</span>
                    <span class="n">passwd</span><span class="o">=</span><span class="s">'234567'</span><span class="p">,</span>
                    <span class="n">db</span><span class="o">=</span><span class="s">'py1702'</span><span class="p">,</span>
                    <span class="n">charset</span><span class="o">=</span><span class="s">'utf8'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">charset</span><span class="p">)</span>
<span class="c"># 创建游标对象</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
<span class="c"># 准备 sql</span>
<span class="n">sql</span> <span class="o">=</span> <span class="s">'select * from myindex3'</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="c"># 获取结果集</span>
<span class="k">print</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

<span class="c"># 获取影响行数</span>
<span class="k">print</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span><span class="p">)</span>
<span class="c"># 关闭数据库</span>
<span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="非关系数据库">非关系数据库</h2>

<ul>
  <li>
    <p>性能: 非关系型数据库是基于键值对, 不需要 sql 层面的解析, 所以说性能非常高</p>
  </li>
  <li>
    <p>可扩展性: 同样是基于键值对的存在, 所以水平扩展性比较好</p>

    <p>​</p>
  </li>
</ul>

<h3 id="redis-数据库">redis 数据库</h3>

<ul>
  <li><a href="http://try.redis.io">redis在线交互教学</a></li>
  <li><a href="https://redis.io/commands">redis官网命令</a></li>
  <li><a href="http://redisdoc.zixuebook.cn">redis 命令中文参考</a></li>
  <li><a href="http://www.gaofi.cn/book/list/?wd=redis&amp;random=1511868698131&amp;online=1">redis 在线书</a></li>
  <li><a href="http://redis.cn/commands.html">redis 全部命令</a></li>
</ul>

<p><strong>redis mac 客户端安装</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>ruby -e <span class="s2">"</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class="k">)</span><span class="s2">"</span> &lt; /dev/null 2&gt; /dev/null ; brew install caskroom/cask/brew-cask 2&gt; /dev/null

</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>brew cask install rdm
</pre></td></tr></tbody></table>
</div>
</div>

<p>安装完后可以看到  rdm app 了</p>

<h4 id="redis-数据库介绍">redis 数据库介绍</h4>

<ul>
  <li>redis 是非关系型远程内存数据库,性能强劲</li>
  <li>发布订阅, 主从复制, 持久化, 支持事物</li>
  <li>五种数据存储类型
    <ul>
      <li>string 字符串</li>
      <li>list 列表</li>
      <li>set 集合</li>
      <li>hash 散列表</li>
      <li>zset 有序集合</li>
    </ul>
  </li>
</ul>

<h4 id="redis-数据库的安装">redis 数据库的安装</h4>

<ul>
  <li>从 <a href="https://redis.io/download">redis官网</a> 下载最新的 redis 安装包</li>
  <li>下载解压后放到 <code class="language-plaintext highlighter-rouge">/usr/local/</code> 目录下 , 会需要 root 权限</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nb">cd</span> /usr/local/redis-4.0.2/

sudo make
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>启动 redis 服务: 安装成功后在命令运行如下命令 <code class="language-plaintext highlighter-rouge">redis-server</code> , 运行后不要退出. 可以看到服务的欢迎界面和端口号, 默认端口是 <code class="language-plaintext highlighter-rouge">Port:6379</code></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>src/redis-server
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>启动 redis 客户端链接 redis 服务器:另外开一个 terminal 窗口执行如下命令 <code class="language-plaintext highlighter-rouge">redis-cli</code> , 并测试是否可以进入 redis 命令行</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>src/redis-cli
<span class="gp">redis&gt; </span><span class="nb">set </span>foo bar
OK
<span class="gp">redis&gt; </span>get foo
<span class="s2">"bar"</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="redis-数据结构">redis 数据结构</h4>

<p>查看当前是几号数据库, 切换数据库</p>

<blockquote>
  <p>可以参看客户端命令行的提示 <code class="language-plaintext highlighter-rouge">127.0.0.1:6379[3]&gt;</code> 表示3号库</p>

  <p>没有中括号,表示 0 号库 <code class="language-plaintext highlighter-rouge">127.0.0.1:6379&gt;</code></p>

  <p><code class="language-plaintext highlighter-rouge">select 1</code> 切换到1号库</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>结构类型</th>
      <th>结构存储的值</th>
      <th>结构的读写能力</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>string</td>
      <td>字符串,可以包含字符串,整数,浮点数</td>
      <td>可以自增, 自减</td>
    </tr>
    <tr>
      <td>list</td>
      <td>列表,每个元素可以包含一个字符串</td>
      <td>推入,弹出,读取,查找</td>
    </tr>
    <tr>
      <td>set</td>
      <td>集合,包含字符串,唯一性,无序性</td>
      <td>可以进行位运算,交集,并集,差集等</td>
    </tr>
    <tr>
      <td>hash</td>
      <td>字典, 无序的键值对集合</td>
      <td>添加,修改,删除</td>
    </tr>
    <tr>
      <td>zset</td>
      <td>有序集合, 排序由score的大小决定</td>
      <td>添加,删除</td>
    </tr>
  </tbody>
</table>

<h5 id="key-相关命令">Key 相关命令</h5>

<p>注意:</p>

<ul>
  <li>redis 中 系统命令大小写不敏感</li>
  <li>redis 中 key 的名字大小写敏感</li>
  <li></li>
</ul>

<p>```python redis
help <command /> # 查看任何命令的介绍
command # 列出所有命令
l # 输入部分命令后连续按 tab 键可以补全和推荐命令. 因为 list 命令多数以 l 开头, set 命令多数以 s 开头, hash 命令多数以 h 开头, zset 命令多数以 z 开头, 所以输入第一个字母,按 tab 键可以看到大部分相关的命令.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre>


| 命令        | 解释                                       |
| --------- | ---------------------------------------- |
| keys 简单正则 | 获取按正则可以匹配到的所有的 key. `*` 表示任意多个(0到无穷)任意字符, `?` 表示单个任意字符, `[]`表示多个选项中选一个, `[^]` 表示不在此范围内的其它任意单个字符. `[]` 语法和正则一样.  没有匹配到,返回空列表 or 空集合 |
| exists    | 判断 key 是否存在 ,0不存在 1存在. 如果同时匹配多个 keys, 则返回匹配到的 key 的个数 |
| type      | 看 key 的类型                                |
| del       | 删除 key,  成功返回1, 失败返回0 . 可以一次删除多个 key, 成功返回删除成功的个数 |
| expire    | 给 key 设置过期时间. 成功返回1, 失败返回0               |
| ttl       | 查看 key 的过期时间,单位秒. 如果返回值为-1, 表示该 key 永不过期 |
| pttl      | 查看 key 设置过期时间,单位毫秒. 如果返回值为-1, 表示该 key 永不过期 |
| persist   | 为 key 设置永久不过期. 设置成功返回1, 失败返回0.           |
| flushdb   | 删除当前库中所有key                              |
| flushall  | 删除所有库中所有key. redis 库是从0 ~ 15, 每个库有自己独立的 keys |
| rename    | 修改 key 名. 成功返回 ok, 原 key不存在返回 error. 如果 目标 Key 存在,则目标 key 被覆盖 |
| move      | 将 key 移到某库中                              |
| randomkey | 随机返回一个 key. 没有任何 keys 则返回 nil            |

```python redis
keys * 		# 返回所有 keys
keys *a* 	# 返回包含 a 的所有 key
keys a*		# 返回以 a 开头的所有 key
keys a?		# 返回 a开头的第二个字符是任意字符的两个字符的 keys
keys *a*e 	# 匹配中间有a, 结尾是 e 的所有 keys
keys h[ae]llo # 匹配第二个字符是 a或 e, 的以 h 开头, llo 结尾的keys
keys h[^a-z]llo # 匹配第二个字符不是 a-z 的所有以 h 开头, llo 结尾的keys
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="string-字符串">string 字符串</h5>

<p>字符串命令</p>

<table>
  <thead>
    <tr>
      <th>命令</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>get</td>
      <td>根据 key 获取键中的值, 不存在返回 nil</td>
    </tr>
    <tr>
      <td>set</td>
      <td>存值到键中, 返回成功失败</td>
    </tr>
    <tr>
      <td>del</td>
      <td>删除指定键中的值</td>
    </tr>
    <tr>
      <td>setex</td>
      <td>设置键值及过期时间, 以秒为单位, 成功返回 ok</td>
    </tr>
    <tr>
      <td>ttl</td>
      <td>查看有效时间, 以秒为单位</td>
    </tr>
    <tr>
      <td>setnx</td>
      <td>只有在 key 不存在的时候设置健值, 成功返回1, 失败返回0</td>
    </tr>
    <tr>
      <td>mset</td>
      <td>设置多个值, 返回成功失败</td>
    </tr>
    <tr>
      <td>setrange</td>
      <td>覆盖已有字符串值, 重置重 offset 开始其中一部分. offset 值范围以0 开始. 成功返回新的字符串长度</td>
    </tr>
    <tr>
      <td>mget</td>
      <td>通过多个 keys, 一次获取多个健值, 不存在 返回 nil</td>
    </tr>
    <tr>
      <td>getrange</td>
      <td>获取某字符串变量中的一段, 返回子串. offset 从0开始, -1 结束. 如果 end 的值大于字符串长度, 会返回到 字符串结尾的字符串</td>
    </tr>
    <tr>
      <td>getset</td>
      <td>返回已有变量的值,再给该变量重设新值</td>
    </tr>
    <tr>
      <td>incr</td>
      <td>对变量中的数字型字符串加一, 返回新值</td>
    </tr>
    <tr>
      <td>decr</td>
      <td>对变量中的数字型字符串减一, 返回新值</td>
    </tr>
    <tr>
      <td>incrby</td>
      <td>对变量中的数字型字符串加整数,返回新值</td>
    </tr>
    <tr>
      <td>decrby</td>
      <td>对变量中的数字型字符串减整数, 返回新值. 值可以使负数</td>
    </tr>
    <tr>
      <td>append</td>
      <td>对字符串右侧拼接新字符串, 返回str 长度</td>
    </tr>
    <tr>
      <td>strlen</td>
      <td>获取字符串长度. 如果 key不存在, 返回0</td>
    </tr>
  </tbody>
</table>

<p>```python redis
set name dalong # 设置 dalong 到 name中 , 返回 ok 表示成功</p>

<p>get name # 按键获取 value, 返回 “dalong “</p>

<p>del name # 按键名删除, 返回的1 代表成功的数量</p>

<p>get name # 获取空 键或返回 nil. python 会转成 None</p>

<p>setex name 10 ‘dalong’ # 设置 name 变量, 10秒后过期</p>

<p>ttl name # 查看变量name 所剩过期时间</p>

<p>setnx name ‘dalong’# 如果变量 name 不存在, 则设置. 成功返回1, 失败返回0
mset name ‘dalong’ sex ‘f’ # 同时设置多个变量</p>

<p>set key ‘hello world’ 
setrange key 6 ‘Redis’ # 从 key 的偏移量6开始替换成 Redis</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre>


##### list 列表

redis 列表是简单的字符串列表, 按照插入顺序排序, 可以在列表左侧右侧添加新元素

list命令

| 命令      | 描述                                       |
| ------- | ---------------------------------------- |
| rpush   | 将值在列表右侧依次推入, 成功返回1, 否则0. 没有 key 就创建一个新的 list |
| rpushx  | Append a value to a list, only if the list exists |
| lpush   | 将值在列表左侧依次推入, 成功返回1, 否则0. 没有 key 就创建一个新的 list |
| lpushx  | Prepend a value to a list, only if the list exists |
| lrange  | 获取指定范围内的列表值                              |
| lindex  | 按索引返回列表中的值                               |
| lpop    | 从列表左侧弹出一个值,并返回                           |
| linsert | 在列表某元素值得前\|后插入新值.  Insert an element before or after another element in a list |
| lset    | 覆盖指定索引位置值为新值.  如果索引不存在,则报错 ERR index out of range |
| rpop    | 从列表右侧弹出一个值,并返回                           |
| lrem    | count &gt; 0 : 从表头向表尾搜索,删除掉 COUNT 个 value 元素&lt;br /&gt;count &lt; 0 : 从表尾向表头搜索,删除掉 COUNT 个 value 元素&lt;br /&gt;count = 0 : 删除表中所有与 VALUE 相等的元素 |
| ltrim   | 将原来的List 进行剪裁. 范围外的扔掉.语法和 lrange 一样.  Trim a list to the specified range |
| llen    | 返回列表元素个数                                 |

```python redis
rpush mylist v1 # 连续 push 三个值,两个相同

rpush mylist v2

rpush mylist v1

lrange mylist 0 -1 # 获取从头到尾的所有值

lindex mylist 0 # 按索引查看每一个值

lindex mylist 1

lindex mylist 2

lindex mylist 3

lpop mylist # 弹出最左边的值

lrange mylist 0 -1 # 再查看一遍所有值

linsert myl after a c # 在 myl 中的 a 后面插入 c
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="set-集合">set 集合</h5>

<p>set 命令</p>

<table>
  <thead>
    <tr>
      <th>命令</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>sadd</td>
      <td>为集合添加一个或多个元素, 若成功,则返回添加元素个数. 如果集合不存在, 创建新的集合</td>
    </tr>
    <tr>
      <td>smembers</td>
      <td>返回集合所有元素</td>
    </tr>
    <tr>
      <td>sismember</td>
      <td>检查某个值是否已在集合中, 找到返回1, 否则0</td>
    </tr>
    <tr>
      <td>srem</td>
      <td>从集合中按值删除一个或多个元素, 成功返回1, 否则0</td>
    </tr>
    <tr>
      <td>scard</td>
      <td>返回集合元素个数</td>
    </tr>
    <tr>
      <td>spop</td>
      <td>随机从集合中删除一个元素,并返回该元素. 如果集合为空, 返回 nil</td>
    </tr>
    <tr>
      <td>sinter</td>
      <td>求交集</td>
    </tr>
    <tr>
      <td>sdiff</td>
      <td>求差集, 注意比较顺序</td>
    </tr>
    <tr>
      <td>sunion</td>
      <td>求合集</td>
    </tr>
    <tr>
      <td>srandmember</td>
      <td>随即返回一个集合元素</td>
    </tr>
  </tbody>
</table>

<p>```python redis
sadd myset item1 # 为集合增加元素</p>

<p>sadd myset item2</p>

<p>sadd myset item3</p>

<p>smembers myset # 返回集合所有元素</p>

<p>sismember myset item4 # 测试一个元素是否属于集合, 返回0</p>

<p>sismember myset item3 # 返回1</p>

<p>srem myset item2 # 删除一个集合</p>

<p>smembers myset # 再次查看集合</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></td><td class="code"><pre>


#### hash-key 散列/字典

- hash-key 包含多个带键值对的元素 field-value
- key 中有多个 fields, 每个 field 有对应的值
- key 中的 field 是不会重复的
- 适用于保存实例化的对象. 可以将 python 中的对象进行保存. `print(a.__dict__)` 
- 和 python 字典概念类似

hk 命令

| 命令           | 描述                                       |
| ------------ | ---------------------------------------- |
| hset         | 设置 hk. `hset key field value`. 如果 key 不存在 创建新的 hk. 如果key 已经存在, 但是 field 不存在, 创建新的 field. 如果key ,field 都存在, 那么覆盖原有 value. |
| hget         | 获取指定 field 的 value                       |
| hgetall      | 返回所有 key 中的 fields 和 values              |
| hdel         | 移除 指定 field                              |
| hmset        | 一次设置多个fields 的值, 成功返回 ok                 |
| hincrby      | 对键值对的值增加整数, 成功返回新的 数值. 不能增加浮点数           |
| hincrbyfloat | 对键值对的值增加浮点数 ,成功返回新的数值. 如果  field不存在 也会添加. 可添加整数. |
| hsetnx       | 当field不存在变量时设置                           |
| hmget        | 一次获取多个fields 的值                          |
| hlen         | 返回 key 中的键值对个数, 注意要和 hstrlen             |
| hexists      | 看一个变量的 field 是否存在 ,存在返回1, 否则0            |
| hdel         | 删除某 key 的一个或多个 fields                    |
| hstrlen      | 获取某变量 field 对应 value 的长度. **注意**要和 hlen 区别开 |
| hkeys        | 获取所有 fields                              |
| hvals        | 获取所有 values of fields                    |



```python redis
hset myhk k1 v1 # 为hk 创建元素 , 返回1

hset myhk k2 v2

hset myhk k1 v1 # 已存在同名的 key, 返回0

hmset hash name 'zs' age 18 sex 'w' # 设置多个值

hgetall myhk # 获取所有 hk

hdel myhk k2 # 按 key 删除一个 hk

hgetall myhk # 再次获取所有 hk

HINCRBY hash age 10 # 对 hash 的 age 增加10 

HINCRBYFLOAT hash money 10.1 


</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="zset-有序集合">zset 有序集合</h4>

<blockquote>
  <p>zset 是有序集合, 元素具有唯一性,不重复</p>

  <p>zk 的排序是由元素的score来决定的</p>

  <p>zk 的值被称为 <strong>score</strong> 必须是<strong>浮点型</strong>的</p>

  <p>zk 是唯一可以<strong>根据成员来访问元素</strong>的数据类型</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>命令</th>
      <th>描述</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>zadd</td>
      <td>为 集合 添加元素, 如果集合不存在,创建新集合. 成功返回添加个数, 失败返回0</td>
    </tr>
    <tr>
      <td>zrange</td>
      <td>根据 range 的索引值范围 获取多个元素(0 -1 表示从第一个索引返回到最后一个索引). 可以通过 WITHSCORES 关键字同时返回权重值</td>
    </tr>
    <tr>
      <td>zrangebyscore</td>
      <td>根据 score 的取值范围 获取多个元素. 可以通过 WITHSCORES 关键字同时返回权重值.</td>
    </tr>
    <tr>
      <td>zscore</td>
      <td>获取指定元素对应的 score 分数</td>
    </tr>
    <tr>
      <td>zrem</td>
      <td>移除指定元素</td>
    </tr>
    <tr>
      <td>zincrby</td>
      <td>对集合中指定元素的分数加整数权重</td>
    </tr>
    <tr>
      <td>zcard</td>
      <td>返回集合内元素个数</td>
    </tr>
    <tr>
      <td>zcount</td>
      <td>返回集合内指定score 范围元素个数.  Count the members in a sorted set with scores within the given v</td>
    </tr>
  </tbody>
</table>

<pre><code class="language-redis">zadd mysk 728 k1 # 为zk添加元素, key 是 k1, score 是 728

zadd mysk 982 k2

zrange mysk 0 -1 withscores #返回从头到尾的所有元素, 不加 withscores 参数, 将值返回 key, 否则返回 key,value

zrangebyscore mysk 0 800 withscores # 只返回 value 在0-800之间的元素. 有 withscore 参数则返回 key value, 否则只返回 key 

zrem mysk k1 # 按 key删除 元素

zrange mysk 0 -1 withscores # 再次显示所有 元素

ZINCRBY z1 10 a # 为 z1集合的 a 的 score 增加10点权重 
</code></pre>

<h4 id="用-python-连接-redis">用 Python 连接 redis</h4>

<p><a href="http://bbs.redis.cn/forum.php?mod=viewthread&amp;tid=495&amp;extra=page%3D1">连接方法</a></p>

<ul>
  <li>先导入 redis 模块 <code class="language-plaintext highlighter-rouge">pip3.7 install redis</code></li>
  <li>写如下链接测试代码</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">redis</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'localhost'</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span><span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span><span class="s">'dalong'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'name'</span><span class="p">))</span> <span class="c"># 返回 b'dalong'</span>



</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">redis</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="s">'s1'</span><span class="p">,</span> <span class="s">'dalong'</span><span class="p">)</span> <span class="c"># 成功返回 ture</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'s1'</span><span class="p">))</span>    <span class="c"># 获取 s1 的值</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'s1'</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'UTF-8'</span><span class="p">))</span> <span class="c"># 获取解码的 s1 值</span>
<span class="n">r</span><span class="o">.</span><span class="n">setex</span><span class="p">(</span><span class="s">'s1'</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s">'xiaolong'</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">setnx</span><span class="p">(</span><span class="s">'s2'</span> <span class="p">,</span> <span class="s">'zhangsan'</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">mset</span><span class="p">({</span><span class="s">'s3'</span><span class="p">:</span><span class="s">'lisi'</span><span class="p">,</span> <span class="s">'s4'</span><span class="p">:</span><span class="s">'wangwu'</span><span class="p">})</span>
<span class="n">r</span><span class="o">.</span><span class="n">mset</span><span class="p">(</span><span class="n">s5</span><span class="o">=</span><span class="s">'lisi'</span><span class="p">,</span> <span class="n">s6</span><span class="o">=</span><span class="s">'wangwu'</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">setrange</span><span class="p">(</span><span class="s">'s6'</span><span class="p">,</span><span class="mi">2</span> <span class="p">,</span> <span class="s">'xxx'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">mget</span><span class="p">(</span><span class="s">'s1'</span><span class="p">,</span><span class="s">'s2'</span><span class="p">))</span> <span class="c"># 返回一个列表</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getrange</span><span class="p">(</span><span class="s">'s1'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'UTF-8'</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getset</span><span class="p">(</span><span class="s">'s7'</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s">'s7'</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="mongodb-数据库">MongoDB 数据库</h3>

<p><a href="https://docs.mongodb.com/manual/reference/">mongo 官方文档</a></p>

<h4 id="了解-json">了解 JSON</h4>

<p>JSON 是一个轻量级的数据传输格式</p>

<p>用在web前台, 移动端, 第三方接口和后台的数据交互中.</p>

<p>类似于 python 的字典</p>

<p>导入 JSON 模块</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">json</span>

<span class="c"># json 化后写入文件</span>
<span class="c">#json.dump()</span>
<span class="c">#json.load()</span>

<span class="c"># json 化后返回字符串</span>
<span class="c">#json.dumps()</span>
<span class="c">#json.loads()</span>

<span class="n">myDict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'lisi'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">:</span><span class="mi">18</span><span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./test.txt'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span>
	<span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">myDict</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'./test.txt'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span>
	<span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">myDict</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">myDict</span><span class="p">)))</span>



<span class="c">#序列化后写入文件</span>
<span class="c">#pickle.dump()</span>
<span class="c">#pickle.load()</span>
<span class="c">#序列化后返回字符串</span>
<span class="c">#pickle.dumps()</span>
<span class="c">#pickle.loads()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="安装mongodb">安装MongoDB</h4>

<p><a href="https://docs.mongodb.com/v3.6/tutorial/install-mongodb-on-os-x/">官方安装文档</a></p>

<ul>
  <li>下载和安装 mongodb</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>brew install mongodb --with-openssl
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>安装成功后运行如下命令创建数据库需要存储数据文件的目录和权限</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>sudo mkdir -p /data/db

sudo chown dalong -u /data/db
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>分别启动 mongodb 服务端 <code class="language-plaintext highlighter-rouge">mongod</code> 和 客户端 <code class="language-plaintext highlighter-rouge">mongo</code>, 客户端需要另外开一个 terminal 窗口.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="c"># 新建 terminal 窗口, 启动后不要关掉. 启动后可以看到服务端口号. 默认端口号 27017</span>
mongod

<span class="c"># 新建 terminal 窗口</span>
mongo
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>尝试在 Mongo客户端输入命令 <code class="language-plaintext highlighter-rouge">show dbs</code> 测试是否成功</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>show dbs # 输出两个数据库, admin local
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="mongo-db-介绍">Mongo DB 介绍</h4>

<ul>
  <li>
    <p>mongo 严格区分大小写, 所有命令都要小写</p>
  </li>
  <li>
    <p>mongodb 将数据存为文档, 数据结构有 key value 组成</p>
  </li>
  <li>
    <p>mongo 文档类似于 josn 字段值</p>
  </li>
  <li>
    <p>字段值可以包含其他文档或者是数组</p>

    <p><code class="language-plaintext highlighter-rouge">{'name':{'name':'value'}}</code></p>
  </li>
</ul>

<h5 id="mongo-存储的概念区别"><strong>mongo 存储的概念(区别)</strong></h5>

<table>
  <thead>
    <tr>
      <th>SQL 术语/ 概念</th>
      <th>mongo 术语/概念</th>
      <th>解释说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>database</td>
      <td>dbs</td>
      <td>数据库</td>
    </tr>
    <tr>
      <td>table</td>
      <td>collection</td>
      <td>表</td>
    </tr>
    <tr>
      <td>row</td>
      <td>document</td>
      <td>行/文档</td>
    </tr>
    <tr>
      <td>column</td>
      <td>field</td>
      <td>字段/域</td>
    </tr>
    <tr>
      <td>primary key</td>
      <td>primary key</td>
      <td>主键索引/mongo 会自动将_id 设置成主键索引</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h5 id="对库的操作">对库的操作</h5>

<p><a href="https://docs.mongodb.com/manual/reference/method/#database">手册</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>help # 查看 help 相关的帮助信息
db.help() # 数据库相关帮助; 任何命令后面加上 .help() 可以获取这个命令的帮助信息
db.users.help() # 获取集合相关帮助. 
d # 输入部分命令后双击 tab 可以补全
db.  # 输入命令加点后双击 tab 可以看到该命令的子命令
</pre></td></tr></tbody></table>
</div>
</div>

<blockquote>
  <p>库命名规范:</p>
</blockquote>

<ul>
  <li>库名全部小写，禁止使用任何<code class="language-plaintext highlighter-rouge">_</code>以外的特殊字符，禁止使用数字打头的库名，如：<code class="language-plaintext highlighter-rouge">123_abc</code>；</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>show dbs # 查看所有的库 

use users # 使用一个库, 没有就创建

#当不存在的库创建以后, 需要使用`db.createCollection('goods')` 在这个库中创建一个新的 collection 后才能用 `show dbs` 看到新的库

db.getName() #可以看到当前正在使用的数据库名. db 就代表了 users

db.getMongo() # 查看当前客户端连接的服务器信息对象

db.hostInfo() # 获取服务器信息

db.stats() # 查看当前库的统计报告

db.version() # 查看当前 mongo 版本信息

db.dropDatabase() # 删掉数据库, 删除之前最好先 use 一下,确认删除的是当前数据库
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="对于集合的操作">对于集合的操作</h5>

<p><a href="https://docs.mongodb.com/manual/reference/method/#collection">手册</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>db.collection.help()  # 看和 表 相关的帮助
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>技巧</strong></p>

<p><code class="language-plaintext highlighter-rouge">db.集合名. + 双击 tab</code> 可以获取对集合的所有操作</p>

<blockquote>
  <p>集合命名规范</p>
</blockquote>

<ul>
  <li>禁止使用任何<code class="language-plaintext highlighter-rouge">_</code>以外的特殊字符，禁止使用数字打头的集合 集合名全部小写，名，如：<code class="language-plaintext highlighter-rouge">123_abc</code></li>
</ul>

<pre><code class="language-mongo">show collections # 查看所有集合

  # db.createCollection('集合名字') # 创建集合
db.createCollection('user') # 创建一个叫做 user 的集合. 


  # db.集合名.drop # 删除集合
db.user.drop()
</code></pre>

<h5 id="insertsave-文档的添加修改文档覆盖">INSERT/SAVE 文档的添加/修改(文档覆盖)</h5>

<p><a href="http://blog.csdn.net/permike/article/details/51800948">_id 相关的资料</a></p>

<ul>
  <li>如果往一个不存在的 collection 中插入一条记录, 那么等于同时创建了这个 collection.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre>  <span class="c"># insert 添加文档</span>
  <span class="c"># db.集合名.insert(文档)</span>
<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insertOne</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'zhangsan'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">18</span><span class="p">})</span> <span class="c"># 插入1条文档 ,成功会返回 "insertedId" : ObjectId("5a1fd3ba07e9cb5855b8e747") 表示成功插入一条. 返回自动生成的 id,  key 的引号可有可无 </span>

<span class="n">db</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">insertOne</span><span class="p">(</span> <span class="p">{</span> <span class="n">_id</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="s">"box"</span><span class="p">,</span> <span class="n">qty</span><span class="p">:</span> <span class="mi">20</span> <span class="p">}</span> <span class="p">)</span> <span class="c"># 也可以自己生成 id  进行插入, _id 是必须的id格式</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span> <span class="c"># 查看所有文档 也可以写成 db['users'].find()</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">'age'</span><span class="p">:</span><span class="s">'43'</span><span class="p">});</span> <span class="c"># find() 函数可以带上条件, 查看 age 是43的所有数据</span>

<span class="n">db</span><span class="o">.</span><span class="n">goods</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">"_id"</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">"5a1fcd1d07e9cb5855b8e733"</span><span class="p">)})</span> <span class="c"># 按照 id 查,可以查出唯一数据</span>

<span class="c"># db.集合名.insert([文档1,文档2...]) # 插入多条数据</span>
<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insertMany</span><span class="p">([{</span><span class="n">name</span><span class="p">:</span><span class="s">'dalong'</span><span class="p">,</span><span class="n">age</span><span class="p">:</span><span class="s">'43'</span><span class="p">},{</span><span class="n">name</span><span class="p">:</span><span class="s">'xiaoyu'</span><span class="p">,</span><span class="n">age</span><span class="p">:</span><span class="mi">12</span><span class="p">}])</span> <span class="c"># 插入多条数据, 多条数据用[]括起来</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">save</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="s">'zhaoliu'</span><span class="p">,</span><span class="n">age</span><span class="p">:</span><span class="mi">20</span><span class="p">})</span> <span class="c"># 修改,也可以作为添加. 不给 id 就是添加,和 insert 一样</span>
<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">save</span><span class="p">({</span><span class="s">"_id"</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">"5a1fb66260f017e8a99f054d"</span><span class="p">),</span> <span class="n">name</span><span class="p">:</span><span class="s">'zhaoliu'</span><span class="p">,</span><span class="n">age</span><span class="p">:</span><span class="s">'21'</span><span class="p">})</span> <span class="c"># 这是修改或者叫做覆盖, 返回信息 { "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 } 表示 找到一条, 修改了一条.</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="update-修改">Update 修改</h5>

<p><a href="https://docs.mongodb.com/manual/reference/method/db.collection.update/">官方解释</a></p>

<p>主体结构:</p>

<pre><code class="language-mongo">db.collection.update(
   &lt;query&gt;,
   &lt;update&gt;,
   {
     upsert: &lt;boolean&gt;, # 默认 false, 当 true 时,无存在就创建
     multi: &lt;boolean&gt;, # 默认 false, 当 true 时,匹配多条就更新多条
     writeConcern: &lt;document&gt;, # 这个先不用管
     collation: &lt;document&gt; # 这个先不用管
   }
)
</code></pre>

<pre><code class="language-mongo"># 修改一条
db.users.updateOne(
	{name:'dalong'},
	{$set:{age:10}},
	{upsert:true}
)

# 修改多条
db.goods.updateMany( 
	{name:'dalong'}, 
	{$set:{age:10}}, 
	{upsert:true} 
)

</code></pre>

<p>修改的操作符</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">$inc</code> 可以对文档的某个值为数字型（只能为满足要求的数字）的键进行增减的操作</li>
  <li><code class="language-plaintext highlighter-rouge">$set</code> 用来指定一个键并更新键值. set 可以设定任意类型的值,修改方式就是直接覆盖掉原来的值(比如将原来的字符串类型值换成列表型). 若键不存在就创建.</li>
</ol>

<pre><code class="language-mongo">
  # inc 的例子
db.createCollection('b') 
db.b.insert({"uid":"201203","type":"1",size:10})
db.b.find()
db.b.update({"uid" : "201203"},{"$inc":{"size" : 1}})
db.b.find()
db.b.update({"uid" : "201203"},{"$inc":{"size" : 2}})
db.b.find()
db.b.update({"uid" : "201203"},{"$inc":{"size" : -1}})
db.b.find()

  # set 的例子
db.goods.updateMany( 
	{name:'dalong'}, 
	{$set :{age:18,goods:['books','food','money']}} 
);

db.users.updateMany(
	{name:'mike'}, 
	{$inc:{age:10}}, 
	true,true)

</code></pre>

<h6 id="find-查找所有">find 查找所有</h6>

<p><code class="language-plaintext highlighter-rouge">db.users.find().help()</code> 可以看和 find 相关的命令</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>db.users.find() 	# 默认返回所有记录
db.users.find({name:'taotao'}) # 只查名字是涛涛的数据
db.users.find({},{name:1}) # 第一个大括号是查询条件,第二个大括号是要显示哪些字段, name:1 表示只显示 name 字段信息
db.users.find({},{age:0}) # age:0 表示不显示 age 字段, 其他都显示
db.users.find({},{name:1,_id:0}) # 这个是正确的, 因为_id 是系统提供的
db.users.find({},{age:0,name:1}) # 这是错误写法,因为矛盾了(,除了_id 可以,其他都不行)
</pre></td></tr></tbody></table>
</div>
</div>

<p>findOne 查一条</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>db.users.findOne({},{name:1,_id:0}) # 查看一条,并只显示名字
</pre></td></tr></tbody></table>
</div>
</div>

<p>count 统计条数</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>db.users.find().count()  # 统计所有信息条数, 可以加条件
</pre></td></tr></tbody></table>
</div>
</div>

<p>pretty 展开查看</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>db.users.find().pretty() # 以容易让人看的样式展示数据
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>查询条件的操作符</strong></p>

<ol>
  <li>$gt 大于 <code class="language-plaintext highlighter-rouge">db.users.find({age:{$gt:10}})</code>
    <ol>
      <li>大于某 ID <code class="language-plaintext highlighter-rouge">db.col.find({"_id":{$gt:ObjectId("5a22b67a60f017e8a99f0558")}}).pretty()</code></li>
    </ol>
  </li>
  <li>$gte 大于等于 <code class="language-plaintext highlighter-rouge">db.users.find({age:{$gte:10}})</code></li>
  <li>$lt 小于 <code class="language-plaintext highlighter-rouge">db.users.find({age:{$lt:10}})</code></li>
  <li>$lte 小于等于 <code class="language-plaintext highlighter-rouge">db.users.find({age:{$lte:10}})</code></li>
  <li>$ne 不等于 <code class="language-plaintext highlighter-rouge">db.users.find({age:{$ne:10}})</code></li>
  <li>等于 {field:值} <code class="language-plaintext highlighter-rouge">db.users.find({age:10})</code></li>
  <li>使用 id 来查询  <code class="language-plaintext highlighter-rouge">db.col.find({"_id":ObjectId("5a22b67a60f017e8a99f0558")}).pretty()</code></li>
  <li>/数据/ 模糊查询   <code class="language-plaintext highlighter-rouge">db.users.find(name:/da/)</code></li>
  <li>/^数据/ 以..开头  <code class="language-plaintext highlighter-rouge">db.users.find({name:/^da/})</code></li>
  <li>/数据$/ 以..结尾  <code class="language-plaintext highlighter-rouge">db.users.find({name:/ng$/})</code></li>
  <li>$in 在 .. 之内    <code class="language-plaintext highlighter-rouge">db.users.find({age:{$in:[18,20]}})</code></li>
  <li>$nin 不在… 之内 <code class="language-plaintext highlighter-rouge">db.users.find({age:{$nin:[18,20]}})</code></li>
</ol>

<p><strong>and 查询</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="c"># db.collection.find({key1:val2,key2,val2}) 语法</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="s">'dalong'</span><span class="p">,</span><span class="n">age</span><span class="p">:</span><span class="mi">10</span><span class="p">})</span> <span class="c">#找名字是大龙,年龄是10岁得人</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="s">'dalong'</span><span class="p">,</span><span class="n">age</span><span class="p">:{</span><span class="err">$</span><span class="n">gte</span><span class="p">:</span><span class="mi">10</span><span class="p">}})</span> <span class="c"># 找到名字是大龙,年龄大于10岁得人</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">updateOne</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="s">'dalong'</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="err">$</span><span class="nb">set</span><span class="p">:{</span><span class="n">age</span><span class="p">:</span><span class="mi">20</span><span class="p">}</span> <span class="p">})</span> <span class="c"># 找到名字是大龙, 年龄是10岁的人,把他的名字更新成20 </span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="s">'dalong'</span><span class="p">,</span><span class="n">age</span><span class="p">:{</span><span class="err">$</span><span class="n">gte</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="err">$</span><span class="n">lte</span><span class="p">:</span><span class="mi">20</span><span class="p">}})</span> <span class="c">#找名字是大龙, 年龄在10到20之间的数据</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="n">name</span><span class="p">:</span><span class="s">'dalong'</span><span class="p">,</span><span class="n">name</span><span class="p">:</span><span class="s">'zhangsan'</span><span class="p">})</span> <span class="c"># 后面的条件会覆盖前面的条件, 不建议使用这样的写法</span>

<span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="n">name</span><span class="p">:{</span><span class="err">$</span><span class="ow">in</span><span class="p">:[</span><span class="s">'dalong'</span><span class="p">,</span><span class="s">'zhangsan'</span><span class="p">]}})</span> <span class="c"># 查找名字是大龙或张三的数据</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>or 查询</strong></p>

<p>要用 <code class="language-plaintext highlighter-rouge">$or</code> 关键字</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>db.users.find({$or:[{name:'dalong'},{name:'zhangsan'}]}) # 查询 neme 是大龙或者张三的数据

db.users.find({name:'zhangsan',$or:[{age:{$gte:10}},{age:{$lte:30}}]}) # 查询名字是张三, 年龄大于10 或 小于 30的数据


</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>and or  组合写法</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>db.users.find({name:'zhangsan',$or:[{age:{$gte:10}},{age:{$lte:30}}]},{name:1,_id:0}) # 查询名字是张三, 年龄大于10 或 小于 30的数据
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>limit 限制返回条数</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>db.users.find().limit(3) # 从零开始取3条

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>skip 跳过前 n 条数据后再取值</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>db.users.find().skip(5) # 从第5条开始去
db.users.find().skip(2).limit(3) # 从第二条开始取, 取三条
db.users.find().limit(3).skip(2) # 返回来写也一样
db.users.find().skip(2).limit(3).count() # 统计
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>sort 排序</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>db.users.find().sort({age:1}) # 升序

db.users.find().sort({age:-1}) # 降序

db.users.find().sort({age:-1}).limit(1) # 取年龄最大的一条记录
</pre></td></tr></tbody></table>
</div>
</div>

<h6 id="remove-删除">remove 删除</h6>

<p>db.collection.remove({条件},1) #</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>db.users.remove({name:'zhaoliu'}) # 删掉符合条件的数据
db.users.remove({name:'taotao'},1) # 只删除匹配到的第一条数据
db.users.remove({name:'taotao'},{justOne:true})

db.users.remove({}) # 删除所有数据

db.dropDatabase() # 删掉数据库, 删除之前最好先 use 一下,确认删除的是当前数据库
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="数据库的备份和恢复">数据库的备份和恢复</h5>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>mongodump --help
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>备份数据</strong></p>

<ol>
  <li>先启动 mongod 服务</li>
  <li>cd 到想要存储备份数据的目录,</li>
  <li>打开一个终端 输入如下命令</li>
  <li>会发现有一个新的目录 dump , 可以看到备份的库数据</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>mongodump
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>删除数据库 用来测试接下来 mongorestore</strong></p>

<p>```python bash
use users  # drop 库之前必须先 use 
db.dropDatabase() # 干掉
use py
db.dropDatabase()</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>


**恢复数据**

1. 进入dump 所在目录
2. 运行如下命令
3. 再次进入 mongo 客户端, 查看之前删掉的库是否重现

```bash
mongorestore
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="为-python-安装-mongo-模块">为 python 安装 mongo 模块</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>pip3.7 install pymongo
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="python-中使用-pymongo-模块">python 中使用 pymongo 模块</h4>

<p><a href="http://api.mongodb.com/python/current/tutorial.html">pymongo 使用手册</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">pymongo</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">py</span>
<span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
<span class="c"># print(db.users.insert_one({'name':'taotao', 'age':14}).inserted_id)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">'name'</span><span class="p">])</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">datetime</span>					
<span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>  <span class="c"># 导入 mongo 客户端</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span> <span class="c"># 连接服务器, 默认端口号27017</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">users</span>				<span class="c"># 连接 users 数据库</span>
<span class="n">post</span> <span class="o">=</span> <span class="p">{</span><span class="s">"author"</span><span class="p">:</span> <span class="s">"Mike"</span><span class="p">,</span>		<span class="c"># 建立一个字典</span>
        <span class="s">"text"</span><span class="p">:</span> <span class="s">"My first blog post!"</span><span class="p">,</span>
        <span class="s">"tags"</span><span class="p">:</span> <span class="p">[</span><span class="s">"mongodb"</span><span class="p">,</span> <span class="s">"python"</span><span class="p">,</span> <span class="s">"pymongo"</span><span class="p">],</span>
        <span class="s">"date"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()}</span>
<span class="n">posts</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">posts</span>				<span class="c"># 为 users 库建立一个叫做 posts 的表 </span>
<span class="n">post_id</span> <span class="o">=</span> <span class="n">posts</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">post</span><span class="p">)</span><span class="o">.</span><span class="n">inserted_id</span>	<span class="c"># 将字典插入 posts 表中并将 id 赋值到 post_id 变量中</span>
<span class="k">print</span><span class="p">(</span><span class="n">post_id</span><span class="p">)</span> 					<span class="c"># 打印该 id</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">posts</span><span class="o">.</span><span class="n">find_one</span><span class="p">())</span> <span class="c"># 打印 posts 表中的一条记录 , 这里没有加条件, 但是可以加搜索条件</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">posts</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">"author"</span><span class="p">:</span> <span class="s">"Mike"</span><span class="p">}))</span> <span class="c"># 加了搜索条件</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">posts</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s">"_id"</span><span class="p">:</span> <span class="n">post_id</span><span class="p">}))</span> <span class="c"># 用刚才获取的 id 来搜索</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>文档添加</strong></p>

<p><code class="language-plaintext highlighter-rouge">insert</code> : 插入一条或多条, 返回单个 id 或列表 id . 不建议使用</p>

<p><code class="language-plaintext highlighter-rouge">insert_one</code> : 插入一条, 返回一个对象, 需要通过 obj.inserted_id 获取 ID 值</p>

<p><code class="language-plaintext highlighter-rouge">insert_many</code> : 插入多条, 返回一个对象, 需要通过 obj.inserted_ids 获取一个 ID 列表</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>

<span class="n">cli</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">py</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
<span class="c"># 添加一条文档</span>
<span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'ZHANGSAN'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">:</span><span class="s">'w'</span><span class="p">}))</span>
<span class="c"># 返回 创建的 id</span>

<span class="c"># 添加多条文档</span>
<span class="k">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insert</span><span class="p">([{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'LISI'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">:</span><span class="s">'w'</span><span class="p">},{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'WANGWU'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">:</span><span class="s">'w'</span><span class="p">}]))</span>
<span class="c"># 以列表形式返回创建的 id 信息</span>

<span class="c"># insertOne</span>
<span class="n">insertObj</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insert_one</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'CAILIU'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">:</span><span class="s">'w'</span><span class="p">})</span>
<span class="c"># 返回一个pymongo 对象, 需要进行解析</span>
<span class="k">print</span><span class="p">(</span><span class="n">insertObj</span><span class="o">.</span><span class="n">inserted_id</span><span class="p">)</span>

<span class="c"># insertMany</span>
<span class="n">insertObjs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">insert_many</span><span class="p">([{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'LISI'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">:</span><span class="s">'w'</span><span class="p">},{</span><span class="s">'name'</span><span class="p">:</span><span class="s">'WANGWU'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span> <span class="s">'sex'</span><span class="p">:</span><span class="s">'w'</span><span class="p">}])</span>
<span class="k">print</span><span class="p">(</span><span class="n">insertObjs</span><span class="o">.</span><span class="n">inserted_ids</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>** find 文档查询**</p>

<p>注意:</p>

<ul>
  <li>当需要按照 id 来查询是, 需要导入 <code class="language-plaintext highlighter-rouge">from bson import ObjectId</code> , 避免报错</li>
  <li>当需要模糊查询时, 需要导入 <code class="language-plaintext highlighter-rouge">import re</code> , 并用 <code class="language-plaintext highlighter-rouge">re.compile('da')</code> 来代替原来的 <code class="language-plaintext highlighter-rouge">/da/</code></li>
  <li>当进行排序的时候, 在 python 中的写法 <code class="language-plaintext highlighter-rouge">sort('age',1)</code> 和 mongo 命令行中的写法 <code class="language-plaintext highlighter-rouge">sort({age:1})</code> 不一样</li>
</ul>

<p>示例代码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="kn">from</span> <span class="nn">bson</span> <span class="kn">import</span> <span class="n">ObjectId</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterator</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">py</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>  <span class="c"># 返回一个迭代器, 通过 next 方法可以进行遍历取值</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'name'</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="s">'age'</span><span class="p">])</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find_one</span><span class="p">()</span> <span class="c"># 返回一条字典</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># 返回一个带条件的搜索</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'ZHANGSAN'</span><span class="p">,</span><span class="s">'age'</span><span class="p">:{</span><span class="s">'$gt'</span><span class="p">:</span><span class="s">'17'</span><span class="p">}})</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># 通过 id 查询一个文档 , 需要导入 from bson import ObjectId , 避免错误</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">"_id"</span> <span class="p">:</span> <span class="n">ObjectId</span><span class="p">(</span><span class="s">"5a20f48a421aa99cd374b7b9"</span><span class="p">)})</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># 模糊查询   需要导入正则模块 import re, 用 re.compile 来搜索</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">'da'</span><span class="p">)})</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># 排序 , 注意 最后面的 sort('age',1) 和 mongo 命令行中的写法 sort({age:1}) 不一样</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">'age'</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># count 统计条数</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># skip 跳过前四条,获取剩下的</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c"># limit 从第4条开始取, 取4条文档</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>update 文档更新</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="kn">from</span> <span class="nn">bson</span> <span class="kn">import</span> <span class="n">ObjectId</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterator</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">py</span>

<span class="c"># update 更新数据 , 成功后返回一个影响数据的字典</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'LISI'</span><span class="p">},</span> <span class="p">{</span><span class="s">'$set'</span><span class="p">:{</span><span class="s">'age'</span><span class="p">:</span><span class="mi">20</span><span class="p">}})</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'LISI'</span><span class="p">},</span> <span class="p">{</span><span class="s">'$inc'</span><span class="p">:{</span><span class="s">'age'</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c"># updateOne 更新一条数据 ,成功后返回一个对象, 可以使用 modified_count 获取改动条数</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update_one</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'LISI'</span><span class="p">},</span> <span class="p">{</span><span class="s">'$set'</span><span class="p">:{</span><span class="s">'sex'</span><span class="p">:</span><span class="s">'f'</span><span class="p">}})</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update_one</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'LISI'</span><span class="p">},</span> <span class="p">{</span><span class="s">'$inc'</span><span class="p">:{</span><span class="s">'age'</span><span class="p">:</span><span class="mi">1</span><span class="p">}})</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">modified_count</span><span class="p">)</span>

<span class="c"># updateMany 更新多条数据, 成功后返回一个对象, 可以使用 modified_count 获取改动条数</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">update_many</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'LISI'</span><span class="p">},</span> <span class="p">{</span><span class="s">'$set'</span><span class="p">:{</span><span class="s">'sex'</span><span class="p">:</span><span class="s">'f'</span><span class="p">}})</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">modified_count</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>remove 删除</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="kn">from</span> <span class="nn">bson</span> <span class="kn">import</span> <span class="n">ObjectId</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Iterator</span>
<span class="n">cli</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s">'localhost'</span><span class="p">,</span> <span class="mi">27017</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">cli</span><span class="o">.</span><span class="n">py</span>

<span class="c"># 按条件删除</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'WANGWU'</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c"># 删除一条数据, 返回一个对象, 需要解析, result.deleted_count 得到删除的条数</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'WANGWU'</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span><span class="p">)</span>

<span class="c"># 删除多条, 返回一个对象, 需要解析, result.deleted_count 得到删除的条数</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({</span><span class="s">'name'</span><span class="p">:</span><span class="s">'WANGWU'</span><span class="p">})</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span><span class="p">)</span>

<span class="c"># 删除表中的所有数据(清空)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>  <span class="c"># 删除成功返回对象,result.deleted_count 得到删除的条数</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>关闭数据库</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>


            </div>

            <!-- Rating -->
            
            <div class="rating mb-4 d-flex align-items-center">
                <strong class="mr-1">Rating:</strong> <div class="rating-holder">
<div class="c-rating c-rating--regular" data-rating-value="4.5">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
</div>
</div>
            </div>
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2018-03-12">12 Mar 2018</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#MongoDB">MongoDB</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Mysql">Mysql</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Redis">Redis</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//Beginning-Python-From-Novice-to-Professional-Part-2/"> &laquo; Learning Python From Scratch (Part2)</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//Python-Crowler-In-Actrion/">Python Crowler In Action &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Thing",
    "name": "Python and Databases(Mysql, Redia, MongoDB) Basic"
  },
  "author": {
    "@type": "Person",
    "name": "Dalong"
  },
  "datePublished": "2018-03-12",
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": "4.5",
    "bestRating": "5"
  }
}
</script>

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Linux">Linux (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (16)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mysql">Mysql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Redis">Redis (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MongoDB">MongoDB (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Flask">Flask (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Django">Django (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DjangoRest">DjangoRest (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Web-development">Web development (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Numpy">Numpy (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Panda">Panda (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Sklearn">Sklearn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jupyter">Jupyter (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenCV">OpenCV (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AI">AI (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Science">Data Science (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Tensorflow">Tensorflow (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ML">ML (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Microservice">Microservice (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Docker">Docker (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#NLP">NLP (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Container">Container (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS">AWS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture">Architecture (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Database">Database (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Storage">Storage (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DevOps">DevOps (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IAM">IAM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cloud">Cloud (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#API">API (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Migration">Data Migration (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Network">Network (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#YAML">YAML (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Security">Security (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#kubernetes">kubernetes (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Serverless">Serverless (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#CICD">CICD (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Agile">Agile (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Scrum">Scrum (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Design-Thinking">Design Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GCP">GCP (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Google-Cloud-Platform">Google Cloud Platform (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MLPS">MLPS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PIPL">PIPL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PII">PII (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GDPR">GDPR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Metaverse">Metaverse (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#VR">VR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AR">AR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#XR">XR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Togaf">Togaf (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture-Thinking">Architecture Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ChatGPT">ChatGPT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenAI">OpenAI (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#LLM">LLM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Prompt">Prompt (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DALL-E">DALL-E (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OCR">OCR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Face-API">Face API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Chat-Bot">Chat Bot (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Speech-Service">Speech Service (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Computer-Vision">Computer Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Custom-Vision">Custom Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Video-indexer">Video indexer (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Translator">Translator (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cognitive-Search">Cognitive Search (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Knowledge-Base">Knowledge Base (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ITIL">ITIL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IT">IT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Github">Github (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Liquid">Liquid (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Markdown">Markdown (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 Dalong's personal blog 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="#">Designed</a> by Dalong.work
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>

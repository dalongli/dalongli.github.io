<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Django In Action | Dalong's personal blog</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Django In Action | Dalong’s personal blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Django In Action" />
<meta name="author" content="Dalong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Django 是一个免费的开源 Python 框架，旨在消除后端编程中的麻烦和麻烦。有了它，开发人员可以快速创建复杂、安全和可扩展的应用程序。每个欣赏效率和干净代码的后端或全栈编码人员都可以从他们的工具箱中拥有 Django 中受益。本文我将带领大家从头开始了解 Django 的环境安装以及实现一些令人兴奋的基本功能." />
<meta property="og:description" content="Django 是一个免费的开源 Python 框架，旨在消除后端编程中的麻烦和麻烦。有了它，开发人员可以快速创建复杂、安全和可扩展的应用程序。每个欣赏效率和干净代码的后端或全栈编码人员都可以从他们的工具箱中拥有 Django 中受益。本文我将带领大家从头开始了解 Django 的环境安装以及实现一些令人兴奋的基本功能." />
<link rel="canonical" href="http://localhost:4000/Django-In-Action/" />
<meta property="og:url" content="http://localhost:4000/Django-In-Action/" />
<meta property="og:site_name" content="Dalong’s personal blog" />
<meta property="og:image" content="http://localhost:4000/assets/images/django.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-10T00:00:00+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Django In Action","dateModified":"2020-05-10T00:00:00+08:00","datePublished":"2020-05-10T00:00:00+08:00","description":"Django 是一个免费的开源 Python 框架，旨在消除后端编程中的麻烦和麻烦。有了它，开发人员可以快速创建复杂、安全和可扩展的应用程序。每个欣赏效率和干净代码的后端或全栈编码人员都可以从他们的工具箱中拥有 Django 中受益。本文我将带领大家从头开始了解 Django 的环境安装以及实现一些令人兴奋的基本功能.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Dalong"},"image":"http://localhost:4000/assets/images/django.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Django-In-Action/"},"url":"http://localhost:4000/Django-In-Action/","author":{"@type":"Person","name":"Dalong"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Carter+One&display=swap" rel="stylesheet">
    </noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Dalong's personal blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

<!-- 以后再加上相关链接

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>
-->
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/dalongli"><i class="fab fa-github"></i> Fork on Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Dalong's personal blog</h1>
    <p class="lead">
        Record the bits and pieces of the technology big bang.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Django In Action&url=http://localhost:4000/Django-In-Action/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/Django-In-Action/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/Django-In-Action/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/avatar_dl.png" alt="Dalong">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://dalongli.github.io/about">Dalong</a><a target="_blank" href="https://dalongli.github.io." class="btn follow">Follow</a>
                        <span class="author-description">A profesional technical consultant and blogger.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Django In Action</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/django.jpg" alt="Django In Action">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <h3 class="font-weight-bold">Summary</h3>
                        <ul>
  <li><a href="#django">Django</a>
    <ul>
      <li><a href="#django-介绍">Django 介绍</a>
        <ul>
          <li><a href="#pycharm-针对-django-技巧">Pycharm 针对 Django 技巧</a></li>
          <li><a href="#django-的安装">Django 的安装</a></li>
        </ul>
      </li>
      <li><a href="#django-基本命令">django 基本命令</a>
        <ul>
          <li><a href="#创建项目-django-admin-startproject-项目名">创建项目 <code class="language-plaintext highlighter-rouge">django-admin startproject 项目名</code></a></li>
          <li><a href="#创建项目中的应用-django-admin-startapp-应用名">创建项目中的应用 <code class="language-plaintext highlighter-rouge">django-admin startapp 应用名</code></a></li>
          <li><a href="#启动-web-服务-python37-managepy-runserver-端口">启动 web 服务 <code class="language-plaintext highlighter-rouge">python3.7 manage.py runserver [端口]</code></a></li>
          <li><a href="#迁移创建数据库-python37-managepy-makemigrations--python37-managepy-migrate">迁移(创建)数据库 <code class="language-plaintext highlighter-rouge">python3.7 manage.py makemigrations</code>  <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></a></li>
          <li><a href="#创建超级用户--python37-managepy-createsuperuser-并进入管理界面">创建超级用户 : <code class="language-plaintext highlighter-rouge">python3.7 manage.py createsuperuser</code> 并进入管理界面</a></li>
          <li><a href="#清空数据-python37-managepy-flush">清空数据 <code class="language-plaintext highlighter-rouge">python3.7 manage.py flush</code></a></li>
          <li><a href="#将数据库数据导出到文件中-python37-managepy-dumpdata-应用名--应用名json">将数据库数据导出到文件中 <code class="language-plaintext highlighter-rouge">python3.7 manage.py dumpdata 应用名 &gt; 应用名.json</code></a></li>
          <li><a href="#将-json-数据导入到应用中-python37-managepy-loaddata-应用名json">将 json 数据导入到应用中 <code class="language-plaintext highlighter-rouge">python3.7 manage.py loaddata 应用名.json</code></a></li>
          <li><a href="#进入项目的-terminal-shell终端-python37-managepy-shell">进入项目的 Terminal shell终端 <code class="language-plaintext highlighter-rouge">python3.7 manage.py shell</code></a></li>
          <li><a href="#进入项目的数据库-terminal-shell-终端-python37-managepy-dbshell">进入项目的数据库 Terminal shell 终端 <code class="language-plaintext highlighter-rouge">python3.7 manage.py dbshell</code></a></li>
        </ul>
      </li>
      <li><a href="#django项目中的常见文件">django项目中的常见文件</a>
        <ul>
          <li><a href="#网址入口-urlspy">网址入口 <code class="language-plaintext highlighter-rouge">urls.py</code></a></li>
          <li><a href="#视图文件-viewspy">视图文件 <code class="language-plaintext highlighter-rouge">views.py</code></a></li>
          <li><a href="#数据管理文件-modelspy">数据管理文件 <code class="language-plaintext highlighter-rouge">models.py</code></a></li>
          <li><a href="#表单处理文件-formspy">表单处理文件 <code class="language-plaintext highlighter-rouge">forms.py</code></a></li>
          <li><a href="#模板目录-templates">模板目录 <code class="language-plaintext highlighter-rouge">templates/</code></a></li>
          <li><a href="#后台入口-adminpy">后台入口 <code class="language-plaintext highlighter-rouge">admin.py</code></a></li>
          <li><a href="#配置文件-settingspy">配置文件 <code class="language-plaintext highlighter-rouge">settings.py</code></a></li>
        </ul>
      </li>
      <li><a href="#创建一个-django-项目-django-admin-startproject-mysite">创建一个 django 项目 <code class="language-plaintext highlighter-rouge">django-admin startproject mysite</code></a>
        <ul>
          <li><a href="#在项目中创建应用---python37-managepy-startapp-polls">在项目中创建应用   <code class="language-plaintext highlighter-rouge">python3.7 manage.py startapp polls</code></a></li>
          <li><a href="#1-修改项目路由-mysitemysiteurlspy">(1) 修改项目路由 <em>mysite/mysite/urls.py</em></a></li>
          <li><a href="#2-创建应用路由--mysitepollsurlspy">(2) 创建应用路由.  <em>mysite/polls/urls.py</em></a></li>
          <li><a href="#3-修改应用-views-文件-pollsviewspy">(3) 修改应用 views 文件: <em>polls/views.py</em></a></li>
          <li><a href="#运行项目-访问应用--python37-managepy-runserver">运行项目, 访问应用  <code class="language-plaintext highlighter-rouge">python3.7 manage.py runserver</code></a></li>
        </ul>
      </li>
      <li><a href="#处理url-中带的参数">处理URL 中带的参数</a>
        <ul>
          <li><a href="#获取-get-参数-a1b2">获取 GET 参数 <code class="language-plaintext highlighter-rouge">?a=1&amp;b=2</code></a></li>
          <li><a href="#获取-路径中的参数-add34">获取 路径中的参数 <code class="language-plaintext highlighter-rouge">add/3/4</code></a></li>
        </ul>
      </li>
      <li><a href="#生成url--url--和-reverse">生成URL <code class="language-plaintext highlighter-rouge">{% url %} 和 reverse</code></a>
        <ul>
          <li><a href="#通过--url--我们可以按照-urlspy-中定义的规则来反向生成-url">通过 <code class="language-plaintext highlighter-rouge">{% url %}</code> 我们可以按照 urls.py 中定义的规则来反向生成 url</a></li>
          <li><a href="#通过-reverse-反向生成-路径">通过 <code class="language-plaintext highlighter-rouge">reverse</code> 反向生成 路径</a></li>
        </ul>
      </li>
      <li><a href="#为-django-连接-mysql-并初始化数据库">为 django 连接 mysql 并初始化数据库</a>
        <ul>
          <li><a href="#1启动-mysql-服务-并在-mysql-中创建一个django-用的数据库">(1)启动 mysql 服务, 并在 mysql 中创建一个django 用的数据库</a></li>
          <li><a href="#2mysitemysitesettingpy-文件中设置数据库配置信息">(2)<code class="language-plaintext highlighter-rouge">mysite/mysite/setting.py</code> 文件中设置数据库配置信息</a></li>
          <li><a href="#3mysitemysite__init__py-导入-pymysql-模块">(3)<code class="language-plaintext highlighter-rouge">mysite/mysite/__init__.py</code> 导入 pymysql 模块</a></li>
          <li><a href="#4为-django-做数据库初始化-python37-managepy-migrate">(4)为 django 做数据库初始化 <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></a></li>
        </ul>
      </li>
      <li><a href="#建模-modelspy-数据模型">建模 models.py 数据模型.</a>
        <ul>
          <li><a href="#1在应用名modelspy-文件中创建数据模型">(1)在<code class="language-plaintext highlighter-rouge">应用名/models.py</code> 文件中创建数据模型</a></li>
          <li><a href="#2将应用添加到-mysitemysitesettingpy-文件中">(2)将应用添加到 <code class="language-plaintext highlighter-rouge">mysite/mysite/setting.py</code> 文件中</a></li>
          <li><a href="#3将应用的数据模型转化为迁移文件-python37-managepy-makemigrations">(3)将应用的数据模型转化为迁移文件 <code class="language-plaintext highlighter-rouge">python3.7 manage.py makemigrations</code></a></li>
          <li><a href="#运行命令-生成-sql语句-python37-managepy-sqlmigrate-polls-0001"><em>运行命令, 生成 SQL语句</em> <code class="language-plaintext highlighter-rouge">python3.7 manage.py sqlmigrate polls 0001</code></a></li>
          <li><a href="#4再次初始化数据库-python37-managepy-migrate">(4)再次初始化数据库 <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></a></li>
          <li><a href="#在django-shell-中尝试查询数据">在django shell 中尝试查询数据</a></li>
          <li><a href="#在管理后台管理新建的表对象-pollsadminpy">在管理后台管理新建的表对象 <code class="language-plaintext highlighter-rouge">polls/admin.py</code></a></li>
          <li><a href="#外键关联-反向关联--modelsforeignkeyquestion-on_deletemodelscascade">外键关联, 反向关联,  <code class="language-plaintext highlighter-rouge">models.ForeignKey(Question, on_delete=models.CASCADE)</code></a></li>
        </ul>
      </li>
      <li><a href="#创建模板文件">创建模板文件</a></li>
      <li><a href="#修改debug-模式">修改debug 模式</a></li>
      <li><a href="#自定义的报错信息页面">自定义的报错信息页面</a></li>
      <li><a href="#命名空间">命名空间</a></li>
      <li><a href="#创建form-表单-和-处理表单-templatespollsdetailhtml">创建form 表单 和 处理表单 <code class="language-plaintext highlighter-rouge">templates/polls/detail.html</code></a></li>
      <li><a href="#代码重构---让投票app-面向对象">代码重构 - 让投票app 面向对象</a></li>
      <li><a href="#优化样式">优化样式</a></li>
      <li><a href="#后台管理界面的定制化">后台管理界面的定制化</a></li>
      <li><a href="#测试驱动开发---自动化测试">测试驱动开发 - 自动化测试.</a>
        <ul>
          <li><a href="#测试目标-针对-modelspy-进行测试">测试目标: <em>针对 models.py 进行测试</em></a></li>
          <li><a href="#创建测试步骤">创建测试步骤:</a></li>
          <li><a href="#一些常用断言">一些常用断言</a></li>
          <li><a href="#django-命令行-进行测试">django 命令行 进行测试</a></li>
          <li><a href="#测试目标-针对-viewspy-进行测试">测试目标: <em>针对 views.py 进行测试</em></a></li>
        </ul>
      </li>
      <li><a href="#为网站创建首页">为网站创建首页</a></li>
      <li><a href="#简单登录和登出">简单登录和登出</a></li>
      <li><a href="#需求分析">需求分析</a></li>
      <li><a href="#建模">建模</a></li>
      <li><a href="#视图-viewspy">视图 views.py</a></li>
      <li><a href="#urlspy-创建">URLs.py 创建</a></li>
      <li><a href="#模板">模板</a>
        <ul>
          <li><a href="#创建一个基础模板-basehtml-用于被其他继承"><em>创建一个基础模板 base.html, 用于被其他继承</em></a></li>
          <li><a href="#创建首页模板-继承-templatesblogbasehtml"><em>创建首页模板, 继承 templates/blog/base.html</em></a></li>
          <li><a href="#在-detail-页-为blog-添加-markdown-功能">在 detail 页 为Blog 添加 Markdown 功能</a></li>
        </ul>
      </li>
      <li><a href="#创建自定义标签">创建自定义标签</a></li>
      <li><a href="#django实现登录注册">Django实现登录、注册</a></li>
      <li><a href="#django-表单类-的使用--博客评论功能重构">Django 表单类 的使用 – 博客评论功能重构</a></li>
      <li><a href="#分页功能-blogviewspy">分页功能 blog/views.py</a></li>
      <li><a href="#简单搜索功能">简单搜索功能</a></li>
      <li><a href="#实现高级搜索-whoosh-django-haystack">实现高级搜索 whoosh django-haystack</a></li>
      <li><a href="#数据模型-modelspy-高级用法-class-meta-def-save">数据模型 models.py 高级用法 <code class="language-plaintext highlighter-rouge">class Meta; def save()</code></a></li>
      <li><a href="#面向对象-viewspy-传递多个上下文参数给模板">面向对象 views.py 传递多个上下文参数给模板</a></li>
      <li><a href="#对数据进行统计过滤--aggregates--annotate">对数据进行统计过滤  <code class="language-plaintext highlighter-rouge">aggregates</code>  <code class="language-plaintext highlighter-rouge">annotate</code></a></li>
    </ul>
  </li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>Django 是一个免费的开源 Python 框架，旨在消除后端编程中的麻烦和麻烦。有了它，开发人员可以快速创建复杂、安全和可扩展的应用程序。每个欣赏效率和干净代码的后端或全栈编码人员都可以从他们的工具箱中拥有 Django 中受益。本文我将带领大家从头开始了解 Django 的环境安装以及实现一些令人兴奋的基本功能.</p>

<h1 id="django">Django</h1>

<h2 id="django-介绍">Django 介绍</h2>

<p><a href="http://python.usyiyi.cn/translate/Django_111/index.html">Django 1.11 中文文档</a>
<a href="https://www.djangoproject.com">Django 官网</a></p>

<h3 id="pycharm-针对-django-技巧">Pycharm 针对 Django 技巧</h3>

<table>
  <thead>
    <tr>
      <th>快捷键</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>option + fn + f12</td>
      <td>打开/关闭 终端</td>
    </tr>
    <tr>
      <td>cmd + 1</td>
      <td>开启 project 侧边栏</td>
    </tr>
    <tr>
      <td>control(+option) + r</td>
      <td>运行项目</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="django-的安装">Django 的安装</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>pip3.7 install <span class="nv">Django</span><span class="o">==</span>2.0
<span class="c"># pip3.7 install Django==1.10.6q</span>
python3.7 -m django --version   <span class="c"># 查看版本</span>
print<span class="o">(</span>django.get_version<span class="o">())</span>		<span class="c"># 查看版本</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>查看安装的 django 有哪些 package</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">django</span>

<span class="n">help</span><span class="p">(</span><span class="n">django</span><span class="p">)</span>

<span class="n">PACKAGE</span> <span class="n">CONTENTS</span>
    <span class="n">__main__</span>
    <span class="n">apps</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">conf</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">contrib</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">core</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">db</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">dispatch</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">forms</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">http</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">middleware</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">shortcuts</span>
    <span class="n">template</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">templatetags</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">test</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">urls</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">utils</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
    <span class="n">views</span> <span class="p">(</span><span class="n">package</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="django-基本命令">django 基本命令</h2>

<p>查看 django 所有命令.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="创建项目-django-admin-startproject-项目名">创建项目 <code class="language-plaintext highlighter-rouge">django-admin startproject 项目名</code></h3>

<p>新建一个 django 项目:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>django-admin startproject 项目名
</pre></td></tr></tbody></table>
</div>
</div>

<p>生成目录如下:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>/mysite
	manage.py
	/mysite
		__init__.py
		settings.py  <span class="c"># 配置文件</span>
		urls.py		 <span class="c"># 设置路由</span>
		wsgi.py

</pre></td></tr></tbody></table>
</div>
</div>

<p>界面改成中文mysite/mysite/settings.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">'zh-Hans'</span>
<span class="c"># LANGUAGE_CODE = 'en-us'</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>时间改成中国时间</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="c">#TIME_ZONE = 'UTC'</span>
<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">'Asia/Shanghai'</span>
<span class="n">USE_TZ</span> <span class="o">=</span> <span class="bp">False</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="创建项目中的应用-django-admin-startapp-应用名">创建项目中的应用 <code class="language-plaintext highlighter-rouge">django-admin startapp 应用名</code></h3>

<p>一个应用</p>

<ul>
  <li>比如一个电商网站项目的用户管理算是一个应用</li>
  <li>一个项目中可以有多个应用, 当然, 通用的 app 也可以在多个项目中出现</li>
</ul>

<p>新建一个应用</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>django-admin startapp 应用名
<span class="c"># 或者</span>
python manage.py startapp 应用名
</pre></td></tr></tbody></table>
</div>
</div>

<p>目录结构</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>/polls
	/migrations
	__init__.py
	admin.py
	apps.py
	models.py
	tests.py
	views.py
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="启动-web-服务-python37-managepy-runserver-端口">启动 web 服务 <code class="language-plaintext highlighter-rouge">python3.7 manage.py runserver [端口]</code></h3>

<p>启动开发服务器</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python manage.py runserver <span class="o">[</span>端口]
</pre></td></tr></tbody></table>
</div>
</div>

<p>当服务器端口被其他端口占用时, 端口号可以自定义</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py runserver 8001
</pre></td></tr></tbody></table>
</div>
</div>

<p>让外网,局域网可访问的服务</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py runserver 0.0.0.0:8002
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="迁移创建数据库-python37-managepy-makemigrations--python37-managepy-migrate">迁移(创建)数据库 <code class="language-plaintext highlighter-rouge">python3.7 manage.py makemigrations</code>  <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></h3>

<p>同步数据库</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>python3.7 manage.py makemigrations
python3.7 manage.py migrate
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>
    <p>命令成功后, 在项目目录下就可以看到一个 db.sqlite3</p>
  </li>
  <li>python manage.py makemigrations</li>
  <li>当你在 models.py 中创建了数据类, 改动数据模型时, 运行这个命令就可以自动在数据库中创建表和修改表了.</li>
</ul>

<h3 id="创建超级用户--python37-managepy-createsuperuser-并进入管理界面">创建超级用户 : <code class="language-plaintext highlighter-rouge">python3.7 manage.py createsuperuser</code> 并进入管理界面</h3>

<p>创建用户名, 邮件, 密码</p>

<p>用户名 root</p>

<p>邮箱 37016175@qq.com</p>

<p>密码 @moyu<em>**</em>NI</p>

<p>输入完成后, 启动服务, 然后再进入下面URL 进入后台管理界面</p>

<p>http://127.0.0.1:8000/admin/login/</p>

<p>在 pycharm 中的数据表视图中可以看到 auth_user 表中多了一个记录.</p>

<h3 id="清空数据-python37-managepy-flush">清空数据 <code class="language-plaintext highlighter-rouge">python3.7 manage.py flush</code></h3>

<ul>
  <li>命令会提示 yes/no.  如果选择 yes, 将清空表中的所有数据, 只留下空表.</li>
</ul>

<h3 id="将数据库数据导出到文件中-python37-managepy-dumpdata-应用名--应用名json">将数据库数据导出到文件中 <code class="language-plaintext highlighter-rouge">python3.7 manage.py dumpdata 应用名 &gt; 应用名.json</code></h3>

<ul>
  <li>导出数据到 json 文件</li>
</ul>

<h3 id="将-json-数据导入到应用中-python37-managepy-loaddata-应用名json">将 json 数据导入到应用中 <code class="language-plaintext highlighter-rouge">python3.7 manage.py loaddata 应用名.json</code></h3>

<ul>
  <li>将 json 数据导入到应用中</li>
</ul>

<h3 id="进入项目的-terminal-shell终端-python37-managepy-shell">进入项目的 Terminal shell终端 <code class="language-plaintext highlighter-rouge">python3.7 manage.py shell</code></h3>

<ul>
  <li>进入项目的 Terminal shell终端</li>
  <li>我们使用上述命令而不是简单地键入“python”进入python环境，是因为<code class="language-plaintext highlighter-rouge">manage.py</code> 设置了<code class="language-plaintext highlighter-rouge">DJANGO_SETTINGS_MODULE</code> 环境变量，该环境变量告诉Django导入<code class="language-plaintext highlighter-rouge">mysite/settings.py</code>文件的路径。</li>
</ul>

<h3 id="进入项目的数据库-terminal-shell-终端-python37-managepy-dbshell">进入项目的数据库 Terminal shell 终端 <code class="language-plaintext highlighter-rouge">python3.7 manage.py dbshell</code></h3>

<ul>
  <li>进入项目的数据库 Terminal shell 终端</li>
</ul>

<h2 id="django项目中的常见文件">django项目中的常见文件</h2>

<h3 id="网址入口-urlspy">网址入口 <code class="language-plaintext highlighter-rouge">urls.py</code></h3>

<ul>
  <li>网址入口, 对应到 views.py中的一个函数.</li>
</ul>

<h3 id="视图文件-viewspy">视图文件 <code class="language-plaintext highlighter-rouge">views.py</code></h3>

<ul>
  <li>响应用户发出的请求. 请求的数据是来自 urls.py 的.</li>
  <li>通过渲染 templates中的网页可以将内容显示.</li>
</ul>

<h3 id="数据管理文件-modelspy">数据管理文件 <code class="language-plaintext highlighter-rouge">models.py</code></h3>

<ul>
  <li>与数据库相操作相关的文件. 存取数据时用到. 如果不用数据库就可以不用这个文件.</li>
</ul>

<h3 id="表单处理文件-formspy">表单处理文件 <code class="language-plaintext highlighter-rouge">forms.py</code></h3>

<ul>
  <li>表单. 输入框生成, 用户的输入数据提交, 验证数据等工作.</li>
</ul>

<h3 id="模板目录-templates">模板目录 <code class="language-plaintext highlighter-rouge">templates/</code></h3>

<ul>
  <li>views.py 中的函数用来渲染 templates 中的 html 模板, 得到最终的网页.</li>
</ul>

<h3 id="后台入口-adminpy">后台入口 <code class="language-plaintext highlighter-rouge">admin.py</code></h3>

<ul>
  <li>后台, 可以用少量代码得到强大的后台.</li>
</ul>

<h3 id="配置文件-settingspy">配置文件 <code class="language-plaintext highlighter-rouge">settings.py</code></h3>

<ul>
  <li>Django 的配置文件. 比如 debug 开关, 静态文件位置等.</li>
</ul>

<h2 id="创建一个-django-项目-django-admin-startproject-mysite">创建一个 django 项目 <code class="language-plaintext highlighter-rouge">django-admin startproject mysite</code></h2>

<p>概念: 一个项目会有多个应用. 一个应用也可以被多个项目使用.</p>

<p>将会在你的当前目录下生成一个 <code class="language-plaintext highlighter-rouge">mysite</code> 目录</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>cd /Users/dalong/code/python1702/dj
django-admin startproject mysite
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>生成目录如下</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>mysite 	   <span class="c"># 根目录仅仅是项目的一个容器。 它的名字与Django无关；可以将其重命名为你喜欢的任何内容。</span>
	manage.py     <span class="c"># 一个命令行工具，可以使你用多种方式对Django项目进行交互。</span>
	mysite/    	  <span class="c"># 你的项目的真正的Python包。 它是你导入任何东西时将需要使用的Python包的名字</span>
		__init__.py   <span class="c"># 一个空文件，它告诉Python这个目录应该被看做一个Python包。</span>
		settings.py   <span class="c"># 该Django 项目的设置/配置</span>
		urls.py       <span class="c"># 此Django项目的URL声明；Django驱动的网站的路由。</span>
		wsgi.py       <span class="c"># 用于你的项目的与WSGI兼容的Web服务器入口。</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="在项目中创建应用---python37-managepy-startapp-polls">在项目中创建应用   <code class="language-plaintext highlighter-rouge">python3.7 manage.py startapp polls</code></h3>

<p>应用是一个Web应用程序，它完成具体的事项 —— 比如一个博客系统、一个存储公共档案的数据库或者一个简单的投票应用。 一个项目是特定网站的配置和应用程序的集合。 一个项目可以包含多个应用。 一个应用可以运用到多个项目中去。</p>

<p><em>创建一个叫 <code class="language-plaintext highlighter-rouge">polls</code> 的应用</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="nb">cd</span> /Users/dalong/code/python1702/dj/mysite/
python3.7 manage.py startapp polls
</pre></td></tr></tbody></table>
</div>
</div>

<p><strong>生成目录如下:</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>polls/  <span class="c"># </span>
    __init__.py
    admin.py
    apps.py
    migrations/
    models.py
    tests.py
    views.py
</pre></td></tr></tbody></table>
</div>
</div>

<p>应用创建成功后分三个步骤修改</p>

<ol>
  <li>修改项目路径(路由): 应用名</li>
  <li>创建应用路径(路由)</li>
  <li>修改应用 views 文件</li>
</ol>

<h3 id="1-修改项目路由-mysitemysiteurlspy">(1) 修改项目路由 <em>mysite/mysite/urls.py</em></h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>  <span class="c"># 1 </span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^polls/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'polls.urls'</span><span class="p">)),</span> <span class="c"># 2 </span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^admin/'</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)</span> <span class="c"># 1</span>
<span class="p">]</span>

<span class="c"># 1.  include 用于处理路由的模块.当你要包含其他URL模式时，应始终使用include()。 admin.site.urls是唯一的例外。</span>
<span class="c"># 2. 一旦匹配到以 "polls/"开头的路径,就对应到 polls文件夹中的 urls.py 文件</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="2-创建应用路由--mysitepollsurlspy">(2) 创建应用路由.  <em>mysite/polls/urls.py</em></h3>

<p>在生成的应用目录下创建一个 urls.py 的文件</p>

<ul>
  <li>此处的 name=’index’ 是定义了一个命名空间</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span>  <span class="c"># 如果本层的路径为空,那么就进入 views.py 中的 index 方法</span>
<span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="3-修改应用-views-文件-pollsviewspy">(3) 修改应用 views 文件: <em>polls/views.py</em></h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>  <span class="c"># index 这里指的就是路由定义的 index 方法</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"Hello, world. You're at the polls index."</span><span class="p">)</span> <span class="c"># 定义相应信息</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>引入 HttpResponse 模块, 他是用来向网页返回内容的. 就像 print 一样,只不过是返回到网页上.</li>
  <li>index 函数的第一个参数必须是 request. 包含了网页发过来的请求数据. 可以包含 GET 或 POST 的数据内容.</li>
</ul>

<h3 id="运行项目-访问应用--python37-managepy-runserver">运行项目, 访问应用  <code class="language-plaintext highlighter-rouge">python3.7 manage.py runserver</code></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="nb">cd</span> /Users/dalong/code/python1702/dj/mysite/

python3.7 manage.py runserver

<span class="c">#会有下面的信息展示出来. 其中 http://127.0.0.1:8000/ 就是服务地址</span>
December 23, 2017 - 15:27:45
Django version 2.0, using settings <span class="s1">'mysite.settings'</span>
Starting development server at http://127.0.0.1:8000/
</pre></td></tr></tbody></table>
</div>
</div>

<p>如果看到有 url 地址出来,就说明启动成功了, 用你的浏览器访问 <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>。</p>

<p>请注意：</p>

<ul>
  <li>
    <p><strong>不要</strong>在任何生产环境使用这个服务器。 它仅仅是用于在开发中使用。 （我们的重点是编写Web框架，非Web服务器。）</p>
  </li>
  <li>
    <p>更改端口:  可以自定义端口号</p>

    <ul>
      <li>
        <div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py runserver 8080
</pre></td></tr></tbody></table>
</div>
        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>自动重载</p>

    <ul>
      <li>开发服务器会根据需要自动重新载入Python代码。 你不必为了使更改的代码生效而重启服务器。 然而，一些行为比如添加文件，不会触发服务器的重启，所以在这种情况下你需要手动重启服务器。</li>
    </ul>
  </li>
</ul>

<p>访问应用:</p>

<ul>
  <li><a href="http://127.0.0.1:8000/polls/">http://127.0.0.1:8000/polls/</a></li>
  <li><a href="http://127.0.0.1:8000/learn/">http://127.0.0.1:8000/learn/</a></li>
</ul>

<h2 id="处理url-中带的参数">处理URL 中带的参数</h2>

<h3 id="获取-get-参数-a1b2">获取 GET 参数 <code class="language-plaintext highlighter-rouge">?a=1&amp;b=2</code></h3>

<p>在 views.py 中定义方法</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="c"># 测试获取url 中的 参数, 比如 http://127.0.0.1:8000/blog/add/?a=1&amp;b=2</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'a'</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'b'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>设置urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^add/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'add'</span><span class="p">),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="获取-路径中的参数-add34">获取 路径中的参数 <code class="language-plaintext highlighter-rouge">add/3/4</code></h3>

<p>在 views.py中定义方法</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>    <span class="c"># 获取url 中的数字路径参数进行加法运算 http://127.0.0.1:8000/blog/add2/10/10/</span>
<span class="k">def</span> <span class="nf">add2</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>// 设置urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^add2/(?P&lt;a&gt;</span><span class="err">\</span><span class="s">d+)/(?P&lt;b&gt;</span><span class="err">\</span><span class="s">d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'add2'</span><span class="p">),</span>
<span class="c"># 也可以不为传递的变量定义名称, 这样就是按照顺序在 view中赋值</span>
<span class="c">#url(r'^add2/(\d+)/(\d+)/$', views.add2, name='add2'),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="生成url--url--和-reverse">生成URL <code class="language-plaintext highlighter-rouge">{% url %} 和 reverse</code></h2>

<h3 id="通过--url--我们可以按照-urlspy-中定义的规则来反向生成-url">通过 <code class="language-plaintext highlighter-rouge">{% url %}</code> 我们可以按照 urls.py 中定义的规则来反向生成 url</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:add2' 4 5 %}"</span><span class="nt">&gt;</span>{% url 'blog:add2' 4 5 %}<span class="nt">&lt;/a&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>会生成如下代码</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/blog/add2/4/5/"</span><span class="nt">&gt;</span>/blog/add2/4/5/<span class="nt">&lt;/a&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="通过-reverse-反向生成-路径">通过 <code class="language-plaintext highlighter-rouge">reverse</code> 反向生成 路径</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">reverse</span><span class="p">(</span><span class="n">viewname</span><span class="o">=</span><span class="s">'blog:add2'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="s">'/blog/add2/4/5/'</span>
<span class="o">&gt;&gt;&gt;</span> 
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="为-django-连接-mysql-并初始化数据库">为 django 连接 mysql 并初始化数据库</h2>

<p>需要几个步骤如下:</p>

<ol>
  <li>启动 mysql 服务, 并在 mysql 中创建一个django 用的数据库</li>
  <li><code class="language-plaintext highlighter-rouge">项目名/项目名/setting.py</code> 文件中设置数据库配置信息, 同时设置 <code class="language-plaintext highlighter-rouge">TIME_ZONE</code></li>
  <li><code class="language-plaintext highlighter-rouge">项目名/项目名/__init__.py</code> 导入 pymysql 模块</li>
  <li>为 django 做数据库初始化 <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></li>
</ol>

<h3 id="1启动-mysql-服务-并在-mysql-中创建一个django-用的数据库">(1)启动 mysql 服务, 并在 mysql 中创建一个django 用的数据库</h3>

<pre><code class="language-mysql">create database py1702dj charset utf8;
</code></pre>

<h3 id="2mysitemysitesettingpy-文件中设置数据库配置信息">(2)<code class="language-plaintext highlighter-rouge">mysite/mysite/setting.py</code> 文件中设置数据库配置信息</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'django.db.backends.mysql'</span><span class="p">,</span>
        <span class="s">'NAME'</span><span class="p">:</span> <span class="s">'py1702dj'</span><span class="p">,</span>
        <span class="s">'USER'</span><span class="p">:</span> <span class="s">'root'</span><span class="p">,</span>
        <span class="s">'PASSWORD'</span><span class="p">:</span> <span class="s">'xxxxxx'</span><span class="p">,</span>
        <span class="s">'HOST'</span><span class="p">:</span> <span class="s">'/Applications/XAMPP/xamppfiles/var/mysql/mysql.sock'</span><span class="p">,</span>  
        <span class="s">'CHARSET'</span><span class="p">:</span> <span class="s">'utf8'</span><span class="p">,</span>
        <span class="s">'PORT'</span><span class="p">:</span> <span class="s">'3308'</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">'Asia/Shanghai'</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="3mysitemysite__init__py-导入-pymysql-模块">(3)<code class="language-plaintext highlighter-rouge">mysite/mysite/__init__.py</code> 导入 pymysql 模块</h3>

<ul>
  <li>用 sqlite的的跳过这一步</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="4为-django-做数据库初始化-python37-managepy-migrate">(4)为 django 做数据库初始化 <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></h3>

<p>初始化命令是根据以下两点决定如何进行初始化的..</p>

<ul>
  <li>在setting 中读取数据库设置(<code class="language-plaintext highlighter-rouge">DATABASES={}</code>),</li>
  <li>以及 setting 中的应用列表(<code class="language-plaintext highlighter-rouge">INSTALLED_APPS=[]</code>)中了解到要对哪些 app 做数据库初始化.</li>
</ul>

<p>进入到 项目第一层目录中运行命令 <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></p>

<ul>
  <li>
    <p>命令行会输出一堆信息</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>Operations to perform:

  Apply all migrations: admin, auth, contenttypes, sessions

Running migrations:

  Applying contenttypes.0001_initial... OK
  .....
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>进入 mysql 的 py2017dj 会看到一堆新的表, 这些表就是<code class="language-plaintext highlighter-rouge">INSTALLED_APPS=[]</code> 中的 app 需要用到的表.</p>

    <ul>
      <li>auth_group</li>
      <li>auth_group_permissions</li>
      <li>auth_permission</li>
      <li>auth_user</li>
      <li>auth_user_groups</li>
      <li>auth_user_user_permissions</li>
      <li>django_admin_log</li>
      <li>django_content_type</li>
      <li>django_migrations</li>
      <li>django_session</li>
    </ul>
  </li>
</ul>

<h2 id="建模-modelspy-数据模型">建模 models.py 数据模型.</h2>

<p><a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/">QuerySet 查询数据库相关的操作手册</a></p>

<p>创建数据模型需要如下步骤</p>

<ol>
  <li>在<code class="language-plaintext highlighter-rouge">应用名/models.py</code> 文件中创建数据模型</li>
  <li>将应用添加到 <code class="language-plaintext highlighter-rouge">项目名/项目名/setting.py</code> 文件中</li>
  <li>将应用的数据模型转化为迁移文件 <code class="language-plaintext highlighter-rouge">python manage.py makemigrations polls</code></li>
  <li>再次初始化数据库 <code class="language-plaintext highlighter-rouge">python manage.py migrate</code></li>
</ol>

<h3 id="1在应用名modelspy-文件中创建数据模型">(1)在<code class="language-plaintext highlighter-rouge">应用名/models.py</code> 文件中创建数据模型</h3>

<ul>
  <li>每个类名对应一个表名</li>
  <li>类中的每个属性对应一个字段</li>
  <li>某些字段类型需要必选参数, 比如 max_length 等.</li>
  <li>一个字段可以同时有多个参数</li>
  <li>任何对models.py 文件的更改最好要做一次迁移.</li>
  <li>字段默认是必填项(Not Null), 设置 <code class="language-plaintext highlighter-rouge">blank=True, null=True</code> 可以让字段变成非必填项
    <ul>
      <li><code class="language-plaintext highlighter-rouge">blank=True</code> 是前端输入限制, blank=True 就是管理后台插入数据时,该字段可以什么都不输入. 插入后该字段的数据就是 <code class="language-plaintext highlighter-rouge">''</code></li>
      <li><code class="language-plaintext highlighter-rouge">null=True</code> 是数据库操作限制, null=True 就是在数据库中操作插入数据时,可以不给该字段指定数据. 插入后该字段的数据是 <code class="language-plaintext highlighter-rouge">Null</code></li>
      <li>一般都是 blank 和 null 一起用 <code class="language-plaintext highlighter-rouge">blank=True, null=True</code></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="c"># Create your models here.</span>


<span class="k">class</span> <span class="nc">Question</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c"># 字段默认是不能为空, 设置 blank=True, null=True 可以让字段变成非必填项</span>
    <span class="c"># question_text = models.CharField(max_length=200, null=True, blank=True)</span>
    <span class="n">question_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>  
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="s">'date published'</span><span class="p">)</span>
	
    <span class="c"># 定义一个类, 让生成的对象可以看到内容</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">question_text</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span><span class="p">)</span>
	
    <span class="c"># 定义一个方法, 让返回的对象可以调用该方法查看是否是这个问题是在24小时内创建的</span>
    <span class="k">def</span> <span class="nf">was_registered_in24hours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> 
    	<span class="c"># return self.pub_date &gt;= (timezone.now() - datetime.timedelta(days=1)) and (self.pub_date &lt;= timezone.now())</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>定义字段的可选参数如下:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">max_length</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">db_index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">NOT_PROVIDED</span><span class="p">,</span> <span class="n">editable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">serialize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">unique_for_date</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">unique_for_month</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">unique_for_year</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">db_column</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">db_tablespace</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">auto_created</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">(),</span>
             <span class="n">error_messages</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="2将应用添加到-mysitemysitesettingpy-文件中">(2)将应用添加到 <code class="language-plaintext highlighter-rouge">mysite/mysite/setting.py</code> 文件中</h3>

<p>将新建的站点追加到 <code class="language-plaintext highlighter-rouge">INSTALLED_APPS</code> 数组中</p>

<p>注意:</p>

<ul>
  <li>如果不添加, 那么就无法看到最终的模板</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">'django.contrib.admin'</span><span class="p">,</span>         <span class="c"># 管理站点。 你会很快使用它。</span>
    <span class="s">'django.contrib.auth'</span><span class="p">,</span>          <span class="c"># 认证系统。</span>
    <span class="s">'django.contrib.contenttypes'</span><span class="p">,</span>  <span class="c"># 用于内容类型的框架。</span>
    <span class="s">'django.contrib.sessions'</span><span class="p">,</span>      <span class="c"># 会话框架。</span>
    <span class="s">'django.contrib.messages'</span><span class="p">,</span>      <span class="c"># 消息框架。</span>
    <span class="s">'django.contrib.staticfiles'</span><span class="p">,</span>   <span class="c"># 管理静态文件的框架。</span>
	<span class="s">'polls.apps.PollsConfig'</span><span class="p">,</span>		<span class="c"># polls 是应用名; apps 表示 apps.py; PollsConfig 是 apps.py 中的一个类名# polls 文件夹下 apps.py 这个文件类 PollsConfig</span>
<span class="c"># apps.py 这个文件一般不需要修改</span>

<span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>可以帮助新建的 app 找到模板文件(<code class="language-plaintext highlighter-rouge">应用名/templates/</code>)和静态文件(<code class="language-plaintext highlighter-rouge">应用名/static/</code>)</p>

<h3 id="3将应用的数据模型转化为迁移文件-python37-managepy-makemigrations">(3)将应用的数据模型转化为迁移文件 <code class="language-plaintext highlighter-rouge">python3.7 manage.py makemigrations</code></h3>

<p><em>运行命令, 生成迁移文件</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>python3.7 manage.py makemigrations polls
<span class="c">#会得到如下输出</span>
<span class="c">#Migrations for 'polls':</span>
<span class="c">#  polls/migrations/0001_initial.py</span>
<span class="c">#    - Create model Choice</span>
<span class="c">#    - Create model Question</span>
<span class="c">#    - Add field question to choice</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>这时, 会生成一个新的迁移文件 <code class="language-plaintext highlighter-rouge">应用名/migrations/0001_initial.py</code></li>
  <li>该文将数据模型改换成了迁移文件的代码格式.</li>
</ul>

<h3 id="运行命令-生成-sql语句-python37-managepy-sqlmigrate-polls-0001"><em>运行命令, 生成 SQL语句</em> <code class="language-plaintext highlighter-rouge">python3.7 manage.py sqlmigrate polls 0001</code></h3>

<ul>
  <li>这个步骤可以省略, 只要 makeimgrations + migrate 就可以了</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>python3.7 manage.py sqlmigrate polls 0001
<span class="c"># 输出 sql 建表语句</span>
<span class="c">#--</span>
<span class="c">#-- Create model Question</span>
<span class="c">#--</span>
<span class="c">#CREATE TABLE "polls_question" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, #"question_text" varchar(200) NOT NULL, "pub_date" datetime NOT NULL);</span>
<span class="c">#COMMIT;</span>

</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sqlmigrate</code>命令并不会在你的数据库上真正运行迁移文件 —— 它只是把Django 认为需要的SQL打印在屏幕上以让你能够看到。 这对于检查Django将要进行的数据库操作或者你的数据库管理员需要这些SQL脚本是非常有用的。</li>
</ul>

<h3 id="4再次初始化数据库-python37-managepy-migrate">(4)再次初始化数据库 <code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code></h3>

<p>命令执行后,会在sqlite 库中生成新的表</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>python3.7 manage.py migrate
<span class="c"># 命令行中可以看到 如下输出, 表示表已经在 DB 中成功初始化.</span>
<span class="c"># Applying polls.0001_initial... OK</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">migrate</code> 命令会在应用列表中找到还没有同步的应用,然后将应用的迁移文件迁移到数据库中</li>
  <li>
    <p>任何对 <code class="language-plaintext highlighter-rouge">models.py</code> 的修改都会让 <code class="language-plaintext highlighter-rouge">migrate</code> 命令进行增量迁移.</p>
  </li>
  <li>修改你的模型（在<code class="language-plaintext highlighter-rouge">models.py</code>文件中）。</li>
</ul>

<p>之后的任何对数据模型的修改就简化为如下三步</p>

<ul>
  <li>修改你的模型（在<code class="language-plaintext highlighter-rouge">models.py</code>文件中）。</li>
  <li>运行<code class="language-plaintext highlighter-rouge">python3.7 manage.py makemigrations</code> ，为这些修改创建迁移文件</li>
  <li>运行<code class="language-plaintext highlighter-rouge">python3.7 manage.py migrate</code> ，将这些改变更新到数据库中。</li>
</ul>

<h3 id="在django-shell-中尝试查询数据">在django shell 中尝试查询数据</h3>

<p><a href="https://docs.djangoproject.com/en/2.0/ref/models/querysets/">更多数据查询方法</a></p>

<ul>
  <li>如果对数据库模型或者代码做了修改, 那么就需要退出命令行再进入</li>
  <li>因为命令行驱动的时候只是读取当时的程序代码到内存中, 所以没有办法识别新的更改.</li>
  <li>技巧: 要多用 tab 命令.
    <ul>
      <li>当创建一个对象 u 后, 输入u. + tab 可以看到这个对象的所有可能的方法和属性</li>
      <li>当使用一个类的时候,也可以同上面一样操作.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">pk</code> 是 primary key 的意思, 和 <code class="language-plaintext highlighter-rouge">id</code> 一样</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">python3</span><span class="o">.</span><span class="mi">7</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">shell</span>
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></td><td class="code"><pre><span class="c"># 以下步骤是shell中逐条交互进行的</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Question</span>
<span class="n">qset</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">queryset</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="p">[</span><span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">qset</span><span class="p">]</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">str</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">'hello'</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="n">q</span>
<span class="n">q</span><span class="o">.</span><span class="n">question_text</span>
<span class="n">q</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">'hahaha'</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span> <span class="c"># 另一种创建的方法. 不需要save()</span>
<span class="n">q</span><span class="o">.</span><span class="n">question_text</span> <span class="o">=</span> <span class="s">"byebye"</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 精确匹配, 返回一个对象, </span>
<span class="n">q</span>
<span class="n">q</span><span class="o">.</span><span class="n">was_registered_in24hours</span><span class="p">()</span>  <span class="c"># 返回True 因为是24小时创建的问题.</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c"># 筛选, 返回一组对象, </span>
<span class="n">q</span>
<span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c"># 这时去admin 后台的Question 那里增加一堆新的Questions. 然后再回来</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>  <span class="c"># 查看虽有数据</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__gt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>  <span class="c"># 查看id 大于1 的数据</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__gte</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># 大于等于1</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__lt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>  <span class="c"># 小于1</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__lte</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># 小于等于1</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">question_text__startswith</span> <span class="o">=</span> <span class="s">'g'</span><span class="p">)</span> <span class="c"># question_text字段以g开头的所有数据. 不区分大小写</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">question_text__endswith</span> <span class="o">=</span> <span class="s">'g'</span><span class="p">)</span> <span class="c"># 查以 g 结尾</span>

<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">reg_date__lte</span><span class="o">=</span><span class="s">'2018-01-01 00:00:00'</span><span class="p">)</span> <span class="c"># 日期范围</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stu_name</span> <span class="o">=</span> <span class="s">'xiaolong'</span><span class="p">)</span>  <span class="c"># 大小写敏感</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">stu_name__contains</span> <span class="o">=</span> <span class="s">'iaolon'</span><span class="p">)</span>  <span class="c"># 模糊匹配, 相当于sql语句的like '%iaolon%'</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">stu_name__contains</span> <span class="o">=</span> <span class="s">'wang'</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">stu_score__lte</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="c"># 查名字带wang,  并且成绩小于等于60分的同学</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">stu_name__contains</span> <span class="o">=</span> <span class="s">'wang'</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">reg_date__year</span> <span class="o">=</span> <span class="s">'2018'</span><span class="p">)</span> <span class="c"># 查姓wang, 并且在2018年注册的同学</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">pub_date__year</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="c"># 查询所有今年的数据</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">stu_name__contains</span> <span class="o">=</span> <span class="s">'wang'</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">reg_date__year</span> <span class="o">=</span> <span class="s">'2018'</span><span class="p">)</span> <span class="c"># 查除了在2018年注册的姓王之外的其他同学</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__in</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="c"># 按指定id 获取数据</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c"># pk 是 primary key 的意思, 和 id 一样</span>
<span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span> <span class="c"># 删除对象</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>  <span class="c"># 清空数据表</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">id__in</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stu_score</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="c"># 同时更新多条记录</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stu_score</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="c"># 更新所有记录</span>
<span class="n">Py1702</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c"># 统计条数</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="在管理后台管理新建的表对象-pollsadminpy">在管理后台管理新建的表对象 <code class="language-plaintext highlighter-rouge">polls/admin.py</code></h3>

<ul>
  <li>为了可以在管理后台管理表, 需要创建一个管理类</li>
  <li>这个管理类需要列出想要管理的字段名称, 然后再admin.site上进行注册.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Question</span>
<span class="c"># Register your models here.</span>


<span class="c"># 用列表形式显示</span>
<span class="k">class</span> <span class="nc">QuestionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'question_text'</span><span class="p">]</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">QuestionAdmin</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>修改完成后,进入后台, 就可以看到可以管理的数据表了</p>

<ul>
  <li>在后台可以操作对表CRUD 操作.</li>
</ul>

<h3 id="外键关联-反向关联--modelsforeignkeyquestion-on_deletemodelscascade">外键关联, 反向关联,  <code class="language-plaintext highlighter-rouge">models.ForeignKey(Question, on_delete=models.CASCADE)</code></h3>

<p>polls/models.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Choice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
  	<span class="c"># 建立外键, 第一个参数是目标的表对象, 第二个参数是在目标对象删除某数据时, 级联当前表中的数据也被删掉. 不如删掉了吃饭的问题,那么关于吃饭的选项也会被删掉</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
<span class="c">#    question = models.ForeignKey(Question, on_delete=models.DO_NOTHING)  # 不使用级联操作</span>
    <span class="n">choice_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">vote</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   		<span class="c"># 整数</span>
    <span class="n">vote</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  	<span class="c"># 正整数</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">choice_text</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>ForeignKey:</p>

<ul>
  <li>
    <p>A many-to-one relationship</p>
  </li>
  <li>
    <p>建立外键, 第一个参数是目标的表对象, 第二个参数是在目标对象删除某数据时, 级联当前表中的数据也被删掉. 不如删掉了吃饭的问题,那么关于吃饭的选项也会被删掉</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">on_delete</code> 选项:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">CASCADE</code>: 级联删除外键对应的数据对象</li>
          <li><code class="language-plaintext highlighter-rouge">PROTECT</code>: 当有外键关联到这个对象的时候, 将不进行删除操作, 并报错. 如果没有外键关联到这个对象, 则执行删除操作.</li>
          <li><code class="language-plaintext highlighter-rouge">DO_NOTHING</code>: 不对外键关联做任何保护, 可以随意删除.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>外键的另一个用处就是能够在目标表中产生反向引用. 可以在直接查询某个 question 对象的所有对应 choice</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
    </div>

    <p>​</p>
  </li>
</ul>

<p><em>字段整型的定义:</em></p>

<p>IntegerField:</p>

<ul>
  <li>Values from <code class="language-plaintext highlighter-rouge">-2147483648</code> to <code class="language-plaintext highlighter-rouge">2147483647</code></li>
</ul>

<p>PositiveIntegerField :</p>

<ul>
  <li>Values from <code class="language-plaintext highlighter-rouge">0</code> to <code class="language-plaintext highlighter-rouge">2147483647</code></li>
</ul>

<p><em>下面是对应的交互命令行的操作</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Question</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Choice</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">'are u hangury now?'</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Choice</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice_text</span><span class="o">=</span><span class="s">'yes, very'</span><span class="p">,</span> <span class="n">vote</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">question</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="nb">id</span>
<span class="n">c</span><span class="o">.</span><span class="n">question_id</span>
<span class="n">c</span><span class="o">.</span><span class="n">question</span><span class="o">.</span><span class="n">question_text</span>
<span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">choice_text</span><span class="o">=</span><span class="s">'No, not really.'</span><span class="p">,</span> <span class="n">vote</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span> 
<span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="c"># 统计条数</span>
<span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="nb">all</span><span class="p">())</span> <span class="c"># 也可以统计</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="nb">all</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">c</span><span class="o">.</span><span class="n">choice_text</span> <span class="o">=</span> <span class="s">'555'</span>
<span class="n">c</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">q</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>  <span class="c"># 级联删除q 和与它关联的所有choice 表中的数据</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="创建模板文件">创建模板文件</h2>

<p><em>在 <code class="language-plaintext highlighter-rouge">polls/views.py</code> 中增加一些新的视图函数</em></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">order_by()</code> 是排序功能, 参数需要是参数, 倒序的话,参数前面加一个 - 号
    <ul>
      <li>order_by() 默认是按照id 正序排列</li>
    </ul>
  </li>
  <li>[:5] 表示从头显示到第5条记录</li>
  <li>​</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Question</span>
<span class="c"># loader 是 django 的模板加载器</span>
<span class="c"># from django.template import loader</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="c"># 定义一个视图函数, 名字叫做index</span>
<span class="c"># def index(request):</span>
<span class="c">#     return HttpResponse("Hello, world, I'ma in Shanghai")</span>

<span class="c"># def index(request):</span>
<span class="c">#     latest_question_list = Question.objects.order_by('-pub_date')[:5]</span>
<span class="c">#     output = ', '.join([q.question_text for q in latest_question_list])</span>
<span class="c">#     return HttpResponse(output)</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">latest_question_list</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-pub_date'</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="c"># 这里会从 应用目录下的templates 目录中寻找参数中指定的模板.</span>
    <span class="c"># template 获得一个 list</span>
    <span class="c"># template = loader.get_template('polls/index.html')</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'latest_question_list'</span><span class="p">:</span> <span class="n">latest_question_list</span><span class="p">,</span>
    <span class="p">}</span>
	<span class="c"># return HttpResponse(template.render(context, request))</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'polls/index.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>


<span class="c"># 第二个参数的变量名是在 urls.py 中正则表达式中定义的变量名.</span>
<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
  	<span class="c"># # 获取多个参数</span>
    <span class="c"># return HttpResponse("you are viewing question %s. second id is %s" % (question_id, second_id))</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"you are viewing question </span><span class="si">%</span><span class="s">s."</span> <span class="o">%</span> <span class="n">question_id</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="s">"You are looking at the result of questoin </span><span class="si">%</span><span class="s">s."</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">response</span> <span class="o">%</span> <span class="n">question_id</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="s">"You are voting at the question </span><span class="si">%</span><span class="s">s."</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">response</span> <span class="o">%</span> <span class="n">question_id</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>
    <p>另一种模板渲染方式: , 上面代码中把这部分注释打开</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre># from django.template import loader
# template = loader.get_template('polls/index.html')
# return HttpResponse(template.render(context, request))
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
</ul>

<p><em>在 <code class="language-plaintext highlighter-rouge">polls/urls.py</code> 增加正则路由</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="c"># 第一个参数是正则表达式, 可以将内容赋给一个变量, 变量要在回调函数中作为参数引入.</span>
<span class="c"># 第二个参数是回调函数, 第三个参数是定义的命名空间, 在后面的 reverse() 或者 url() 中会用到</span>
<span class="c"># # 多个参数的传递方法</span>
<span class="c"># url(r'^(?P&lt;question_id&gt;[0-9]+)/(?P&lt;second_id&gt;[\w]+)/$', views.detail, name='detail'),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;question_id&gt;[0-9]+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'detail'</span><span class="p">),</span>

<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;question_id&gt;[0-9]+)/results/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'result'</span><span class="p">),</span>

<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;question_id&gt;[0-9]+)/vote/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">vote</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'vote'</span><span class="p">),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>在 polls目录下创建 templates/polls/index.html 文件</em></p>

<p><code class="language-plaintext highlighter-rouge">templates/polls/index.html</code></p>

<ul>
  <li>模板中的链接url 都默认从应用目录下的templates 目录下开始寻找</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre>{% if latest_question_list %}
    <span class="nt">&lt;ul&gt;</span>
        {% for question in latest_question_list %}
      		{# 此处的路径/polls/ 指的是 polls 目录下 templates 下面的路径 #}
            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/polls/{{ question.id }}/"</span><span class="nt">&gt;</span>{{ question.question_text }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
        {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
{% else %}
    <span class="nt">&lt;p&gt;</span>No polls are available.<span class="nt">&lt;/p&gt;</span>
{% endif %}
</pre></td></tr></tbody></table>
</div>
</div>

<p>增加详情页的视图函数 polls/views.py</p>

<ul>
  <li>get_object_or_404 需要 from django.shortcuts import get_object_or_404</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>
    <span class="c"># question = get_object_or_404(Question, id=question_id)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'polls/detail.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'question'</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>增加详情页模板</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre><span class="nt">&lt;h1&gt;</span>{{ question.question_text }}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
   {# django 模板要求函数不能输入后面的括号, 所以如果写 all() 会报错. #}
   {% for choice in question.choice_set.all %}
       <span class="nt">&lt;li&gt;</span>{{ choice.choice_text }}<span class="nt">&lt;/li&gt;</span>
   {% endfor %}
<span class="nt">&lt;/ul&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="修改debug-模式">修改debug 模式</h2>

<p>修改 django 的 debug 模式</p>

<p>mysites/settings.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'localhost'</span><span class="p">,</span> <span class="s">'127.0.0.1'</span><span class="p">,]</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="自定义的报错信息页面">自定义的报错信息页面</h2>

<p>polls/views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">Http404</span>

<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="c"># question = Question.objects.get(id=question_id)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># question = get_object_or_404(Question, id=question_id)</span>
        <span class="n">question</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Question</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'hahaha'</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">Http404</span><span class="p">(</span><span class="s">'Question does not exit'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'polls/detail.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'question'</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="命名空间">命名空间</h2>

<p>命名空间的意义:</p>

<ol>
  <li>
    <p>让模板文件中的超链接在多个app间跳转的时候,不会因为app中有同名的函数而找错对应的函数</p>

    <p>​</p>
  </li>
</ol>

<p>使用方法:</p>

<p>(1) 在 <code class="language-plaintext highlighter-rouge">polls/urls.py</code> 中为 app 定义一个命名空间变量 <code class="language-plaintext highlighter-rouge">app_name='polls'</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="c"># 下面这个变量是polls 的命名空间上定义的app名</span>
<span class="c"># 如果省略下面这个变量, 那么在模板中也要响应的去掉app的命名指向</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="s">'polls'</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>(2) 在模板文件 templates/polls/index.html 中将原来的超链接href属性进行修改</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre> {# 此处的路径/polls/ 指的是 polls 目录下 templates 下面的路径 #}
{# <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"/polls/{{ question.id }}/"</span><span class="nt">&gt;</span>{{ question.question_text }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span> #}
{# <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'detail' question.id %}"</span><span class="nt">&gt;</span>{{ question.question_text }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span> #}
<span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'polls:detail' question.id %}"</span><span class="nt">&gt;</span>{{ question.question_text }}<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>url 函数用来生成URL</li>
</ul>

<h2 id="创建form-表单-和-处理表单-templatespollsdetailhtml">创建form 表单 和 处理表单 <code class="language-plaintext highlighter-rouge">templates/polls/detail.html</code></h2>

<p>csrf - Cross-site request forgery跨站请求伪造</p>

<ul>
  <li>
    <p>是用来防止跨域攻击的, 下面代码会生成如下 html</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">&lt;input type='hidden' name='csrfmiddlewaretoken' value='viyT4IFnnKWBfjzbgjQFei7D0YCiHe3kd5peZUpCtDVQ5azUAGmvuQxkk6JpAdZG' /&gt;</code></p>
  </li>
</ul>

<p>forloop</p>

<ul>
  <li>是用来控制当前循环的序号, 可以展示循环计数, 可以反向展示等等. 具体用法可以输入forloop. 然后看提示</li>
  <li>forloop.counter 是用来展示当前循环的序号</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></td><td class="code"><pre>{#<span class="nt">&lt;h1&gt;</span>{{ question.question_text }}<span class="nt">&lt;/h1&gt;</span>#}
{#<span class="nt">&lt;ul&gt;</span>#}
    {# django 模板要求函数不能输入后面的括号, 所以all() 会报错. #}
{#	{% for choice in question.choice_set.all %}#}
{#	    <span class="nt">&lt;li&gt;</span>{{ choice.choice_text }}<span class="nt">&lt;/li&gt;</span>#}
{#	{% endfor %}#}
{#<span class="nt">&lt;/ul&gt;</span>#}

<span class="nt">&lt;h1&gt;</span>{{ question.question_text }}<span class="nt">&lt;/h1&gt;</span>
{% if error_message %}
    <span class="nt">&lt;p&gt;&lt;strong&gt;</span>{{ error_message }}<span class="nt">&lt;/strong&gt;&lt;/p&gt;</span>
{% endif %}
<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"{% url 'polls:vote' question.id %}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    {#  csrf 是用来防止跨域攻击的, 下面代码会生成如下 html   #}
    {# <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'hidden'</span> <span class="na">name=</span><span class="s">'csrfmiddlewaretoken'</span> <span class="na">value=</span><span class="s">'viyT4IFnnKWBfjzbgjQFei7D0YCiHe3kd5peZUpCtDVQ5azUAGmvuQxkk6JpAdZG'</span> <span class="nt">/&gt;</span> #}
    {% csrf_token %}
    {% for choice in question.choice_set.all %}
        {# forloop 是用来控制当前循环的序号, 可以展示循环计数, 可以反向展示等等. 具体用法可以输入forloop. 然后看提示 #}
        {# forloop.counter 是用来展示当前循环的序号 #}
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"choice"</span> <span class="na">id=</span><span class="s">"choice{{ forloop.counter }}"</span> <span class="na">value=</span><span class="s">"{{ choice.id }}"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"choice{{ forloop.counter }}"</span><span class="nt">&gt;</span>{{ choice.choice_text }}<span class="nt">&lt;/label&gt;&lt;br/&gt;</span>
    {% endfor %}
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"提交"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>form 提交信息到 polls/views.py 的 vote函数中</li>
</ul>

<p><em>修改 <code class="language-plaintext highlighter-rouge">polls/views.py</code> 的 <code class="language-plaintext highlighter-rouge">vote</code> 方法 和 <code class="language-plaintext highlighter-rouge">result</code> 方法</em></p>

<ul>
  <li>request.POST[]可以获取所有post 过来的变量</li>
  <li>HttpResponseRedirect 用于重镜像</li>
  <li>reverse 的作用和模板中的 url 函数一样, 都是反向建立URL 路径.  区别是 url 用在模板中, reverse 用在python 文件中</li>
  <li>reverse 通过urls.py 的规则反向的创造出url. “reverse(viewname=’polls:result’, args=(question.id,)))” 可以创建的url 是 “/polls/3/result/”</li>
  <li>args 参数是一个tuple 元组, 要注意, 如果只有一个参数, 后面一定加一个逗号</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>

<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># request.POST[]可以获取所有post 过来的变量</span>
        <span class="c"># print(str(request.POST))</span>
        <span class="c"># 打印获得变量如下:</span>
        <span class="c"># &lt;QueryDict: {'csrfmiddlewaretoken': ['RnjlKSnzipfrHvFzDFvGreSbQeKCCQGzzaaGF47OoieGxmFiX21wHMiSamRJvPCV'], 'choice': ['3']}&gt;</span>
        <span class="n">selected_choice</span> <span class="o">=</span> <span class="n">question</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'choice'</span><span class="p">])</span>
    <span class="c"># 如果是没有选择内容选项就提交, 那么就会走到 except中</span>
    <span class="c"># KeyError 的定义: Raised when a mapping (dictionary) key is not found in the set of existing keys.</span>
    <span class="c"># DoesNotExist 官方定义:  当一个给定参数的查询未能发现对象时抛出该异常。</span>
    <span class="k">except</span> <span class="p">(</span><span class="nb">KeyError</span><span class="p">,</span> <span class="n">Choice</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">):</span> <span class="c">#</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'polls/detail.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span>
            <span class="s">'question'</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
            <span class="s">'error_message'</span><span class="p">:</span> <span class="s">'还没选中选项'</span><span class="p">,</span>
        <span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">vote</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c"># HttpResponseRedirect 用于重镜像</span>
        <span class="c"># reverse 的作用类似于模板中的 url 函数, 只不过这个reverse 用在view.py 中</span>
        <span class="c"># reverse 通过urls.py 的规则反向的创造出url. "reverse(viewname='polls:result', args=(question.id,)))" 可以创建的url 是 "/polls/3/result/"</span>
        <span class="c"># reverse 的第一个参数是要跳转的目标地址的命名空间</span>
        <span class="c"># reverse 的第二个参数是跳转需要带的参数, 用 args 变量来携带</span>
        <span class="c"># 这里的 args 参数是一个tuple 元组, 要注意, 如果只有一个参数, 后面一定加一个逗号</span>
		<span class="c"># reverse 第一个参数一定注意, polls:result 中间是冒号,不是 /</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="n">viewname</span><span class="o">=</span><span class="s">'polls:result'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">question</span><span class="o">.</span><span class="nb">id</span><span class="p">,)))</span>
      
      
<span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">question_id</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">question_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'polls/result.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'question'</span><span class="p">:</span> <span class="n">question</span><span class="p">})</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>最后在增加一个 result 模板</em></p>

<ul>
  <li>犯的错误: polls:detail, 这里中间是冒号, 别写成 /</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="nt">&lt;h1&gt;</span>{{ question.question_text }}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
	{% for choice in question.choice_set.all %}
		{#    这里 |pluralize 可以判断管道符前面的内容是1还是大于1, 然后来决定后面是否加 s 复数    #}
	    <span class="nt">&lt;li&gt;</span>{{ choice.choice_text }} -- {{ choice.vote }} vote{{ choice.vote|pluralize }}<span class="nt">&lt;/li&gt;</span>
	{% endfor %}
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'polls:detail' question.id %}"</span><span class="nt">&gt;</span>再投一票<span class="nt">&lt;/a&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="代码重构---让投票app-面向对象">代码重构 - 让投票app 面向对象</h2>

<p>注意:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">model = Question</code> 和 <code class="language-plaintext highlighter-rouge">def get_queryset(self):</code> 可以二选一, 只要用一个就可以.
    <ul>
      <li>get_queryset() 方法用来对默认的排序方式进行调整和过滤</li>
    </ul>
  </li>
  <li>context_object_name 可以省略, 但前提是template模板中循环的对象的变量名必须是和models 中定义的模型的类名一致(头字母变成小写)
    <ul>
      <li>比如, models.py中定义的类是 <code class="language-plaintext highlighter-rouge">class Question(models.Model):</code> 那么 模板中就需要使用 <code class="language-plaintext highlighter-rouge">{{ question.question_text }}</code></li>
    </ul>
  </li>
</ul>

<p><em>polls/views.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">generic</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>

<span class="c"># 命名规范: view.py 中所有的类名都要以View 结尾, 比如 XxxxView</span>
<span class="c"># generic.ListView 是普通类型.列表视图</span>
<span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">ListView</span><span class="p">):</span>
    <span class="c"># template_name 是基类中的属性, 所以名字不能拼错</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'polls/index.html'</span>
    <span class="c"># context_object_name 也是基类的属性, 不能拼错</span>
    <span class="c"># latest_question_list 是一个自定义的列表的名字.</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'latest_question_list'</span>
    <span class="c"># self 表示当前对象.</span>
    <span class="c"># get_queryset , 定义获取列表数据的方法. 方法将获取的列表数据赋值到latest_question_list 变量,并返回一个列表就可以了.</span>
    <span class="c"># 这个get_quertset 方法不是必须的</span>
    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-pub_date'</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
      

      
<span class="c"># DetailView 基层自</span>
<span class="k">class</span> <span class="nc">DetailView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="c"># model 是一个基类定义的变量名,不能随便改.</span>
    <span class="c"># model 变量定义了这个detail view 需要使用的申诉局是 Question中的数据</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Question</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'polls/detail.html'</span>
    


    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#</span>
        <span class="k">return</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">pub_date__lte</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

      
      

<span class="c"># ResultView 也是继承自DetailView 基类</span>
<span class="k">class</span> <span class="nc">ResultView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="c"># model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Question</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'polls/result.html'</span>

    <span class="c"># def get_queryset(self):</span>
    <span class="c">#     return Question.objects.filter(pub_date__lte=timezone.now())</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p>polls/urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="c"># 重构后index, url 的回调函数使用方法IndexView.as_view() , 理解为作为view来使用.</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span>

<span class="c"># 重构后的 detail. 参数必须改成pk, pk是基类中定义的.</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;[0-9]+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'detail'</span><span class="p">),</span>

<span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;[0-9]+)/result/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ResultView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'result'</span><span class="p">),</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>模板中的展示 mysite/template/detail.html</p>

<p>{% for choice in question.choice_set.all %}</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>    {# forloop 是用来控制当前循环的序号, 可以展示循环计数, 可以反向展示等等. 具体用法可以输入forloop. 然后看提示 #}
    {# forloop.counter 是用来展示当前循环的序号 #}
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"choice"</span> <span class="na">id=</span><span class="s">"choice{{ forloop.counter }}"</span> <span class="na">value=</span><span class="s">"{{ choice.id }}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"choice{{ forloop.counter }}"</span><span class="nt">&gt;</span>{{ choice.choice_text }}<span class="nt">&lt;/label&gt;&lt;br/&gt;</span>
{% endfor %}
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="优化样式">优化样式</h2>

<p>创建静态内容的目录和文件:</p>

<p>polls/static/polls/images/background2.jpg</p>

<p>polls/static/polls/style.css</p>

<p>css 文件如下:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="nt">li</span> <span class="nt">a</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>

<span class="p">}</span>

<span class="nt">body</span><span class="p">{</span>
    <span class="c">/*这里的图片路径是针对于css 文件自己的相对路径*/</span>
    <span class="nl">background</span><span class="p">:</span> <span class="no">white</span> <span class="sx">url("images/background2.jpg")</span> <span class="nb">no-repeat</span> <span class="nb">center</span> <span class="nb">center</span><span class="p">;</span>
    <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>templates/index.html 作如下修改</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>{# load static 是django 模板自带的方法, 注意拼写 #}
{% load static %}


<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"{% static 'polls/style.css' %}"</span><span class="nt">/&gt;</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="后台管理界面的定制化">后台管理界面的定制化</h2>

<p>可以控制列表显示的内容和编辑页面显示的可编辑字段</p>

<p><em>polls/admin.py</em></p>

<ul>
  <li>list_display: 定义显示的字段</li>
  <li>fieldsets: 对可编辑的字段集合进行分组显示.</li>
  <li>inlines: 增加 Question对象外键关联的Choice 内容, 定义列表中的内容是上面类的名字</li>
  <li>list_filter: 定义管理界面右侧的过滤项</li>
  <li>search_fields: 定义可搜索的字段</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Question</span><span class="p">,</span> <span class="n">Choice</span>
<span class="c"># Register your models here.</span>


<span class="c"># 这个ChoiceInline 需要继承 一个显示以后台的显示样式</span>
<span class="k">class</span> <span class="nc">ChoiceInline</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">StackedInline</span><span class="p">):</span>
    <span class="c"># 指定 model 的内容是 Choice</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Choice</span>
    <span class="c"># 除了显示原有的内容外, 再增加三个空白选项,让管理员可以增加新的内容.</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="mi">3</span>


<span class="c"># 用列表形式显示</span>
<span class="k">class</span> <span class="nc">QuestionAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="c"># 控制列表页面显示哪些字段</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'question_text'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">,</span> <span class="p">]</span>
    <span class="c"># 可以控制详情页面可以显示哪些内容</span>
    <span class="c"># fields = ['pub_date', 'question_text']</span>
    <span class="c"># 对可编辑的字段集合进行分组显示.</span>
    <span class="n">fieldsets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c"># 第一栏的None 表示没有标题. 包含的字段是 question_text</span>
        <span class="c"># 包含的字段中不能加 id 字段</span>
        <span class="p">(</span><span class="s">'问题名称'</span><span class="p">,</span> <span class="p">{</span><span class="s">'fields'</span><span class="p">:</span> <span class="p">[</span><span class="s">'question_text'</span><span class="p">]}),</span>
        <span class="c"># 第二栏的标题是 Date information, 包含的字段是 pub_date</span>
        <span class="p">(</span><span class="s">'发布日期'</span><span class="p">,</span> <span class="p">{</span><span class="s">'fields'</span><span class="p">:</span> <span class="p">[</span><span class="s">'pub_date'</span><span class="p">]}),</span>
    <span class="p">]</span>
    <span class="c"># 定义在Question对象外键关联的Choice 内容, 定义列表中的内容是上面类的名字</span>
    <span class="n">inlines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ChoiceInline</span><span class="p">]</span>
    <span class="c"># 在Question 管理界面添加一个筛选项, 可以对应增加很多筛选的</span>
    <span class="c"># 过滤项的标题是在 models.py文件中定义的</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">[</span><span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'question_text'</span><span class="p">]</span>
    <span class="c"># 增加搜索功能</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'question_text'</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ChoiceAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'choice_text'</span><span class="p">,</span> <span class="s">'vote'</span><span class="p">]</span>
    <span class="n">fieldsets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'选择项名称'</span><span class="p">,</span> <span class="p">{</span><span class="s">'fields'</span><span class="p">:</span> <span class="p">[</span><span class="s">'choice_text'</span><span class="p">]}),</span>
        <span class="p">(</span><span class="s">'票数'</span><span class="p">,</span> <span class="p">{</span><span class="s">'fields'</span><span class="p">:</span> <span class="p">[</span><span class="s">'vote'</span><span class="p">]}),</span>
    <span class="p">]</span>
    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">[</span><span class="s">'choice_text'</span><span class="p">,</span> <span class="s">'vote'</span><span class="p">]</span>
    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'choice_text'</span><span class="p">]</span>


<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Question</span><span class="p">,</span> <span class="n">QuestionAdmin</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Choice</span><span class="p">,</span> <span class="n">ChoiceAdmin</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="测试驱动开发---自动化测试">测试驱动开发 - 自动化测试.</h2>

<ul>
  <li>下面的测试是针对 sqlite 进行的.</li>
  <li>如果换成 mysql, 需要连接的账号有 mysql 的建表建库权限(比如 root).</li>
</ul>

<h3 id="测试目标-针对-modelspy-进行测试">测试目标: <em>针对 models.py 进行测试</em></h3>

<ul>
  <li>was_published_recently() 方法的目的是验证一个问卷问题是否在过去的24小时之内发表的.</li>
  <li>测试目标: 用三个case 测试这个方法,
    <ul>
      <li>用一个未来时间测试该方法, 预期结果: False</li>
      <li>用一个过去24小时之前的时间测试该方法, 预期结果: False</li>
      <li>用一个过去24小时之内的时间测试该方法, 预期结果: True</li>
    </ul>
  </li>
</ul>

<h3 id="创建测试步骤">创建测试步骤:</h3>

<p>(1) polls/models.py 文件中的一段代码改成有bug( 问题可以发布自未来 )</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="c"># 查看最近24小时内发布的问题, 且不是发布自未来</span>
    <span class="k">def</span> <span class="nf">was_published_recently</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># return self.pub_date &gt;= (timezone.now() - datetime.timedelta(days=1)) and (self.pub_date &lt;= timezone.now())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>(2)在 <code class="language-plaintext highlighter-rouge">polls/test.py</code> 文件中增加如下代码</p>

<ul>
  <li>test.py 文件的执行会自动调用测试数据, 不会影响现有数据库. 执行完毕后, 就会把测试数据库删掉.</li>
  <li>测试模型的类名随便起, 但需要继承 TestCase 的测试用例基类</li>
  <li>类中的所有测试方法执行顺序不是顺序执行, 而是因及其不同而异</li>
  <li>如果一个方法中有数据在表中创造出来, 那么在这个方法结束的时候, 数据也会从表中删除, 不会影响下一个方法的测试.</li>
  <li>每个测试方法中都要定义测试对象以及用断言校验测试对象的执行结果</li>
  <li>技巧: 每个断言都是测试失败的可能, 那么排除了所有的失败, 最后的结果就是成功.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><pre><span class="c"># 引入django 测试用例模块</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="c"># Create your tests here.</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Question</span>


<span class="c"># 测试模型的名字随便起, 但需要继承 TestCase 的测试用例基类</span>
<span class="k">class</span> <span class="nc">QuestionModelTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="c"># 测试一个问卷问题是否可以从未来发布的可能性.</span>
    <span class="k">def</span> <span class="nf">test_was_published_recently_with_future_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 创建一个未来30天的时间点</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="c"># 创建一条测试数据对象</span>
        <span class="c"># 测试中, 创建对象可以不用填必选字段. 只要用需要测试的字段创建对象即可</span>
        <span class="n">future_question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="c"># 执行 is 断言测试,  验证 数据对象was_published_recently() 是 False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">future_question</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c"># 测试一个问卷问题是否可以从过去1天之前发布.</span>
    <span class="k">def</span> <span class="nf">test_was_published_recently_with_old_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">old_question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">old_question</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c"># 测试一个正确的时间段的问题可以被正确验证.</span>
    <span class="k">def</span> <span class="nf">test_was_published_recently_with_rencent_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>
        <span class="n">recent_question</span> <span class="o">=</span> <span class="n">Question</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">recent_question</span><span class="o">.</span><span class="n">was_published_recently</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>(3) 执行测试命令  <code class="language-plaintext highlighter-rouge">python3.7 manage.py test polls</code></p>

<ul>
  <li>命令中不需要指定测试文件, 只要指定测试的app 名字</li>
  <li>django 框架会帮助TDD 创建一个临时空数据库和对应测试需要的空表</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>python3.7 manage.py <span class="nb">test </span>polls
</pre></td></tr></tbody></table>
</div>
</div>

<p>有错误的输出结果如下:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre>Creating <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...
System check identified no issues <span class="o">(</span>0 silenced<span class="o">)</span>.
F
<span class="o">======================================================================</span>
FAIL: test_was_published_recently_with_future_question <span class="o">(</span>polls.tests.QuestionModelTests<span class="o">)</span>
----------------------------------------------------------------------
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/Users/dalong/code/python1702/django/day2/project/mysite/polls/tests.py"</span>, line 22, <span class="k">in </span>test_was_published_recently_with_future_question
    self.assertIs<span class="o">(</span>future_question.was_published_recently<span class="o">()</span>, False<span class="o">)</span>
AssertionError: True is not False

----------------------------------------------------------------------
Ran 1 <span class="nb">test </span><span class="k">in </span>0.001s

FAILED <span class="o">(</span><span class="nv">failures</span><span class="o">=</span>1<span class="o">)</span>
Destroying <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...

</pre></td></tr></tbody></table>
</div>
</div>

<p>改掉bug, 无错误的数据结果如下:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre>Creating <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...
System check identified no issues <span class="o">(</span>0 silenced<span class="o">)</span>.
.
----------------------------------------------------------------------
Ran 1 <span class="nb">test </span><span class="k">in </span>0.000s

OK
Destroying <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">'default'</span>...

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="一些常用断言">一些常用断言</h3>

<table>
  <thead>
    <tr>
      <th>断言</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>assertEqual</td>
      <td>断言相等, 相当于 <code class="language-plaintext highlighter-rouge">==</code>, 相等返回True</td>
    </tr>
    <tr>
      <td>assertNotEqual</td>
      <td>断言不等, 相当于 <code class="language-plaintext highlighter-rouge">!=</code>, 不等返回True</td>
    </tr>
    <tr>
      <td>assertFalse</td>
      <td>断言结果是 <code class="language-plaintext highlighter-rouge">False</code> ,  是False 返回True</td>
    </tr>
    <tr>
      <td>assertTrue</td>
      <td>断言结果是 <code class="language-plaintext highlighter-rouge">True</code> ,  是True 返回True</td>
    </tr>
    <tr>
      <td>assertGreater</td>
      <td>断言大于(assertTrue(a &gt; b)), 大于返回True</td>
    </tr>
    <tr>
      <td>assertGreaterEqual</td>
      <td> </td>
    </tr>
    <tr>
      <td>assertLess</td>
      <td>断言小于(assertTrue(a &lt; b)), 小于返回True</td>
    </tr>
    <tr>
      <td>assertLessEqual</td>
      <td> </td>
    </tr>
    <tr>
      <td>assertIsNone</td>
      <td>断言对象是空(assertTrue(obj is None)) 空返回True</td>
    </tr>
    <tr>
      <td>assertIsNotNone</td>
      <td> </td>
    </tr>
    <tr>
      <td>assertIn</td>
      <td>断言包含(assertTrue(a in b)) 包含返回True</td>
    </tr>
    <tr>
      <td>assertNotIn</td>
      <td> </td>
    </tr>
    <tr>
      <td>assertIs</td>
      <td>断言是(assertTrue(a is b)) 是返回True</td>
    </tr>
    <tr>
      <td>assertIsNot</td>
      <td> </td>
    </tr>
    <tr>
      <td>assertIsInstance</td>
      <td>断言是实例(assertTrue(isinstance(obj, cls))) 是返回True</td>
    </tr>
    <tr>
      <td>assertNotIsInstance</td>
      <td> </td>
    </tr>
    <tr>
      <td>assertListEqual</td>
      <td>断言是列表 , 是返回True</td>
    </tr>
    <tr>
      <td>assertDictEqual</td>
      <td>断言是字典, 是返回True</td>
    </tr>
    <tr>
      <td>assertTupleEqual</td>
      <td>断言是元组, 是返回True</td>
    </tr>
    <tr>
      <td>assertSetEqual</td>
      <td>断言是集合, 是返回True</td>
    </tr>
    <tr>
      <td>assertRaises</td>
      <td>断言异常, with self.assertRaises(SomeException) as cm:</td>
    </tr>
    <tr>
      <td>assertContains</td>
      <td>断言包含(assertContains(response, “NoN polls are available.”)) 包含返回True</td>
    </tr>
    <tr>
      <td>assertQuerysetEqual</td>
      <td>断言query集包含assertQuerysetEqual(response.context[‘latest_question_list’], []), 一般是在view 函数中定义的<code class="language-plaintext highlighter-rouge">context_object_name = 'latest_question_list'</code> 包含返回True</td>
    </tr>
  </tbody>
</table>

<h3 id="django-命令行-进行测试">django 命令行 进行测试</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="c"># 导入测试用的环境变量</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">setup_test_environment</span>
<span class="c"># 执行设置测试环境方法</span>
<span class="n">setup_test_environment</span><span class="p">()</span>
<span class="c"># 从测试模块引入客户端类</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="c"># 实例化模拟浏览器客户端</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">()</span>
<span class="c"># 用 GET 方法访问根目录, 将结果存到response 中.</span>
<span class="c"># 如果这时web 服务已经启动, 这里默认请求的就是 http://127.0.0.1:8000/</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span> <span class="c"># 结果是 Not Found: /</span>
<span class="n">rp</span><span class="o">.</span> <span class="o">+</span> <span class="err">双击</span> <span class="n">tab</span> <span class="c"># 查看响应对应的所有属性和方法.</span>
<span class="c"># 查看响应的状态码</span>
<span class="n">response</span><span class="o">.</span><span class="n">status_code</span>  <span class="c"># 输出 404</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/polls/'</span><span class="p">)</span> 
<span class="n">response</span>  <span class="c"># 输出一个 响应对象 &lt;TemplateResponse status_code=200, "text/html; charset=utf-8"&gt;</span>
<span class="n">response</span><span class="o">.</span><span class="n">status_code</span>  <span class="c"># 输出 200</span>
<span class="c"># 获得响应的内容. 就是HTML 中的内容.</span>
<span class="n">response</span><span class="o">.</span><span class="n">content</span> 
<span class="c"># 获得响应的上下文, 这里是django 设置的环境变量. 上下文中已经带上了view中设置的context_object_name 设置的对象</span>
<span class="n">response</span><span class="o">.</span><span class="n">context</span>
<span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'latest_question_list'</span><span class="p">]</span>
<span class="c"># 进入详情页</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'/polls/3/'</span><span class="p">)</span>
<span class="c"># 获得详情页当前对象的信息. 这里的object 就是 view.py 中的 context_object_name 对应的对象</span>
<span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'object'</span><span class="p">]</span><span class="o">.</span><span class="nb">id</span>
<span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'object'</span><span class="p">]</span><span class="o">.</span><span class="n">question_text</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>更多的 <a href="http://www.django-rest-framework.org/api-guide/status-codes/">状态码</a></li>
</ul>

<h3 id="测试目标-针对-viewspy-进行测试">测试目标: <em>针对 views.py 进行测试</em></h3>

<p>首页测试用例 polls/test.py</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">client.get(reverse('polls:index'))</code> 这里的 get 是 http的请求方法GET 的意思.</li>
  <li>类中的所有测试方法不会依次执行, 而是乱的</li>
  <li>如果一个方法中有数据在表中创造出来, 那么在这个方法结束的时候, 数据也会从表中删除, 不会影响下一个方法的测试.</li>
  <li>每个测试方法中都要定义测试对象以及用断言校验测试对象的执行结果</li>
  <li>测试数据就是要找各种边界条件的数据, 比如测试过去五天的数据,那就要测试过去1秒和过去5天零1秒的数据.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>

<span class="c"># 一个创建问题的函数, 接收问题和创建日期两个参数</span>
<span class="k">def</span> <span class="nf">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="p">,</span> <span class="n">days</span><span class="p">):</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>
    <span class="c"># crete() 方法的好处是不用 save()</span>
    <span class="k">return</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="n">question_text</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">QuestionIndexViewTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_no_questions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># print("### reverse URL ###" + reverse('polls:index'))  # /polls/</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'polls:index'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        <span class="c"># print('### response ###:' + str(response))  # &lt;TemplateResponse status_code=200, "text/html; charset=utf-8"&gt;</span>
        <span class="c"># 包含断言</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">"No polls are available."</span><span class="p">)</span> <span class="c"># 参数中的文字是在</span>
        <span class="c"># print('### latest ###:' + str(response.context['latest_question_list']))  # &lt;QuerySet []&gt;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'latest_question_list'</span><span class="p">],</span> <span class="p">[])</span>

    <span class="c"># 测试目标: 测试过去发表的问题, 预期是能从浏览器看到数据.</span>
    <span class="k">def</span> <span class="nf">test_past_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">"Past question."</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'polls:index'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'latest_question_list'</span><span class="p">],</span> <span class="p">[</span><span class="s">'&lt;Question: Past question.&gt;'</span><span class="p">],)</span>

    <span class="c"># 测试目标: 测试未来问题.</span>
    <span class="c"># 测试方法: 创建一个未来问题,并从网页获取, 预期获取不到未来数据</span>
    <span class="k">def</span> <span class="nf">test_future_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">'Future question.'</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'polls:index'</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotContains</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s">'Future question.'</span><span class="p">)</span>


	<span class="c"># 插入两条数据,一个是过去的,一个是未来的,那么查询的数据应该只有一条.</span>
    <span class="k">def</span> <span class="nf">test_future_question_and_past_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">"Past question."</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">'Future question.'</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'polls:index'</span><span class="p">))</span>
        <span class="c"># self.assertNotContains(response, 'Future question.')</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertQuerysetEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'latest_question_list'</span><span class="p">],</span> <span class="p">[</span><span class="s">'&lt;Question: Past question.&gt;'</span><span class="p">],</span> <span class="p">)</span>

        

<span class="k">class</span> <span class="nc">QuestionDetailView</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_future_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">future_question</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">'Future'</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'polls:detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">future_question</span><span class="o">.</span><span class="nb">id</span><span class="p">,))</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">test_past_question</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">past_question</span> <span class="o">=</span> <span class="n">create_question</span><span class="p">(</span><span class="n">question_text</span><span class="o">=</span><span class="s">'Past'</span><span class="p">,</span> <span class="n">days</span><span class="o">=-</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'polls:detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">past_question</span><span class="o">.</span><span class="nb">id</span><span class="p">,))</span>
        <span class="n">rp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>注意:</p>

<ul>
  <li>如果多条记录排序的字段值都相同, 那么测试框架返回的顺序是随机的.</li>
  <li>可以去</li>
</ul>

<h2 id="为网站创建首页">为网站创建首页</h2>

<p><em>方法一: 为网站创建一个首页</em></p>

<p>mysite/urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>polls/views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"Hello, world, I'ma in Shanghai"</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>方法二: 将首页转到 polls 的首页</em></p>

<ul>
  <li>注意, 正则中不能有 <code class="language-plaintext highlighter-rouge">$</code> , 因为URL 后续的部分还要在 polls/urls 中继续截取, 那里才可以用 <code class="language-plaintext highlighter-rouge">$</code> 结束URL截取工作.</li>
</ul>

<p>mysite/urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'polls.urls'</span><span class="p">)),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>方法三: 为首页创建模板的范式</em></p>

<p>(1)创建项目根目录下的mysite/templates/home.html 文件夹和文件.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
Hi, this is home page!
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>(2)mysites/urls</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'home'</span><span class="p">),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>(3)polls/view.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">home</span> <span class="o">=</span> <span class="n">Question</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'home'</span><span class="p">:</span> <span class="n">home</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'home.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>(4)mysite/settings.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c"># 'DIRS': [],</span>
<span class="s">'DIRS'</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'templates'</span><span class="p">)],</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="简单登录和登出">简单登录和登出</h2>

<p>mysite/urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^login/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'login'</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^logout/$'</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">logout</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'logout'</span><span class="p">),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>创建 project/mysite/template/registration/login.html 目录和文件</p>

<p>```html # project/mysite/template/registration/login.html
{% block title %} 登录页面 {% endblock %}
{% block content %}
    &lt;h2&gt;登录页面&lt;/h2&gt;
    &lt;form action="" method="post"&gt;
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">登录</button>
    &lt;/form&gt;</p>

<p>{% endblock %}</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre>


mysite/settings.py  文件底部 增加两行

```python
LOGIN_URL='/login/'
LOGIN_REDIRECT_URL='/'
</pre></td></tr></tbody></table>
</div>
</div>

<p>为投票页 detail 增加登录限制 polls/urls.py</p>

<p>```python # polls/urls.py
from django.contrib.auth.decorators import login_required
url(r’^(?P<pk>[0-9]+)/$', login_required(views.DetailView.as_view()), name='detail'),</pk></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></td><td class="code"><pre>


之后进入 http://127.0.0.1:8000/polls/ 查看进入





# Django 博客项目

## 环境配置

*requirements.txt*

```bash
Django==2.0
django-haystack==2.6.1
jieba==0.39
Markdown==2.6.9
Pygments==2.2.0
pytz==2017.2
Whoosh==2.7.4
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>先为博客创建虚拟环境以及目录</em></p>

<p>创建项目目录/Users/dalong/code/python1702/django/day6/blog</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="nb">cd</span> /Users/dalong/code/python1702/django/day6/blog
django-admin startproject mysite
<span class="nb">cd </span>mysite/
virtualenv venv
<span class="nb">source</span> ./venv/bin/activate
pip3.7 install -r /Users/dalong/Downloads/requirements.txt
python3.7 manage.py init
python3.7 manage.py makemigrations
python3.7 manage.py migrate
python3.7 manage.py createsuperuser
python3.7 manage.py startapp blog
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>修模模板默认路径, 让模板在项目根目录下</em></p>

<ul>
  <li>修改 mysite/settings.py 在 INSTALLEDAPP中增加</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="s">'blog.apps.BlogConfig'</span><span class="p">,</span> 

<span class="s">'DIRS'</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'templates'</span><span class="p">)],</span>
</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>新建一个临时的模板文件 mysite/templates/blog/index.html</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7</pre></td><td class="code"><pre>{% block title %}
    {{ title }}
{% endblock %}
{% block content %}
    {{ welcome }}
{% endblock %}
hello
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="需求分析">需求分析</h2>

<p>博客分类 -&gt; 博客文章 (一对多)</p>

<p>博客文章 -&gt; 博客评论 (一对多)</p>

<p>博客文章 -&gt; 标签 (多对多)</p>

<p>博客: 列表页, 详情页, 评论页</p>

<p>分类: 增删改查</p>

<p>标签: 管理</p>

<p>用户: 管理</p>

<h2 id="建模">建模</h2>

<ul>
  <li>一对多关系 <code class="language-plaintext highlighter-rouge">models.ForeignKey()</code></li>
  <li>多对多关系 <code class="language-plaintext highlighter-rouge">models.ManyToManyField()</code>,
    <ul>
      <li><code class="language-plaintext highlighter-rouge">null=True</code> 对多对多关系字段无效, 所以不需要</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">auto_now_add=True</code> 是创建时间的时候自动增加创建日期. 要注意, 如果添加了这个, 那么后台就没有办法对时间进行了编辑</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="c"># 导入django 默认自带的 User 用户模型</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>

<span class="c"># Create your models here.</span>


<span class="c"># 分类模型, 需要放在Post 类的上面</span>
<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="c"># 标签</span>
<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'标题'</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'正文'</span><span class="p">)</span>
    <span class="c"># auto_now_add 是</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'发布日期'</span><span class="p">)</span>
    <span class="c"># auto_now 意思是自动修改时会更新该字段为now</span>
    <span class="n">modified_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'修改日期'</span><span class="p">)</span>
    <span class="c"># 摘要</span>
    <span class="n">excerpt</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"摘要"</span><span class="p">)</span>
    <span class="c"># 浏览次数, 正整数字段</span>
    <span class="n">views</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'浏览次数'</span><span class="p">)</span>
    <span class="c"># 分类的外键. 默认</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"分类"</span><span class="p">)</span>
    <span class="c"># tag 多对多关联</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"标签"</span><span class="p">)</span>
    <span class="c"># 作者, User 类时从from django.contrib.auth.models import User 导入的</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'用户'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
	<span class="c"># redirect 会用到 Post 中定义的 get_absolute_url 方法找到对应的路径,然后进行跳转</span>
    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'blog:detail'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>


<span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'评论'</span><span class="p">)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'评论时间'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p>做数据迁移</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>python3.7 manage.py makemigrations

python3.7 manage.py migrate
</pre></td></tr></tbody></table>
</div>
</div>

<p>后台创建一些数据, 然后进入shell</p>

<p>python3.7 manage.py shell</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">Post</span>
<span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c"># 查看p 中对应的所有 tags 的标签</span>
<span class="n">p</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
<span class="c"># 查看tag 中是 post id 是 p 的所有 tag</span>
<span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">post</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="视图-viewspy">视图 views.py</h2>

<p><em>创建首页视图, 详情, 分类, 作者, 标签, 评论, 搜索结果, 边栏</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
<span class="c"># Create your views here.</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span><span class="p">,</span> <span class="n">DetailView</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">Review</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>
<span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span>
<span class="kn">import</span> <span class="nn">markdown</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-create_time'</span><span class="p">)</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'page'</span><span class="p">)</span>
    <span class="n">post_list</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/index.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'post_list'</span><span class="p">:</span> <span class="n">post_list</span><span class="p">,</span> <span class="p">})</span>


<span class="c">#</span>
<span class="k">def</span> <span class="nf">archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">):</span>
    <span class="c"># post_list = Post.objects.filter(create_time__year=year).filter(create_time__month=month).order_by('-create_time') # 这个方法和下一个方法效果相同</span>
    <span class="n">post_list</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">create_time__year</span><span class="o">=</span><span class="n">year</span><span class="p">,</span> <span class="n">create_time__month</span><span class="o">=</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-create_time'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/index.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'post_list'</span><span class="p">:</span> <span class="n">post_list</span><span class="p">,</span> <span class="p">})</span>


<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c">#p.save()</span>
    <span class="c"># 可以指定 更新的字段名. 好处是防止有其他字段被程序更新掉</span>
    <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s">'views'</span><span class="p">])</span>
    <span class="n">p</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
        <span class="s">'markdown.extensions.extra'</span><span class="p">,</span>       <span class="c">#</span>
        <span class="s">'markdown.extensions.codehilite'</span><span class="p">,</span>  <span class="c"># 代码高亮</span>
        <span class="s">'markdown.extensions.toc'</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/detail.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'p'</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="p">})</span>


<span class="k">def</span> <span class="nf">category</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/category.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'c'</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="p">})</span>

  
<span class="c"># 用类的方法也可以实现分类页</span>
<span class="c"># class CategoryView(DetailView):</span>
<span class="c">#    model = Category</span>
<span class="c">#    template_name = 'blog/category.html'</span>
  

<span class="k">def</span> <span class="nf">author</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/author.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'a'</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span>  <span class="p">})</span>


<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">review_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'review'</span><span class="p">])</span>
    <span class="n">r</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="n">viewname</span><span class="o">=</span><span class="s">'blog:detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="nb">id</span><span class="p">,)))</span>


<span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/tag.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'t'</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span>  <span class="p">})</span>


<span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">kwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'keyword'</span><span class="p">)</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">kwd</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"请输入关键词"</span><span class="p">)</span>
    <span class="n">post_list</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">title__contains</span><span class="o">=</span><span class="n">kwd</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">body__contains</span><span class="o">=</span><span class="n">kwd</span><span class="p">))</span>
    <span class="c"># s = sidebar()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/index.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'post_list'</span><span class="p">:</span> <span class="n">post_list</span><span class="p">,</span> <span class="p">})</span>


<span class="c"># 新博客的输入页面</span>
<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/new.html'</span><span class="p">)</span>


<span class="c"># 处理新创建的博客, 写入数据库</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">category_</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'category'</span><span class="p">])</span>
    <span class="n">author_</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">author_</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s">'tags'</span><span class="p">)))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'title'</span><span class="p">],</span> <span class="n">body</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'body'</span><span class="p">],</span> <span class="n">excerpt</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'excerpt'</span><span class="p">],</span> <span class="n">category</span><span class="o">=</span><span class="n">category_</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">author_</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s">'tags'</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">tag</span><span class="p">))</span>
    <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="n">viewname</span><span class="o">=</span><span class="s">'blog:detail'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="nb">id</span><span class="p">,)))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="urlspy-创建">URLs.py 创建</h2>

<p>创建 blog/urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">app_name</span> <span class="o">=</span> <span class="s">'blog'</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;id&gt;[0-9]+)/detail/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">detail</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'detail'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;year&gt;[0-9]4)/(?P&lt;month&gt;[0-9]{1,2})/archive/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">archive</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'archive'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;id&gt;[0-9]+)/category/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'category'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;id&gt;[0-9]+)/author/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">author</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'author'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;id&gt;[0-9]+)/review/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">review</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'review'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;id&gt;[0-9]+)/tag/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'tag'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^search/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'search'</span><span class="p">),</span>

<span class="p">]</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="模板">模板</h2>

<h3 id="创建一个基础模板-basehtml-用于被其他继承"><em>创建一个基础模板 base.html, 用于被其他继承</em></h3>

<p>技巧:</p>

<ul>
  <li>{% load staticfiles %} 读取静态文件</li>
  <li>{% static ‘blog/js/jquery-2.1.3.min.js’ %} 引用静态文件</li>
  <li>在css 和 js 代码下面增加如下 块, 这样就可以让子模板继承并添加自己的css , js 代码 <code class="language-plaintext highlighter-rouge">{% block css %}{% endblock %} {% block js %}{% endblock %}</code></li>
  <li>将框架在base.html 中定义, 把每个页面需要变动的地方用 <code class="language-plaintext highlighter-rouge">{% block main_content %}主要内容{% endblock %}</code> 留出来, 让子类模板继承.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre></td><td class="code"><pre><span class="p">{</span><span class="c"># 加载静态文件. #}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">staticfiles</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">blog_tags</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">title</span> <span class="o">%</span><span class="p">}</span><span class="n">Python1702</span> <span class="err">论坛</span><span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">meta</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s">"viewport"</span> <span class="n">content</span><span class="o">=</span><span class="s">"width=device-width, initial-scale=1"</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">css</span> <span class="o">--&gt;</span>

    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/css/ionicons.min.css' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/css/bootstrap.min.css' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/css/pace.css' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/css/custom.css' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/css/highlights/zenburn.css' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">css</span> <span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>


    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">js</span> <span class="o">--&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/js/jquery-2.1.3.min.js' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/js/bootstrap.min.js' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/js/pace.min.js' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/js/modernizr.custom.js' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">js</span> <span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"container"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">header</span> <span class="nb">id</span><span class="o">=</span><span class="s">"site-header"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"row"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"col-md-4 col-sm-5 col-xs-8"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"logo"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'blog:index' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">Py1702</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span> <span class="err">论坛</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">col</span><span class="o">-</span><span class="n">md</span><span class="o">-</span><span class="mi">4</span> <span class="o">--&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"col-md-8 col-sm-7 col-xs-4"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">nav</span> <span class="n">class</span><span class="o">=</span><span class="s">"main-nav"</span> <span class="n">role</span><span class="o">=</span><span class="s">"navigation"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"navbar-header"</span><span class="o">&gt;</span>

                            <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-navicon"</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'blog:index' </span><span class="si">%</span><span class="s">}"</span> <span class="n">data</span><span class="o">-</span><span class="n">hover</span><span class="o">=</span><span class="s">"首页"</span><span class="o">&gt;</span><span class="err">首页</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                            <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-navicon"</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'blog:new' </span><span class="si">%</span><span class="s">}"</span> <span class="n">data</span><span class="o">-</span><span class="n">hover</span><span class="o">=</span><span class="s">"博客"</span><span class="o">&gt;</span><span class="err">发表博客</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                            <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-navicon"</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"about.html"</span> <span class="n">data</span><span class="o">-</span><span class="n">hover</span><span class="o">=</span><span class="s">"注册"</span><span class="o">&gt;</span><span class="err">注册</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                            <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-navicon"</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"contact.html"</span> <span class="n">data</span><span class="o">-</span><span class="n">hover</span><span class="o">=</span><span class="s">"登录"</span><span class="o">&gt;</span><span class="err">登录</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>

                    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>


                <span class="o">&lt;/</span><span class="n">nav</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s">"header-search-box"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">a</span> <span class="nb">id</span><span class="o">=</span><span class="s">"search-menu"</span> <span class="n">href</span><span class="o">=</span><span class="s">"#"</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="nb">id</span><span class="o">=</span><span class="s">"search-icon"</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-ios-search-strong"</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s">"search-form"</span> <span class="n">class</span><span class="o">=</span><span class="s">"search-form"</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">form</span> <span class="n">role</span><span class="o">=</span><span class="s">"search"</span> <span class="n">method</span><span class="o">=</span><span class="s">"get"</span> <span class="nb">id</span><span class="o">=</span><span class="s">"searchform"</span> <span class="n">action</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'blog:search' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span>
                            <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
                            <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s">"search"</span> <span class="n">name</span><span class="o">=</span><span class="s">"keyword"</span> <span class="n">placeholder</span><span class="o">=</span><span class="s">"搜索"</span> <span class="n">required</span><span class="o">&gt;</span>
                            <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s">"submit"</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-ios-search-strong"</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                        <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">col</span><span class="o">-</span><span class="n">md</span><span class="o">-</span><span class="mi">8</span> <span class="o">--&gt;</span>
        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">header</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>


<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"content-body"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"container"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"row"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">main</span> <span class="n">class</span><span class="o">=</span><span class="s">"col-md-8"</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">main_content</span> <span class="o">%</span><span class="p">}</span>
                <span class="err">主要内容</span>

            <span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
            <span class="o">&lt;/</span><span class="n">main</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">aside</span> <span class="n">class</span><span class="o">=</span><span class="s">"col-md-4"</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">toc</span> <span class="o">%</span><span class="p">}</span>
                <span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget widget-recent-posts"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">h3</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget-title"</span><span class="o">&gt;</span><span class="err">最新文章</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="o">%</span> <span class="n">get_recent_posts</span> <span class="k">as</span> <span class="n">lastes_posts</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">latest_p</span> <span class="ow">in</span> <span class="n">lastes_posts</span> <span class="o">%</span><span class="p">}</span>
                            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
<span class="p">{</span><span class="c">#                                &lt;a href="{% url 'blog:detail' latest_p.id %}"&gt;{{ latest_p.title }}&lt;/a&gt;#}</span>
                                <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{{ latest_p.get_absolute_url }}"</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">latest_p</span><span class="o">.</span><span class="n">title</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                            <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="n">empty</span> <span class="o">%</span><span class="p">}</span>
                            <span class="err">暂无文章</span>
                        <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget widget-archives"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">h3</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget-title"</span><span class="o">&gt;</span><span class="err">归档</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="o">%</span> <span class="n">archives</span> <span class="k">as</span> <span class="n">dates</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span> <span class="o">%</span><span class="p">}</span>
                            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
                                <span class="p">{</span><span class="c"># url 反向生成 URL,  如果要传递多个参数, 参数间用空格分割. #}</span>
                                <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'blog:archive'  date.year date.month </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span> <span class="p">}}</span>
                                    <span class="err">年</span> <span class="p">{{</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span> <span class="p">}}</span> <span class="err">月</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                            <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="n">empty</span> <span class="o">%</span><span class="p">}</span>
                            <span class="err">暂无文章</span>
                        <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget widget-category"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">h3</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget-title"</span><span class="o">&gt;</span><span class="err">分类</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="o">%</span> <span class="n">get_categories</span> <span class="k">as</span> <span class="n">categories</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">cate</span> <span class="ow">in</span> <span class="n">categories</span> <span class="o">%</span><span class="p">}</span>
                            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
                                <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'blog:category' cate.id </span><span class="si">%</span><span class="s">} "</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">cate</span><span class="o">.</span><span class="n">name</span> <span class="p">}}</span><span class="o">&lt;</span><span class="n">span</span>
                                        <span class="n">class</span><span class="o">=</span><span class="s">"post-count"</span><span class="o">&gt;</span><span class="p">({{</span> <span class="n">cate</span><span class="o">.</span><span class="n">post_set</span><span class="o">.</span><span class="n">count</span> <span class="p">}})</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                            <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget widget-tag-cloud"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">h3</span> <span class="n">class</span><span class="o">=</span><span class="s">"widget-title"</span><span class="o">&gt;</span><span class="err">标签云</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
                    <span class="p">{</span><span class="o">%</span> <span class="n">get_tags</span> <span class="k">as</span> <span class="n">tags</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span> <span class="o">%</span><span class="p">}</span>
                            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span>
                                <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'blog:tag' tag.id </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                            <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
                        <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"rss"</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">""</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-social-rss-outline"</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">RSS</span> <span class="err">订阅</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">aside</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">footer</span> <span class="nb">id</span><span class="o">=</span><span class="s">"site-footer"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"container"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"row"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"col-md-12"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">p</span> <span class="n">class</span><span class="o">=</span><span class="s">"copyright"</span><span class="o">&gt;&amp;</span><span class="n">copy</span> <span class="mi">2017</span>
                <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">footer</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Mobile</span> <span class="n">Menu</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s">"overlay overlay-hugeinc"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s">"button"</span> <span class="n">class</span><span class="o">=</span><span class="s">"overlay-close"</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s">"ion-ios-close-empty"</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">nav</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"index.html"</span><span class="o">&gt;</span><span class="err">首页</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"full-width.html"</span><span class="o">&gt;</span><span class="err">博客</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"about.html"</span><span class="o">&gt;</span><span class="err">关于</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"contact.html"</span><span class="o">&gt;</span><span class="err">联系</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">nav</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'blog/js/script.js' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="创建首页模板-继承-templatesblogbasehtml"><em>创建首页模板, 继承 templates/blog/base.html</em></h3>

<ul>
  <li>{% extends “blog/base.html” %} 继承父类模板</li>
  <li>{% for post in post_list %} {% empty %} {% endfor %} 其中的 empty 是 当for 为空的情况时需要加载的模板样式.</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>{{ post.create_time</td>
          <td>date:”SHORT_DATE_FORMAT” }} 日期格式化. 也可以改成 date:”Y-m-D H:i:s”</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></td><td class="code"><pre>{% extends "blog/base.html" %}
{% block title %}首页{% endblock %}
{% block css %}

    <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
        <span class="nc">.entry-title</span> <span class="p">{</span>
            <span class="nl">text-align</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
            <span class="nl">margin-left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
            <span class="nl">padding-left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nc">.entry-meta</span> <span class="p">{</span>
            <span class="nl">text-align</span><span class="p">:</span> <span class="nb">right</span><span class="p">;</span>
            <span class="nl">margin-left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
            <span class="nl">padding-left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
{% endblock %}
{% block main_content %}
{% for post in post_list %}
                    <span class="nt">&lt;article</span> <span class="na">class=</span><span class="s">"post post-{{ post.pk }}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;header</span> <span class="na">class=</span><span class="s">"entry-header"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;h1</span> <span class="na">class=</span><span class="s">"entry-title"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:detail' post.id %}"</span><span class="nt">&gt;</span>{{ post.title }}<span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;/h1&gt;</span>
                            <span class="nt">&lt;h4&gt;</span>{{ post.excerpt }}<span class="nt">&lt;/h4&gt;</span>

                                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:detail' post.id %}"</span> <span class="na">class=</span><span class="s">"more-link"</span><span class="nt">&gt;</span>继续阅读 <span class="nt">&lt;span</span>
                                            <span class="na">class=</span><span class="s">"meta-nav"</span><span class="nt">&gt;</span>→<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>

                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"entry-meta"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"post-category"</span><span class="nt">&gt;&lt;a</span>
                                        <span class="na">href=</span><span class="s">"{% url 'blog:category' post.category.id %}"</span><span class="nt">&gt;</span>{{ post.category.name }}<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"post-date"</span><span class="nt">&gt;&lt;time</span> <span class="na">class=</span><span class="s">"entry-date"</span>
                                                              <span class="na">datetime=</span><span class="s">"{{ post.create_time }}"</span><span class="nt">&gt;</span>{{ post.create_time|date:"SHORT_DATE_FORMAT" }}<span class="nt">&lt;/time&gt;&lt;/span&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"post-author"</span><span class="nt">&gt;&lt;a</span>
                                        <span class="na">href=</span><span class="s">"{% url 'blog:author' post.author_id %} "</span><span class="nt">&gt;</span>{{ post.author }}<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"comments-link"</span><span class="nt">&gt;&lt;a</span>
                                        <span class="na">href=</span><span class="s">"{% url 'blog:detail' post.id %}"</span><span class="nt">&gt;</span>{{ post.review_set.count }} 评论<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
                                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"views-count"</span><span class="nt">&gt;</span>{{ post.views }} 阅读<span class="nt">&lt;/span&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/header&gt;</span>

                    <span class="nt">&lt;/article&gt;</span>
                {% empty %}
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"no-post"</span><span class="nt">&gt;</span>暂时还没有发布的文章！<span class="nt">&lt;/div&gt;</span>
                {% endfor %}

                {# 分页 #}
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"step-links"</span><span class="nt">&gt;</span>
                        {% if post_list.has_previous %}
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page=1"</span><span class="nt">&gt;</span><span class="ni">&amp;laquo;</span> 第一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ post_list.previous_page_number }}"</span><span class="nt">&gt;</span>上一页<span class="nt">&lt;/a&gt;</span>
                        {% endif %}

                        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"current"</span><span class="nt">&gt;</span>
                             <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> {{ post_list.number }} / {{ post_list.paginator.num_pages }} <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                        <span class="nt">&lt;/span&gt;</span>

                        {% if post_list.has_next %}
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ post_list.next_page_number }}"</span><span class="nt">&gt;</span>下一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ post_list.paginator.num_pages }}"</span><span class="nt">&gt;</span>最后一页 <span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;</span>
                        {% endif %}
                    <span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;/div&gt;</span>

{% endblock %}
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="在-detail-页-为blog-添加-markdown-功能">在 detail 页 为Blog 添加 Markdown 功能</h3>

<p><a href="https://segmentfault.com/a/1190000009536349">网上的详细介绍</a></p>

<p><em>首先安装 markdow 和 语法高亮的 Pygments 扩展</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>pip3.7 install markdown
pip3.7 install Pygments
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>视图函数导入markdown 和 Pygments</em></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">blog/views.py</code></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">markdown</span>
<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
        <span class="s">'markdown.extensions.extra'</span><span class="p">,</span>
        <span class="s">'markdown.extensions.codehilite'</span><span class="p">,</span>  <span class="c"># 语法高亮</span>
        <span class="s">'markdown.extensions.toc'</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">sidebar</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/detail.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'p'</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="s">'s'</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="p">})</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>在 模板中引入高亮样式, 并将需要显示 markdown语法的内容用 <code class="language-plaintext highlighter-rouge">Safe</code> 进行过滤</em></p>

<ul>
  <li>
    <table>
      <tbody>
        <tr>
          <td>{{ p.body</td>
          <td>safe }} 用于 告诉 Django 输出内容是安全的, 所以可以将源代码进行转义成Markdown 语法 并显示在网页上</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{% static 'blog/css/highlights/zenburn.css' %}"</span><span class="nt">&gt;</span>
...
{{ p.body|safe }}
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="创建自定义标签">创建自定义标签</h2>

<p>目的: 自定义标签可以在模板中被使用</p>

<p>方法:</p>

<ul>
  <li>在blog 目录下创建一个 templatetags 目录, 这个目录名是固定的</li>
  <li>创建空文件 <code class="language-plaintext highlighter-rouge">blog/templatetags/__init__.py</code> # 空文件</li>
  <li>创建标签文件 <code class="language-plaintext highlighter-rouge">blog/templatetags/blog_tags.py</code> 如下</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">from</span> <span class="nn">..models</span> <span class="kn">import</span> <span class="n">Post</span><span class="p">,</span> <span class="n">Category</span><span class="p">,</span> <span class="n">Tag</span>

<span class="c"># Library() 是 A class 用于注册模板标签和过滤器</span>
<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>


<span class="c"># @register.simple_tag 装饰器 将get_recent_posts() 方法注册成一个模板的标签</span>
<span class="nd">@register.simple_tag</span>
<span class="k">def</span> <span class="nf">get_recent_posts</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-create_time'</span><span class="p">)[:</span><span class="n">num</span><span class="p">]</span>


<span class="c"># @register.simple_tag 装饰器 将get_recent_posts() 方法注册成一个模板的标签</span>
<span class="nd">@register.simple_tag</span>
<span class="k">def</span> <span class="nf">archives</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s">'create_time'</span><span class="p">,</span> <span class="s">'month'</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">'DESC'</span><span class="p">)</span>


<span class="nd">@register.simple_tag</span>
<span class="k">def</span> <span class="nf">get_categories</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

<span class="nd">@register.simple_tag</span>
<span class="k">def</span> <span class="nf">get_tags</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>

</pre></td></tr></tbody></table>
</div>
</div>

<ul>
  <li>在 base.html 中对标签进行引用, 并循环输出内容.</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre></td><td class="code"><pre>
{# load blog_tags 会默认去 应用/templatetags 目录下去找 blog_tags.py 这个文件并获取它里面的所有注册了tags的函数 #}
{% load blog_tags %}

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"widget widget-recent-posts"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"widget-title"</span><span class="nt">&gt;</span>最新文章<span class="nt">&lt;/h3&gt;</span>
    {% get_recent_posts as lastes_posts %}
    <span class="nt">&lt;ul&gt;</span>
        {% for latest_p in lastes_posts %}
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:detail' latest_p.id %}"</span><span class="nt">&gt;</span>{{ latest_p.title }}<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        {% empty %}
            暂无文章
        {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"widget widget-archives"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"widget-title"</span><span class="nt">&gt;</span>归档<span class="nt">&lt;/h3&gt;</span>
    {% archives as dates %}
    <span class="nt">&lt;ul&gt;</span>
        {% for date in dates %}
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:archive'  date.year date.month %}"</span><span class="nt">&gt;</span>{{ date.year }}
                    年 {{ date.month }} 月<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"widget widget-category"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"widget-title"</span><span class="nt">&gt;</span>分类<span class="nt">&lt;/h3&gt;</span>
    {% get_categories as categories %}
    <span class="nt">&lt;ul&gt;</span>
        {% for cate in categories %}
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:category' cate.id %} "</span><span class="nt">&gt;</span>{{ cate.name }}<span class="nt">&lt;span</span>
                        <span class="na">class=</span><span class="s">"post-count"</span><span class="nt">&gt;</span>({{ cate.post_set.count }})<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"widget widget-tag-cloud"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"widget-title"</span><span class="nt">&gt;</span>标签云<span class="nt">&lt;/h3&gt;</span>
    {% get_tags as tags %}
    <span class="nt">&lt;ul&gt;</span>
        {% for tag in tags %}
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:tag' tag.id %}"</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="django实现登录注册">Django实现登录、注册</h2>

<p>本章将注册登录作为一个独立的app 在原有的项目中进行创建.</p>

<p><a href="http://blog.csdn.net/foryouslgme/article/details/51442860">参考</a></p>

<p>步骤:</p>

<ul>
  <li>创建app logReg, 并进行设置</li>
  <li>设计数据模型 User</li>
  <li>写视图函数 views.py</li>
  <li>设置路由 urls.py</li>
  <li>设置模板</li>
</ul>

<p><em>创建app logReg</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>django-admin startapp logReg
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>添加应用 mysite/settings.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="s">'logReg.apps.LogregConfig'</span><span class="p">,</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>修改 mysite/urls.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c"># path('logReg', include('logReg.url')),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r'^'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'logReg.urls'</span><span class="p">)),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>设计数据模型 logReg/models.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c"># Create your models here.</span>


<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'用户名'</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'密码'</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'邮件地址'</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="n">verbose_name</span><span class="o">=</span><span class="s">'激活状态'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">username</span>


</pre></td></tr></tbody></table>
</div>
</div>

<p><em>编辑视图文件  logReg/views.py</em></p>

<p>todo: 待续</p>

<h2 id="django-表单类-的使用--博客评论功能重构">Django 表单类 的使用 – 博客评论功能重构</h2>

<p><em>修改 评论数据模型 blog/models.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Review</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"作者"</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"邮箱"</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">URLField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"链接"</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">"内容"</span><span class="p">)</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">modified_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># 如果是跨app进行foreignkey, 那么需要在目标模型前面加上app 的名字, 或者是从另一个app中导入这个模型</span>
    <span class="c"># post = models.ForeignKey('blog.Post', on_delete=models.CASCADE)</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="c"># 只返回文本内容的钱20个文字.</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>创建 blog/forms/form.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="kn">import</span> <span class="n">Review</span>


<span class="c"># 创建一个表单类, 该类继承自django 的 ModelForm 基类</span>
<span class="k">class</span> <span class="nc">ReviewForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>

    <span class="c"># 嵌套类, 这个类是一个元数据类, 名字固定</span>
    <span class="c"># 这是一个 Inner Class,</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="c"># 指定元数据的数据模型是 Review</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Review</span>
        <span class="c"># 指定模型中需要哪些字段展现在form 表单中</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'email'</span><span class="p">,</span> <span class="s">'url'</span><span class="p">,</span> <span class="s">'body'</span><span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>修改原有的 review 方法 blog/view.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">.forms.form</span> <span class="kn">import</span> <span class="n">ReviewForm</span>

<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">ReviewForm</span><span class="p">()</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
        <span class="s">'markdown.extensions.extra'</span><span class="p">,</span>       <span class="c">#</span>
        <span class="s">'markdown.extensions.codehilite'</span><span class="p">,</span>  <span class="c"># 代码高亮</span>
        <span class="s">'markdown.extensions.toc'</span><span class="p">,</span>
    <span class="p">])</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/detail.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'p'</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span> <span class="s">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="p">})</span>


<span class="k">def</span> <span class="nf">review</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
    <span class="c"># 先建一个空表单</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">ReviewForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="c"># 如果有提交过来的POST 数据, 那么将数据作为参数放到表单对象中</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ReviewForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="c"># 验证表单是否符合数据格式要求(格式的要求就是 Models 中字段定义类型)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c"># form.save 是将表单对象(包括表单数据)保存在r对象中.</span>
            <span class="c"># commit=False 是暂时不存在数据库中.</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">commit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c"># 把缺的post对象加到r 对象中.</span>
            <span class="n">r</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="n">p</span>
            <span class="n">r</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c"># redirect 的定义如下:</span>
            <span class="c"># Return an HttpResponseRedirect to the appropriate URL for the arguments passed.</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"信息输入错误"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># return render(request, 'blog/detail.html', context={'id': id, 'form': form, })</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p><em>修改原有模板  templates/blog/detail.html</em></p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td class="code"><pre><span class="nt">&lt;section</span> <span class="na">class=</span><span class="s">"comment-area"</span> <span class="na">id=</span><span class="s">"comment-area"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;hr&gt;</span>
        <span class="nt">&lt;h3&gt;</span>发表评论<span class="nt">&lt;/h3&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"{% url 'blog:review' p.id %}"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">class=</span><span class="s">"comment-form"</span><span class="nt">&gt;</span>
            {% csrf_token %}
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>

                    {{ form.as_table }}

                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">class=</span><span class="s">"comment-btn"</span><span class="nt">&gt;</span>发表<span class="nt">&lt;/button&gt;</span>

                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>    <span class="c">&lt;!-- row --&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"comment-list-panel"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h3&gt;</span>评论列表，共 <span class="nt">&lt;span&gt;</span>{{ p.review_set.count }}<span class="nt">&lt;/span&gt;</span> 条评论<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"comment-list list-unstyled"</span><span class="nt">&gt;</span>
                {% for r in p.review_set.all %}
                <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"comment-item"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"nickname"</span><span class="nt">&gt;&lt;a</span> <span class="na">href=</span><span class="s">"mailto:{{ r.email }}"</span><span class="nt">&gt;</span>{{ r.name }}<span class="nt">&lt;/a&gt;</span>  <span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;time</span> <span class="na">class=</span><span class="s">"submit-date"</span> <span class="na">datetime=</span><span class="s">"{{ r.create_time }}"</span><span class="nt">&gt;</span>{{ r.create_time|date:'Y-m-d H:i:s' }}<span class="nt">&lt;/time&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{{ r.url }}"</span><span class="nt">&gt;</span>链接<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"text"</span><span class="nt">&gt;</span>
                        {{ r.body }}
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/li&gt;</span>
                {% empty %}
                    还没有任何评论啊...
                {% endfor %}
            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/section&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="分页功能-blogviewspy">分页功能 blog/views.py</h2>

<p>方法一 :</p>

<ul>
  <li>效果: <code class="language-plaintext highlighter-rouge">« 第一页    上一页     2 / 2</code></li>
</ul>

<p>blog/views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="c"># 导入分页模块</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'username'</span><span class="p">)</span>
    <span class="n">posts</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-create_time'</span><span class="p">)</span>
    <span class="c"># 实例化一个分页对象, 需要传递数据对象和每页的页数</span>
    <span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="c"># 获取传递过来的分页参数, 然后将参数</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'page'</span><span class="p">)</span>
    <span class="c"># 将当前页码传递到分页对象中, 获得一个列表对象.</span>
    <span class="n">post_list</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">get_page</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/index.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'post_list'</span><span class="p">:</span> <span class="n">post_list</span><span class="p">,</span>  <span class="p">})</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>templates/blog/index.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</pre></td><td class="code"><pre>{# 分页 #}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"step-links"</span><span class="nt">&gt;</span>
        {% if post_list.has_previous %}
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page=1"</span><span class="nt">&gt;</span><span class="ni">&amp;laquo;</span> 第一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ post_list.previous_page_number }}"</span><span class="nt">&gt;</span>上一页<span class="nt">&lt;/a&gt;</span>
        {% endif %}

        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"current"</span><span class="nt">&gt;</span>
             <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> {{ post_list.number }} / {{ post_list.paginator.num_pages }} <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
        <span class="nt">&lt;/span&gt;</span>

        {% if post_list.has_next %}
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ post_list.next_page_number }}"</span><span class="nt">&gt;</span>下一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ post_list.paginator.num_pages }}"</span><span class="nt">&gt;</span>最后一页 <span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;</span>
        {% endif %}
    <span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>方法二</p>

<ul>
  <li>效果和方法一一致: <code class="language-plaintext highlighter-rouge">« 第一页    上一页     2 / 2</code></li>
</ul>

<p>blog/views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'blog/index.html'</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'post_list'</span>
    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">5</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>templates/blog/index.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><pre>{#分页方法二#}
{% if is_paginated %}
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"step-links"</span><span class="nt">&gt;</span>
            {% if page_obj.has_previous %}
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page=1"</span><span class="nt">&gt;</span><span class="ni">&amp;laquo;</span> 第一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.previous_page_number }}"</span><span class="nt">&gt;</span>上一页<span class="nt">&lt;/a&gt;</span>
            {% endif %}

            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"current"</span><span class="nt">&gt;</span>
                 <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> {{ page_obj.number }} / {{ page_obj.paginator.num_pages }} <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
            <span class="nt">&lt;/span&gt;</span>

            {% if page_obj.has_next %}
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.next_page_number }}"</span><span class="nt">&gt;</span>下一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.paginator.num_pages }}"</span><span class="nt">&gt;</span>最后一页 <span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;</span>
            {% endif %}
        <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
{% endif %}
</pre></td></tr></tbody></table>
</div>
</div>

<p>方法三</p>

<ul>
  <li>视图函数不需要做任何修改, 只是改一下模板文件即可</li>
  <li>当要显示的数据条数大于<code class="language-plaintext highlighter-rouge">paginate_by</code> 时 <code class="language-plaintext highlighter-rouge">is_paginated</code> 为 True, 否则为False</li>
</ul>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></td><td class="code"><pre>{% if is_paginated %}
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"step-links"</span><span class="nt">&gt;</span>
            {% if page_obj.has_previous %}
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page=1"</span><span class="nt">&gt;</span><span class="ni">&amp;laquo;</span> 第一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.previous_page_number }}"</span><span class="nt">&gt;</span>上一页<span class="nt">&lt;/a&gt;</span>
            {% endif %}

            {% for x in page_obj.paginator.page_range %}
                {% if x == page_obj.number %}
                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"current"</span><span class="nt">&gt;</span>
                {% else %}
                    <span class="nt">&lt;span&gt;</span>
                {% endif %}
                        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ x }}"</span><span class="nt">&gt;</span>{{ x }}<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/span&gt;</span>
            {% endfor %}

            {% if page_obj.has_next %}
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.next_page_number }}"</span><span class="nt">&gt;</span>下一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.paginator.num_pages }}"</span><span class="nt">&gt;</span>最后一页 <span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;</span>
            {% endif %}
        <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
{% endif %}
</pre></td></tr></tbody></table>
</div>
</div>

<p>方法四: 用 telplatetags 方法实现. views.py 代码不变</p>

<p><em>blog/templatetags/blog_tags.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="kn">from</span> <span class="nn">django.utils.html</span> <span class="kn">import</span> <span class="n">format_html</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>

<span class="nd">@register.simple_tag</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">circle_page</span><span class="p">(</span><span class="n">curr_page</span><span class="p">,</span> <span class="n">loop_page</span><span class="p">):</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">curr_page</span> <span class="o">-</span> <span class="n">loop_page</span><span class="p">)</span>
    <span class="c"># 当前页左右留几个页码, 如果设置offset 为3, 那么就会显示5个页码</span>
    <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">curr_page</span> <span class="o">==</span> <span class="n">loop_page</span><span class="p">:</span>
            <span class="n">pe</span> <span class="o">=</span> <span class="s">'&lt;li class="active"&gt;&lt;a href="?page=</span><span class="si">%</span><span class="s">s"&gt;</span><span class="si">%</span><span class="s">s&lt;/a&gt;&lt;/li&gt;'</span> <span class="o">%</span> <span class="p">(</span><span class="n">loop_page</span><span class="p">,</span> <span class="n">loop_page</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pe</span> <span class="o">=</span> <span class="s">'&lt;li&gt;&lt;a href="?page=</span><span class="si">%</span><span class="s">s"&gt;</span><span class="si">%</span><span class="s">s&lt;/a&gt;&lt;/li&gt;'</span> <span class="o">%</span> <span class="p">(</span><span class="n">loop_page</span><span class="p">,</span> <span class="n">loop_page</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">format_html</span><span class="p">(</span><span class="n">pe</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">''</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>templates/blog/index.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre>{% load blog_tags %}

{% if is_paginated %}
        <span class="nt">&lt;nav</span> <span class="na">aria-label=</span><span class="s">"Page Navigation"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
                {% if page_obj.has_previous %}
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page=1"</span><span class="nt">&gt;</span><span class="ni">&amp;laquo;</span> 第一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span><span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.previous_page_number }}"</span><span class="nt">&gt;</span>上一页<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                {% endif %}

                {% for x in page_obj.paginator.page_range %}
                    {% circle_page page_obj.number x %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.next_page_number }}"</span><span class="nt">&gt;</span>下一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span><span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:index' %}?page={{ page_obj.paginator.num_pages }}"</span><span class="nt">&gt;</span>最后一页 <span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                {% endif %}
            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/nav&gt;</span>
    {% endif %}
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="简单搜索功能">简单搜索功能</h2>

<p>创建 form 表单</p>

<p>templates/base.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"header-search-box"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"search-menu"</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;&lt;span</span> <span class="na">id=</span><span class="s">"search-icon"</span> <span class="na">class=</span><span class="s">"ion-ios-search-strong"</span><span class="nt">&gt;&lt;/span&gt;&lt;/a&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"search-form"</span> <span class="na">class=</span><span class="s">"search-form"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">role=</span><span class="s">"search"</span> <span class="na">method=</span><span class="s">"get"</span> <span class="na">id=</span><span class="s">"searchform"</span> <span class="na">action=</span><span class="s">"{% url 'blog:search' %}"</span><span class="nt">&gt;</span>
            {% csrf_token %}
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">name=</span><span class="s">"q"</span> <span class="na">placeholder=</span><span class="s">"搜索"</span> <span class="na">required</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;&lt;span</span> <span class="na">class=</span><span class="s">"ion-ios-search-strong"</span><span class="nt">&gt;&lt;/span&gt;&lt;/button&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>定义视图函数 blog/views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'q'</span><span class="p">)</span>
    <span class="n">error_msg</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">q</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">"请输入关键词"</span><span class="p">)</span>
    <span class="c"># Q 类, 可以更简单的使用 &amp; 和 | 进行 类似 sql 的过滤功能</span>
    <span class="c"># Q 的官方定义: Encapsulate filters as objects that can then be combined logically (using `&amp;` and `|`).</span>
    <span class="n">post_list</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">title__contains</span><span class="o">=</span><span class="n">q</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">body__contains</span><span class="o">=</span><span class="n">q</span><span class="p">))</span>
    <span class="c"># s = sidebar()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'blog/index.html'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s">'post_list'</span><span class="p">:</span> <span class="n">post_list</span><span class="p">,</span> <span class="p">})</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>定义 路由  blog/urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^search/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">search</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'search'</span><span class="p">),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="实现高级搜索-whoosh-django-haystack">实现高级搜索 whoosh django-haystack</h2>

<p><a href="https://www.zmrenwu.com/post/45/">网上的资料</a></p>

<p><em>安装 搜索引擎需要的包</em></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>pip3.7 install jieba
pip3.7 install whoosh
pip3.7 install django-haystack
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>配置</em></p>

<p>mysite/settings.py app中注册一个新的应用heystack, 并配置haystack参数</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="s">'haystack'</span><span class="p">,</span>

<span class="o">...</span>

<span class="n">HAYSTATIC_CONNECTIONS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'default'</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">'ENGINE'</span><span class="p">:</span> <span class="s">'blog.whoosh_cn_backend.WhooshEngine'</span><span class="p">,</span>
        <span class="s">'PATH'</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'whoosh_index'</span><span class="p">),</span> <span class="c"># 创建索引后, 会在app 目录下生成一个 whoosh_index 文件夹</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">HAYSTACK_SEARCH_RESULTS_PER_PAGE</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">HAYSTACK_SIGNAL_PROCESSOR</span> <span class="o">=</span> <span class="s">'haystack.signals.RealtimeSignalProcessor'</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p><em>创建搜索文件</em></p>

<p>新建一个文件 blog/search_indexes.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">haystack</span> <span class="kn">import</span> <span class="n">indexes</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Post</span>


<span class="k">class</span> <span class="nc">PostIndex</span><span class="p">(</span><span class="n">indexes</span><span class="o">.</span><span class="n">SearchIndex</span><span class="p">,</span> <span class="n">indexes</span><span class="o">.</span><span class="n">Indexable</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">document</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">use_template</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Post</span>

    <span class="k">def</span> <span class="nf">index_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>创建文件post_text.txt 和对应目录</p>

<p>templates/search/indexes/blog/post_text.txt</p>

<p>指定要索引的内容</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>{{ object.title }}
{{ object.body }}
</pre></td></tr></tbody></table>
</div>
</div>

<p>修改 mysite/urls.py</p>

<p>haystack 是 pip 安装好的</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^search'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">'haystack.urls'</span><span class="p">)),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>将 blog/urls.py 中的 url 注释掉, 防止冲突</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre># url(r'^search/$', views.search, name='search'),
</pre></td></tr></tbody></table>
</div>
</div>

<p>将文件 /Users/dalong/code/python1702/django/day8/mysite/venv/lib/python3.7/site-packages/haystack/backends/whoosh_backend.py</p>

<p>拷贝到  /mysite/blog 目录下改名 whoosh_cn_backend.py</p>

<p>并对文件进行修改</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">jieba.analyse</span> <span class="kn">import</span> <span class="n">ChineseAnalyzer</span>

                <span class="c"># schema_fields[field_class.index_fieldname] = TEXT(stored=True, analyzer=StemmingAnalyzer(), field_boost=field_class.boost, sortable=True)</span>
                <span class="n">schema_fields</span><span class="p">[</span><span class="n">field_class</span><span class="o">.</span><span class="n">index_fieldname</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEXT</span><span class="p">(</span><span class="n">stored</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">analyzer</span><span class="o">=</span><span class="n">ChineseAnalyzer</span><span class="p">(),</span> <span class="n">field_boost</span><span class="o">=</span><span class="n">field_class</span><span class="o">.</span><span class="n">boost</span><span class="p">,</span> <span class="n">sortable</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>建立索引</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c"># python3.7 manage.py rebuild_index # 这个不行, 要用下一个</span>
python3.7 manage.py update_index
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="数据模型-modelspy-高级用法-class-meta-def-save">数据模型 models.py 高级用法 <code class="language-plaintext highlighter-rouge">class Meta; def save()</code></h2>

<ul>
  <li>save() 方法 可以帮助我们把一些没有填写的数据的字段按照我们到的需要进行保存</li>
  <li>class Meta 内嵌类可以帮助我们对数据进行默认排序.</li>
</ul>

<p><em>blog/models.py</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'标题'</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s">'正文'</span><span class="p">)</span>
    <span class="c"># auto_now_add 是</span>
    <span class="n">create_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'发布日期'</span><span class="p">)</span>
    <span class="c"># auto_now 意思是自动修改时会更新该字段为now</span>
    <span class="n">modified_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'修改日期'</span><span class="p">)</span>
    <span class="c"># 摘要</span>
    <span class="n">excerpt</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"摘要"</span><span class="p">)</span>
    <span class="c"># 浏览次数, 正整数字段</span>
    <span class="n">views</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'浏览次数'</span><span class="p">)</span>
    <span class="c"># 分类的外键. 默认</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"分类"</span><span class="p">)</span>
    <span class="c"># tag 多对多关联</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">"标签"</span><span class="p">)</span>
    <span class="c"># 作者, User 类时从from django.contrib.auth.models import User 导入的</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s">'用户'</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s">'blog:detail'</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">increase_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">views</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c"># # 可以指定 更新的字段名. 好处是防止有其他字段被程序更新掉</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s">'views'</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">excerpt</span><span class="p">:</span>
            <span class="c"># 首先实例化一个 markdown 类, 用于渲染 body 的文本</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">Markdown</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
                <span class="s">'markdown.extensions.extra'</span><span class="p">,</span>
                <span class="s">'markdown.extensions.codehilite'</span><span class="p">,</span>
            <span class="p">])</span>
            <span class="c"># 先将Markdown 语法转成 HTML 语法</span>
            <span class="c"># 再用 strip_tags 去掉 html 中的全部 html 标签</span>
            <span class="c"># 目的是将所有的 markdown 和 html 标签全部干掉.</span>
            <span class="c"># 最后从文本中获取前 54个字符, 赋值给 excerpt 字段</span>
            <span class="bp">self</span><span class="o">.</span> <span class="n">excerpt</span> <span class="o">=</span> <span class="n">strip_tags</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">))[:</span><span class="mi">54</span><span class="p">]</span>
        <span class="c"># 将过滤结果保存到数据库</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Post</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c"># 按时间倒序排序</span>
    <span class="c"># 这样一来, 就不需要在views.py中 用 get_queryset() 方法进行排序了</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s">'-create_time'</span><span class="p">]</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="面向对象-viewspy-传递多个上下文参数给模板">面向对象 views.py 传递多个上下文参数给模板</h2>

<p>该方法可以替代老实讲的方法, 实际分页代码只有1行</p>

<p>blog/views.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">TestView</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Post</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'blog/test2.html'</span>
    <span class="c"># context_object_name 专门指定模板中用来迭代 Post 数据模型的变量名</span>
    <span class="c"># 如果制定了 paginate_by , 那么就不需要再指定 context_object_name 了. 是二选一的</span>
    <span class="c"># context_object_name = 'pl'</span>

    <span class="c"># 一旦指定了 paginate_by 变量, 那么就不再需要 context_object_name 了.</span>
    <span class="c"># 而且在模板中可以直接使用 page_obj.object_list 对数据进行循环</span>
    <span class="c"># 并且使用 is_paginated, page_obj 的 has_previous, previous_page_number, has_next, next_page_number, number</span>
    <span class="c"># paginator.num_pages,  paginator.page_range 等 预定义的分页模板变量</span>
    <span class="n">paginate_by</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c"># get_context_data 用来定义附加的需要传递给模板的参数 -- context</span>
    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">object_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s">'aaa'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'aaa'</span>
        <span class="n">context</span><span class="p">[</span><span class="s">'bbb'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">context</span><span class="p">[</span><span class="s">'ccc'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123</span>
        <span class="n">context</span><span class="p">[</span><span class="s">'ddd'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'&lt;h2&gt;haha&lt;/h2&gt;'</span>
        <span class="k">return</span> <span class="n">context</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>blog/urls.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^test2/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">TestView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'test2'</span><span class="p">),</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>templates/blog/test2.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre>+++++
{{ aaa }}
+++++
{{ bbb }}
+++++
{{ ccc }}
+++++
{{ ddd }}

{#用 page_obj 对象 代替 context_object_name 定义的 post_list 对象#}
{#好处是可以少传一个参数#}
{% for p in page_obj.object_list %}
    <span class="nt">&lt;br&gt;&lt;hr&gt;</span> {{ p.title }}
{% endfor %}
分页方法二
{% if is_paginated %}
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pagination"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"step-links"</span><span class="nt">&gt;</span>
            {% if page_obj.has_previous %}
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:test2' %}?page=1"</span><span class="nt">&gt;</span><span class="ni">&amp;laquo;</span> 第一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:test2' %}?page={{ page_obj.previous_page_number }}"</span><span class="nt">&gt;</span>上一页<span class="nt">&lt;/a&gt;</span>
            {% endif %}

            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"current"</span><span class="nt">&gt;</span>
                 <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span> {{ page_obj.number }} / {{ page_obj.paginator.num_pages }} <span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
            <span class="nt">&lt;/span&gt;</span>

            {% if page_obj.has_next %}
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:test2' %}?page={{ page_obj.next_page_number }}"</span><span class="nt">&gt;</span>下一页<span class="nt">&lt;/a&gt;</span><span class="ni">&amp;nbsp;</span> <span class="ni">&amp;nbsp;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:test2' %}?page={{ page_obj.paginator.num_pages }}"</span><span class="nt">&gt;</span>最后一页 <span class="ni">&amp;raquo;</span><span class="nt">&lt;/a&gt;</span>
            {% endif %}
        <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
{% endif %}

</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="对数据进行统计过滤--aggregates--annotate">对数据进行统计过滤  <code class="language-plaintext highlighter-rouge">aggregates</code>  <code class="language-plaintext highlighter-rouge">annotate</code></h2>

<ul>
  <li>可以使用 <code class="language-plaintext highlighter-rouge">aggregates</code> 对想要获取的数据模型中的数据进行统计和过滤
    <ul>
      <li>官方解释: 官方描述: <em>Classes to represent the definitions of aggregate functions.</em></li>
      <li>其他可以进行统计的类还有: <code class="language-plaintext highlighter-rouge">'Aggregate', 'Avg', 'Count', 'Max', 'Min', 'StdDev', 'Sum'</code></li>
    </ul>
  </li>
  <li>使用方式是 <code class="language-plaintext highlighter-rouge">数据集.objects.annotate()</code> 方法中指定要进行统计的类型, 并对该类型进行过滤筛选</li>
  <li>objects.annotate() 可以理解为 对 objects.all() 进行修饰.
    <ul>
      <li>官方解释: <em>Return a query set in which the returned objects have been annotatedwith extra data or aggregations.</em></li>
      <li>annotate() 返回的对象和 objects.all() 返回的对象是一样的, 所以可以继续进行筛选过滤.</li>
    </ul>
  </li>
</ul>

<p>blog/templatetags/blog_tags.py</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>
<span class="c"># 导入django 的数据统计模型中的 总计类</span>
<span class="c"># 官方描述: Classes to represent the definitions of aggregate functions.</span>
<span class="c"># 其他可以进行统计的类还有: 'Aggregate', 'Avg', 'Count', 'Max', 'Min', 'StdDev', 'Sum', 'Variance',</span>
<span class="kn">from</span> <span class="nn">django.db.models.aggregates</span> <span class="kn">import</span> <span class="n">Count</span>

<span class="c"># Library() 是 A class 用于注册模板标签和过滤器</span>
<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>


<span class="c"># @register.simple_tag</span>
<span class="c"># def get_categories():</span>
<span class="c">#     return Category.objects.all()</span>

<span class="nd">@register.simple_tag</span>
<span class="k">def</span> <span class="nf">get_categories</span><span class="p">():</span>
  	<span class="c"># 将Category数据集中的post 外键关联进行统计, 并将统计结果赋值给 num_posts 变量.</span>
    <span class="c"># category 和 post 是一对多的关系</span>
    <span class="c"># 然后对该变量再次进行筛选, 去掉统计结果为 0 的分类</span>
    <span class="k">return</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">num_posts</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'post'</span><span class="p">))</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">num_posts__gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

  
<span class="nd">@register.simple_tag</span>
<span class="k">def</span> <span class="nf">get_tags</span><span class="p">():</span>
    <span class="c"># 这里对 tag 进行数据统计的目的是可以让统计为更多被标注过的标签变得更大些.</span>
    <span class="c"># 这里和上面的 get_category 方法实现一模一样.</span>
    <span class="c"># 但是要注意, tag 和 post 表时多对多关系.</span>
    <span class="k">return</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">num_posts</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s">'post'</span><span class="p">))</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">num_posts__gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

  
</pre></td></tr></tbody></table>
</div>
</div>

<p>模板 templates/base.html</p>

<div class="language-html highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre>{% load blog_tags %}

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"widget widget-category"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"widget-title"</span><span class="nt">&gt;</span>分类<span class="nt">&lt;/h3&gt;</span>
    {% get_categories as categories %}
    <span class="nt">&lt;ul&gt;</span>
        {% for cate in categories %}
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:category' cate.id %} "</span><span class="nt">&gt;</span>{{ cate.name }}<span class="nt">&lt;span</span>
                        <span class="na">class=</span><span class="s">"post-count"</span><span class="nt">&gt;</span>({{ cate.post_set.count }})<span class="nt">&lt;/span&gt;&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"widget widget-tag-cloud"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"widget-title"</span><span class="nt">&gt;</span>标签云<span class="nt">&lt;/h3&gt;</span>
    {% get_tags as tags %}
    <span class="nt">&lt;ul&gt;</span>
        {% for tag in tags %}
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{% url 'blog:tag' tag.id %}"</span><span class="nt">&gt;</span>{{ tag.name }}<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
        {% endfor %}
    <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>


            </div>

            <!-- Rating -->
            
            <div class="rating mb-4 d-flex align-items-center">
                <strong class="mr-1">Rating:</strong> <div class="rating-holder">
<div class="c-rating c-rating--regular" data-rating-value="4.5">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
</div>
</div>
            </div>
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2020-05-10">10 May 2020</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Django">Django</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//Flask-framework-for-Python/"> &laquo; Flask Framework for Python</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//Django-Rest-From-Zero-To-Hero/">Django Rest From Zero to Hero &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Thing",
    "name": "Django In Action"
  },
  "author": {
    "@type": "Person",
    "name": "Dalong"
  },
  "datePublished": "2020-05-10",
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": "4.5",
    "bestRating": "5"
  }
}
</script>

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Linux">Linux (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (16)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mysql">Mysql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Redis">Redis (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MongoDB">MongoDB (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Flask">Flask (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Django">Django (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DjangoRest">DjangoRest (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Web-development">Web development (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Numpy">Numpy (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Panda">Panda (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Sklearn">Sklearn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jupyter">Jupyter (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenCV">OpenCV (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AI">AI (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Science">Data Science (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Tensorflow">Tensorflow (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ML">ML (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Microservice">Microservice (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Docker">Docker (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Rest-API">Rest API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Container">Container (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#NLP">NLP (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS">AWS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture">Architecture (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Database">Database (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Storage">Storage (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DevOps">DevOps (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IAM">IAM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cloud">Cloud (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#API">API (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Migration">Data Migration (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Network">Network (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#YAML">YAML (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Security">Security (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#kubernetes">kubernetes (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Serverless">Serverless (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#CICD">CICD (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Agile">Agile (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Scrum">Scrum (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Design-Thinking">Design Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GCP">GCP (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Google-Cloud-Platform">Google Cloud Platform (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MLPS">MLPS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PIPL">PIPL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PII">PII (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#GDPR">GDPR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Metaverse">Metaverse (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#VR">VR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AR">AR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#XR">XR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Togaf">Togaf (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture-Thinking">Architecture Thinking (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ChatGPT">ChatGPT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenAI">OpenAI (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#LLM">LLM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Prompt">Prompt (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DALL-E">DALL-E (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OCR">OCR (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Face-API">Face API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Chat-Bot">Chat Bot (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Speech-Service">Speech Service (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Computer-Vision">Computer Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Custom-Vision">Custom Vision (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Video-indexer">Video indexer (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Translator">Translator (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Cognitive-Search">Cognitive Search (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Knowledge-Base">Knowledge Base (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ITIL">ITIL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IT">IT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Github">Github (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Liquid">Liquid (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Markdown">Markdown (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Node.js">Node.js (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Yarn">Yarn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Nest.JS">Nest.JS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Typescript">Typescript (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#javascript">javascript (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Restful-API">Restful API (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Postman">Postman (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Postgresql">Postgresql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#TypeORM">TypeORM (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 Dalong's personal blog 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="#">Designed</a> by Dalong.work
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>

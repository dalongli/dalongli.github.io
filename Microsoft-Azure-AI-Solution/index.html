<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>Designing and Implementing a Microsoft Azure AI Solution | Dalong's personal blog</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Designing and Implementing a Microsoft Azure AI Solution | Dalong’s personal blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Designing and Implementing a Microsoft Azure AI Solution" />
<meta name="author" content="Dalong" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="随着微软收购了 OpenAI, ChatGPT 的能力也融入到了 微软的 Azure 中. 我将带领大家了解 Microsoft Azure AI 不同服务, 包括 Cognitive Services, Computer Vision, Custom Vision, Video indexer, Natural Language Processing (NLP), Speech Service, Translate Language, OpenAI 等等. 还等什么, 让我们开始吧." />
<meta property="og:description" content="随着微软收购了 OpenAI, ChatGPT 的能力也融入到了 微软的 Azure 中. 我将带领大家了解 Microsoft Azure AI 不同服务, 包括 Cognitive Services, Computer Vision, Custom Vision, Video indexer, Natural Language Processing (NLP), Speech Service, Translate Language, OpenAI 等等. 还等什么, 让我们开始吧." />
<link rel="canonical" href="http://localhost:4000/Microsoft-Azure-AI-Solution/" />
<meta property="og:url" content="http://localhost:4000/Microsoft-Azure-AI-Solution/" />
<meta property="og:site_name" content="Dalong’s personal blog" />
<meta property="og:image" content="http://localhost:4000/assets/images/AzureAI.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-05-30T00:00:00+08:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Designing and Implementing a Microsoft Azure AI Solution","dateModified":"2023-05-30T00:00:00+08:00","datePublished":"2023-05-30T00:00:00+08:00","description":"随着微软收购了 OpenAI, ChatGPT 的能力也融入到了 微软的 Azure 中. 我将带领大家了解 Microsoft Azure AI 不同服务, 包括 Cognitive Services, Computer Vision, Custom Vision, Video indexer, Natural Language Processing (NLP), Speech Service, Translate Language, OpenAI 等等. 还等什么, 让我们开始吧.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Dalong"},"image":"http://localhost:4000/assets/images/AzureAI.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/Microsoft-Azure-AI-Solution/"},"url":"http://localhost:4000/Microsoft-Azure-AI-Solution/","author":{"@type":"Person","name":"Dalong"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
        <link rel="preconnect" href="https://fonts.googleapis.com"> 
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
        <link href="https://fonts.googleapis.com/css2?family=Carter+One&display=swap" rel="stylesheet">
    </noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="Dalong's personal blog">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link" href="/about">About</a>
                </li>

<!-- 以后再加上相关链接

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://bootstrapstarter.com/bootstrap-templates/template-mediumish-bootstrap-jekyll/"> Docs</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-wordpress/"><i class="fab fa-wordpress-simple"></i> WP Version</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://www.wowthemes.net/themes/mediumish-ghost/"><i class="fab fa-snapchat-ghost"></i> Ghost Version</a>
                </li>
-->
                <li class="nav-item">
                <a target="_blank" class="nav-link" href="https://github.com/dalongli"><i class="fab fa-github"></i> Fork on Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Dalong's personal blog</h1>
    <p class="lead">
        Record the bits and pieces of the technology big bang.
    </p>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Designing and Implementing a Microsoft Azure AI Solution&url=http://localhost:4000/Microsoft-Azure-AI-Solution/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/Microsoft-Azure-AI-Solution/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/Microsoft-Azure-AI-Solution/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="/assets/images/avatar_dl.png" alt="Dalong">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://dalongli.github.io/about">Dalong</a><a target="_blank" href="https://dalongli.github.io." class="btn follow">Follow</a>
                        <span class="author-description">A profesional technical consultant and blogger.</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Designing and Implementing a Microsoft Azure AI Solution</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/AzureAI.png" alt="Designing and Implementing a Microsoft Azure AI Solution">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <h3 class="font-weight-bold">Summary</h3>
                        <ul>
  <li><a href="#az-102-designing-and-implementing-a-microsoft-azure-ai-solution">AZ-102 Designing and Implementing a Microsoft Azure AI Solution</a>
    <ul>
      <li><a href="#资源">资源</a>
        <ul>
          <li><a href="#考试计划相关">考试计划相关</a></li>
          <li><a href="#考试大纲">考试大纲</a></li>
          <li><a href="#受众概况">受众概况</a></li>
          <li><a href="#计划和管理-azure-ai-解决方案-25-30">计划和管理 Azure AI 解决方案 (25-30%)</a></li>
          <li><a href="#实现图像和视频处理解决方案-15-20">实现图像和视频处理解决方案 (15-20%)</a></li>
          <li><a href="#实现自然语言处理解决方案-25-30">实现自然语言处理解决方案 (25-30%)</a></li>
          <li><a href="#实现知识挖掘解决方案-5-10">实现知识挖掘解决方案 (5-10%)</a></li>
          <li><a href="#实现对话式-ai-解决方案-15-20">实现对话式 AI 解决方案 (15-20%)</a></li>
        </ul>
      </li>
      <li><a href="#plan-and-manage">Plan and Manage</a></li>
      <li><a href="#创建认知服务资源">创建认知服务资源</a>
        <ul>
          <li><a href="#为认知服务创建-alert">为认知服务创建 Alert</a></li>
          <li><a href="#通过-metrics-来监控-认知服务">通过 Metrics 来监控 认知服务</a></li>
          <li><a href="#用-postman-调用-speech-service-api">用 postman 调用 speech service API</a></li>
          <li><a href="#设置-诊断-diagnostic-settings">设置 诊断 Diagnostic settings</a></li>
          <li><a href="#cognitive-service-security-安全">Cognitive Service Security 安全</a></li>
          <li><a href="#微软的--ai-policies-policy">微软的  AI Policies /Policy</a></li>
          <li><a href="#认知服务-容器-containers">认知服务 容器 containers</a></li>
        </ul>
      </li>
      <li><a href="#implement-computer-vision-soluiton-计算机视觉方案">Implement Computer Vision Soluiton 计算机视觉方案</a>
        <ul>
          <li><a href="#获取图片的-tag">获取图片的 tag</a></li>
          <li><a href="#获取图片的-描述-description">获取图片的 描述 Description</a></li>
          <li><a href="#identify-landmarks-and-celebrities-识别地标和名人">Identify landmarks and Celebrities 识别地标和名人</a></li>
          <li><a href="#identify-brands-in-image-品牌检测">Identify Brands in image, 品牌检测</a></li>
          <li><a href="#moderate-adult-content-适度中度的成人内容检测">Moderate Adult Content 适度(中度)的成人内容检测</a></li>
          <li><a href="#创建缩略图">创建缩略图</a></li>
          <li><a href="#从图片中获取文字---ocr">从图片中获取文字 - OCR</a></li>
        </ul>
      </li>
      <li><a href="#从图片中获取-面部信息-facial-infomation">从图片中获取 面部信息 Facial Infomation</a>
        <ul>
          <li><a href="#在图片中辨别和匹配一张脸-face-api">在图片中辨别和匹配一张脸 Face API</a></li>
          <li><a href="#在训练的模型中识别出一张脸">在训练的模型中识别出一张脸</a></li>
          <li><a href="#获取面部的参数信息">获取面部的参数信息</a></li>
        </ul>
      </li>
      <li><a href="#用-custom-vision-自定义视觉-进行图片分类">用 Custom Vision 自定义视觉 进行图片分类</a>
        <ul>
          <li><a href="#用-web-portal-训练-视觉分类模型-clasification-model">用 web portal 训练 视觉分类模型 (Clasification Model)</a></li>
          <li><a href="#用-python-训练-视觉分类模型-clasification-model">用 Python 训练 视觉分类模型 (Clasification Model)</a></li>
        </ul>
      </li>
      <li><a href="#用-object-detection-with-custom-version-自定义视觉-进行图片中的对象检测">用 Object Detection with Custom Version 自定义视觉 进行图片中的对象检测</a>
        <ul>
          <li><a href="#用-web-portal-来训练和使用-oblect-detection-model">用 web portal 来训练和使用 Oblect Detection Model</a></li>
          <li><a href="#用-python-来训练和使用-object-detection-model">用 python 来训练和使用 object detection model</a></li>
        </ul>
      </li>
      <li><a href="#用-video-indexer-来分析视频">用 video indexer 来分析视频</a>
        <ul>
          <li><a href="#video-indexer-in-action">video indexer in action</a></li>
        </ul>
      </li>
      <li><a href="#实现自然语言处理-natural-language-processing-nlp">实现自然语言处理 Natural Language Processing (NLP)</a>
        <ul>
          <li><a href="#文字处理-text-analytics">文字处理 Text Analytics</a>
            <ul>
              <li><a href="#key-phrases-extraction-关键字短语-抽取">Key Phrases extraction 关键字/短语 抽取</a></li>
              <li><a href="#entity-information-extract-抽取-文字中的实体信息">Entity information extract 抽取 文字中的实体信息</a></li>
              <li><a href="#抽取文字中的-sentiment-观点情感-信息">抽取文字中的 sentiment (观点/情感) 信息</a></li>
              <li><a href="#detect-the-language-used-in-text-检测文本用了什么语言">detect the language used in text 检测文本用了什么语言</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#speech-service-语音---文字互转">Speech Service (语音 - 文字互转)</a>
        <ul>
          <li><a href="#text-to-speech">Text to speech</a></li>
          <li><a href="#speech-to-text">Speech to Text</a></li>
        </ul>
      </li>
      <li><a href="#translate-language--翻译服务">Translate Language  翻译服务</a>
        <ul>
          <li><a href="#text-to-text-翻译">text to text 翻译</a></li>
          <li><a href="#speech-to-speech-翻译">speech to speech 翻译</a></li>
          <li><a href="#speech-to-text-翻译">Speech to text 翻译</a></li>
        </ul>
      </li>
      <li><a href="#luis-language-understanding-service-语言理解服务">LUIS Language Understanding Service 语言理解服务</a>
        <ul>
          <li><a href="#通过-luis-portal-使用-luis-ai">通过 LUIS portal 使用 LUIS AI</a></li>
          <li><a href="#luis-代码示例">LUIS 代码示例</a></li>
        </ul>
      </li>
      <li><a href="#cognitive-search">Cognitive Search</a></li>
      <li><a href="#qna-maker">QnA Maker</a></li>
      <li><a href="#bot-service---framework-sdk">Bot Service - Framework SDK</a>
        <ul>
          <li><a href="#echo-bot-聊天机器人">Echo Bot 聊天机器人</a></li>
          <li><a href="#welcome-bot">Welcome Bot</a></li>
          <li><a href="#bot-dialogs">Bot Dialogs</a></li>
          <li><a href="#adaptive-cards-适应卡">Adaptive Cards 适应卡</a></li>
          <li><a href="#tracking-events-with-application-insights">Tracking Events with Application Insights</a></li>
          <li><a href="#把-bot-和其他-cognitive-服务整合">把 Bot 和其他 cognitive 服务整合</a></li>
        </ul>
      </li>
      <li><a href="#用-botframework-composer-来创建机器人">用 BotFramework-Composer 来创建机器人</a></li>
      <li><a href="#练习题总结">练习题总结</a>
        <ul>
          <li><a href="#bot-framework">Bot Framework</a></li>
          <li><a href="#qna-和-knowledge-base-知识库">QnA 和 Knowledge Base 知识库</a></li>
          <li><a href="#luis">LUIS</a></li>
          <li><a href="#认知搜索">认知搜索</a></li>
          <li><a href="#speech">Speech</a></li>
          <li><a href="#translator">Translator</a></li>
          <li><a href="#text-analytics">Text Analytics</a></li>
          <li><a href="#video-analyzer">Video analyzer</a></li>
          <li><a href="#custom-vision">Custom Vision</a></li>
          <li><a href="#computer-vision">Computer Vision</a></li>
          <li><a href="#脸部识别-face-api">脸部识别 Face API</a></li>
          <li><a href="#认知服务-policy--日志--principle">认知服务 Policy / 日志 / Principle</a></li>
          <li><a href="#安全">安全</a></li>
          <li><a href="#devops">DevOps</a></li>
          <li><a href="#cost">Cost</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>随着微软收购了 OpenAI, ChatGPT 的能力也融入到了 微软的 Azure 中. 我将带领大家了解 Microsoft Azure AI 不同服务, 包括 Cognitive Services, Computer Vision, Custom Vision, Video indexer, Natural Language Processing (NLP), Speech Service, Translate Language, OpenAI 等等. 还等什么, 让我们开始吧.</p>

<h1 id="az-102-designing-and-implementing-a-microsoft-azure-ai-solution">AZ-102 Designing and Implementing a Microsoft Azure AI Solution</h1>

<p>[TOC]</p>

<h2 id="资源">资源</h2>
<p><a href="https://learn.microsoft.com/en-us/certifications/exams/ai-102?source=recommendations">官网考试介绍</a>
<a href="https://pts.measureup.com/web/PBS/LMS/index.php?l=1&amp;k=8470033&amp;tam=2239279&amp;role=1&amp;course=at_test202108190737001629358620">官网提供的练习题</a>
<a href="https://ibm.ent.box.com/s/2xyk6ol34gveidavuyj102lrmeygr7og/file/836586127926">考试券申请流程</a> or 看 57文件夹 中的word 文档
<a href="https://esi.microsoft.com/getcertification">预约考试 + 考试券申请 + 模拟考题练习</a>  目前只能申请 50% 的折扣 
Wendy: 这个事儿global正在协调，会给我们发免费券。具体流程announce后大家就可以考了。
<a href="https://learn.microsoft.com/zh-cn/certifications/resources/study-guides/ai-102#skills-measured-as-of-may-2-2023">2023年 5 月 2 日之后的考试的技能要求</a>
<a href="https://learn.microsoft.com/zh-cn/certifications/request-accommodations?source=recommendations">考试便利相关说明</a>
<a href="https://home.pearsonvue.com/getattachment/926b7ba7-a45b-4d50-b8e0-663917554885/English%20as%20a%20Second%20Language%20ESL%20Request%20Form-999930.aspx">英语作为第二语言考试需要填写的表格, 填写后可以获取额外的考试时间</a>  要先拿到这个 额外时间的 approval, 再去 schedule 考试时间
<a href="https://github.com/Azure-Samples">github 上的 azure sample code repositories</a>
<a href="https://github.com/Azure-Samples/cognitive-services-python-sdk-samples">cognitive-services-python-sdk-samples</a>
<a href="https://azure.microsoft.com/en-us/products/cognitive-services/openai-service">Azure OpenAI 服务</a>
<a href="https://azure.microsoft.com/en-us/products/cognitive-services/#api">Azure cognitive Service API</a> 
<a href="https://azure.microsoft.com/en-us/products/cognitive-services/#overview">Azure Cognitive Service Overview</a>
<a href="https://portal.azure.com/#view/Microsoft_Azure_ProjectOxford/CognitiveServicesHub/~/SpeechServices">Azure Cognitive Service 登录后的服务</a>
<a href="https://azure.microsoft.com/zh-cn/pricing/details/cognitive-services/">认知服务定价</a>
<a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli-macos">Mac 上安装 Azure 命令行</a>
<a href="https://learn.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account-cli?tabs=macos">Mac 命令行创建 Cognitive Service</a>
<a href="https://www.microsoft.com/en-us/ai/responsible-ai?activetab=pivot1%3aprimaryr6">微软的 AI principles 原则</a>
<a href="https://aka.ms/azsdk/python/all">可用 PIP 安装的 Python 的 Azure library</a>
<a href="https://azure.github.io/azure-sdk/releases/latest/all/python.html">Azure SDK Release for Python</a></p>

<h3 id="考试计划相关">考试计划相关</h3>

<p><strong>考试当天：</strong></p>

<p>建议考生提前 30 分钟登录帐户开始检录流程，以便留出时间解决任何故障问题。
这将让考生做好充分准备，但并不保证可提前入场或开始考试。
如果考生迟到15分钟以上，将不得参加考试，且不大可能获得退款。</p>

<p><strong>进入考试页面：</strong></p>

<p>在考试确认、改期或提醒邮件中选择签到（Check-in）以开始考试。
<a href="https://home.pearsonvue.com/microsoft/onvue">登录</a>
<a href="https://wsr.pearsonvue.com/testtaker/registration/Dashboard.htm?conversationId=632646">修改预约</a>
<a href="https://urldefense.proofpoint.com/v2/url?u=https-3A__examlaunchpad.pearsonvue.com_entry-2Dpoint_launch-2Dexam_MICROSOFT_OP-3FregistrationToken-3Dgoa6Pi5nbLkirsP7ZW0cFkLfSG6eEgOaf2OVrMYFuJpsr5lC2HXNy6OtGfNX4cyd0rD-252BEf8bI33oG0mIuGiEYpPU-252BjOTTL3NQtzL3BXzj6CeJEO5czz0sV5y4-252BcfxlNPw7rHFzIeyzTaxhW-252FEUMLbg-253D-253D-26locale-3Dzh-2DCN&amp;d=DwMFaQ&amp;c=jf_iaSHvJObTbx-siA1ZOg&amp;r=GLwRVU7hck8WtQLt00OlfCENdMd8AeFwl22sHdgXegI&amp;m=GBbXuvHYOLPLfRywUPBpiW0oKcBt9Hhoy3s7PWmL3iKoAir_oC2ahvKG60fhhAtL&amp;s=9j_FXpZP68-clvlHeqk9xtnLkWSVGKej3e9gV8VtX8o&amp;e=">考试入口</a>
查看即将进行的考试预约，
按照屏幕上的提示完成检录流程，
考生须完成检录后方可开始考试。</p>

<p><strong>考试改期规定</strong></p>

<p>如果您需要改期考试预约，请确保至少在您预约的考试时间 24 个小时前改期。如果您没有在考试预约时间 24 个小时前改期，我们将不会退还您的考试费用和/或您所在的公司可能需要付费。</p>

<p><strong>考试取消规定</strong></p>

<p>如果您需要取消考试预约，请确保至少在您预约的考试时间 24 个小时前取消。如果您没有在考试预约时间 24 个小时前取消，我们将不会退还您的考试费用和/或您所在的公司可能需要付费。</p>

<h3 id="考试大纲">考试大纲</h3>
<p>自 2023 年 5 月 2 日起测试的技能, 基本没啥变化
58 道题, 120 分钟, 可以额外申请 30 分钟? 
总共 1000 分, 700 分通过 , 70% 正确率</p>

<h3 id="受众概况">受众概况</h3>
<p>Microsoft Azure AI 工程师构建、管理和部署充分利用 Azure 认知服务和 Azure 服务的 AI 解决方案。 他们的职责包括参与 AI 解决方案开发的所有阶段，从需求定义和设计到开发、部署、集成、维护、性能优化和监视。
这些专业人员与解决方案架构师合作将其愿景转化为事实，并与数据科学家、数据工程师、IoT 专家、基础结构管理员和其他软件开发人员合作，以构建完整的端到端 AI 解决方案。
Azure AI 工程师具有开发使用 Python 或 C# 等语言的解决方案的经验，并且应该能够使用基于 REST 的 API 和软件开发工具包 (SDK) 来构建安全的图像处理、视频处理、自然语言处理 (NLP)、知识挖掘和对话式 AI 解决方案。 他们应熟悉实现 AI 解决方案的所有方法。 此外，他们了解构成 Azure AI 产品组合的组件以及可用的数据存储选项。 Azure AI 工程师还需要理解并能够应用负责任 AI 原则。</p>
<ul>
  <li>计划和管理 Azure AI 解决方案 (25-30%)</li>
  <li>实现图像和视频处理解决方案 (15-20%)</li>
  <li>实现自然语言处理解决方案 (25-30%)</li>
  <li>实现知识挖掘解决方案 (5-10%)</li>
  <li>实现对话式 AI 解决方案 (15-20%)</li>
</ul>

<h3 id="计划和管理-azure-ai-解决方案-25-30">计划和管理 Azure AI 解决方案 (25-30%)</h3>

<p>选择适当的 Azure AI 服务</p>
<ul>
  <li>为视觉解决方案选择适当的服务</li>
  <li>为语言分析解决方案选择适当的服务</li>
  <li>为决策支持解决方案选择适当的服务</li>
  <li>为语音解决方案选择适当的服务
选择适当的应用 AI 服务</li>
  <li>为 Azure AI 服务计划和配置安全性</li>
  <li>管理帐户密钥</li>
  <li>管理资源的身份验证</li>
  <li>使用 Azure 虚拟网络保护服务</li>
  <li>计划符合负责任 AI 原则的解决方案
创建和管理 Azure AI 服务</li>
  <li>创建 Azure AI 资源</li>
  <li>配置诊断日志记录</li>
  <li>管理 Azure AI 服务的成本</li>
  <li>监视 Azure AI 资源
部署 Azure AI 服务</li>
  <li>确定服务的默认终结点</li>
  <li>使用 Azure 门户创建资源</li>
  <li>将 Azure AI 服务集成到持续集成/持续部署 (CI/CD) 管道中</li>
  <li>计划容器部署</li>
  <li>在连接的环境中实现预生成容器
创建解决方案以检测异常并改进内容</li>
  <li>创建使用异常检测器（认知服务的一部分）的解决方案</li>
  <li>创建使用 Azure 内容审查器（认知服务的一部分）的解决方案</li>
  <li>创建使用个性化体验创建服务（认知服务的一部分）的解决方案</li>
  <li>创建使用 Azure 指标顾问（Azure 应用 AI 服务的一部分）的解决方案</li>
  <li>创建使用 Azure 沉浸式阅读器（Azure 应用 AI 服务的一部分）的解决方案</li>
</ul>

<h3 id="实现图像和视频处理解决方案-15-20">实现图像和视频处理解决方案 (15-20%)</h3>

<p>分析图像</p>
<ul>
  <li>选择适当的视觉特征以满足图像处理要求</li>
  <li>创建图像处理请求以包含适当的图像分析功能</li>
  <li>解释图像处理响应
从图像中提取文本</li>
  <li>使用计算机视觉服务从图像或 PDF 中提取文本</li>
  <li>使用计算机视觉服务转换手写文本</li>
  <li>使用 Azure 表单识别器中的预生成模型提取信息</li>
  <li>为 Azure 表单识别器生成和优化自定义模型
使用自定义视觉服务（Azure 认知服务的一部分）实现图像分类和物体检测</li>
  <li>在图像分类和物体检测模型之间选择</li>
  <li>指定模型配置选项，包括类别、版本和压缩</li>
  <li>标记图像</li>
  <li>训练自定义图像模型，包括分类器和检测器</li>
  <li>管理训练迭代</li>
  <li>评估模型指标</li>
  <li>发布已训练的模型迭代</li>
  <li>导出模型以在特定目标上运行</li>
  <li>以 Docker 容器形式实现自定义视觉模型</li>
  <li>解释模型响应
处理视频</li>
  <li>使用 Azure 视频索引器处理视频</li>
  <li>使用 Azure 视频索引器从视频或实时流中提取见解</li>
  <li>使用 Azure 视频索引器实现内容审核</li>
  <li>将自定义语言模型集成到 Azure 视频索引器中</li>
</ul>

<h3 id="实现自然语言处理解决方案-25-30">实现自然语言处理解决方案 (25-30%)</h3>

<p>分析文本</p>
<ul>
  <li>检索和处理关键短语</li>
  <li>检索和处理实体</li>
  <li>检索和处理情绪</li>
  <li>检测文本中使用的语言</li>
  <li>检测个人身份信息 (PII)
处理语音</li>
  <li>实现和自定义文本转语音</li>
  <li>实现和自定义语音转文本</li>
  <li>使用 SSML 和神经网络定制声音改进文本转语音</li>
  <li>使用短语列表和自定义语音识别改进语音转文本</li>
  <li>实现意向识别</li>
  <li>实现关键字识别
转换语言</li>
  <li>使用转换器服务转换文本和文档</li>
  <li>实现自定义转换，包括训练、改进和发布自定义模型</li>
  <li>使用语音服务将语音转换为语音</li>
  <li>使用语音服务将语音转换为文本</li>
  <li>同时转换为多种语言
生成和管理语言理解模型</li>
  <li>创建意向并添加语句</li>
  <li>创建实体</li>
  <li>训练、评估、部署和测试语言理解模型</li>
  <li>优化语言理解 (LUIS) 模型</li>
  <li>使用 Orchestrator 集成多种语言服务模型</li>
  <li>导入和导出语言理解模型
创建问题解答解决方案</li>
  <li>创建问题解答项目</li>
  <li>手动添加问答对</li>
  <li>导入源</li>
  <li>训练和测试知识库</li>
  <li>发布知识库</li>
  <li>创建多回合对话</li>
  <li>添加备用措辞</li>
  <li>向知识库添加聊天内容</li>
  <li>导入知识库</li>
  <li>创建多语言问题解答解决方案</li>
  <li>创建多域问题解答解决方案</li>
  <li>对问答对使用元数据</li>
</ul>

<h3 id="实现知识挖掘解决方案-5-10">实现知识挖掘解决方案 (5-10%)</h3>

<p>实现认知搜索解决方案</p>
<ul>
  <li>预配认知搜索资源</li>
  <li>创建数据源</li>
  <li>定义索引</li>
  <li>创建并运行索引器</li>
  <li>查询索引，包括语法、排序、筛选和通配符</li>
  <li>管理知识存储投影，包括文件、对象和表投影
将 AI 扩充技能应用于索引器管道</li>
  <li>将认知服务帐户附加到技能组</li>
  <li>选择并包含文档的内置技能</li>
  <li>实现自定义技能并将其包含在技能组中</li>
  <li>实现增量扩充</li>
</ul>

<h3 id="实现对话式-ai-解决方案-15-20">实现对话式 AI 解决方案 (15-20%)</h3>

<p>设计和实现对话流</p>
<ul>
  <li>设计机器人的对话逻辑</li>
  <li>为机器人选择合适的活动处理程序、对话或主题、触发器和状态处理
生成对话机器人</li>
  <li>通过模板创建机器人</li>
  <li>从头开始创建机器人</li>
  <li>实现活动处理程序、对话或主题和触发器</li>
  <li>实现特定于通道的逻辑</li>
  <li>实现自适应卡片</li>
  <li>在机器人中实现多语言支持</li>
  <li>实现多步骤对话</li>
  <li>管理机器人的状态</li>
  <li>将认知服务集成到机器人中，包括问题解答、语言理解和语音服务
测试、发布和维护对话机器人</li>
  <li>使用 Bot Framework Emulator 或 Power Virtual Agents Web 应用测试机器人</li>
  <li>在特定于通道的环境中测试机器人</li>
  <li>排查对话机器人问题</li>
  <li>部署机器人逻辑</li>
</ul>

<h2 id="plan-and-manage">Plan and Manage</h2>

<p>Azure Cognitive Service 的概念</p>
<ul>
  <li>预先训练好的 ML models</li>
  <li>可以方便的把 AI functions 集成到我们自己的代码中</li>
  <li>不需要 ML 的经验</li>
</ul>

<p><strong>Cognitive API</strong></p>
<ul>
  <li>包含了4大类
    <ul>
      <li>Vision Service
        <ul>
          <li>Image analysis
            <ul>
              <li>分析图片和视频中的物体</li>
            </ul>
          </li>
          <li>Spatial analysis
            <ul>
              <li>空间识别, 实时分析空间中的人和移动</li>
              <li>比如商店 checkout 区域的排队人数分析</li>
            </ul>
          </li>
          <li>Optical character recognition (OCR)
            <ul>
              <li>识别图片中的文字</li>
            </ul>
          </li>
          <li>Facial recognition
            <ul>
              <li>探测面部, 识别人, 识别情感</li>
            </ul>
          </li>
          <li>基于我们自己的图片训练 ML model, 来使用我们自己的业务需要</li>
        </ul>
      </li>
      <li>Speech Service
        <ul>
          <li>speech to text
            <ul>
              <li>语音转文字</li>
            </ul>
          </li>
          <li>text to speech
            <ul>
              <li>文字转语音</li>
            </ul>
          </li>
          <li>speech translation
            <ul>
              <li>语音翻译</li>
            </ul>
          </li>
          <li>speaker recognition (preview)
            <ul>
              <li>语音识别是谁</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Language Service
        <ul>
          <li>Language Understanding(LUIS)
            <ul>
              <li>内容可以用于Bing, 给一个关键词, bing 通过 LUIS 来进行搜索</li>
            </ul>
          </li>
          <li>QnA Maker
            <ul>
              <li>和 chatbot 关联</li>
            </ul>
          </li>
          <li>Text Analytics</li>
          <li>Translator (90种语言)
            <ul>
              <li>不但可以翻译, 还可以分析被翻译的内容的情感, 链接, PII 等信息</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Decision Service
        <ul>
          <li>Anomaly Detector (异常检测)</li>
          <li>Content Moderator (内容审查器)
            <ul>
              <li>分析数据趋势, 画图, 预测波峰波谷</li>
            </ul>
          </li>
          <li>Personalizer  (个性化)
            <ul>
              <li>是一个决策服务, 通过强化学习大规模做出更明智的决策</li>
              <li>比如商品推荐, 电影推荐, 文章推荐,  广告推荐, 智能消息推送</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="创建认知服务资源">创建认知服务资源</h2>

<p>概念</p>
<ul>
  <li>Subscription
    <ul>
      <li>订阅, 所有在同一个订阅下的资源分享同一个bill (收费订单)</li>
      <li>目前有的两个 subscription
        <ul>
          <li><code class="language-plaintext highlighter-rouge">Free Tier</code></li>
          <li><code class="language-plaintext highlighter-rouge">Pay as you go</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Resource Group
    <ul>
      <li>资源组, 同一个资源组下面的资源分享同样的生命周期, 权限和 policy</li>
      <li>目前创建的 Resource Group
        <ul>
          <li><code class="language-plaintext highlighter-rouge">dl-cogsvs-group</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Region
    <ul>
      <li>国家</li>
    </ul>
  </li>
  <li>Instance Name
    <ul>
      <li>资源的名字, 只能是字母和中划线</li>
      <li>目前创建的 Cognitive Service 是
        <ul>
          <li><code class="language-plaintext highlighter-rouge">dl-cogsvs</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Pricing Tier
    <ul>
      <li>定价</li>
      <li>目前的几种定价
        <ul>
          <li><code class="language-plaintext highlighter-rouge">s0</code></li>
          <li><code class="language-plaintext highlighter-rouge">s1</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Key
    <ul>
      <li>用来访问认知服务 API 的, 不能分享给别人, 否则别人用了, 我需要付费.</li>
      <li><code class="language-plaintext highlighter-rouge">1010f2e03585456db07c30cc04c9e520</code></li>
      <li>默认有2个key</li>
      <li>key 可以 regenerate 重建</li>
    </ul>
  </li>
  <li>Endpoint
    <ul>
      <li>登录点, 访问认知服务 API 的 URL 地址</li>
      <li><code class="language-plaintext highlighter-rouge">https://dl-cogsvs.cognitiveservices.azure.com/</code>
        <ul>
          <li>dl-cogsvs 是我们创建的认知服务资源名字</li>
          <li>cognitiveservices.azure.com 是官方确认的域名</li>
          <li>具体的认知服务会拼接到这个域名的后面</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>创建流程</p>
<ol>
  <li>进入认知服务 console</li>
  <li>底部看到 Cognitive Service Multi-service Account</li>
  <li>点进去, 创建一个认知服务账户</li>
  <li>完成创建</li>
</ol>

<h3 id="为认知服务创建-alert">为认知服务创建 Alert</h3>

<p>概念</p>
<ul>
  <li>alert rule
    <ul>
      <li>就是一个 alert 的规则</li>
      <li>一个 alert rule 可以产生多个 alert</li>
      <li>这里的alert rule 的名字是
        <ul>
          <li><code class="language-plaintext highlighter-rouge">dl-alert-rule-checking-total-calls</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Signal
    <ul>
      <li>信号, 就是需要监控的目标, 可以是
        <ul>
          <li>Total calls</li>
          <li>Total errors</li>
          <li>latency</li>
          <li>Client errors</li>
          <li>Server errors</li>
          <li>…</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Action Group
    <ul>
      <li>一系列的action 可以一起应用到一个 alert rule 中</li>
      <li>当alert rule 被触发, 可以同时触发 action</li>
      <li>action 包括
        <ul>
          <li>通过邮件形式发送信息给指定邮件地址</li>
          <li>发送邮件给指定的当前 cognitive service 的 相关人员</li>
          <li>调用 function</li>
          <li>调用某个网址</li>
          <li>…</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="通过-metrics-来监控-认知服务">通过 Metrics 来监控 认知服务</h3>

<p>Metrics 可以通过监控一些指标来 实时通过 chart 方式查看认知服务情况</p>
<ul>
  <li>Metrics 可监控的指标包括
    <ul>
      <li>http 请求相关
        <ul>
          <li>Avaibility</li>
          <li>BlockedCalls</li>
          <li>ClentError</li>
          <li>Latency</li>
          <li>ServerError</li>
          <li>Data in/out</li>
          <li>Total Calls</li>
          <li>Total Errors</li>
          <li>Total Token Calls</li>
          <li>…</li>
        </ul>
      </li>
      <li>Usage 相关
        <ul>
          <li>Auto seconds translated</li>
          <li>Face images trained</li>
          <li>LUIS Speech Requested</li>
          <li>Processed Images</li>
          <li>QA text records</li>
          <li>Text charactors translated</li>
          <li>Voice model training minutes</li>
          <li>还有很多…</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>创建好一个新的 chart 后就可以通过图表实时监控了</li>
</ul>

<h3 id="用-postman-调用-speech-service-api">用 postman 调用 speech service API</h3>
<p><a href="https://www.youtube.com/watch?v=bmxtEWFmSPM">网上的教学</a></p>
<ol>
  <li>先创建一个 speech service</li>
  <li>进入postman, 创建一个 post request
    <ol>
      <li>填入 speech service 提供的 url
        <ol>
          <li><code class="language-plaintext highlighter-rouge">https://eastus.api.cognitive.microsoft.com/sts/v1.0/issuetoken</code></li>
        </ol>
      </li>
      <li>在 header 中填入 key-value
        <ol>
          <li>key: <code class="language-plaintext highlighter-rouge">Ocp-Apim-Subscription-Key</code></li>
          <li>value: <code class="language-plaintext highlighter-rouge">30bd339f8d6a430c842908ae7bcb43f0</code></li>
        </ol>
      </li>
    </ol>
  </li>
  <li>点击 send, 之后就返回了一个 token
    <ol>
      <li><code class="language-plaintext highlighter-rouge">eyJhbGciOiJFUzI1NiIsImtpZCI6ImtleTEiLCJ0eXAiOiJKV1QifQ.eyJyZWdpb24iOiJlYXN0dXMiLCJzdWJzY3JpcHRpb24taWQiOiI0MjJiMDU3ZmRlOWM0YmYxOGQxYjA5YmU2ZTA1M2FmZSIsInByb2R1Y3QtaWQiOiJTcGVlY2hTZXJ2aWNlcy5GMCIsImNvZ25pdGl2ZS1zZXJ2aWNlcy1lbmRwb2ludCI6Imh0dHBzOi8vYXBpLmNvZ25pdGl2ZS5taWNyb3NvZnQuY29tL2ludGVybmFsL3YxLjAvIiwiYXp1cmUtcmVzb3VyY2UtaWQiOiIvc3Vic2NyaXB0aW9ucy8wNTJiYmUzNy1iOGVkLTQ1MWQtYWNjYy1hMTJlYzAwMzA0MjIvcmVzb3VyY2VHcm91cHMvZGwtY29nc3ZzLWdyb3VwL3Byb3ZpZGVycy9NaWNyb3NvZnQuQ29nbml0aXZlU2VydmljZXMvYWNjb3VudHMvZGwtc3BlZWNoMSIsInNjb3BlIjoic3BlZWNoc2VydmljZXMiLCJhdWQiOiJ1cm46bXMuc3BlZWNoc2VydmljZXMuZWFzdHVzIiwiZXhwIjoxNjgxMjY0NjQyLCJpc3MiOiJ1cm46bXMuY29nbml0aXZlc2VydmljZXMifQ.gxJ06I2kL6P8RS96xaMt5YQUtyntBdFKu7iRGmaNW3W0P69f7rsoani3tBT7F_t6jWIgoPF9SOO9CONUP-gSpw</code></li>
    </ol>
  </li>
  <li>未完成, 后面需要继续</li>
</ol>

<h3 id="设置-诊断-diagnostic-settings">设置 诊断 Diagnostic settings</h3>
<ul>
  <li>诊断设置用于配置将资源的平台日志和指标流式导出到所选目标。最多可以创建五个不同的诊断设置，以将不同的日志和指标发送到不同的目标。</li>
  <li>诊断可以获取的信息
    <ul>
      <li>Audit Logs</li>
      <li>Request and Response Logs</li>
      <li>Trace Logs</li>
      <li>AllMetrics</li>
    </ul>
  </li>
  <li>下游
    <ul>
      <li>Send to Log Analytics workspace  分析</li>
      <li>Archive to a storage account  存储</li>
      <li>Stream to an event hub</li>
      <li>Send to partner solution 第三方</li>
    </ul>
  </li>
</ul>

<h3 id="cognitive-service-security-安全">Cognitive Service Security 安全</h3>

<p>Networking</p>
<ul>
  <li>创建一个新的Speech 服务后, 进入这个服务的 Networking, 会发现提示”Custom Domain Name is required for VNet”</li>
  <li>创建一个 custom domian <code class="language-plaintext highlighter-rouge">dl-work-domain</code></li>
  <li>创建后, Speech 的 endpoint URL 就会增加<code class="language-plaintext highlighter-rouge">dl-work-domain</code> 这个 domain</li>
  <li>这样就可以选择 “Selected Network and Private Endpoints”
    <ul>
      <li>增加 Firewall 功能</li>
      <li>只允许 on-premise 的网络访问这个 Speech 服务.
        <ul>
          <li>要指定 CIDR</li>
        </ul>
      </li>
      <li>或者只允许自己本机 IP 访问 Speech 功能</li>
    </ul>
  </li>
  <li>或者通过 “Private endpoint connections” 建立一个私有 endpoint 通道, 让其他 AZ 服务访问 Speech 服务</li>
</ul>

<p>Identity</p>
<ul>
  <li>A system assigned managed identity is restricted to one per resource and is tied to the lifecycle of this resource. You can grant permissions to the managed identity by using Azure role-based access control (Azure RBAC). The managed identity is authenticated with Azure AD, so you don’t have to store any credentials in code.
    <ul>
      <li>系统分配的托管标识限制为每个资源一个，并绑定到此资源的生命周期。可以使用 Azure 基于角色的访问控制 （Azure RBAC） 向托管标识授予权限。托管标识使用 Azure AD 进行身份验证，因此无需在代码中存储任何凭据。</li>
      <li>使用了 ID, 就不需要使用 key 了.</li>
    </ul>
  </li>
  <li>分为 System Assigned 和 User Assigned
    <ul>
      <li>System Assigned ID
        <ul>
          <li>一旦开启, 系统会分配一个 ID 给这个资源, 并注册到 Azure AD中</li>
          <li>一旦注册到 AZ AD 中, 这个资源就可以访问 Az 的其他资源, 比如 Storage 了.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="微软的--ai-policies-policy">微软的  AI Policies /Policy</h3>
<p><a href="https://www.microsoft.com/en-us/ai/responsible-ai?activetab=pivot1%3aprimaryr6">Azure 官网的 Policy</a></p>

<p><a href="https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions">Azure console 中 Policy 服务中定义的 Cognitive Service 的policy</a>
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-12-054549.jpg" alt="" /></p>

<ul class="task-list">
  <li>Policy 是一段 Json 规则, 可以应用到某个创建的 订阅 的 资源组 的 某个资源上
    <ul>
      <li>比如, 选中 <code class="language-plaintext highlighter-rouge">Cognitive Services accounts should restrict network access</code> 然后assign 给 Free Teir -&gt; dl-cogsvs-group -&gt; dl-cogsvs / dl-speech / dl-alert-rule-checking-total-calls</li>
    </ul>
  </li>
  <li>这里的 Policy 包含了
    <ul>
      <li>限制网络访问</li>
      <li>关闭公共网络访问</li>
      <li>关闭本地认证方法</li>
      <li>使用自己定制的存储</li>
      <li>用 customer managed key 加密数据</li>
      <li>使用私有 DNS zone</li>
      <li>使用私有链接</li>
      <li>使用 private endpoints</li>
      <li>使用 managed identity</li>
    </ul>
  </li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />TODO: 仔细看一下这个链接中的内容, 这是考试中的一部分</li>
</ul>

<h3 id="认知服务-容器-containers">认知服务 容器 containers</h3>
<p><a href="https://learn.microsoft.com/en-us/azure/cognitive-services/cognitive-services-container-support">官网介绍</a></p>
<ul>
  <li>Azure认知服务提供了几个Docker容器，允许您使用本地Azure中可用的相同API。使用这些容器可以灵活地使认知服务更接近您的数据，以符合性、安全性或其他操作原因。容器支持目前可用于Azure认知服务的子集</li>
  <li>认知容器中包含了
    <ul>
      <li>决策容器 Decision containers</li>
      <li>语言容器 Language containers</li>
      <li>语音容器 Speech containers</li>
      <li>视觉容器 Vision containers</li>
    </ul>
  </li>
  <li>好处
    <ul>
      <li>可以把认知服务部署在容器中, 放在客户的 On-premise 环境中</li>
      <li>提高安全性, 满足合规要求</li>
      <li>降低网络延迟</li>
    </ul>
  </li>
  <li>不需要依赖Cloud</li>
  <li>可以通过 <code class="language-plaintext highlighter-rouge">docker pull</code> 命令获取认知服务的容器</li>
  <li>计费
    <ul>
      <li>对于容器的使用, 会把使用记录(meteringz)发到 Azure.com 进行计费计算</li>
    </ul>
  </li>
</ul>

<h2 id="implement-computer-vision-soluiton-计算机视觉方案">Implement Computer Vision Soluiton 计算机视觉方案</h2>
<p><a href="https://learn.microsoft.com/zh-cn/azure/cognitive-services/Custom-Vision-Service/quickstarts/image-classification?tabs=visual-studio&amp;pivots=programming-language-python">官方文档</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>pip install azure-cognitiveservices-vision-customvision
pip install pillow <span class="c"># PIL 的图片处理类库</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="获取图片的-tag">获取图片的 tag</h3>
<p>提供一张照片, 然后让 AI 给图片中的内容进行标注tag</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.computervision</span> <span class="kn">import</span> <span class="n">ComputerVisionClient</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.computervision.models</span> <span class="kn">import</span> <span class="n">OperationStatusCodes</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.computervision.models</span> <span class="kn">import</span> <span class="n">VisualFeatureTypes</span>
<span class="kn">from</span> <span class="nn">msrest.authentication</span> <span class="kn">import</span> <span class="n">CognitiveServicesCredentials</span>

<span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">subscription_key</span> <span class="o">=</span> <span class="s">"faf0bb4ec8bf427a84addba9d5672077"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"https://dlvision1.cognitiveservices.azure.com/"</span>

<span class="n">computervision_client</span> <span class="o">=</span> <span class="n">ComputerVisionClient</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">CognitiveServicesCredentials</span><span class="p">(</span><span class="n">subscription_key</span><span class="p">))</span>

<span class="n">remote_image_url</span> <span class="o">=</span> <span class="s">"https://raw.githubusercontent.com/gottagetgit/AI102Files/main/Computer_Vision"</span> \
                   <span class="s">"/Analyze_images_using_Computer_Vision_API/Images/Landmark.jpg "</span>

<span class="s">'''
Tag an Image - remote
This example returns a tag (key word) for each thing in the image.
'''</span>
<span class="k">print</span><span class="p">(</span><span class="s">"===== Tag an image - remote ====="</span><span class="p">)</span>
<span class="c"># Call API with remote image</span>
<span class="n">tags_result_remote</span> <span class="o">=</span> <span class="n">computervision_client</span><span class="o">.</span><span class="n">tag_image</span><span class="p">(</span><span class="n">remote_image_url</span><span class="p">)</span>

<span class="c"># Print results with confidence score</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Tags in the remote image: </span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags_result_remote</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"No tags detected."</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_result_remote</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"'{}' with confidence {:.2f}</span><span class="si">%</span><span class="s">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tag</span><span class="o">.</span><span class="n">confidence</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<span class="k">print</span><span class="p">()</span>
<span class="c"># '''</span>
<span class="c"># Tag an Image - local</span>
<span class="c"># This example returns a tag (key word) for each thing in the image.</span>
<span class="c"># '''</span>
<span class="c"># print("===== Tag an Image - local =====")</span>
<span class="c"># # Open local image file</span>
<span class="c"># local_image_path = "Images/Landmark.jpg"</span>
<span class="c"># local_image = open(local_image_path, "rb")</span>
<span class="c"># # Call API local image</span>
<span class="c"># tags_result_local = computervision_client.tag_image_in_stream(local_image)</span>

<span class="c"># # Print results with confidence score</span>
<span class="c"># print("Tags in the local image: \n")</span>
<span class="c"># if len(tags_result_local.tags) == 0:</span>
<span class="c">#     print("No tags detected.")</span>
<span class="c"># else:</span>
<span class="c">#     for tag in tags_result_local.tags:</span>
<span class="c">#         print("'{}' with confidence {:.2f}%".format(tag.name, tag.confidence * 100))</span>
<span class="c"># print()</span>
<span class="c"># '''</span>
<span class="c"># END - Tag an Image - local</span>
<span class="c"># '''</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-12-084153.jpg" alt="" /></p>

<h3 id="获取图片的-描述-description">获取图片的 描述 Description</h3>
<p>提供一张照片, 然后让 AI 给图片中的内容进行文字描述</p>

<p>和 打 tag 一样, 只是调用的方法由 <code class="language-plaintext highlighter-rouge">tag_image</code> 改为 <code class="language-plaintext highlighter-rouge">describe_image</code></p>

<p><code class="language-plaintext highlighter-rouge">description_results = computervision_client.tag_image(remote_image_url)</code></p>

<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-12-085058.jpg" alt="" /></p>

<h3 id="identify-landmarks-and-celebrities-识别地标和名人">Identify landmarks and Celebrities 识别地标和名人</h3>

<p>识别地标和名人都属于 domain-specific models</p>
<ul>
  <li>celebraties
    <ul>
      <li>使用了图片的人物分类</li>
      <li>使用了outdoor 和 building 的图片分类</li>
    </ul>
  </li>
</ul>

<p>和图片描述的代码类似, 区别是使用了 <code class="language-plaintext highlighter-rouge">analyze_image_by_domain</code></p>

<p><code class="language-plaintext highlighter-rouge">detect_domain_results_landmarks = computervision_client.analyze_image_by_domain("landmarks", remote_image_url)</code></p>
<ul>
  <li>这里可以把 “landmarks” 改成 “selebraties” 然后去检测图片中的名人</li>
</ul>

<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-12-090538.jpg" alt="" /></p>

<h3 id="identify-brands-in-image-品牌检测">Identify Brands in image, 品牌检测</h3>

<ul>
  <li>和地标名人检测类似, 区别是使用了 <code class="language-plaintext highlighter-rouge">analyze_image</code>
    <ul>
      <li>这里的feature type 是 <code class="language-plaintext highlighter-rouge">brands</code></li>
      <li>其他featrue type 还包括
        <ul>
          <li>Faces</li>
          <li>Brands</li>
          <li>Adult</li>
          <li>Objects</li>
          <li>Color</li>
          <li>ImageType</li>
          <li>Description</li>
          <li>Categories</li>
          <li>Tags</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>可以获得品牌名称 和 品牌在图片中的像素位置</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>
<span class="c"># Select the visual feature(s) you want</span>
<span class="n">remote_image_features</span> <span class="o">=</span> <span class="p">[</span><span class="s">"brands"</span><span class="p">]</span>
<span class="c"># Call API with URL and features</span>
<span class="n">detect_brands_results_remote</span> <span class="o">=</span> <span class="n">computervision_client</span><span class="o">.</span><span class="n">analyze_image</span><span class="p">(</span><span class="n">remote_image_url</span><span class="p">,</span> <span class="n">remote_image_features</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>
<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-12-093159.jpg" alt="" /></p>
<ul>
  <li>检测到两个品牌信息
    <ul>
      <li>logo 和位置</li>
      <li>品牌名称和位置</li>
    </ul>
  </li>
</ul>

<h3 id="moderate-adult-content-适度中度的成人内容检测">Moderate Adult Content 适度(中度)的成人内容检测</h3>

<p>Content flag definitions 内容标注定义 分三类</p>
<ul>
  <li>Adult image, 成人图片, 内容有展示裸体和性行为的 ( nudity , saxual acts)</li>
  <li>Racy,  不雅的行为, 有性暗示的, 比 Audit image 稍微好点 (saxually suggestive)</li>
  <li>Gory, 血腥暴力, (blood, gore )</li>
</ul>

<p>和品牌检测用的是一个API 调用, 也是使用 <code class="language-plaintext highlighter-rouge">analyze_image</code> 方法</p>
<ul>
  <li>这里的 feature type 是 <code class="language-plaintext highlighter-rouge">adult</code>
调用检测 API 后返回的是对应的三个 boolean 值 (true/false) 和对应分数的 JSON 格式</li>
  <li>isAdultContent and adultScore</li>
  <li>isRacyContent and racyScore</li>
  <li>isGoryContent and goryScore</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="c"># Select the visual feature(s) you want</span>
<span class="n">remote_image_features</span> <span class="o">=</span> <span class="p">[</span><span class="s">"adult"</span><span class="p">]</span>
<span class="c"># Call API with URL and features</span>
<span class="n">detect_adult_results_remote</span> <span class="o">=</span> <span class="n">computervision_client</span><span class="o">.</span><span class="n">analyze_image</span><span class="p">(</span><span class="n">remote_image_url</span><span class="p">,</span> <span class="n">remote_image_features</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="创建缩略图">创建缩略图</h3>

<p>提供一个本地或者网络的图片, 然后提交给 API, 然后保存回到本地
调用了 <code class="language-plaintext highlighter-rouge">generate_thumbnail_in_stream</code> 并提供了图片的长宽参数</p>
<ul>
  <li>这里用 AI 服务的价值是, 人工智能可以自动的按照图片中物体的位置和空白的比例来更好的做缩略图
    <ul>
      <li>最后一个参数标成 <code class="language-plaintext highlighter-rouge">true</code> 就可以使用智能缩略图功能
其他代码和前面的例子一样</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="c"># Generate a thumbnail from a local image</span>
<span class="n">local_image_path_thumb</span> <span class="o">=</span> <span class="s">"Images/Faces.jpg"</span>
<span class="n">local_image_thumb</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_image_path_thumb</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Generating thumbnail from a local image..."</span><span class="p">)</span>
<span class="c"># Call the API with a local image, set the width/height if desired (pixels)</span>
<span class="c"># Returns a Generator object, a thumbnail image binary (list).</span>
<span class="n">thumb_local</span> <span class="o">=</span> <span class="n">computervision_client</span><span class="o">.</span><span class="n">generate_thumbnail_in_stream</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">local_image_thumb</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c"># Write the image binary to file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"thumb_local.png"</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">thumb_local</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="从图片中获取文字---ocr">从图片中获取文字 - OCR</h3>
<p><strong>注意: 从 2021 年 7 月 29 日开始, 手写文字识别和 OCR 已经不在考试范围内了</strong></p>

<p>有几种技术</p>
<ul>
  <li>图片获取打印文字用 OCR API</li>
  <li>图片或 PDF 中获取文字用 Read API</li>
  <li>从 图片的表格或者 receipt 收据中获取文字需要 pre-build 一个 收据model,  用 Form Recognizer</li>
</ul>

<p>方法和之前的类似, 用</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">recognize_printed_text_in_stream</code> 进行流式读取图片中的打印文字</li>
  <li><code class="language-plaintext highlighter-rouge">recognize_printed_text</code> 一次性读取图片中的打印文字</li>
  <li><code class="language-plaintext highlighter-rouge">read</code> 读取手写文字</li>
</ul>

<p>读取图片中的打印文字的示例代码</p>
<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="n">ocr_result_local</span> <span class="o">=</span> <span class="n">computervision_client</span><span class="o">.</span><span class="n">recognize_printed_text_in_stream</span><span class="p">(</span><span class="n">local_image_printed_text</span><span class="p">)</span>
<span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">ocr_result_local</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">region</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Bounding box: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">""</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">word</span><span class="o">.</span><span class="n">text</span> <span class="o">+</span> <span class="s">" "</span>
        <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>读取图片中的表格信息的示例代码</p>
<ul>
  <li>这里没有用 <code class="language-plaintext highlighter-rouge">ComputerVisionClient</code>, 而是用了另一个Python 的类库 <code class="language-plaintext highlighter-rouge">FormRecognizerClient</code> 来实现的
    <ul>
      <li><code class="language-plaintext highlighter-rouge">begin_recognize_content_from_url</code> 方法用来读取表格</li>
      <li><code class="language-plaintext highlighter-rouge">begin_recognize_receipts_from_url</code> 方法用来读取收据</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">azure.core.exceptions</span> <span class="kn">import</span> <span class="n">ResourceNotFoundError</span>
<span class="kn">from</span> <span class="nn">azure.ai.formrecognizer</span> <span class="kn">import</span> <span class="n">FormRecognizerClient</span>
<span class="kn">from</span> <span class="nn">azure.ai.formrecognizer</span> <span class="kn">import</span> <span class="n">FormTrainingClient</span>
<span class="kn">from</span> <span class="nn">azure.core.credentials</span> <span class="kn">import</span> <span class="n">AzureKeyCredential</span>

<span class="n">key</span> <span class="o">=</span> <span class="s">"&lt;enter your key here&gt;"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"&lt;enter your endpoint URL here&gt;"</span>

<span class="n">form_recognizer_client</span> <span class="o">=</span> <span class="n">FormRecognizerClient</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">AzureKeyCredential</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="n">form_training_client</span> <span class="o">=</span> <span class="n">FormTrainingClient</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">AzureKeyCredential</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

<span class="n">formUrl</span> <span class="o">=</span> <span class="s">"https://raw.githubusercontent.com/Azure/azure-sdk-for-python/master/sdk/formrecognizer/azure-ai"</span> \
          <span class="s">"-formrecognizer/tests/sample_forms/forms/Form_1.jpg "</span>

<span class="k">print</span><span class="p">(</span><span class="s">"--------Recognizing form--------"</span><span class="p">)</span>

<span class="n">poller</span> <span class="o">=</span> <span class="n">form_recognizer_client</span><span class="o">.</span><span class="n">begin_recognize_content_from_url</span><span class="p">(</span><span class="n">formUrl</span><span class="p">)</span>
<span class="n">page</span> <span class="o">=</span> <span class="n">poller</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">page</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># page 1, table 1</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Table found on page {}:"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">page_number</span><span class="p">))</span>
<span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Cell text: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Location: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">bounding_box</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Confidence score: {}</span><span class="se">\n</span><span class="s">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">confidence</span><span class="p">))</span>

<span class="n">receiptUrl</span> <span class="o">=</span> <span class="s">"https://raw.githubusercontent.com/Azure/azure-sdk-for-python/master/sdk/formrecognizer/azure-ai"</span> \
             <span class="s">"-formrecognizer/tests/sample_forms/receipt/contoso-receipt.png "</span>

<span class="k">print</span><span class="p">(</span><span class="s">"--------Recognizing receipt--------"</span><span class="p">)</span>
<span class="n">poller</span> <span class="o">=</span> <span class="n">form_recognizer_client</span><span class="o">.</span><span class="n">begin_recognize_receipts_from_url</span><span class="p">(</span><span class="n">receiptUrl</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">poller</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="k">for</span> <span class="n">receipt</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">receipt</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">"Items"</span><span class="p">:</span>
            <span class="k">print</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Receipt Items:"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                <span class="k">print</span><span class="p">()</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"...Item #{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"......{}: {} has confidence {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item_name</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">confidence</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"{}: {} has confidence {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">confidence</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="从图片中获取-面部信息-facial-infomation">从图片中获取 面部信息 Facial Infomation</h2>
<p><a href="https://learn.microsoft.com/zh-cn/azure/cognitive-services/computer-vision/concept-face-detection">官方文档</a></p>

<p><strong>注意</strong></p>
<ul>
  <li>为了支持我们负责任的 AI 原则，基于资格和使用标准对人脸服务访问进行限制。 人脸服务仅适用于 Microsoft 托管客户和合作伙伴。 使用人脸识别引入表单来申请访问。 有关详细信息，请参阅人脸受限访问页面。</li>
  <li>人脸识别只有微软大客户和合作伙伴才可以用</li>
  <li>要用还要填表格申请</li>
  <li>
    <p>2023 年 6 月 30 日之后，在这些功能被停用。</p>
  </li>
  <li>要使用 Face API</li>
  <li>Face detection可以识别
    <ul>
      <li>Age, 年龄</li>
      <li>Blur, 污渍</li>
      <li>Emotion, 情感</li>
      <li>Exposure, 暴露程度</li>
      <li>Facial hair, 面部毛发</li>
      <li>Glasses, 眼镜</li>
      <li>Hair, 头发</li>
      <li>Head pose, 头部角度(3D)</li>
      <li>Makeup, 化妆</li>
      <li>Noise, 噪点</li>
      <li>Occlusion, 遮挡</li>
      <li>Smile, 微笑</li>
      <li>口罩</li>
    </ul>
  </li>
</ul>

<h3 id="在图片中辨别和匹配一张脸-face-api">在图片中辨别和匹配一张脸 Face API</h3>

<p>逻辑</p>
<ul>
  <li>先给一张单个脸的照片</li>
  <li>再给一张多个脸的照片</li>
  <li>再在多个脸的照片中匹配单个脸</li>
</ul>

<p>使用了 <code class="language-plaintext highlighter-rouge">FaceClient</code> 类库</p>
<ul>
  <li>包含的方法有
    <ul>
      <li><code class="language-plaintext highlighter-rouge">.face.detect_with_url</code> 检测图片中的脸, 并把每个脸的数据返回</li>
      <li><code class="language-plaintext highlighter-rouge">.face.find_similar</code> 在多个脸的数据中匹配某一个脸</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.face</span> <span class="kn">import</span> <span class="n">FaceClient</span>
<span class="kn">from</span> <span class="nn">msrest.authentication</span> <span class="kn">import</span> <span class="n">CognitiveServicesCredentials</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.face.models</span> <span class="kn">import</span> <span class="n">TrainingStatusType</span><span class="p">,</span> <span class="n">Person</span>

<span class="n">subscription_key</span> <span class="o">=</span> <span class="s">"&lt;enter your key here&gt;"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"&lt;enter your endpoint URL here&gt;"</span>

<span class="c"># Create an authenticated FaceClient.</span>
<span class="n">face_client</span> <span class="o">=</span> <span class="n">FaceClient</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">CognitiveServicesCredentials</span><span class="p">(</span><span class="n">subscription_key</span><span class="p">))</span>

<span class="c"># Detect a face in an image that contains a single face</span>
<span class="n">single_face_image_url</span> <span class="o">=</span> <span class="s">'https://www.biography.com/.image/t_share/MTQ1MzAyNzYzOTgxNTE0NTEz/john-f-kennedy---mini'</span> \
                        <span class="s">'-biography.jpg '</span>
<span class="n">single_image_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">single_face_image_url</span><span class="p">)</span>
<span class="c"># We use detection model 3 to get better performance.</span>
<span class="n">detected_faces</span> <span class="o">=</span> <span class="n">face_client</span><span class="o">.</span><span class="n">face</span><span class="o">.</span><span class="n">detect_with_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">single_face_image_url</span><span class="p">,</span> <span class="n">detection_model</span><span class="o">=</span><span class="s">'detection_03'</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">detected_faces</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'No face detected from image {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">single_image_name</span><span class="p">))</span>

<span class="c"># Display the detected face ID in the first single-face image.</span>
<span class="c"># Face IDs are used for comparison to faces (their IDs) detected in other images.</span>
<span class="k">print</span><span class="p">(</span><span class="s">"==== Detect faces in an image ==="</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Detected face ID from'</span><span class="p">,</span> <span class="n">single_image_name</span><span class="p">,</span> <span class="s">':'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">detected_faces</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="n">face</span><span class="o">.</span><span class="n">face_id</span><span class="p">)</span>

<span class="c"># Save this ID for use in Find Similar</span>
<span class="n">first_image_face_ID</span> <span class="o">=</span> <span class="n">detected_faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">face_id</span>
<span class="k">print</span><span class="p">()</span>

<span class="s">'''
Find a similar face
This example uses detected faces in a group photo to find a similar face using a single-faced image as query.
'''</span>

<span class="k">print</span><span class="p">(</span><span class="s">"===== Detect the faces in an image that contains multiple faces ====="</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="c"># Detect the faces in an image that contains multiple faces</span>
<span class="c"># Each detected face gets assigned a new ID</span>
<span class="n">multi_face_image_url</span> <span class="o">=</span> <span class="s">"http://www.historyplace.com/kennedy/president-family-portrait-closeup.jpg"</span>
<span class="n">multi_image_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">multi_face_image_url</span><span class="p">)</span>
<span class="c"># We use detection model 3 to get better performance.</span>
<span class="n">detected_faces2</span> <span class="o">=</span> <span class="n">face_client</span><span class="o">.</span><span class="n">face</span><span class="o">.</span><span class="n">detect_with_url</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">multi_face_image_url</span><span class="p">,</span> <span class="n">detection_model</span><span class="o">=</span><span class="s">'detection_03'</span><span class="p">)</span>

<span class="c"># Search through faces detected in group image for the single face from first image.</span>
<span class="c"># First, create a list of the face IDs found in the second image.</span>
<span class="n">second_image_face_IDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">face_id</span><span class="p">,</span> <span class="n">detected_faces2</span><span class="p">))</span>
<span class="c"># Next, find similar face IDs like the one detected in the first image.</span>
<span class="n">similar_faces</span> <span class="o">=</span> <span class="n">face_client</span><span class="o">.</span><span class="n">face</span><span class="o">.</span><span class="n">find_similar</span><span class="p">(</span><span class="n">face_id</span><span class="o">=</span><span class="n">first_image_face_ID</span><span class="p">,</span> <span class="n">face_ids</span><span class="o">=</span><span class="n">second_image_face_IDs</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">similar_faces</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'No similar faces found in'</span><span class="p">,</span> <span class="n">multi_image_name</span><span class="p">,</span> <span class="s">'.'</span><span class="p">)</span>

<span class="c"># Print the details of the similar faces detected</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Similar faces found in'</span><span class="p">,</span> <span class="n">multi_image_name</span> <span class="o">+</span> <span class="s">':'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">similar_faces</span><span class="p">:</span>
        <span class="n">first_image_face_ID</span> <span class="o">=</span> <span class="n">face</span><span class="o">.</span><span class="n">face_id</span>
        <span class="c"># The similar face IDs of the single face image and the group image do not need to match,</span>
        <span class="c"># they are only used for identification purposes in each image.</span>
        <span class="c"># The similar faces are matched using the Cognitive Services algorithm in find_similar().</span>
        <span class="n">face_info</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">detected_faces2</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">face_id</span> <span class="o">==</span> <span class="n">first_image_face_ID</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">face_info</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'  Face ID: '</span><span class="p">,</span> <span class="n">first_image_face_ID</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'  Face rectangle:'</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'    Left: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">face_info</span><span class="o">.</span><span class="n">face_rectangle</span><span class="o">.</span><span class="n">left</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'    Top: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">face_info</span><span class="o">.</span><span class="n">face_rectangle</span><span class="o">.</span><span class="n">top</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'    Width: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">face_info</span><span class="o">.</span><span class="n">face_rectangle</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'    Height: '</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">face_info</span><span class="o">.</span><span class="n">face_rectangle</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-020835.jpg" alt="" /></p>

<h3 id="在训练的模型中识别出一张脸">在训练的模型中识别出一张脸</h3>

<p>逻辑</p>
<ul>
  <li>为三个人创建3 个 person group 的 Face AI 对象, 分别是 man, woman, children</li>
  <li>为每个对象(每个人)导入 3 张照片进行训练</li>
  <li>给一张多人照片, 然后分别识别是否有之前训练的三个人</li>
</ul>

<p>使用了 <code class="language-plaintext highlighter-rouge">TrainingStatusType</code>, <code class="language-plaintext highlighter-rouge">Person</code> 和 <code class="language-plaintext highlighter-rouge">FaceClient</code> 类库</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">face_client.person_group.create</code> 先创建一个组</li>
  <li><code class="language-plaintext highlighter-rouge">face_client.person_group_person.create(PERSON_GROUP_ID, "Woman")</code> 在分别创建三个 person</li>
  <li><code class="language-plaintext highlighter-rouge">face_client.person_group_person.add_face_from_stream</code> 给每个person 加入他们的日常照片</li>
  <li><code class="language-plaintext highlighter-rouge">face_client.person_group.train</code> 开始训练</li>
  <li><code class="language-plaintext highlighter-rouge">face_client.person_group.get_training_status</code> 获取训练状态(成功或者失败)</li>
  <li><code class="language-plaintext highlighter-rouge">face_client.face.detect_with_stream(image, detection_model='detection_03')</code> 输入多人测试图片, 并检测图片中的人脸, 返回多个脸</li>
  <li><code class="language-plaintext highlighter-rouge">face_client.face.identify(face_ids, PERSON_GROUP_ID)</code> 把返回的脸和之前的组中的person 进行匹配</li>
</ul>

<p><a href="https://github.com/gottagetgit/AI102Files/blob/main/Computer_Vision/Extract_facial_information_from_images/Recognize%20faces.py">源代码地址</a></p>

<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-024535.jpg" alt="" /></p>

<h3 id="获取面部的参数信息">获取面部的参数信息</h3>

<ul>
  <li>Face detection可以识别
    <ul>
      <li>Age, 年龄</li>
      <li>Blur, 污渍</li>
      <li>Emotion, 情感</li>
      <li>Exposure, 暴露程度</li>
      <li>Facial hair, 面部毛发</li>
      <li>Glasses, 眼镜</li>
      <li>Hair, 头发</li>
      <li>Head pose, 头部角度(3D)</li>
      <li>Makeup, 化妆</li>
      <li>Noise, 噪点</li>
      <li>Occlusion, 遮挡</li>
      <li>Smile, 微笑</li>
      <li>口罩</li>
    </ul>
  </li>
  <li>代码通过 http request 的方式请求 Azure Face API
    <ul>
      <li>获取 age,gender,headPose,smile,facialHair,glasses,emotion 信息</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">patches</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="k">def</span> <span class="nf">config</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Call Config"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">subscription_key</span><span class="p">,</span> <span class="n">face_api_url</span>


<span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">r'/Computer_Vision/Extract_facial_information_from_images/CapFrame.jpg'</span><span class="p">)</span>
<span class="n">image_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span>

<span class="n">subscription_key</span> <span class="o">=</span> <span class="s">"&lt;enter your key&gt;"</span>
<span class="n">face_api_url</span> <span class="o">=</span> <span class="s">"&lt;place the API URL here&gt;"</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/octet-stream'</span><span class="p">,</span>
           <span class="s">'Ocp-Apim-Subscription-Key'</span><span class="p">:</span> <span class="n">subscription_key</span><span class="p">}</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'returnFaceId'</span><span class="p">:</span> <span class="s">'true'</span><span class="p">,</span>
    <span class="s">'returnFaceLandmarks'</span><span class="p">:</span> <span class="s">'true'</span><span class="p">,</span>
    <span class="s">'returnFaceAttributes'</span><span class="p">:</span> <span class="s">'age,gender,headPose,smile,facialHair,glasses,emotion'</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">face_api_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">image_data</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="n">faces</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"faces.json"</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">faces_file</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">faces_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码运行结果保存在文件中
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-025726.jpg" alt="" /></p>

<h2 id="用-custom-vision-自定义视觉-进行图片分类">用 Custom Vision 自定义视觉 进行图片分类</h2>
<p>使用 Azure 认知服务中的自定义视觉为特定域自定义和嵌入最先进的计算机视觉图像分析。构建顺畅的客户体验、优化制造流程、加速数字营销活动等。</p>

<ul>
  <li>也是 Cumputer Vision, 只是可以更灵活的进行定制(customize)</li>
  <li>custom vision 主要是会把标签打到图片上,  而不是从图片获取标签</li>
  <li>定制场景
    <ul>
      <li>用自己的图片训练和设置自己的模型</li>
      <li>模型可以部署到 edge 或 cloud</li>
      <li>可以部署到本地, 有更大的安全和隐私保障</li>
      <li>可以适用于不同的行业</li>
    </ul>
  </li>
</ul>

<p>分两个 model</p>
<ul>
  <li>trainning model
    <ul>
      <li>训练模型</li>
    </ul>
  </li>
  <li>prediction model
    <ul>
      <li>正式使用的模型 (预测模型)</li>
    </ul>
  </li>
</ul>

<p>概念</p>
<ul>
  <li>iteration
    <ul>
      <li>一个训练好的模型实例就叫 一个 iteration</li>
    </ul>
  </li>
</ul>

<h3 id="用-web-portal-训练-视觉分类模型-clasification-model">用 web portal 训练 视觉分类模型 (Clasification Model)</h3>

<p>实验场景:</p>
<ol>
  <li>用两种植物的多张照片对模型进行训练</li>
  <li>然后上传一种植物的一张图片, 让模型预测是那种植物</li>
</ol>

<ul>
  <li>
    <p>需要从 custom vision console 中的 overview 中的 Get Started 的连接进入 https://www.customvision.ai 进行配置</p>
  </li>
  <li>
    <p>分为几个步骤</p>
    <ul>
      <li>创建 project
        <ul>
          <li>project 类型分为
            <ul>
              <li>classification
                <ul>
                  <li>为图像分类 - 打tags
                    <ul>
                      <li>可以分为一个图片多个tag, 或者一个图片一个 tag</li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li>object detection
                <ul>
                  <li>检测图像中的对象</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>project 可以指定 domain, 比如 generial, food, landmarks, retail 等等</li>
        </ul>
      </li>
      <li>上传已经标注过 tag 的图片
        <ul>
          <li>分别上传 Hemlock 和 Japanese Cherry 的多张图片并打上标签</li>
        </ul>
      </li>
      <li>训练
        <ul>
          <li>点击训练按钮</li>
          <li>训练完成的页面展示
            <ul>
              <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-054315.jpg" alt="" /></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>测试
        <ul>
          <li>点击测试按钮, 上传一张测试照片, 然后让模型预测是哪种植物</li>
          <li>测试结果
            <ul>
              <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-054649.jpg" alt="" /></li>
            </ul>
          </li>
        </ul>
      </li>
      <li>publish
        <ul>
          <li>点击publish, 让预测模型对外提供服务</li>
          <li>对外服务的预测模型地址展示
            <ul>
              <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-054813.jpg" alt="" /></li>
            </ul>
          </li>
          <li>通过命令行 <code class="language-plaintext highlighter-rouge">curl</code> 来调用预测模型的 API 来测试
            <ul>
              <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-060025.jpg" alt="" /></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="用-python-训练-视觉分类模型-clasification-model">用 Python 训练 视觉分类模型 (Clasification Model)</h3>

<p>流程和 web portal 一样, 只不过是通过代买实现</p>

<p>代码使用了多个 类库</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">CustomVisionTrainingClient</code>  训练库</li>
  <li><code class="language-plaintext highlighter-rouge">CustomVisionPredictionClient</code> 预测库</li>
  <li><code class="language-plaintext highlighter-rouge">ImageFileCreateBatch</code> 批量建图</li>
  <li><code class="language-plaintext highlighter-rouge">ImageFileCreateEntry</code> 图片实体</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.customvision.training</span> <span class="kn">import</span> <span class="n">CustomVisionTrainingClient</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.customvision.prediction</span> <span class="kn">import</span> <span class="n">CustomVisionPredictionClient</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.customvision.training.models</span> <span class="kn">import</span> <span class="n">ImageFileCreateBatch</span><span class="p">,</span> <span class="n">ImageFileCreateEntry</span><span class="p">,</span> <span class="n">Region</span>
<span class="kn">from</span> <span class="nn">msrest.authentication</span> <span class="kn">import</span> <span class="n">ApiKeyCredentials</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c"># Replace with valid values</span>
<span class="n">ENDPOINT</span> <span class="o">=</span> <span class="s">"&lt;Your endpoint&gt;"</span>
<span class="n">training_key</span> <span class="o">=</span> <span class="s">"&lt;Your training key&gt;"</span>
<span class="n">prediction_key</span> <span class="o">=</span> <span class="s">"&lt;Your prediction key&gt;"</span>
<span class="n">prediction_resource_id</span> <span class="o">=</span> <span class="s">"&lt;Your prediction resource ID&gt;"</span>

<span class="n">credentials</span> <span class="o">=</span> <span class="n">ApiKeyCredentials</span><span class="p">(</span><span class="n">in_headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Training-key"</span><span class="p">:</span> <span class="n">training_key</span><span class="p">})</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">CustomVisionTrainingClient</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
<span class="n">prediction_credentials</span> <span class="o">=</span> <span class="n">ApiKeyCredentials</span><span class="p">(</span><span class="n">in_headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Prediction-key"</span><span class="p">:</span> <span class="n">prediction_key</span><span class="p">})</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">CustomVisionPredictionClient</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="n">prediction_credentials</span><span class="p">)</span>

<span class="n">publish_iteration_name</span> <span class="o">=</span> <span class="s">"classifyModel"</span>

<span class="n">credentials</span> <span class="o">=</span> <span class="n">ApiKeyCredentials</span><span class="p">(</span><span class="n">in_headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Training-key"</span><span class="p">:</span> <span class="n">training_key</span><span class="p">})</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">CustomVisionTrainingClient</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>

<span class="c"># Create a new project</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Creating project..."</span><span class="p">)</span>
<span class="n">project</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span><span class="s">"My New Project"</span><span class="p">)</span>

<span class="c"># Make two tags in the new project</span>
<span class="n">hemlock_tag</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_tag</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="s">"Hemlock"</span><span class="p">)</span>
<span class="n">cherry_tag</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_tag</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="s">"Japanese Cherry"</span><span class="p">)</span>

<span class="n">base_image_location</span> <span class="o">=</span> <span class="s">"&lt;Your image location&gt;"</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Adding images..."</span><span class="p">)</span>

<span class="n">image_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">image_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s">"hemlock_{}.jpg"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_num</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_image_location</span> <span class="o">+</span> <span class="s">"images/Hemlock/"</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_contents</span><span class="p">:</span>
        <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ImageFileCreateEntry</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="n">image_contents</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">tag_ids</span><span class="o">=</span><span class="p">[</span><span class="n">hemlock_tag</span><span class="o">.</span><span class="nb">id</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">image_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">):</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s">"japanese_cherry_{}.jpg"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_num</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_image_location</span> <span class="o">+</span> <span class="s">"images/Japanese Cherry/"</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_contents</span><span class="p">:</span>
        <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ImageFileCreateEntry</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="n">image_contents</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">tag_ids</span><span class="o">=</span><span class="p">[</span><span class="n">cherry_tag</span><span class="o">.</span><span class="nb">id</span><span class="p">]))</span>

<span class="n">upload_result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_images_from_files</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">ImageFileCreateBatch</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">image_list</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">upload_result</span><span class="o">.</span><span class="n">is_batch_successful</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Image batch upload failed."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Image status: "</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Training..."</span><span class="p">)</span>
<span class="n">iteration</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train_project</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
<span class="k">while</span> <span class="n">iteration</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s">"Completed"</span><span class="p">:</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">get_iteration</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Training status: "</span> <span class="o">+</span> <span class="n">iteration</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># The iteration is now trained. Publish it to the project endpoint</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">publish_iteration</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">publish_iteration_name</span><span class="p">,</span> <span class="n">prediction_resource_id</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Done!"</span><span class="p">)</span>

<span class="c"># Now there is a trained endpoint that can be used to make a prediction</span>
<span class="n">prediction_credentials</span> <span class="o">=</span> <span class="n">ApiKeyCredentials</span><span class="p">(</span><span class="n">in_headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Prediction-key"</span><span class="p">:</span> <span class="n">prediction_key</span><span class="p">})</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">CustomVisionPredictionClient</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="n">prediction_credentials</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_image_location</span> <span class="o">+</span> <span class="s">"images/Test/test_image.jpg"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_contents</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">classify_image</span><span class="p">(</span>
        <span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">publish_iteration_name</span><span class="p">,</span> <span class="n">image_contents</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="c"># Display the results.</span>
    <span class="k">for</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">predictions</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">+</span> <span class="n">prediction</span><span class="o">.</span><span class="n">tag_name</span> <span class="o">+</span>
              <span class="s">": {0:.2f}</span><span class="si">%</span><span class="s">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">probability</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-13-055754.jpg" alt="" /></p>

<h2 id="用-object-detection-with-custom-version-自定义视觉-进行图片中的对象检测">用 Object Detection with Custom Version 自定义视觉 进行图片中的对象检测</h2>

<p>对图片中的内容(特定方框的 4 个像素坐标)打标签</p>
<ul>
  <li>可以通过 web Portal 或者 SDK API 对 custom object detection model 进行训练</li>
  <li>管理模型 iteration</li>
  <li>把模型发布, 并部署到容器中</li>
</ul>

<h3 id="用-web-portal-来训练和使用-oblect-detection-model">用 web portal 来训练和使用 Oblect Detection Model</h3>

<p>实验场景:</p>
<ol>
  <li>分别用剪子和叉子的多张照片对模型进行训练
    <ol>
      <li>每个照片都会标注照片中的物体的四个点位的坐标</li>
      <li>并提供一个 tag 名字 fork/scissors</li>
    </ol>
  </li>
  <li>然后上传一张叉子的图片, 让模型给出是什么物体, 以及 4 个点位的坐标</li>
</ol>

<p>实验步骤</p>
<ol>
  <li>进入 https://www.customvision.ai/projects</li>
  <li>创建一个新的project
    <ol>
      <li>类型选 “Object Detection”</li>
      <li>domain 选 “generial”</li>
    </ol>
  </li>
  <li>分别上传剪子和叉子的照片, 并给特定区域打上标签</li>
  <li>点击训练按钮
    <ol>
      <li>训练结果</li>
      <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-14-014926.jpg" alt="" /></li>
    </ol>
  </li>
  <li>完成后, 点击测试, 上传一个测试的叉子照片, 然后看看结果.
    <ol>
      <li>测试结果</li>
      <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-14-015003.jpg" alt="" /></li>
    </ol>
  </li>
  <li>发布这个 API, 可以让外部通过 API 访问</li>
</ol>

<h3 id="用-python-来训练和使用-object-detection-model">用 python 来训练和使用 object detection model</h3>

<p>python 代码 的流程和 web portal 一样, 只是用 代码来实现</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.customvision.training</span> <span class="kn">import</span> <span class="n">CustomVisionTrainingClient</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.customvision.prediction</span> <span class="kn">import</span> <span class="n">CustomVisionPredictionClient</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.vision.customvision.training.models</span> <span class="kn">import</span> <span class="n">ImageFileCreateBatch</span><span class="p">,</span> <span class="n">ImageFileCreateEntry</span><span class="p">,</span> \
    <span class="n">Region</span>
<span class="kn">from</span> <span class="nn">msrest.authentication</span> <span class="kn">import</span> <span class="n">ApiKeyCredentials</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c"># Replace with valid values</span>
<span class="n">ENDPOINT</span> <span class="o">=</span> <span class="s">"&lt;your API endpoint&gt;"</span>
<span class="n">training_key</span> <span class="o">=</span> <span class="s">"&lt;your training key&gt;"</span>
<span class="n">prediction_key</span> <span class="o">=</span> <span class="s">"&lt;your prediction key&gt;"</span>
<span class="n">prediction_resource_id</span> <span class="o">=</span> <span class="s">"&lt;your prediction resource id&gt;"</span>

<span class="n">credentials</span> <span class="o">=</span> <span class="n">ApiKeyCredentials</span><span class="p">(</span><span class="n">in_headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Training-key"</span><span class="p">:</span> <span class="n">training_key</span><span class="p">})</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">CustomVisionTrainingClient</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
<span class="n">prediction_credentials</span> <span class="o">=</span> <span class="n">ApiKeyCredentials</span><span class="p">(</span><span class="n">in_headers</span><span class="o">=</span><span class="p">{</span><span class="s">"Prediction-key"</span><span class="p">:</span> <span class="n">prediction_key</span><span class="p">})</span>
<span class="n">predictor</span> <span class="o">=</span> <span class="n">CustomVisionPredictionClient</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="n">prediction_credentials</span><span class="p">)</span>

<span class="n">publish_iteration_name</span> <span class="o">=</span> <span class="s">"detectModel"</span>

<span class="c"># Find the object detection domain</span>
<span class="n">obj_detection_domain</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
    <span class="n">domain</span> <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">trainer</span><span class="o">.</span><span class="n">get_domains</span><span class="p">()</span> <span class="k">if</span> <span class="n">domain</span><span class="o">.</span><span class="nb">type</span> <span class="o">==</span> <span class="s">"ObjectDetection"</span> <span class="ow">and</span> <span class="n">domain</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"General"</span><span class="p">)</span>

<span class="c"># Create a new project</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Creating project..."</span><span class="p">)</span>
<span class="n">project</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span><span class="s">"My Detection Project"</span><span class="p">,</span> <span class="n">domain_id</span><span class="o">=</span><span class="n">obj_detection_domain</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>

<span class="c"># Make two tags in the new project</span>
<span class="n">fork_tag</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_tag</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="s">"fork"</span><span class="p">)</span>
<span class="n">scissors_tag</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_tag</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="s">"scissors"</span><span class="p">)</span>

<span class="n">fork_image_regions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"fork_1"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.145833328</span><span class="p">,</span> <span class="mf">0.3509314</span><span class="p">,</span> <span class="mf">0.5894608</span><span class="p">,</span> <span class="mf">0.238562092</span><span class="p">],</span>
    <span class="s">"fork_2"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.294117659</span><span class="p">,</span> <span class="mf">0.216944471</span><span class="p">,</span> <span class="mf">0.534313738</span><span class="p">,</span> <span class="mf">0.5980392</span><span class="p">],</span>
    <span class="s">"fork_3"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.09191177</span><span class="p">,</span> <span class="mf">0.0682516545</span><span class="p">,</span> <span class="mf">0.757352948</span><span class="p">,</span> <span class="mf">0.6143791</span><span class="p">],</span>
    <span class="s">"fork_4"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.254901975</span><span class="p">,</span> <span class="mf">0.185898721</span><span class="p">,</span> <span class="mf">0.5232843</span><span class="p">,</span> <span class="mf">0.594771266</span><span class="p">],</span>
    <span class="s">"fork_5"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2365196</span><span class="p">,</span> <span class="mf">0.128709182</span><span class="p">,</span> <span class="mf">0.5845588</span><span class="p">,</span> <span class="mf">0.71405226</span><span class="p">],</span>
    <span class="s">"fork_6"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.115196079</span><span class="p">,</span> <span class="mf">0.133611143</span><span class="p">,</span> <span class="mf">0.676470637</span><span class="p">,</span> <span class="mf">0.6993464</span><span class="p">],</span>
    <span class="s">"fork_7"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.164215669</span><span class="p">,</span> <span class="mf">0.31008172</span><span class="p">,</span> <span class="mf">0.767156839</span><span class="p">,</span> <span class="mf">0.410130739</span><span class="p">],</span>
    <span class="s">"fork_8"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.118872553</span><span class="p">,</span> <span class="mf">0.318251669</span><span class="p">,</span> <span class="mf">0.817401946</span><span class="p">,</span> <span class="mf">0.225490168</span><span class="p">],</span>
    <span class="s">"fork_9"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.18259804</span><span class="p">,</span> <span class="mf">0.2136765</span><span class="p">,</span> <span class="mf">0.6335784</span><span class="p">,</span> <span class="mf">0.643790841</span><span class="p">],</span>
    <span class="s">"fork_10"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05269608</span><span class="p">,</span> <span class="mf">0.282303959</span><span class="p">,</span> <span class="mf">0.8088235</span><span class="p">,</span> <span class="mf">0.452614367</span><span class="p">],</span>
    <span class="s">"fork_11"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05759804</span><span class="p">,</span> <span class="mf">0.0894935</span><span class="p">,</span> <span class="mf">0.9007353</span><span class="p">,</span> <span class="mf">0.3251634</span><span class="p">],</span>
    <span class="s">"fork_12"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3345588</span><span class="p">,</span> <span class="mf">0.07315363</span><span class="p">,</span> <span class="mf">0.375</span><span class="p">,</span> <span class="mf">0.9150327</span><span class="p">],</span>
    <span class="s">"fork_13"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.269607842</span><span class="p">,</span> <span class="mf">0.194068655</span><span class="p">,</span> <span class="mf">0.4093137</span><span class="p">,</span> <span class="mf">0.6732026</span><span class="p">],</span>
    <span class="s">"fork_14"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.143382356</span><span class="p">,</span> <span class="mf">0.218578458</span><span class="p">,</span> <span class="mf">0.7977941</span><span class="p">,</span> <span class="mf">0.295751631</span><span class="p">],</span>
    <span class="s">"fork_15"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.19240196</span><span class="p">,</span> <span class="mf">0.0633497</span><span class="p">,</span> <span class="mf">0.5710784</span><span class="p">,</span> <span class="mf">0.8398692</span><span class="p">],</span>
    <span class="s">"fork_16"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.140931368</span><span class="p">,</span> <span class="mf">0.480016381</span><span class="p">,</span> <span class="mf">0.6838235</span><span class="p">,</span> <span class="mf">0.240196079</span><span class="p">],</span>
    <span class="s">"fork_17"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.305147052</span><span class="p">,</span> <span class="mf">0.2512582</span><span class="p">,</span> <span class="mf">0.4791667</span><span class="p">,</span> <span class="mf">0.5408496</span><span class="p">],</span>
    <span class="s">"fork_18"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.234068632</span><span class="p">,</span> <span class="mf">0.445702642</span><span class="p">,</span> <span class="mf">0.6127451</span><span class="p">,</span> <span class="mf">0.344771236</span><span class="p">],</span>
    <span class="s">"fork_19"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.219362751</span><span class="p">,</span> <span class="mf">0.141781077</span><span class="p">,</span> <span class="mf">0.5919118</span><span class="p">,</span> <span class="mf">0.6683006</span><span class="p">],</span>
    <span class="s">"fork_20"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.180147052</span><span class="p">,</span> <span class="mf">0.239820287</span><span class="p">,</span> <span class="mf">0.6887255</span><span class="p">,</span> <span class="mf">0.235294119</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">scissors_image_regions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"scissors_1"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.4007353</span><span class="p">,</span> <span class="mf">0.194068655</span><span class="p">,</span> <span class="mf">0.259803921</span><span class="p">,</span> <span class="mf">0.6617647</span><span class="p">],</span>
    <span class="s">"scissors_2"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.426470578</span><span class="p">,</span> <span class="mf">0.185898721</span><span class="p">,</span> <span class="mf">0.172794119</span><span class="p">,</span> <span class="mf">0.5539216</span><span class="p">],</span>
    <span class="s">"scissors_3"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.289215684</span><span class="p">,</span> <span class="mf">0.259428144</span><span class="p">,</span> <span class="mf">0.403186262</span><span class="p">,</span> <span class="mf">0.421568632</span><span class="p">],</span>
    <span class="s">"scissors_4"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.343137264</span><span class="p">,</span> <span class="mf">0.105833367</span><span class="p">,</span> <span class="mf">0.332107842</span><span class="p">,</span> <span class="mf">0.8055556</span><span class="p">],</span>
    <span class="s">"scissors_5"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.3125</span><span class="p">,</span> <span class="mf">0.09766343</span><span class="p">,</span> <span class="mf">0.435049027</span><span class="p">,</span> <span class="mf">0.71405226</span><span class="p">],</span>
    <span class="s">"scissors_6"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.379901975</span><span class="p">,</span> <span class="mf">0.24308826</span><span class="p">,</span> <span class="mf">0.32107842</span><span class="p">,</span> <span class="mf">0.5718954</span><span class="p">],</span>
    <span class="s">"scissors_7"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.341911763</span><span class="p">,</span> <span class="mf">0.20714055</span><span class="p">,</span> <span class="mf">0.3137255</span><span class="p">,</span> <span class="mf">0.6356209</span><span class="p">],</span>
    <span class="s">"scissors_8"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.231617644</span><span class="p">,</span> <span class="mf">0.08459154</span><span class="p">,</span> <span class="mf">0.504901946</span><span class="p">,</span> <span class="mf">0.8480392</span><span class="p">],</span>
    <span class="s">"scissors_9"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.170343131</span><span class="p">,</span> <span class="mf">0.332957536</span><span class="p">,</span> <span class="mf">0.767156839</span><span class="p">,</span> <span class="mf">0.403594762</span><span class="p">],</span>
    <span class="s">"scissors_10"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.204656869</span><span class="p">,</span> <span class="mf">0.120539248</span><span class="p">,</span> <span class="mf">0.5245098</span><span class="p">,</span> <span class="mf">0.743464053</span><span class="p">],</span>
    <span class="s">"scissors_11"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05514706</span><span class="p">,</span> <span class="mf">0.159754932</span><span class="p">,</span> <span class="mf">0.799019635</span><span class="p">,</span> <span class="mf">0.730392158</span><span class="p">],</span>
    <span class="s">"scissors_12"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.265931368</span><span class="p">,</span> <span class="mf">0.169558853</span><span class="p">,</span> <span class="mf">0.5061275</span><span class="p">,</span> <span class="mf">0.606209159</span><span class="p">],</span>
    <span class="s">"scissors_13"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.241421565</span><span class="p">,</span> <span class="mf">0.184264734</span><span class="p">,</span> <span class="mf">0.448529422</span><span class="p">,</span> <span class="mf">0.6830065</span><span class="p">],</span>
    <span class="s">"scissors_14"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.05759804</span><span class="p">,</span> <span class="mf">0.05027781</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.882352948</span><span class="p">],</span>
    <span class="s">"scissors_15"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.191176474</span><span class="p">,</span> <span class="mf">0.169558853</span><span class="p">,</span> <span class="mf">0.6936275</span><span class="p">,</span> <span class="mf">0.6748366</span><span class="p">],</span>
    <span class="s">"scissors_16"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1004902</span><span class="p">,</span> <span class="mf">0.279036</span><span class="p">,</span> <span class="mf">0.6911765</span><span class="p">,</span> <span class="mf">0.477124184</span><span class="p">],</span>
    <span class="s">"scissors_17"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.2720588</span><span class="p">,</span> <span class="mf">0.131977156</span><span class="p">,</span> <span class="mf">0.4987745</span><span class="p">,</span> <span class="mf">0.6911765</span><span class="p">],</span>
    <span class="s">"scissors_18"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.180147052</span><span class="p">,</span> <span class="mf">0.112369314</span><span class="p">,</span> <span class="mf">0.6262255</span><span class="p">,</span> <span class="mf">0.6666667</span><span class="p">],</span>
    <span class="s">"scissors_19"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.333333343</span><span class="p">,</span> <span class="mf">0.0274019931</span><span class="p">,</span> <span class="mf">0.443627447</span><span class="p">,</span> <span class="mf">0.852941155</span><span class="p">],</span>
    <span class="s">"scissors_20"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.158088237</span><span class="p">,</span> <span class="mf">0.04047389</span><span class="p">,</span> <span class="mf">0.6691176</span><span class="p">,</span> <span class="mf">0.843137264</span><span class="p">]</span>
<span class="p">}</span>

<span class="c"># Update this with the path to where you downloaded the images.</span>
<span class="n">base_image_location</span> <span class="o">=</span> <span class="s">"&lt;path to directory"</span>

<span class="c"># Go through the data table above and create the images</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Adding images..."</span><span class="p">)</span>
<span class="n">tagged_images_with_regions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">fork_image_regions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">fork_image_regions</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span>
    <span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">Region</span><span class="p">(</span><span class="n">tag_id</span><span class="o">=</span><span class="n">fork_tag</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">)]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_image_location</span> <span class="o">+</span> <span class="s">"images/fork/"</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s">".jpg"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_contents</span><span class="p">:</span>
        <span class="n">tagged_images_with_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ImageFileCreateEntry</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="n">image_contents</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">regions</span><span class="o">=</span><span class="n">regions</span><span class="p">))</span>

<span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">scissors_image_regions</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">scissors_image_regions</span><span class="p">[</span><span class="n">file_name</span><span class="p">]</span>
    <span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="n">Region</span><span class="p">(</span><span class="n">tag_id</span><span class="o">=</span><span class="n">scissors_tag</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">)]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_image_location</span> <span class="o">+</span> <span class="s">"images/scissors/"</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s">".jpg"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_contents</span><span class="p">:</span>
        <span class="n">tagged_images_with_regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ImageFileCreateEntry</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="n">image_contents</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">regions</span><span class="o">=</span><span class="n">regions</span><span class="p">))</span>

<span class="n">upload_result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_images_from_files</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">ImageFileCreateBatch</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">tagged_images_with_regions</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">upload_result</span><span class="o">.</span><span class="n">is_batch_successful</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Image batch upload failed."</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">upload_result</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Image status: "</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Training..."</span><span class="p">)</span>
<span class="n">iteration</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">train_project</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
<span class="k">while</span> <span class="n">iteration</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s">"Completed"</span><span class="p">:</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">get_iteration</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Training status: "</span> <span class="o">+</span> <span class="n">iteration</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># The iteration is now trained. Publish it to the project endpoint</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">publish_iteration</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">iteration</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">publish_iteration_name</span><span class="p">,</span> <span class="n">prediction_resource_id</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Done!"</span><span class="p">)</span>

<span class="c"># Now there is a trained endpoint that can be used to make a prediction</span>

<span class="c"># Open the sample image and get back the prediction results.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">base_image_location</span> <span class="o">+</span> <span class="s">"images/Test/test_od_image.jpg"</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">test_data</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">detect_image</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">publish_iteration_name</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="c"># Display the results.</span>
<span class="k">for</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">predictions</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span>
        <span class="s">"</span><span class="se">\t</span><span class="s">"</span> <span class="o">+</span> <span class="n">prediction</span><span class="o">.</span><span class="n">tag_name</span> <span class="o">+</span> <span class="s">": {0:.2f}</span><span class="si">% </span><span class="s">bbox.left = {1:.2f}, bbox.top = {2:.2f}, bbox.width = {3:.2f}, bbox.height = {4:.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">prediction</span><span class="o">.</span><span class="n">probability</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">prediction</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="n">prediction</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">top</span><span class="p">,</span>
            <span class="n">prediction</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">prediction</span><span class="o">.</span><span class="n">bounding_box</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="用-video-indexer-来分析视频">用 video indexer 来分析视频</h2>
<p><a href="https://vi.microsoft.com/zh-Hans/learn">官方文档</a></p>

<p>上传一个视频, 然后通过 AI 来获取视频的一些 insight</p>
<ul>
  <li>Deep search
    <ul>
      <li>可以把视频中说的话, 出现的脸进行索引, 然后通过搜索找到视频中的一个画面</li>
      <li>可以获取的内容包括
        <ul>
          <li>Face detection  面部</li>
          <li>celebrity identification  名人</li>
          <li>品牌</li>
          <li>物体</li>
          <li>insight</li>
          <li>文字</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>辅助功能
    <ul>
      <li>提取视频中人物和他们说的话, 然后把话在视频中叠加到说话人上, 方便听觉障碍的人可以快速理解</li>
      <li>可以做实时翻译</li>
    </ul>
  </li>
  <li>参与度
    <ul>
      <li>一段教育视频前 30 分钟讲解球体，后 30 分钟讲解棱锥。如果从 30 分钟时的标记开始定位视频，那么阅读棱锥的学生会受益更多。同样，视频推荐系统可以利用视频见解来更好地决定应该向用户推荐哪个视频。</li>
    </ul>
  </li>
  <li>变现
    <ul>
      <li>通过理解视频内容, 然后可以在合适的位置插入对应的广告来获取变现能力</li>
    </ul>
  </li>
</ul>

<h3 id="video-indexer-in-action">video indexer in action</h3>

<p>video indexer 有自己的 <a href="https://www.videoindexer.ai/media/library">web portal</a></p>

<ol>
  <li>通过 AAD 账户登录</li>
  <li>上传视频 (https://aka.ms/responsible-ai-video)
    <ol>
      <li>提供视频名称, 语言种类, 是否是privacy 还是 public</li>
    </ol>
  </li>
  <li>提交后, 开始对视频进行 indexing</li>
  <li>视频index 成功后, 点击该视频
    <ol>
      <li>找到了 26 个人, 和对应的名字(有些事unknow) , 对应在视频中出现的时间点, 视频中的占比</li>
      <li>找到了8 个topic
        <ol>
          <li>教育</li>
          <li>科技</li>
          <li>商业</li>
          <li>…</li>
        </ol>
      </li>
      <li>1 个audoi</li>
      <li>27 个 keyword</li>
      <li>55 个 labels</li>
      <li>2 个 entity (品牌)
        <ol>
          <li>Eric Horvitz</li>
          <li>Microsoft</li>
        </ol>
      </li>
      <li>30 个场景 (拍视频的段场景)
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-14-065921.jpg" alt="" /></li>
    </ol>
  </li>
</ol>

<p>搜索 <code class="language-plaintext highlighter-rouge">Microsoft</code> 可以找到所有和视频相关的元素</p>
<ul>
  <li>视频中出现的文字</li>
  <li>品牌</li>
  <li>讨论的话题</li>
</ul>

<p><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-14-070039.jpg" alt="" /></p>

<p>附加功能</p>
<ul>
  <li>可以把带有insight 的视频内容通过 HTML 源代码的 embed 形式提供
    <ul>
      <li>Share 的地址 <code class="language-plaintext highlighter-rouge">https://www.videoindexer.ai/accounts/1771eab4-fb17-463d-97f5-aa30eceaee38/videos/9448d2362b/</code></li>
      <li>Enbed 的地址 <code class="language-plaintext highlighter-rouge">https://www.videoindexer.ai/embed/insights/1771eab4-fb17-463d-97f5-aa30eceaee38/9448d2362b/?accessToken=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJWZXJzaW9uIjoiMi4wLjAuMCIsIktleVZlcnNpb24iOiIxNGU0M2M5NDFlOWI0OTg1OWU0NDkzNDFhZjgxZjNiNiIsIkFjY291bnRJZCI6IjE3NzFlYWI0LWZiMTctNDYzZC05N2Y1LWFhMzBlY2VhZWUzOCIsIkFjY291bnRUeXBlIjoiVHJpYWwiLCJWaWRlb0lkIjoiOTQ0OGQyMzYyYiIsIlBlcm1pc3Npb24iOiJSZWFkZXIiLCJFeHRlcm5hbFVzZXJJZCI6IjNCNUNGQkIyMzVGNTQ1NTVBMEQ4NzQzOUEwQ0NGMEI4IiwiVXNlclR5cGUiOiJNaWNyb3NvZnRDb3JwQWFkIiwiSXNzdWVyTG9jYXRpb24iOiJUcmlhbCIsIm5iZiI6MTY4MjgxODI5MiwiZXhwIjoxNjgyODIyMTkyLCJpc3MiOiJodHRwczovL2FwaS52aWRlb2luZGV4ZXIuYWkvIiwiYXVkIjoiaHR0cHM6Ly9hcGkudmlkZW9pbmRleGVyLmFpLyJ9.W8ZTosIUqZQrkyjcw-M2UnCAovtL_6pj1SQIiGMLc3LxnFMblKsg-3Qt6aQEHltRV_6H_Pmp7wyZUcKX8WDr-yXTKVzTOy7_z_w6Hj_PrYuFR1qJyxVBbwFnORoDbJyyjXekkBHV3hOWHgHUbTrmS1aCDnAIIH5qNibbhezYYNEPMCwWr15nXCpm-JlUl0MlVpeIxfcqUYZPqBZ-GAKaZ0wuxGaRhQFFtQ91ztR258dIfapZk0gbCditBxlxm5vGcBuOk-ccUa9-syFZlYHOzrgV3Sx0jPl_xrY1SEn7no-tdw3TQJASVJsqLZKLlBJ1EIerIemFnLtfOSxA0UV3BQ&amp;locale=en&amp;location=trial</code></li>
    </ul>
  </li>
  <li>可以把视频中的insight 以 JSON 的格式下载</li>
  <li>可以查看整个视频中的按时间顺序的 insight 列表, 并且可以按照不同的分类对内容进行筛选</li>
</ul>

<h2 id="实现自然语言处理-natural-language-processing-nlp">实现自然语言处理 Natural Language Processing (NLP)</h2>

<p>实现任何计算机之间的自然语言处理, 包括</p>
<ul>
  <li>Text Analytics</li>
  <li>Speech Service</li>
  <li>Translation</li>
  <li>创建自己的语言模型  LUIS , 并进行优化和使用</li>
</ul>

<h3 id="文字处理-text-analytics">文字处理 Text Analytics</h3>

<p>内容包括了</p>
<ul>
  <li>处理 关键字/短语 抽取 (key phrases)</li>
  <li>处理重要实体 (人, 地址, URL 等等)</li>
  <li>处理 态度 (sentiment)</li>
  <li>探测文本中使用的是什么语言</li>
</ul>

<h4 id="key-phrases-extraction-关键字短语-抽取">Key Phrases extraction 关键字/短语 抽取</h4>
<p><a href="https://learn.microsoft.com/en-us/azure/cognitive-services/language-service/key-phrase-extraction/overview">官方文档</a>
<a href="https://learn.microsoft.com/en-us/rest/api/cognitiveservices-textanalytics/3.0/key-phrases/key-phrases?tabs=HTTP">API 文档</a>
<a href="https://learn.microsoft.com/zh-cn/azure/cognitive-services/language-service/key-phrase-extraction/language-support">支持的语言类型</a></p>

<ul>
  <li>识别文字中的重要短语</li>
  <li>使用关键短语提取来快速识别文本中的主要概念。例如，在“食物很美味，工作人员很棒”的文本中，关键短语提取将返回主要主题：“食物”和“很棒的员工”。</li>
</ul>

<p>流程</p>
<ul>
  <li>Portal 中 创建一个Azure Cognitive Service 的 Language Service
    <ul>
      <li>默认的功能包含了
        <ul>
          <li>Sentiment analysis</li>
          <li>Key phrase extraction</li>
          <li>Pre-built question answering</li>
          <li>Conversational language understanding</li>
          <li>Named entity recognition</li>
          <li>Text Summarization</li>
          <li>Text analytics for Health</li>
        </ul>
      </li>
      <li>可选的功能包括:
        <ul>
          <li>Custom question answering</li>
          <li>Custom text classification &amp; Custom named entity recognition</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>使用REST API或C#、Java、JavaScript和Python的客户端库创建请求。您还可以使用批处理请求发送异步调用，将多个功能的API请求合并到单个调用中。</li>
  <li>将包含您的数据的请求作为原始非结构化文本发送。您的密钥和端点将用于身份验证。</li>
  <li>在本地流式传输或存储响应。</li>
</ul>

<p>代码使用了 <code class="language-plaintext highlighter-rouge">TextAnalyticsClient</code> 这个类库</p>
<ul>
  <li>代码逻辑是把 4 种语言做成一个字典, 发给文字分析服务
    <ul>
      <li><code class="language-plaintext highlighter-rouge">response = client.key_phrases(documents=documents)</code></li>
    </ul>
  </li>
  <li>然后在把结果展示出来</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">azure.cognitiveservices.language.textanalytics</span> <span class="kn">import</span> <span class="n">TextAnalyticsClient</span>
<span class="kn">from</span> <span class="nn">msrest.authentication</span> <span class="kn">import</span> <span class="n">CognitiveServicesCredentials</span>

<span class="c"># variables to store subscription key and root URL for the Cognitive Service resource</span>
<span class="n">subscription_key</span> <span class="o">=</span> <span class="s">"YourKey"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"YourEndpoint"</span>


<span class="k">def</span> <span class="nf">authenticateclient</span><span class="p">():</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">CognitiveServicesCredentials</span><span class="p">(</span><span class="n">subscription_key</span><span class="p">)</span>
    <span class="n">text_analytics_client</span> <span class="o">=</span> <span class="n">TextAnalyticsClient</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text_analytics_client</span>


<span class="k">def</span> <span class="nf">key_phrases</span><span class="p">():</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">authenticateclient</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"ja"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">:</span> <span class="s">"猫は幸せ"</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"de"</span><span class="p">,</span>
             <span class="s">"text"</span><span class="p">:</span> <span class="s">"Fahrt nach Stuttgart und dann zum Hotel zu Fu."</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"en"</span><span class="p">,</span>
             <span class="s">"text"</span><span class="p">:</span> <span class="s">"My cat might need to see a veterinarian."</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"4"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"es"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">:</span> <span class="s">"A mi me encanta el fútbol!"</span><span class="p">}</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span>
                <span class="s">"Asking key-phrases on '{}' (id: {})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s">'text'</span><span class="p">],</span> <span class="n">document</span><span class="p">[</span><span class="s">'id'</span><span class="p">]))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">key_phrases</span><span class="p">(</span><span class="n">documents</span><span class="o">=</span><span class="n">documents</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">documents</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Document Id: "</span><span class="p">,</span> <span class="n">document</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">Key Phrases:"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">phrase</span> <span class="ow">in</span> <span class="n">document</span><span class="o">.</span><span class="n">key_phrases</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">"</span><span class="p">,</span> <span class="n">phrase</span><span class="p">)</span>

    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Encountered exception. {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>


<span class="n">key_phrases</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码运行结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-15-012405.jpg" alt="" /></p>
<ul>
  <li>英文结果
    <ul>
      <li>从 “My cat might need to see a veterinarian.” 提取了</li>
      <li>cat 猫</li>
      <li>veterinarian 兽医</li>
    </ul>
  </li>
</ul>

<h4 id="entity-information-extract-抽取-文字中的实体信息">Entity information extract 抽取 文字中的实体信息</h4>

<p>Entity 的概念: 就比如在 wikipedia 中的一段文字, 有些文字有链接, 这些文字往往有更明确的解释, 可以理解为 entity</p>

<p>这里的代码是用了 Rest API 直接调用</p>
<ul>
  <li>将2种语言的句子组成一个字典</li>
  <li>将字典发送给 endpint , 并获取结果
    <ul>
      <li>endpoint 是 <code class="language-plaintext highlighter-rouge">https://dl-language-service-1.cognitiveservices.azure.com/text/analytics/v2.1/entities</code></li>
      <li><code class="language-plaintext highlighter-rouge">response = requests.post(entities_url, headers=headers, json=documents)</code></li>
    </ul>
  </li>
  <li>将结果打印</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></td><td class="code"><pre><span class="kn">from</span> <span class="nn">pip._vendor</span> <span class="kn">import</span> <span class="n">requests</span>
<span class="c"># pprint is used to format the JSON response</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="c"># variables to store subscription key and root URL for the Cognitive Service resource</span>
<span class="n">subscription_key</span> <span class="o">=</span> <span class="s">"a3c9bca3107644108def6f2dd02822d2"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"https://dl-language-service-1.cognitiveservices.azure.com/"</span>

<span class="c"># append the Text Analytics endpoint information to the URL</span>
<span class="n">entities_url</span> <span class="o">=</span> <span class="n">endpoint</span> <span class="o">+</span> <span class="s">"/text/analytics/v2.1/entities"</span>

<span class="c"># variable to store a JSON formatted document that contains two entries in a JSON array.</span>
<span class="n">documents</span> <span class="o">=</span> <span class="p">{</span><span class="s">"documents"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"en"</span><span class="p">,</span>
     <span class="s">"text"</span><span class="p">:</span> <span class="s">"Microsoft was founded by Bill Gates and Paul Allen on April 4, 1975, to develop and sell "</span>
             <span class="s">"BASIC interpreters for the Altair 8800."</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"es"</span><span class="p">,</span>
     <span class="s">"text"</span><span class="p">:</span> <span class="s">"La sede principal de Microsoft se encuentra en la ciudad de Redmond, a 21 kilómetros de "</span>
             <span class="s">"Seattle."</span><span class="p">}</span>
<span class="p">]}</span>

<span class="c"># Setup the header information for the REST request passing in the subscription key</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Ocp-Apim-Subscription-Key"</span><span class="p">:</span> <span class="n">subscription_key</span><span class="p">}</span>

<span class="c"># Build the REST request by passing in the complete URL, header information for authentication, and the JSON document</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">entities_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">documents</span><span class="p">)</span>

<span class="c"># Create a variable to store the results that are returned from the REST request</span>
<span class="n">entities</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c"># Output the result using pprint.</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>下面是输出的json结果</p>
<ul>
  <li>分析出了以下 entity 的名字, 类型, 和 对应的 wikipedia 的链接
    <ul>
      <li>比尔盖茨</li>
      <li>微软</li>
      <li>Paul Allen</li>
    </ul>
  </li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</pre></td><td class="code"><pre><span class="p">{</span><span class="err">'documents':</span><span class="w"> </span><span class="err">[{'entities':</span><span class="w"> </span><span class="err">[{'bingId':</span><span class="w"> </span><span class="err">'a093e9b9-90f5-a3d5-c4b8-5855e1b01f85',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'entityTypeScore':</span><span class="w"> </span><span class="err">1.0,</span><span class="w">
                                           </span><span class="err">'length':</span><span class="w"> </span><span class="err">9,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">0,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Microsoft',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.5080587142195991</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Microsoft',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Organization',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'Microsoft',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'en',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://en.wikipedia.org/wiki/Microsoft'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'bingId':</span><span class="w"> </span><span class="err">'0d47c987-0042-5576-15e8-97af601614fa',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'entityTypeScore':</span><span class="w"> </span><span class="err">0.67,</span><span class="w">
                                           </span><span class="err">'length':</span><span class="w"> </span><span class="err">10,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">25,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Bill</span><span class="w"> </span><span class="err">Gates',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.5601095924849657</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Bill</span><span class="w"> </span><span class="err">Gates',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Person',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'Bill</span><span class="w"> </span><span class="err">Gates',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'en',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://en.wikipedia.org/wiki/Bill_Gates'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'bingId':</span><span class="w"> </span><span class="err">'df2c4376-9923-6a54-893f-2ee5a5badbc7',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'entityTypeScore':</span><span class="w"> </span><span class="err">0.81,</span><span class="w">
                                           </span><span class="err">'length':</span><span class="w"> </span><span class="err">10,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">40,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Paul</span><span class="w"> </span><span class="err">Allen',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.5647133956039234</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Paul</span><span class="w"> </span><span class="err">Allen',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Person',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'Paul</span><span class="w"> </span><span class="err">Allen',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'en',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://en.wikipedia.org/wiki/Paul_Allen'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'bingId':</span><span class="w"> </span><span class="err">'52535f87-235e-b513-54fe-c03e4233ac6e',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'length':</span><span class="w"> </span><span class="err">7,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">54,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'April</span><span class="w"> </span><span class="err">4',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.34538928435757743</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'April</span><span class="w"> </span><span class="mi">4</span><span class="err">',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Other',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'April</span><span class="w"> </span><span class="mi">4</span><span class="err">',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'en',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://en.wikipedia.org/wiki/April_</span><span class="mi">4</span><span class="err">'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'entityTypeScore':</span><span class="w"> </span><span class="err">0.8,</span><span class="w">
                                           </span><span class="err">'length':</span><span class="w"> </span><span class="err">13,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">54,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'April</span><span class="w"> </span><span class="err">4,</span><span class="w"> </span><span class="err">1975'</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'April</span><span class="w"> </span><span class="mi">4</span><span class="err">,</span><span class="w"> </span><span class="mi">1975</span><span class="err">',</span><span class="w">
                              </span><span class="err">'subType':</span><span class="w"> </span><span class="err">'Date',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'DateTime'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'bingId':</span><span class="w"> </span><span class="err">'5b16443d-501c-58f3-352e-611bbe75aa6e',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'length':</span><span class="w"> </span><span class="err">5,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">89,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'BASIC',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.313848923908594</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'BASIC',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Other',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'BASIC',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'en',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://en.wikipedia.org/wiki/BASIC'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'bingId':</span><span class="w"> </span><span class="err">'7216c654-3779-68a2-c7b7-12ff3dad5606',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'length':</span><span class="w"> </span><span class="err">11,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">116,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Altair</span><span class="w"> </span><span class="err">8800',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.8690828819485741</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Altair</span><span class="w"> </span><span class="mi">8800</span><span class="err">',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Other',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'Altair</span><span class="w"> </span><span class="mi">8800</span><span class="err">',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'en',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://en.wikipedia.org/wiki/Altair_</span><span class="mi">8800</span><span class="err">'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'entityTypeScore':</span><span class="w"> </span><span class="err">0.8,</span><span class="w">
                                           </span><span class="err">'length':</span><span class="w"> </span><span class="err">4,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">123,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'8800'</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'</span><span class="mi">8800</span><span class="err">',</span><span class="w">
                              </span><span class="err">'subType':</span><span class="w"> </span><span class="err">'Number',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Quantity'}],</span><span class="w">
                </span><span class="err">'id':</span><span class="w"> </span><span class="err">'</span><span class="mi">1</span><span class="err">'},</span><span class="w">
               </span><span class="p">{</span><span class="err">'entities':</span><span class="w"> </span><span class="err">[{'bingId':</span><span class="w"> </span><span class="err">'a093e9b9-90f5-a3d5-c4b8-5855e1b01f85',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'length':</span><span class="w"> </span><span class="err">9,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">21,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Microsoft',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.3868553907750074</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Microsoft',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Organization',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'Microsoft',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'es',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://es.wikipedia.org/wiki/Microsoft'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'bingId':</span><span class="w"> </span><span class="err">'8769d4c0-b645-70ac-03ec-6eebabf6d26e',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'length':</span><span class="w"> </span><span class="err">7,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">60,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Redmond',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.4737390069279388</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Redmond</span><span class="w"> </span><span class="err">(Washington)',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Location',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'Redmond</span><span class="w"> </span><span class="err">(Washington)',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'es',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://es.wikipedia.org/wiki/Redmond_(Washington)'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'entityTypeScore':</span><span class="w"> </span><span class="err">0.8,</span><span class="w">
                                           </span><span class="err">'length':</span><span class="w"> </span><span class="err">13,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">71,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'21</span><span class="w"> </span><span class="err">kilómetros'</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'</span><span class="mi">21</span><span class="w"> </span><span class="err">kilómetros',</span><span class="w">
                              </span><span class="err">'subType':</span><span class="w"> </span><span class="err">'Dimension',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Quantity'},</span><span class="w">
                             </span><span class="p">{</span><span class="err">'bingId':</span><span class="w"> </span><span class="err">'5fbba6b8-85e1-4d41-9444-d9055436e473',</span><span class="w">
                              </span><span class="err">'matches':</span><span class="w"> </span><span class="err">[{'length':</span><span class="w"> </span><span class="err">7,</span><span class="w">
                                           </span><span class="err">'offset':</span><span class="w"> </span><span class="err">88,</span><span class="w">
                                           </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Seattle',</span><span class="w">
                                           </span><span class="err">'wikipediaScore':</span><span class="w"> </span><span class="err">0.34624433748176875</span><span class="p">}</span><span class="err">],</span><span class="w">
                              </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Seattle',</span><span class="w">
                              </span><span class="err">'type':</span><span class="w"> </span><span class="err">'Location',</span><span class="w">
                              </span><span class="err">'wikipediaId':</span><span class="w"> </span><span class="err">'Seattle',</span><span class="w">
                              </span><span class="err">'wikipediaLanguage':</span><span class="w"> </span><span class="err">'es',</span><span class="w">
                              </span><span class="err">'wikipediaUrl':</span><span class="w"> </span><span class="err">'https://es.wikipedia.org/wiki/Seattle'}],</span><span class="w">
                </span><span class="err">'id':</span><span class="w"> </span><span class="err">'</span><span class="mi">2</span><span class="err">'}],</span><span class="w">
 </span><span class="err">'errors':</span><span class="w"> </span><span class="p">[]</span><span class="err">}</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
</div>

<p>下面是一段 .Net 代码的类似的输出结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-15-015326.jpg" alt="" /></p>

<h4 id="抽取文字中的-sentiment-观点情感-信息">抽取文字中的 sentiment (观点/情感) 信息</h4>

<p>sentiment 主要包含三种结果</p>
<ul>
  <li>positive 积极的</li>
  <li>nagitave 消极的</li>
  <li>neutral 中等的</li>
  <li>结果的数字打分是 0-1, 越大越好</li>
</ul>

<p>代码发送2 段不同语言的句子给到 sentiment API 和</p>
<ul>
  <li>endpoint <code class="language-plaintext highlighter-rouge">https://dl-language-service-1.cognitiveservices.azure.com/text/analytics/v3.0/sentiment</code></li>
  <li></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="c"># pprint is used to format the JSON response</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">subscription_key</span> <span class="o">=</span> <span class="s">"a3c9bca3107644108def6f2dd02822d2"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"https://dl-language-service-1.cognitiveservices.azure.com/"</span>

<span class="n">sentiment_url</span> <span class="o">=</span> <span class="n">endpoint</span> <span class="o">+</span> <span class="s">"/text/analytics/v3.0/sentiment"</span>

<span class="n">documents</span> <span class="o">=</span> <span class="p">{</span><span class="s">"documents"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"en"</span><span class="p">,</span>
     <span class="s">"text"</span><span class="p">:</span> <span class="s">"I really enjoy the new XBox One S. It has a clean look, it has 4K/HDR resolution and it is affordable."</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"language"</span><span class="p">:</span> <span class="s">"es"</span><span class="p">,</span>
     <span class="s">"text"</span><span class="p">:</span> <span class="s">"Este ha sido un dia terrible, llegué tarde al trabajo debido a un accidente automobilistico."</span><span class="p">}</span>
<span class="p">]}</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Ocp-Apim-Subscription-Key"</span><span class="p">:</span> <span class="n">subscription_key</span><span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">sentiment_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">documents</span><span class="p">)</span>
<span class="n">sentiments</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">sentiments</span><span class="p">)</span>

</pre></td></tr></tbody></table>
</div>
</div>

<p>返回的json 内容如下</p>
<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><pre><span class="p">{</span><span class="err">'documents':</span><span class="w"> </span><span class="err">[{'confidenceScores':</span><span class="w"> </span><span class="err">{'negative':</span><span class="w"> </span><span class="err">0.0,</span><span class="w">
                                     </span><span class="err">'neutral':</span><span class="w"> </span><span class="err">0.01,</span><span class="w">
                                     </span><span class="err">'positive':</span><span class="w"> </span><span class="err">0.99</span><span class="p">}</span><span class="err">,</span><span class="w">
                </span><span class="err">'id':</span><span class="w"> </span><span class="err">'</span><span class="mi">1</span><span class="err">',</span><span class="w">
                </span><span class="err">'sentences':</span><span class="w"> </span><span class="p">[{</span><span class="err">'confidenceScores':</span><span class="w"> </span><span class="err">{'negative':</span><span class="w"> </span><span class="err">0.0,</span><span class="w">
                                                    </span><span class="err">'neutral':</span><span class="w"> </span><span class="err">0.01,</span><span class="w">
                                                    </span><span class="err">'positive':</span><span class="w"> </span><span class="err">0.99</span><span class="p">},</span><span class="w">
                               </span><span class="err">'length':</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
                               </span><span class="err">'offset':</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                               </span><span class="err">'sentiment':</span><span class="w"> </span><span class="err">'positive'</span><span class="p">,</span><span class="w">
                               </span><span class="err">'text':</span><span class="w"> </span><span class="err">'I</span><span class="w"> </span><span class="err">really</span><span class="w"> </span><span class="err">enjoy</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">XBox</span><span class="w"> </span><span class="err">One</span><span class="w"> </span><span class="err">S.</span><span class="w"> </span><span class="err">'}</span><span class="p">,</span><span class="w">
                              </span><span class="p">{</span><span class="err">'confidenceScores':</span><span class="w"> </span><span class="err">{'negative':</span><span class="w"> </span><span class="err">0.0,</span><span class="w">
                                                    </span><span class="err">'neutral':</span><span class="w"> </span><span class="err">0.59,</span><span class="w">
                                                    </span><span class="err">'positive':</span><span class="w"> </span><span class="err">0.4</span><span class="p">},</span><span class="w">
                               </span><span class="err">'length':</span><span class="w"> </span><span class="mi">67</span><span class="p">,</span><span class="w">
                               </span><span class="err">'offset':</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w">
                               </span><span class="err">'sentiment':</span><span class="w"> </span><span class="err">'neutral'</span><span class="p">,</span><span class="w">
                               </span><span class="err">'text':</span><span class="w"> </span><span class="err">'It</span><span class="w"> </span><span class="err">has</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">clean</span><span class="w"> </span><span class="err">look</span><span class="p">,</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">has</span><span class="w"> </span><span class="mi">4</span><span class="err">K/HDR</span><span class="w"> </span><span class="err">'</span><span class="w">
                                       </span><span class="err">'resolution</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">affordable.'}</span><span class="p">]</span><span class="err">,</span><span class="w">
                </span><span class="err">'sentiment':</span><span class="w"> </span><span class="err">'positive',</span><span class="w">
                </span><span class="err">'warnings':</span><span class="w"> </span><span class="p">[]</span><span class="err">},</span><span class="w">
               </span><span class="p">{</span><span class="err">'confidenceScores':</span><span class="w"> </span><span class="err">{'negative':</span><span class="w"> </span><span class="err">1.0,</span><span class="w">
                                     </span><span class="err">'neutral':</span><span class="w"> </span><span class="err">0.0,</span><span class="w">
                                     </span><span class="err">'positive':</span><span class="w"> </span><span class="err">0.0</span><span class="p">}</span><span class="err">,</span><span class="w">
                </span><span class="err">'id':</span><span class="w"> </span><span class="err">'</span><span class="mi">2</span><span class="err">',</span><span class="w">
                </span><span class="err">'sentences':</span><span class="w"> </span><span class="p">[{</span><span class="err">'confidenceScores':</span><span class="w"> </span><span class="err">{'negative':</span><span class="w"> </span><span class="err">1.0,</span><span class="w">
                                                    </span><span class="err">'neutral':</span><span class="w"> </span><span class="err">0.0,</span><span class="w">
                                                    </span><span class="err">'positive':</span><span class="w"> </span><span class="err">0.0</span><span class="p">},</span><span class="w">
                               </span><span class="err">'length':</span><span class="w"> </span><span class="mi">92</span><span class="p">,</span><span class="w">
                               </span><span class="err">'offset':</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
                               </span><span class="err">'sentiment':</span><span class="w"> </span><span class="err">'negative'</span><span class="p">,</span><span class="w">
                               </span><span class="err">'text':</span><span class="w"> </span><span class="err">'Este</span><span class="w"> </span><span class="err">ha</span><span class="w"> </span><span class="err">sido</span><span class="w"> </span><span class="err">un</span><span class="w"> </span><span class="err">dia</span><span class="w"> </span><span class="err">terrible</span><span class="p">,</span><span class="w"> </span><span class="err">llegué</span><span class="w"> </span><span class="err">'</span><span class="w">
                                       </span><span class="err">'tarde</span><span class="w"> </span><span class="err">al</span><span class="w"> </span><span class="err">trabajo</span><span class="w"> </span><span class="err">debido</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">un</span><span class="w"> </span><span class="err">accidente</span><span class="w"> </span><span class="err">'</span><span class="w">
                                       </span><span class="err">'automobilistico.'}</span><span class="p">]</span><span class="err">,</span><span class="w">
                </span><span class="err">'sentiment':</span><span class="w"> </span><span class="err">'negative',</span><span class="w">
                </span><span class="err">'warnings':</span><span class="w"> </span><span class="p">[]</span><span class="err">}],</span><span class="w">
 </span><span class="err">'errors':</span><span class="w"> </span><span class="p">[]</span><span class="err">,</span><span class="w">
 </span><span class="err">'modelVersion':</span><span class="w"> </span><span class="err">'</span><span class="mi">2022-11-01</span><span class="err">'}</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
</div>

<h4 id="detect-the-language-used-in-text-检测文本用了什么语言">detect the language used in text 检测文本用了什么语言</h4>

<p>检测语言类型需要发送文字信息到 lanugage API</p>
<ul>
  <li>endpoint <code class="language-plaintext highlighter-rouge">https://dl-language-service-1.cognitiveservices.azure.com/text/analytics/v3.0/languages</code></li>
  <li>把多段不同语言的文字放到字典中发送给 endpoint</li>
  <li>打印Json返回结果
    <ul>
      <li>结果是语言的 iso 名称, 名称, 和信任值(0-1)</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">requests</span>
<span class="c"># pprint is used to format the JSON response</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">subscription_key</span> <span class="o">=</span> <span class="s">"a3c9bca3107644108def6f2dd02822d2"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"https://dl-language-service-1.cognitiveservices.azure.com/"</span>

<span class="n">language_api_url</span> <span class="o">=</span> <span class="n">endpoint</span> <span class="o">+</span> <span class="s">"/text/analytics/v3.0/languages"</span>

<span class="n">documents</span> <span class="o">=</span> <span class="p">{</span><span class="s">"documents"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">:</span> <span class="s">"This is a document written in English."</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">:</span> <span class="s">"Este es un document escrito en Español."</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"3"</span><span class="p">,</span> <span class="s">"text"</span><span class="p">:</span> <span class="s">"这是一个用中文写的文件"</span><span class="p">}</span>
<span class="p">]}</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Ocp-Apim-Subscription-Key"</span><span class="p">:</span> <span class="n">subscription_key</span><span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">language_api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">documents</span><span class="p">)</span>
<span class="n">languages</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>返回的json 结果</p>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre><span class="p">{</span><span class="err">'documents':</span><span class="w"> </span><span class="err">[{'detectedLanguage':</span><span class="w"> </span><span class="err">{'confidenceScore':</span><span class="w"> </span><span class="err">0.99,</span><span class="w">
                                     </span><span class="err">'iso6391Name':</span><span class="w"> </span><span class="err">'en',</span><span class="w">
                                     </span><span class="err">'name':</span><span class="w"> </span><span class="err">'English'</span><span class="p">}</span><span class="err">,</span><span class="w">
                </span><span class="err">'id':</span><span class="w"> </span><span class="err">'</span><span class="mi">1</span><span class="err">',</span><span class="w">
                </span><span class="err">'warnings':</span><span class="w"> </span><span class="p">[]</span><span class="err">},</span><span class="w">
               </span><span class="p">{</span><span class="err">'detectedLanguage':</span><span class="w"> </span><span class="err">{'confidenceScore':</span><span class="w"> </span><span class="err">1.0,</span><span class="w">
                                     </span><span class="err">'iso6391Name':</span><span class="w"> </span><span class="err">'es',</span><span class="w">
                                     </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Spanish'</span><span class="p">}</span><span class="err">,</span><span class="w">
                </span><span class="err">'id':</span><span class="w"> </span><span class="err">'</span><span class="mi">2</span><span class="err">',</span><span class="w">
                </span><span class="err">'warnings':</span><span class="w"> </span><span class="p">[]</span><span class="err">},</span><span class="w">
               </span><span class="p">{</span><span class="err">'detectedLanguage':</span><span class="w"> </span><span class="err">{'confidenceScore':</span><span class="w"> </span><span class="err">1.0,</span><span class="w">
                                     </span><span class="err">'iso6391Name':</span><span class="w"> </span><span class="err">'zh_chs',</span><span class="w">
                                     </span><span class="err">'name':</span><span class="w"> </span><span class="err">'Chinese_Simplified'</span><span class="p">}</span><span class="err">,</span><span class="w">
                </span><span class="err">'id':</span><span class="w"> </span><span class="err">'</span><span class="mi">3</span><span class="err">',</span><span class="w">
                </span><span class="err">'warnings':</span><span class="w"> </span><span class="p">[]</span><span class="err">}],</span><span class="w">
 </span><span class="err">'errors':</span><span class="w"> </span><span class="p">[]</span><span class="err">,</span><span class="w">
 </span><span class="err">'modelVersion':</span><span class="w"> </span><span class="err">'</span><span class="mi">2022-10-01</span><span class="err">'}</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
</div>

<h2 id="speech-service-语音---文字互转">Speech Service (语音 - 文字互转)</h2>
<p><a href="https://azure.microsoft.com/en-us/products/cognitive-services/speech-services">官方介绍</a>
<a href="https://learn.microsoft.com/en-us/azure/cognitive-services/speech-service/overview">说明文档</a>
<a href="https://learn.microsoft.com/en-us/azure/cognitive-services/speech-service/language-support?tabs=tts">支持的语言</a></p>

<p>需要先安装 认知语音库</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="c"># pip install azure-cognitiveservices-speech</span>
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple azure-cognitiveservices-speech
</pre></td></tr></tbody></table>
</div>
</div>

<p>包含的 features</p>
<ul>
  <li>speech to text
    <ul>
      <li>说的话转成文字</li>
      <li>场景:
        <ul>
          <li>会议记录</li>
          <li>实时翻译</li>
          <li>语音助手</li>
          <li>help desk/呼叫中心</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>text to speech
    <ul>
      <li>文字转语音</li>
      <li>Azure 使用的是 <code class="language-plaintext highlighter-rouge">Neural vices</code>, 是深度神经网络模仿人类的说话语音语调而产生的语音. 更接近人类自然发音.</li>
      <li>场景:
        <ul>
          <li>小说, 新闻等应用把内容读出来</li>
          <li>自动外呼广告电话</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>实时翻译/同声传译
    <ul>
      <li>结合speech to text &amp; text to speech</li>
      <li>把一种语言翻译成另一种语言</li>
    </ul>
  </li>
  <li>批量转录
    <ul>
      <li>把一批语音转成其他格式或者语言</li>
    </ul>
  </li>
  <li>recognize speaker
    <ul>
      <li>识别说话的人</li>
      <li>场景
        <ul>
          <li>识别会议/视频中说话的人是谁</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>语音操作的应用
    <ul>
      <li>场景
        <ul>
          <li>开灯</li>
          <li>关门</li>
          <li>…</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>声音语言识别 Language identification
    <ul>
      <li>听一下说话人说的是哪国话</li>
    </ul>
  </li>
  <li>发音评估 Pronunciation assessment
    <ul>
      <li>评估发音是否准确</li>
    </ul>
  </li>
  <li>意图识别 Intent recognition
    <ul>
      <li>识别说话人的意图</li>
    </ul>
  </li>
</ul>

<p>附加功能</p>
<ul>
  <li>可以定制化自己的模型, 语音库</li>
</ul>

<p>中文语音可以识别</p>
<ul>
  <li>普通话</li>
  <li>四川话</li>
  <li>山东话</li>
  <li>江浙沪方言 Wu Chinese</li>
  <li>广东话</li>
  <li>香港话</li>
  <li>台湾话
text to speeck 可以说更多的功能, 支持</li>
  <li>方言
    <ul>
      <li>上海话</li>
      <li>河南话</li>
      <li>…</li>
    </ul>
  </li>
  <li>男女</li>
  <li>角色
    <ul>
      <li>Boy</li>
      <li>Girl</li>
      <li>Narrator (中性)</li>
      <li>YoungAdultMale</li>
      <li>…</li>
    </ul>
  </li>
  <li>风格
    <ul>
      <li>生气</li>
      <li>愉快</li>
      <li>…</li>
    </ul>
  </li>
</ul>

<p>使用Speech CLI、Speech SDK、Speech Studio或REST API，语音可以轻松启用您的应用程序、工具和设备</p>
<ul>
  <li><a href="https://learn.microsoft.com/en-us/azure/cognitive-services/speech-service/speech-studio-overview">Speech Studio</a>
    <ul>
      <li>Speech Studio是一套基于UI的工具，用于在您的应用程序中构建和集成Azure认知服务语音服务的功能。您使用无代码方法在Speech Studio中创建项目，然后使用Speech SDK、Speech CLI或REST API在应用程序中引用这些资产。</li>
    </ul>
  </li>
</ul>

<h3 id="text-to-speech">Text to speech</h3>

<p>python 代码</p>
<ul>
  <li>使用了 <code class="language-plaintext highlighter-rouge">import azure.cognitiveservices.speech as speechsdk</code> 类库</li>
  <li>选择一个语言类型, <a href="https://learn.microsoft.com/en-us/azure/cognitive-services/speech-service/language-support?tabs=tts">支持的语言</a></li>
  <li>输入一段要说的文字, 通过 SDK 发送给Azure  text to Speech 服务, 调用 <code class="language-plaintext highlighter-rouge">speak_text_async</code> 方法</li>
  <li><code class="language-plaintext highlighter-rouge">speech_synthesizer = speechsdk.SpeechSynthesizer(speech_config=speech_config, audio_config=audio_output)</code>
    <ul>
      <li>这行代码初始化一个 speech syntyhesizer (语音合成器)</li>
      <li>第二个参数 audio_config=audio_output 不给的话就直接朗读, 如果给的话,就会存到文件中</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">result = speech_synthesizer.speak_text_async(text).get()</code>
    <ul>
      <li>执行这行代码就能听到声音了</li>
    </ul>
  </li>
  <li>将另一个语音存到文件中</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">azure.cognitiveservices.speech</span> <span class="kn">as</span> <span class="nn">speechsdk</span>

<span class="c"># Creates an instance of a speech config with specified subscription key and service region.</span>
<span class="c"># Replace with your own subscription key and service region (e.g., "westus").</span>
<span class="n">speech_key</span><span class="p">,</span> <span class="n">service_region</span> <span class="o">=</span> <span class="s">"6dc37625b4e04652821d23239f58f33a"</span><span class="p">,</span> <span class="s">"eastus"</span>
<span class="n">speech_config</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechConfig</span><span class="p">(</span><span class="n">subscription</span><span class="o">=</span><span class="n">speech_key</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">service_region</span><span class="p">)</span>

<span class="c"># uncomment this line to change the voice used for synthesis</span>
<span class="n">speech_config</span><span class="o">.</span><span class="n">speech_synthesis_voice_name</span> <span class="o">=</span> <span class="s">"zh-CN-YunhaoNeural"</span>

<span class="c"># Creates a speech synthesizer using the default speaker as audio output.</span>
<span class="n">speech_synthesizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechSynthesizer</span><span class="p">(</span><span class="n">speech_config</span><span class="o">=</span><span class="n">speech_config</span><span class="p">)</span>

<span class="c"># Receives a text from console input.</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Type some text that you want to speak..."</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>

<span class="c"># Synthesizes the received text to speech.</span>
<span class="c"># The synthesized speech is expected to be heard on the speaker with this line executed.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">speech_synthesizer</span><span class="o">.</span><span class="n">speak_text_async</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

<span class="c"># Checks result.</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">SynthesizingAudioCompleted</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Speech synthesized to speaker for text [{}]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">Canceled</span><span class="p">:</span>
    <span class="n">cancellation_details</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Speech synthesis canceled: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">CancellationReason</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Error details: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Did you update the subscription info?"</span><span class="p">)</span>

<span class="c"># Creates an audio configuration that points to an audio file.</span>
<span class="c"># Replace with your own audio filename.</span>
<span class="n">audio_filename</span> <span class="o">=</span> <span class="s">"./text-to-speech-py.wav"</span>
<span class="n">audio_output</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">AudioOutputConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">audio_filename</span><span class="p">)</span>

<span class="c"># Creates a synthesizer with the given settings</span>
<span class="n">speech_synthesizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechSynthesizer</span><span class="p">(</span><span class="n">speech_config</span><span class="o">=</span><span class="n">speech_config</span><span class="p">,</span> <span class="n">audio_config</span><span class="o">=</span><span class="n">audio_output</span><span class="p">)</span>

<span class="c"># Receives a text from console input.</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Type some text that you want to speak..."</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>

<span class="c"># Synthesizes the text to speech.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">speech_synthesizer</span><span class="o">.</span><span class="n">speak_text_async</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

<span class="c"># Checks result.</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">SynthesizingAudioCompleted</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Speech synthesized to [{}] for text [{}]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">audio_filename</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">Canceled</span><span class="p">:</span>
    <span class="n">cancellation_details</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Speech synthesis canceled: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">CancellationReason</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Error details: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Did you update the subscription info?"</span><span class="p">)</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码执行的输出:
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-15-055304.jpg" alt="" /></p>

<h3 id="speech-to-text">Speech to Text</h3>
<p><a href="https://learn.microsoft.com/zh-cn/azure/cognitive-services/speech-service/get-started-speech-to-text?pivots=programming-language-python&amp;tabs=macos%2Cterminal">官方文档</a></p>

<p>将说话的语音内容转换成对应的文字</p>

<p>既可以从文件中读取语音, 也可以实时获取语音</p>
<ul>
  <li>text 2 speech 使用的是 <code class="language-plaintext highlighter-rouge">SpeechSynthesizer.speak_text_async(text).get()</code> 方法</li>
  <li>speech 2 text 使用的是
    <ul>
      <li><code class="language-plaintext highlighter-rouge">speech_recognizer = speechsdk.SpeechRecognizer(speech_config=speech_config, audio_config=audio_input)</code>
        <ul>
          <li>如果不指定 <code class="language-plaintext highlighter-rouge">audio_config</code> 参数, 那么就是实时录入信息</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">speech_config.speech_recognition_language="zh-CN"</code> 配置成中文语音输入</li>
      <li><code class="language-plaintext highlighter-rouge">SpeechRecognizer.recognize_once()</code> 方法 执行语音转文字</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">azure.cognitiveservices.speech</span> <span class="kn">as</span> <span class="nn">speechsdk</span>

<span class="s">'''
In this exercise you will see an example of a speech to text translations from a local file.
'''</span>

<span class="n">speech_key</span><span class="p">,</span> <span class="n">service_region</span> <span class="o">=</span> <span class="s">"6dc37625b4e04652821d23239f58f33a"</span><span class="p">,</span> <span class="s">"eastus"</span>
<span class="n">speech_config</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechConfig</span><span class="p">(</span><span class="n">subscription</span><span class="o">=</span><span class="n">speech_key</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">service_region</span><span class="p">)</span>

<span class="n">audio_input</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">AudioConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">"./Speech_Media_narration.wav"</span><span class="p">)</span>

<span class="n">speech_recognizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechRecognizer</span><span class="p">(</span><span class="n">speech_config</span><span class="o">=</span><span class="n">speech_config</span><span class="p">,</span> <span class="n">audio_config</span><span class="o">=</span><span class="n">audio_input</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Recognizing first result..."</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">speech_recognizer</span><span class="o">.</span><span class="n">recognize_once</span><span class="p">()</span>

<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">RecognizedSpeech</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Recognized: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">NoMatch</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"No speech could be recognized: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">no_match_details</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">Canceled</span><span class="p">:</span>
    <span class="n">cancellation_details</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Speech Recognition canceled: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">CancellationReason</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Error details: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">))</span>

<span class="s">'''
In this exercise you will see an example of listening for speech from a microphone and translating it to text output.
'''</span>

<span class="n">speech_key</span><span class="p">,</span> <span class="n">service_region</span> <span class="o">=</span> <span class="s">"6dc37625b4e04652821d23239f58f33a"</span><span class="p">,</span> <span class="s">"eastus"</span>
<span class="n">speech_config</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechConfig</span><span class="p">(</span><span class="n">subscription</span><span class="o">=</span><span class="n">speech_key</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">service_region</span><span class="p">)</span>
<span class="n">speech_config</span><span class="o">.</span><span class="n">speech_recognition_language</span><span class="o">=</span><span class="s">"zh-CN"</span> <span class="c"># 指定中文输入</span>
<span class="n">speech_recognizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechRecognizer</span><span class="p">(</span><span class="n">speech_config</span><span class="o">=</span><span class="n">speech_config</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Begin speaking..."</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">speech_recognizer</span><span class="o">.</span><span class="n">recognize_once</span><span class="p">()</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">RecognizedSpeech</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Recognized: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">NoMatch</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"No speech could be recognized: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">no_match_details</span><span class="p">))</span>
<span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">Canceled</span><span class="p">:</span>
    <span class="n">cancellation_details</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Speech Recognition canceled: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">CancellationReason</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Error details: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码输出
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-15-114808.jpg" alt="" /></p>

<h2 id="translate-language--翻译服务">Translate Language  翻译服务</h2>

<p><a href="https://learn.microsoft.com/en-us/azure/cognitive-services/translator/language-support">官方文档</a></p>

<p>Translator Service是一种基于云的神经机器翻译服务 Neural Machine Translation (NMT)
主要功能包括</p>
<ul>
  <li>文本翻译</li>
  <li>文件翻译
    <ul>
      <li>支持的文件格式包括
        <ul>
          <li>txt</li>
          <li>pdf</li>
          <li>csv</li>
          <li>html</li>
          <li>markdown</li>
          <li>xls</li>
          <li>ppt</li>
          <li>msg (Microsoft Outlook)</li>
          <li>doc</li>
          <li>odt/odp (openDocument)</li>
          <li>rtf</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>自定义翻译
    <ul>
      <li>构建自定义模型，以翻译特定于领域和行业的语言、术语和风格。</li>
      <li>可以指定一些术语不翻译, 比如 <code class="language-plaintext highlighter-rouge">Azure</code></li>
    </ul>
  </li>
</ul>

<p>AI 102 翻译 考点:</p>
<ul>
  <li>文本到文本的翻译</li>
  <li>speech 到 speech 的翻译, 要用speech 服务</li>
  <li>speach 到 text 的分宜, 要用 speech 服务</li>
</ul>

<h3 id="text-to-text-翻译">text to text 翻译</h3>

<p>代码示例 - 文本到文本</p>
<ul>
  <li>一段英语翻译成 法语和中文</li>
  <li>endpoint 是 <code class="language-plaintext highlighter-rouge">endpoint = "https://api.cognitive.microsofttranslator.com/translate"</code></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">uuid</span><span class="o">,</span> <span class="nn">json</span>

<span class="c"># Add your key and endpoint</span>
<span class="n">key</span> <span class="o">=</span> <span class="s">"c5aa54650eff4d09a5009198e46a0bcc"</span>
<span class="n">endpoint</span> <span class="o">=</span> <span class="s">"https://api.cognitive.microsofttranslator.com"</span>
<span class="c"># location, also known as region.</span>
<span class="c"># required if you're using a multi-service or regional (not global) resource. It can be found in the Azure portal on the Keys and Endpoint page.</span>
<span class="n">location</span> <span class="o">=</span> <span class="s">"eastus"</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">'/translate'</span>
<span class="n">constructed_url</span> <span class="o">=</span> <span class="n">endpoint</span> <span class="o">+</span> <span class="n">path</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'api-version'</span><span class="p">:</span> <span class="s">'3.0'</span><span class="p">,</span>
    <span class="s">'from'</span><span class="p">:</span> <span class="s">'en'</span><span class="p">,</span>
    <span class="s">'to'</span><span class="p">:</span> <span class="p">[</span><span class="s">'fr'</span><span class="p">,</span> <span class="s">'zh-Hans'</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'Ocp-Apim-Subscription-Key'</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
    <span class="c"># location required if you're using a multi-service or regional (not global) resource.</span>
    <span class="s">'Ocp-Apim-Subscription-Region'</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span>
    <span class="s">'Content-type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
    <span class="s">'X-ClientTraceId'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<span class="p">}</span>

<span class="c"># You can pass more than one object in body.</span>
<span class="n">body</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s">'text'</span><span class="p">:</span> <span class="s">'I would really like to drive your car around the block a few times!'</span>
<span class="p">}]</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">constructed_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">': '</span><span class="p">)))</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码执行的结果是输出一段 JSON</p>

<div class="language-json highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"translations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"J’aimerais vraiment conduire votre voiture autour du pâté de maisons plusieurs fois!"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"to"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fr"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"我真的很想开你的车绕街区转几次！"</span><span class="p">,</span><span class="w">
                </span><span class="nt">"to"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zh-Hans"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></td></tr></tbody></table>
</div>
</div>

<h3 id="speech-to-speech-翻译">speech to speech 翻译</h3>

<p>注意, 这里用的是 Azure Cognitive Service 的 speech 的 translation服务, 而不是 translator 服务</p>

<p>代码目标:</p>
<ul>
  <li>从英文语音输入翻译成法语和中文</li>
  <li>把原始英文语音输入的文字打印出来</li>
  <li>把翻译成的法文和中文输出到屏幕</li>
  <li>把翻译成的法文和中文朗读出来</li>
</ul>

<p>代码逻辑:</p>
<ul>
  <li>通过 <code class="language-plaintext highlighter-rouge">result = recognizer.recognize_once()</code> 方法获取输入的英文语音</li>
  <li>打印输入语音对应的英文文本 <code class="language-plaintext highlighter-rouge">print("RECOGNIZED '{}': {}".format(fromLanguage, result.text))</code></li>
  <li>分别把英文文本翻译成法文和中文文本 <code class="language-plaintext highlighter-rouge">print("TRANSLATED into {}: {}".format(key, result.translations[key]))</code></li>
  <li>更新 speech_synthesizer, 将原来的英语改成法语和中文并指定语音</li>
  <li>用指定的语音把翻译后的文本读出来 <code class="language-plaintext highlighter-rouge">speech_synthesizer.speak_text_async(result.translations[key]).get()</code></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">azure.cognitiveservices.speech</span> <span class="kn">as</span> <span class="nn">speechsdk</span>

<span class="n">speech_key</span><span class="p">,</span> <span class="n">service_region</span> <span class="o">=</span> <span class="s">"6dc37625b4e04652821d23239f58f33a"</span><span class="p">,</span> <span class="s">"eastus"</span>


<span class="k">def</span> <span class="nf">translate_speech_to_speech</span><span class="p">():</span>
    <span class="c"># Creates an instance of a speech translation config with specified subscription key and service region.</span>
    <span class="c"># Replace with your own subscription key and region identifier from here: https://aka.ms/speech/sdkregion</span>
    <span class="n">translation_config</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">SpeechTranslationConfig</span><span class="p">(</span><span class="n">subscription</span><span class="o">=</span><span class="n">speech_key</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">service_region</span><span class="p">)</span>

    <span class="n">speech_config</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechConfig</span><span class="p">(</span><span class="n">subscription</span><span class="o">=</span><span class="n">speech_key</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">service_region</span><span class="p">)</span>

    <span class="c"># Creates a speech synthesizer using the configured voice for audio output.</span>
    <span class="n">speech_synthesizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechSynthesizer</span><span class="p">(</span><span class="n">speech_config</span><span class="o">=</span><span class="n">speech_config</span><span class="p">)</span>

    <span class="c"># Sets source and target languages. In this example, the service will translate a US English spoken input,</span>
    <span class="c"># to French and Indonesian language spoken output Replace with the languages of your choice, from list found</span>
    <span class="c"># here: https://aka.ms/speech/sttt-languages</span>
    <span class="n">fromLanguage</span> <span class="o">=</span> <span class="s">'en-US'</span>
    <span class="n">translation_config</span><span class="o">.</span><span class="n">speech_recognition_language</span> <span class="o">=</span> <span class="n">fromLanguage</span>

    <span class="c"># Add more than one language to the collection.</span>
    <span class="c"># using the add_target_language() method</span>
    <span class="n">translation_config</span><span class="o">.</span><span class="n">add_target_language</span><span class="p">(</span><span class="s">"fr"</span><span class="p">)</span>
    <span class="n">translation_config</span><span class="o">.</span><span class="n">add_target_language</span><span class="p">(</span><span class="s">"zh-Hans"</span><span class="p">)</span>

    <span class="c"># Creates a translation recognizer using and audio file as input.</span>
    <span class="n">recognizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">TranslationRecognizer</span><span class="p">(</span><span class="n">translation_config</span><span class="o">=</span><span class="n">translation_config</span><span class="p">)</span>

    <span class="c"># Starts translation, and returns after a single utterance is recognized. The end of a</span>
    <span class="c"># single utterance is determined by listening for silence at the end or until a maximum of 15</span>
    <span class="c"># seconds of audio is processed. It returns the recognized text as well as the translation.</span>
    <span class="c"># Note: Since recognize_once() returns only a single utterance, it is suitable only for single</span>
    <span class="c"># shot recognition like command or query.</span>
    <span class="c"># For long-running multi-utterance recognition, use start_continuous_recognition() instead.</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Say something..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">recognizer</span><span class="o">.</span><span class="n">recognize_once</span><span class="p">()</span>

    <span class="c"># Check the result</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">TranslatedSpeech</span><span class="p">:</span>
        <span class="c"># Output the text for the recognized speech input</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"RECOGNIZED '{}': {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fromLanguage</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>

        <span class="c"># Loop through the returned translation results</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">translations</span><span class="p">:</span>

            <span class="c"># Using the Key and Value components of the returned dictionary for the translated results</span>
            <span class="c"># The first portion gets the key (language code) while the second gets the Value</span>
            <span class="c"># which is the translated text for the language specified</span>
            <span class="c"># Output the language and then the translated text</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"TRANSLATED into {}: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">translations</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

            <span class="c"># If the language code is 'fr' for French, then use the French voice for Julie</span>
            <span class="c"># If you change the languages in the 'AddTargetLanguage' above, ensure you modify this if statement as well</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">"fr"</span><span class="p">:</span>
                <span class="n">speech_config</span><span class="o">.</span><span class="n">speech_synthesis_voice_name</span> <span class="o">=</span> <span class="s">"fr-FR-AlainNeural"</span>

                <span class="c"># Update the speech synthesizer to use the proper voice</span>
                <span class="n">speech_synthesizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechSynthesizer</span><span class="p">(</span><span class="n">speech_config</span><span class="o">=</span><span class="n">speech_config</span><span class="p">)</span>

                <span class="c"># Use the proper voice, from the speech synthesizer configuration, to narrate the translated result</span>
                <span class="c"># in the native speaker voice.</span>
                <span class="n">speech_synthesizer</span><span class="o">.</span><span class="n">speak_text_async</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">translations</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># Otherwise, use the voice for the Indonesian translation</span>
                <span class="n">speech_config</span><span class="o">.</span><span class="n">speech_synthesis_voice_name</span> <span class="o">=</span> <span class="s">"zh-CN-XiaochenNeural"</span>

                <span class="c"># Update the speech synthesizer to use the proper voice</span>
                <span class="n">speech_synthesizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">SpeechSynthesizer</span><span class="p">(</span><span class="n">speech_config</span><span class="o">=</span><span class="n">speech_config</span><span class="p">)</span>

                <span class="c"># Use the proper voice, from the speech synthesizer configuration, to narrate the translated result</span>
                <span class="c"># in the native speaker voice.</span>
                <span class="n">speech_synthesizer</span><span class="o">.</span><span class="n">speak_text_async</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">translations</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">RecognizedSpeech</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"RECOGNIZED: {} (text could not be translated)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">NoMatch</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"NOMATCH: Speech could not be recognized: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">no_match_details</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">Canceled</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"CANCELED: Reason={}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">CancellationReason</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"CANCELED: ErrorDetails={}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">))</span>


<span class="n">translate_speech_to_speech</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>代码输出结果:
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-15-151355.jpg" alt="" /> 
并有语音朗读</p>

<h3 id="speech-to-text-翻译">Speech to text 翻译</h3>

<p>是 speech to speech 的简化版</p>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">azure.cognitiveservices.speech</span> <span class="kn">as</span> <span class="nn">speechsdk</span>

<span class="n">speech_key</span><span class="p">,</span> <span class="n">service_region</span> <span class="o">=</span> <span class="s">"YourKey"</span><span class="p">,</span> <span class="s">"YourRegion"</span>


<span class="k">def</span> <span class="nf">translate_speech_to_text</span><span class="p">():</span>
    <span class="c"># Creates an instance of a speech translation config with specified subscription key and service region.</span>
    <span class="c"># Replace with your own subscription key and region identifier from here: https://aka.ms/speech/sdkregion</span>
    <span class="n">translation_config</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">SpeechTranslationConfig</span><span class="p">(</span><span class="n">subscription</span><span class="o">=</span><span class="n">speech_key</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">service_region</span><span class="p">)</span>

    <span class="c"># Sets source and target languages.</span>
    <span class="c"># Replace with the languages of your choice, from list found here: https://aka.ms/speech/sttt-languages</span>
    <span class="n">fromLanguage</span> <span class="o">=</span> <span class="s">'en-US'</span>
    <span class="n">toLanguage</span> <span class="o">=</span> <span class="s">'de'</span>
    <span class="n">translation_config</span><span class="o">.</span><span class="n">speech_recognition_language</span> <span class="o">=</span> <span class="n">fromLanguage</span>
    <span class="n">translation_config</span><span class="o">.</span><span class="n">add_target_language</span><span class="p">(</span><span class="n">toLanguage</span><span class="p">)</span>

    <span class="c"># Creates a translation recognizer using and audio file as input.</span>
    <span class="n">recognizer</span> <span class="o">=</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">TranslationRecognizer</span><span class="p">(</span><span class="n">translation_config</span><span class="o">=</span><span class="n">translation_config</span><span class="p">)</span>

    <span class="c"># Starts translation, and returns after a single utterance is recognized. The end of a</span>
    <span class="c"># single utterance is determined by listening for silence at the end or until a maximum of 15</span>
    <span class="c"># seconds of audio is processed. It returns the recognized text as well as the translation.</span>
    <span class="c"># Note: Since recognize_once() returns only a single utterance, it is suitable only for single</span>
    <span class="c"># shot recognition like command or query.</span>
    <span class="c"># For long-running multi-utterance recognition, use start_continuous_recognition() instead.</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Say something..."</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">recognizer</span><span class="o">.</span><span class="n">recognize_once</span><span class="p">()</span>

    <span class="c"># Check the result</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">TranslatedSpeech</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"RECOGNIZED '{}': {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fromLanguage</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"TRANSLATED into {}: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toLanguage</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">translations</span><span class="p">[</span><span class="n">toLanguage</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">RecognizedSpeech</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"RECOGNIZED: {} (text could not be translated)"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">NoMatch</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"NOMATCH: Speech could not be recognized: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">no_match_details</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">result</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">ResultReason</span><span class="o">.</span><span class="n">Canceled</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"CANCELED: Reason={}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">speechsdk</span><span class="o">.</span><span class="n">CancellationReason</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"CANCELED: ErrorDetails={}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cancellation_details</span><span class="o">.</span><span class="n">error_details</span><span class="p">))</span>


<span class="n">translate_speech_to_text</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="luis-language-understanding-service-语言理解服务">LUIS Language Understanding Service 语言理解服务</h2>
<p><a href="https://learn.microsoft.com/en-us/azure/cognitive-services/luis/what-is-luis">官方文档</a></p>

<p>注意:</p>
<ul>
  <li>LUIS 会在 2025 年 10 月就下架了, 以后会使用 <strong>conversational language understanding</strong> 来代替</li>
  <li>1 April 2023 开始就不能再创建新的 LUIS 应用了</li>
</ul>

<p>语言理解（LUIS）是一种基于云的对话式人工智能服务，将自定义机器学习智能应用于用户的对话、自然语言文本，以预测整体含义，并提取相关的详细信息。</p>

<p>LUIS 可以通过以下方式访问</p>
<ul>
  <li>自定义 <a href="https://www.luis.ai/applications">portal</a></li>
  <li>API</li>
  <li>SDK</li>
</ul>

<p>几个场景</p>
<ul>
  <li>构建企业级对话机器人：
    <ul>
      <li>此参考架构描述了如何使用Azure Bot框架构建企业级对话机器人（聊天机器人）。</li>
    </ul>
  </li>
  <li>商业聊天机器人：
    <ul>
      <li>Azure机器人服务和语言理解服务使开发人员能够为银行、旅行和娱乐等各种场景创建对话界面。</li>
    </ul>
  </li>
  <li>使用语音助理控制物联网设备：
    <ul>
      <li>与所有可访问互联网的设备创建无缝对话界面——从连接的电视或冰箱到连接的发电厂的设备。</li>
    </ul>
  </li>
</ul>

<p>需要安装 LUIS 的 python 扩展库
<code class="language-plaintext highlighter-rouge">pip install azure-cognitiveservices-language-luis</code></p>

<p>需要在 azure portal 创建一个 LUIS 项目的过程</p>
<ul>
  <li>现在 Azure Portal 中创建一个 LUIS 服务</li>
  <li>然后到 https://www.luis.ai/applications 创建 LUIS 项目</li>
</ul>

<h3 id="通过-luis-portal-使用-luis-ai">通过 LUIS portal 使用 LUIS AI</h3>

<p>https://www.luis.ai/applications</p>

<p>概念:</p>
<ul>
  <li>Intend 是意图 (动作)
    <ul>
      <li>比如:
        <ul>
          <li>add flag</li>
          <li>cancel</li>
          <li>delete</li>
          <li>forward</li>
          <li>read aloud</li>
          <li>reply</li>
          <li>…</li>
        </ul>
      </li>
      <li>examples 是 意图下面的一些文字性描述的例子
        <ul>
          <li>比如: “请把这封邮件标记成重要”</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Entities 是实体 (名词/术语),
    <ul>
      <li>让 AI 知道这个领域的一些实体的专有名词</li>
      <li>相当于数据库的字段</li>
      <li>比如:
        <ul>
          <li>附件</li>
          <li>分类</li>
          <li>…</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Prebuild Domains 预先做好的模板, 直接用就可以自动创建 intend 和 Entities</li>
</ul>

<p>使用流程</p>
<ol>
  <li>创建一个应用</li>
  <li>从 Prebuild domain 那里创建 一个 email 的 entities 和 intentions</li>
  <li>点击 “train” 对模型进行训练</li>
  <li>点击 “Test” 对模型进行测试
    <ol>
      <li>给模型输入 “Send email to bob for lunch tomorrow”</li>
    </ol>
  </li>
  <li>点击 “Publish” 把模型发布出去, 就可以有endpoint 可以提供给外部进行  Rest API 访问.</li>
</ol>

<p>Portal 测试结果
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-16-053749.jpg" alt="" /></p>

<h3 id="luis-代码示例">LUIS 代码示例</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre></td><td class="code"><pre><span class="c"># To run this sample, install the following modules.</span>
<span class="c"># pip install azure-cognitiveservices-language-luis</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c"># &lt;Dependencies&gt;</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.language.luis.authoring</span> <span class="kn">import</span> <span class="n">LUISAuthoringClient</span>
<span class="kn">from</span> <span class="nn">azure.cognitiveservices.language.luis.runtime</span> <span class="kn">import</span> <span class="n">LUISRuntimeClient</span>
<span class="kn">from</span> <span class="nn">msrest.authentication</span> <span class="kn">import</span> <span class="n">CognitiveServicesCredentials</span>
<span class="c"># &lt;/Dependencies&gt;</span>


<span class="k">def</span> <span class="nf">quickstart</span><span class="p">():</span>
    <span class="c"># &lt;VariablesYouChange&gt;</span>
    <span class="n">authoringKey</span> <span class="o">=</span> <span class="s">'YourAuthoringKey'</span>
    <span class="n">authoringEndpoint</span> <span class="o">=</span> <span class="s">'YourAuthoringEndpoint'</span>
    <span class="n">predictionKey</span> <span class="o">=</span> <span class="s">'YourAuthoringKey'</span>
    <span class="n">predictionEndpoint</span> <span class="o">=</span> <span class="s">'YourPredictionEndpoint'</span>
    <span class="c"># &lt;/VariablesYouChange&gt;</span>

    <span class="c"># &lt;VariablesYouDontNeedToChangeChange&gt;</span>
    <span class="n">appName</span> <span class="o">=</span> <span class="s">"Contoso Pizza Company"</span>
    <span class="n">versionId</span> <span class="o">=</span> <span class="s">"0.1"</span>
    <span class="n">intentName</span> <span class="o">=</span> <span class="s">"OrderPizzaIntent"</span>
    <span class="c"># &lt;/VariablesYouDontNeedToChangeChange&gt;</span>

    <span class="c"># &lt;AuthoringCreateClient&gt;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">LUISAuthoringClient</span><span class="p">(</span><span class="n">authoringEndpoint</span><span class="p">,</span> <span class="n">CognitiveServicesCredentials</span><span class="p">(</span><span class="n">authoringKey</span><span class="p">))</span>
    <span class="c"># &lt;/AuthoringCreateClient&gt;</span>

    <span class="c"># Create app</span>
    <span class="n">app_id</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">appName</span><span class="p">,</span> <span class="n">versionId</span><span class="p">)</span>

    <span class="c"># &lt;AddIntent&gt;</span>
    <span class="n">client</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_intent</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">intentName</span><span class="p">)</span>
    <span class="c"># &lt;/AddIntent&gt;</span>

    <span class="c"># Add Entities</span>
    <span class="n">add_entities</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">)</span>

    <span class="c"># Add labeled examples</span>
    <span class="n">add_labeled_examples</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">intentName</span><span class="p">)</span>

    <span class="c"># &lt;TrainAppVersion&gt;</span>
    <span class="n">client</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">train_version</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">)</span>
    <span class="n">waiting</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">while</span> <span class="n">waiting</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">)</span>

        <span class="c"># get_status returns a list of training statuses, one for each model. Loop through them and make sure all are</span>
        <span class="c"># done.</span>
        <span class="n">waiting</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'Queued'</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">details</span><span class="o">.</span><span class="n">status</span> <span class="ow">or</span> <span class="s">'InProgress'</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">details</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">waiting</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Waiting 10 seconds for training to complete..."</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"trained"</span><span class="p">)</span>
            <span class="n">waiting</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c"># &lt;/TrainAppVersion&gt;</span>

    <span class="c"># &lt;PublishVersion&gt;</span>
    <span class="n">client</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">is_staging</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c"># &lt;/PublishVersion&gt;</span>

    <span class="c"># &lt;PredictionCreateClient&gt;</span>
    <span class="n">runtimeCredentials</span> <span class="o">=</span> <span class="n">CognitiveServicesCredentials</span><span class="p">(</span><span class="n">predictionKey</span><span class="p">)</span>
    <span class="n">clientRuntime</span> <span class="o">=</span> <span class="n">LUISRuntimeClient</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">predictionEndpoint</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">runtimeCredentials</span><span class="p">)</span>
    <span class="c"># &lt;/PredictionCreateClient&gt;</span>

    <span class="c"># &lt;QueryPredictionEndpoint&gt;</span>
    <span class="c"># Production == slot name</span>
    <span class="n">predictionRequest</span> <span class="o">=</span> <span class="p">{</span><span class="s">"query"</span><span class="p">:</span> <span class="s">"I want two small pepperoni pizzas with more salsa"</span><span class="p">}</span>

    <span class="n">predictionResponse</span> <span class="o">=</span> <span class="n">clientRuntime</span><span class="o">.</span><span class="n">prediction</span><span class="o">.</span><span class="n">get_slot_prediction</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="s">"Production"</span><span class="p">,</span> <span class="n">predictionRequest</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Top intent: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">predictionResponse</span><span class="o">.</span><span class="n">prediction</span><span class="o">.</span><span class="n">top_intent</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Sentiment: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">predictionResponse</span><span class="o">.</span><span class="n">prediction</span><span class="o">.</span><span class="n">sentiment</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Intents: "</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">intent</span> <span class="ow">in</span> <span class="n">predictionResponse</span><span class="o">.</span><span class="n">prediction</span><span class="o">.</span><span class="n">intents</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">{}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">intent</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Entities: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">predictionResponse</span><span class="o">.</span><span class="n">prediction</span><span class="o">.</span><span class="n">entities</span><span class="p">))</span>


<span class="c"># &lt;/QueryPredictionEndpoint&gt;</span>

<span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">appName</span><span class="p">,</span> <span class="n">versionId</span><span class="p">):</span>
    <span class="c"># &lt;AuthoringCreateApplication&gt;</span>
    <span class="c"># define app basics</span>
    <span class="n">appDefinition</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="n">appName</span><span class="p">,</span>
        <span class="s">"initial_version_id"</span><span class="p">:</span> <span class="n">versionId</span><span class="p">,</span>
        <span class="s">"culture"</span><span class="p">:</span> <span class="s">"en-us"</span>
    <span class="p">}</span>

    <span class="c"># create app</span>
    <span class="n">app_id</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">appDefinition</span><span class="p">)</span>

    <span class="c"># get app id - necessary for all other changes</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Created LUIS app with ID {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_id</span><span class="p">))</span>
    <span class="c"># &lt;/AuthoringCreateApplication&gt;</span>

    <span class="k">return</span> <span class="n">app_id</span>


<span class="c"># &lt;/createApp&gt;</span>

<span class="k">def</span> <span class="nf">add_entities</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">):</span>
    <span class="c"># &lt;AuthoringAddEntities&gt;</span>
    <span class="c"># Add Prebuilt entity</span>
    <span class="n">client</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_prebuilt</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">prebuilt_extractor_names</span><span class="o">=</span><span class="p">[</span><span class="s">"number"</span><span class="p">])</span>

    <span class="c"># define machine-learned entity</span>
    <span class="n">mlEntityDefinition</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">"name"</span><span class="p">:</span> <span class="s">"Pizza"</span><span class="p">,</span>
            <span class="s">"children"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Quantity"</span><span class="p">},</span>
                <span class="p">{</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Type"</span><span class="p">},</span>
                <span class="p">{</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Size"</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s">"name"</span><span class="p">:</span> <span class="s">"Toppings"</span><span class="p">,</span>
            <span class="s">"children"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Type"</span><span class="p">},</span>
                <span class="p">{</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"Quantity"</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}]</span>

    <span class="c"># add entity to app</span>
    <span class="n">modelId</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">"Pizza order"</span><span class="p">,</span> <span class="n">children</span><span class="o">=</span><span class="n">mlEntityDefinition</span><span class="p">)</span>

    <span class="c"># define phraselist - add phrases as significant vocabulary to app</span>
    <span class="n">phraseList</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"enabledForAllModels"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">"isExchangeable"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="s">"QuantityPhraselist"</span><span class="p">,</span>
        <span class="s">"phrases"</span><span class="p">:</span> <span class="s">"few,more,extra"</span>
    <span class="p">}</span>

    <span class="c"># add phrase list to app</span>
    <span class="n">client</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">add_phrase_list</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">phraseList</span><span class="p">)</span>

    <span class="c"># Get entity and subentities</span>
    <span class="n">modelObject</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_entity</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">modelId</span><span class="p">)</span>
    <span class="n">toppingQuantityId</span> <span class="o">=</span> <span class="n">get_grandchild_id</span><span class="p">(</span><span class="n">modelObject</span><span class="p">,</span> <span class="s">"Toppings"</span><span class="p">,</span> <span class="s">"Quantity"</span><span class="p">)</span>
    <span class="n">pizzaQuantityId</span> <span class="o">=</span> <span class="n">get_grandchild_id</span><span class="p">(</span><span class="n">modelObject</span><span class="p">,</span> <span class="s">"Pizza"</span><span class="p">,</span> <span class="s">"Quantity"</span><span class="p">)</span>

    <span class="c"># add model as feature to subentity model</span>
    <span class="n">prebuiltFeatureRequiredDefinition</span> <span class="o">=</span> <span class="p">{</span><span class="s">"model_name"</span><span class="p">:</span> <span class="s">"number"</span><span class="p">,</span> <span class="s">"is_required"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
    <span class="n">client</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">add_entity_feature</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">pizzaQuantityId</span><span class="p">,</span> <span class="n">prebuiltFeatureRequiredDefinition</span><span class="p">)</span>

    <span class="c"># add model as feature to subentity model</span>
    <span class="n">prebuiltFeatureNotRequiredDefinition</span> <span class="o">=</span> <span class="p">{</span><span class="s">"model_name"</span><span class="p">:</span> <span class="s">"number"</span><span class="p">}</span>
    <span class="n">client</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">add_entity_feature</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">toppingQuantityId</span><span class="p">,</span> <span class="n">prebuiltFeatureNotRequiredDefinition</span><span class="p">)</span>

    <span class="c"># add phrase list as feature to subentity model</span>
    <span class="n">phraseListFeatureDefinition</span> <span class="o">=</span> <span class="p">{</span><span class="s">"feature_name"</span><span class="p">:</span> <span class="s">"QuantityPhraselist"</span><span class="p">,</span> <span class="s">"model_name"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="n">client</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">add_entity_feature</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">toppingQuantityId</span><span class="p">,</span> <span class="n">phraseListFeatureDefinition</span><span class="p">)</span>


<span class="c"># &lt;/AuthoringAddEntities&gt;</span>


<span class="k">def</span> <span class="nf">add_labeled_examples</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">intentName</span><span class="p">):</span>
    <span class="c"># &lt;AuthoringAddLabeledExamples&gt;</span>
    <span class="c"># Define labeled example</span>
    <span class="n">labeledExampleUtteranceWithMLEntity</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"text"</span><span class="p">:</span> <span class="s">"I want two small seafood pizzas with extra cheese."</span><span class="p">,</span>
        <span class="s">"intentName"</span><span class="p">:</span> <span class="n">intentName</span><span class="p">,</span>
        <span class="s">"entityLabels"</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
                <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Pizza order"</span><span class="p">,</span>
                <span class="s">"children"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                        <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                        <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Pizza"</span><span class="p">,</span>
                        <span class="s">"children"</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                                <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                                <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Quantity"</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                                <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                                <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Size"</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
                                <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span>
                                <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Type"</span>
                            <span class="p">}]</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span>
                        <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
                        <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Toppings"</span><span class="p">,</span>
                        <span class="s">"children"</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span>
                                <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span>
                                <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">41</span><span class="p">,</span>
                                <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Quantity"</span>
                            <span class="p">},</span>
                            <span class="p">{</span>
                                <span class="s">"startCharIndex"</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span>
                                <span class="s">"endCharIndex"</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span>
                                <span class="s">"entityName"</span><span class="p">:</span> <span class="s">"Type"</span>
                            <span class="p">}]</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"Labeled Example Utterance:"</span><span class="p">,</span> <span class="n">labeledExampleUtteranceWithMLEntity</span><span class="p">)</span>

    <span class="c"># Add an example for the entity.</span>
    <span class="c"># Enable nested children to allow using multiple models with the same name.</span>
    <span class="c"># The quantity subentity and the phraselist could have the same exact name if this is set to True</span>
    <span class="n">client</span><span class="o">.</span><span class="n">examples</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">app_id</span><span class="p">,</span> <span class="n">versionId</span><span class="p">,</span> <span class="n">labeledExampleUtteranceWithMLEntity</span><span class="p">,</span> <span class="p">{</span><span class="s">"enableNestedChildren"</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>


<span class="c"># &lt;/AuthoringAddLabeledExamples&gt;</span>

<span class="c"># &lt;AuthoringSortModelObject&gt;</span>
<span class="k">def</span> <span class="nf">get_grandchild_id</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">childName</span><span class="p">,</span> <span class="n">grandChildName</span><span class="p">):</span>
    <span class="n">theseChildren</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">filter</span><span class="p">((</span><span class="k">lambda</span> <span class="n">child</span><span class="p">:</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">childName</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>
    <span class="n">theseGrandchildren</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">filter</span><span class="p">((</span><span class="k">lambda</span> <span class="n">child</span><span class="p">:</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">grandChildName</span><span class="p">),</span> <span class="n">theseChildren</span><span class="o">.</span><span class="n">children</span><span class="p">))</span>

    <span class="n">grandChildId</span> <span class="o">=</span> <span class="n">theseGrandchildren</span><span class="o">.</span><span class="nb">id</span>

    <span class="k">return</span> <span class="n">grandChildId</span>


<span class="c"># &lt;/AuthoringSortModelObject&gt;</span>

<span class="n">quickstart</span><span class="p">()</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="cognitive-search">Cognitive Search</h2>
<p><a href="https://learn.microsoft.com/en-us/azure/search/search-what-is-azure-search">官方文档</a></p>

<p>通过用户提供数据, 文档, 图片等信息创建一个认知搜索引擎</p>
<ul>
  <li>创建数据源</li>
  <li>定义索引</li>
  <li>query 索引</li>
  <li>配置所以提供 autocomplete (自动完成)和 autosuggest (自动推荐)</li>
  <li>根据相关性提供更多结果</li>
  <li>实现同义词</li>
</ul>

<p>在 Azure 中创建了 Cognitive Search 的截图
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-16-123714.jpg" alt="" /></p>

<p>导入数据的步骤</p>
<ol>
  <li>import data
    <ol>
      <li>导入一个 hotel 酒店的 sample</li>
      <li>导入完成后, 就可以看到有
        <ol>
          <li>data source</li>
          <li>indexers
            <ol>
              <li>index 创建器</li>
            </ol>
          </li>
          <li>indexes
            <ol>
              <li>50 个 document</li>
              <li>进入 index 页面就可以搜索了</li>
              <li>搜索 <code class="language-plaintext highlighter-rouge">pool</code> 的结果如下</li>
              <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-16-125456.jpg" alt="" /></li>
            </ol>
          </li>
          <li>页面提供了 app 如果需要整合搜索所需要的 URL 地址.</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<p>创建新的 data source 可以从以下数据源来创建</p>
<ul>
  <li>Azure Blob Storage</li>
  <li>Azure Data Lake Storage Gen2</li>
  <li>Azure SQL Database</li>
  <li>Azure Table Storage</li>
  <li>Cosmos DB</li>
</ul>

<h2 id="qna-maker">QnA Maker</h2>
<p>QnA maker 是一个 NLP 服务, 是用来从一个知识库(knowledge) 中获取合适的答案.</p>
<ul>
  <li>问答机器人</li>
  <li>需要先创建一个 knowledge base</li>
  <li>knowledge base 来源是客户自己通过的内容, 比如 PDF 等文档</li>
</ul>

<p><strong>注意:</strong></p>
<ul>
  <li>QnA Maker 服务将于 2025 年 3 月 31 日停用。</li>
  <li>新的功能将转到 <a href="https://learn.microsoft.com/zh-cn/azure/cognitive-services/language-service/question-answering/quickstart/sdk?pivots=rest">Azure Cognitive Service for Language</a></li>
  <li>现在已经无法创建新的 QnA 服务</li>
</ul>

<p>https://azurefaq.ca 这个网站就是用 QnA 做的</p>

<p>生命周期</p>
<ul>
  <li>创建 knowledge base</li>
  <li>设置</li>
  <li>训练</li>
  <li>测试</li>
  <li>发布</li>
  <li>创建Web App Bot</li>
  <li>测试和 Bot 聊天
    <ul>
      <li><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-16-232355.jpg" alt="" /></li>
      <li>可以下载 web app bot 的源代码 (.net). 源代码可以部署到任何云上. 源代码会调用 Azure 的 chat bot API</li>
    </ul>
  </li>
  <li>发布 QnA Bot
    <ul>
      <li>QnA Bot 可以发布到很多 Channel, 包括
        <ul>
          <li>Slack</li>
          <li>Microsoft Teams</li>
          <li>Skype</li>
          <li>Facebook</li>
          <li>Email</li>
          <li>…</li>
        </ul>
      </li>
      <li>QnA Bot 可以生成一段 enbeded 的 ifrmae html 代码, 直接嵌入到网站代码中</li>
    </ul>
  </li>
</ul>

<h2 id="bot-service---framework-sdk">Bot Service - Framework SDK</h2>
<p><a href="https://learn.microsoft.com/en-us/azure/bot-service/bot-service-overview?wt.md_id=searchAPI_azureportal_inproduct_rmskilling&amp;sessionId=d9db68498be549e89cc0d1d358ec9d41&amp;view=azure-bot-service-4.0">官方文档</a></p>

<p><a href="https://github.com/microsoft/BotBuilder-Samples">官方的 github 的例子</a></p>

<p><strong>注意:</strong></p>
<ul>
  <li>The Bot Framework Python SDK is being retired with final long-term support ending in November 2023</li>
  <li>Bot Framework Python SDK 2023 年 11 月开始就不在更新了</li>
</ul>

<p>Microsoft Bot Framework和Azure Bot Service是库、工具和服务的集合，可让您构建、测试、部署和管理智能机器人。机器人框架包括一个模块化和可扩展的SDK，用于构建机器人和连接到人工智能服务。使用此框架，开发人员可以创建使用语音、理解自然语言、回答问题等的机器人。
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-16-234516.jpg" alt="" /></p>

<ul>
  <li>对比 QnA Bot, Bot framework (Bot service) 更加高级</li>
  <li>这里做的 Bot , 主要还是聊天机器人</li>
</ul>

<p>流程(定披萨为例子):</p>
<ul>
  <li>计划
    <ul>
      <li>设计沟通逻辑</li>
      <li>创建 <code class="language-plaintext highlighter-rouge">.chat</code> 配置文件</li>
      <li>增加response 语言</li>
      <li>adaptive cards</li>
    </ul>
  </li>
  <li>构建</li>
  <li>测试</li>
  <li>发布</li>
  <li>连接</li>
  <li>评估</li>
</ul>

<h3 id="echo-bot-聊天机器人">Echo Bot 聊天机器人</h3>
<p>echo bot 就是你发什么给他, 他就回什么给你</p>

<p>下面用 官方提供的 <a href="https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/02.echo-bot">Echo Bot Github</a> 的例子来构建一个可以聊天的机器人</p>

<p>注意:</p>
<ul>
  <li>Bot Framework Python SDK 2023 年 11 月开始就不在更新了</li>
</ul>

<p>Echo Bot 安装步骤</p>
<ol>
  <li>github 代码下载到本地</li>
  <li>安装并运行 python 代码</li>
  <li>安装一个 Bot Framework 的 emulator (模拟器) 的 Mac 版本到本地
    <ol>
      <li>模拟器的作用是模拟Bot 所需要的 云端的 Azure 服务, 比如计算, 存储等.</li>
    </ol>
  </li>
  <li>在 bot 模拟器中打开python 提示的<a href="http://localhost:3978">地址</a>就可以和 Echo bot 聊天了
    <ol>
      <li>echo bot 就是你发什么给他, 他就回什么给你</li>
    </ol>
  </li>
</ol>

<h3 id="welcome-bot">Welcome Bot</h3>
<ul>
  <li>Bot 会有一段欢迎词给你, 后面还是 Echo 你说的话
<a href="https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/03.welcome-user">github 代码</a></li>
</ul>

<p>和 Echo Bot 安装流程一样</p>

<h3 id="bot-dialogs">Bot Dialogs</h3>
<p>和机器人对话</p>
<ul>
  <li>给 bot 预先设定好问题和答案选项的内容</li>
  <li>当你进入聊天之后, 机器人会先问你问题, 你都答好了之后, 机器人会把你的回答记下来. 作为后续对话的基础.</li>
</ul>

<p><a href="https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/05.multi-turn-prompt">github 代码</a></p>

<p><img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-17-011453.jpg" alt="" /></p>

<h3 id="adaptive-cards-适应卡">Adaptive Cards 适应卡</h3>
<p><a href="https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/07.using-adaptive-cards">github 代码</a></p>

<p>自适应卡片 - 根据聊天框/web 页面大小自适应的一些卡片</p>
<ul>
  <li>包括
    <ul>
      <li>航班信息</li>
      <li>天气信息</li>
      <li>pizza 点评</li>
      <li>…</li>
    </ul>
  </li>
  <li>卡片信息是 JSON 格式的文件, 可以编辑</li>
</ul>

<p>聊天截图
<img src="http://dalong-1251052260.cos.ap-shanghai.myqcloud.com/2023-04-17-014924.jpg" alt="" /></p>

<h3 id="tracking-events-with-application-insights">Tracking Events with Application Insights</h3>
<p><a href="https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/21.corebot-app-insights">github 地址</a></p>

<p>功能: 把 IOT 的遥感数据( telemetry )加到 bot 中, 然后让 Bot 给出一些见解</p>

<h3 id="把-bot-和其他-cognitive-服务整合">把 Bot 和其他 cognitive 服务整合</h3>
<p><a href="https://github.com/microsoft/BotBuilder-Samples/tree/main/samples/python/21.corebot-app-insights">github 地址</a></p>

<p>比如</p>
<ul>
  <li>QnA</li>
  <li>LUIS
    <ul>
      <li>使用LUIS 来判断了用户说的话的intension (意图)</li>
    </ul>
  </li>
  <li>Speech</li>
  <li>…</li>
</ul>

<h2 id="用-botframework-composer-来创建机器人">用 BotFramework-Composer 来创建机器人</h2>
<p><a href="https://github.com/microsoft/BotFramework-Composer">guthub</a></p>

<p>Bot Framework Composer是一个开源的视觉创作画布，供开发人员和多学科团队使用语言理解和QnA Maker设计和构建对话体验，以及机器人回复的复杂组合（语言生成）。在这个工具中，您将拥有构建复杂的对话体验所需的一切。</p>

<ul>
  <li>用于对话流的可视化编辑画布</li>
  <li>语言理解上下文编辑（NLU）</li>
  <li>培训、测试和管理语言理解（NLU）和QnA组件的工具</li>
  <li>语言生成和模板系统</li>
  <li>现成的机器人运行时可执行文件</li>
</ul>

<p>使用界面
https://github.com/microsoft/BotFramework-Composer/blob/main/docs/Assets/Screenshot-ComposerV2-overview.png</p>

<p>有web 和 desktop 两种模式</p>

<p>步骤</p>
<ol>
  <li><a href="https://github.com/microsoft/BotFramework-Composer#get-started">下载</a>bot framework composer  for mac</li>
  <li>创建一个 Empty bot (C#)</li>
  <li>设置 dialog, trigger</li>
  <li>用 bot emulator 进行测试</li>
  <li>发布 bot 到 Azure
    <ol>
      <li>会创建必要的 Azure 资源来为 bot 提供服务</li>
    </ol>
  </li>
  <li>可以转到 Azure Bot Service 查看bot 和管理.</li>
</ol>

<h2 id="练习题总结">练习题总结</h2>

<h3 id="bot-framework">Bot Framework</h3>

<ul>
  <li>对接其他认知服务/第三方服务
    <ul>
      <li>接 speech
        <ul>
          <li>Direct line speech
            <ul>
              <li>其他几种 Direct Line
                <ol>
                  <li>Direct Line Channel 是用来开启 bot 和 一个客户端通过 https 进行通信</li>
                  <li>Direct Line Speech 是用来开启 Bot 的语音交互能力 ( voice in/out)</li>
                  <li>Direct Line App Service 可以让 bot 和 客户端的通信只在 Azure 内网进行</li>
                </ol>
              </li>
            </ul>
          </li>
          <li>三个步骤
            <ol>
              <li>在 Azure Portal 中开启一个 Cognitive Service Speech resource</li>
              <li>到现有的 Azure Bot 中, 在 channel 中选 Direct Line Speech</li>
              <li>在 Azure Bot 的配置页 开启 Streaming Endpoint</li>
            </ol>
          </li>
        </ul>
      </li>
      <li>接 Luis
        <ul>
          <li>C# 用 appsetting.json</li>
          <li>date entity 可以给机器人设置时间提醒功能 (应用于医疗机器人)</li>
          <li>C# 需要安装 Microsoft.Bot.Builder.AI.Luis NuGet 包</li>
        </ul>
      </li>
      <li>接 其他bot
        <ul>
          <li>Orchestrator</li>
          <li>防止欢迎信息发给其他 Bot 的方法
            <ul>
              <li>检查 <code class="language-plaintext highlighter-rouge">turnContext</code> 查看来的人是否是个机器人</li>
            </ul>
          </li>
          <li>多个 bot 的关系
            <ol>
              <li>能为其他 bot 执行任务的 bot 叫做 skill</li>
              <li>调用其他 bot 的 bot 叫做 skill consumer</li>
              <li>skill manifest 是一个 json 文件, 由 skill 这边暴露给 consumer 有哪些命令可以被调用.</li>
            </ol>
          </li>
        </ul>
      </li>
      <li>接 middleware
        <ul>
          <li>多语言翻译</li>
        </ul>
      </li>
      <li>接 Facebook
        <ul>
          <li>attachement 负责设置 logo</li>
          <li>notyification-type 负责通知类型</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>创建一个 Echo bot 的步骤
    <ol>
      <li>从github 下载代码</li>
      <li>pip install -r requirements.txt</li>
      <li>python app.py</li>
      <li>Run Azure Bot Framework Emulator</li>
    </ol>
  </li>
  <li>Bot Composer
    <ul>
      <li>Composer 需要用 Node.js 来创建一个新的 bot</li>
      <li>Composer 会为你的 bot 创建一个默认的 dialog (会话)</li>
      <li>但 Composer 不需要一开始就有 child dialog. 可以后面创建</li>
      <li>验证 输入数字限制 (比如请假天数)
        <ul>
          <li>Validation Rule</li>
        </ul>
      </li>
      <li>抽取 报销金额
        <ul>
          <li>Regular Expression</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>卡片
    <ul>
      <li>HeroCard
        <ul>
          <li>一个图和少量文字, 适合欢迎信息</li>
        </ul>
      </li>
      <li>Thumbnail card
        <ul>
          <li>缩略图卡, 只能包含一张缩略提, 一个按钮和少量文字</li>
        </ul>
      </li>
      <li>Receipt card
        <ul>
          <li>收据卡, 包含收据</li>
        </ul>
      </li>
      <li>Adaptive Card
        <ul>
          <li>适配卡, 可以定制包含图片, 文字, 按钮, 语音, 视频等各种类型的内容同</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>按钮
    <ul>
      <li>ImBack
        <ul>
          <li>展示文字, 比如: 包含隐私条款的信息</li>
        </ul>
      </li>
      <li>OpenURL
        <ul>
          <li>点击跳转到指定 URL</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>TTL
    <ul>
      <li>默认 20 分钟, 可设置更久</li>
      <li>可以把会话信息保存在 cosmos DB</li>
    </ul>
  </li>
  <li>状态管理
    <ul>
      <li>private conversation 私有对话
        <ul>
          <li>比如 投票</li>
        </ul>
      </li>
      <li>conversation 普通对话
        <ul>
          <li>比如 审批流程</li>
        </ul>
      </li>
      <li>user
        <ul>
          <li>比如 用户工作title</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>通过测试文本对 bot 测试
    <ul>
      <li>Bot Framework emulator</li>
      <li>Chatdown</li>
    </ul>
  </li>
  <li>对话模型
    <ul>
      <li>activity handler 活动处理
        <ul>
          <li>比如, 用户进来了就发欢迎信息</li>
        </ul>
      </li>
      <li>component dialog 内容对话
        <ul>
          <li>steps 的集合</li>
        </ul>
      </li>
      <li>waterfall dialog 瀑布对话
        <ul>
          <li>顺序的对话集合</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>关于和机器人的对话
    <ol>
      <li>Chat files 是 markdown 格式的文件 - 正确</li>
      <li>展示的 avatar 是 水平的</li>
      <li>bot 可以配置成和多个用户进行交互 - 正确</li>
    </ol>
  </li>
  <li>可以发布 bot 的 Azure 资源
    <ul>
      <li>Azure Function</li>
      <li>Azure App Service</li>
    </ul>
  </li>
  <li>Debug
    <ul>
      <li>Bot Emulator
        <ul>
          <li>是一个桌面应用, 用于给 chat bot 进行debug 的工具</li>
        </ul>
      </li>
      <li>ngrok
        <ul>
          <li>是一个开源的跨平台应用监控工具</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="qna-和-knowledge-base-知识库">QnA 和 Knowledge Base 知识库</h3>
<ul>
  <li>关于发布一个 QnA 的新的 knowledge base
    <ol>
      <li>可以再 portal 上通过 点击 <code class="language-plaintext highlighter-rouge">publish</code> 按钮发布</li>
      <li>还可以通过 Rest API 发布新的 QnA knowledge base</li>
      <li>发布后的 knowledge base 的内容保存在 Azure Search 的索引中 (a prod index of Azure Search)</li>
      <li>每次发布新的 Knowledge base 之后, 不需要重新连接 bot 和知识库, 他们是自动重新连接的</li>
    </ol>
  </li>
  <li>Role / 最小权限</li>
  <li>Read
    <ul>
      <li>测试知识库</li>
      <li>导出知识库</li>
    </ul>
  </li>
  <li>Editor
    <ul>
      <li>更新知识库</li>
    </ul>
  </li>
  <li>Contributer
    <ul>
      <li>除了给用户分配权限之外, 其他都可以</li>
    </ul>
  </li>
  <li>Owner
    <ul>
      <li>什么都可以</li>
    </ul>
  </li>
  <li>Active learning
    <ul>
      <li>让 QnA 可以在和客户交流的时候提供一些额外的建议问题让用户问</li>
    </ul>
  </li>
  <li>开启 QnA 的 active learning 的 3个步骤
    <ol>
      <li>导航到 https://www.qnamaker.ai/</li>
      <li>导航页面右上角的服务设置</li>
      <li>开启 active learning</li>
    </ol>
  </li>
  <li>QnA knowledge base 支持的导出格式
    <ul>
      <li>Excel</li>
      <li>TSV
        <ul>
          <li>TSV 是 tab separrated value</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Knowledge base 启动方法
    <ul>
      <li>LUDown
        <ul>
          <li>会调用 .lu 文件中的 question/answer 列表在</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>当你创建一个 QnA Maker 的时候, 还会自动创建 2 个服务
    <ol>
      <li>认知搜索
        <ol>
          <li>会搜索 knowledge base</li>
        </ol>
      </li>
      <li>Azure App Service
        <ol>
          <li>运行 bot web 页面</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>认知搜索的请求数在稳定增长, 已经达到最高上限了(阈值throttled) , 解决方案是
    <ol>
      <li>使用 higher tier</li>
      <li>增加 replicas</li>
    </ol>
  </li>
</ul>

<h3 id="luis">LUIS</h3>
<ul>
  <li>即可以和用户进行自然语言交流, 又可以从会话中<strong>获取相关的详细信息 ( revelant 和 detailed )</strong>,</li>
  <li>最快创建一个LUIS 聊天机器人模型的步骤
    <ol>
      <li>Add a new app, 增加一个新的应用</li>
      <li>add sample utterances, 增加用户发送的信息的例子</li>
      <li>train the app, 训练app</li>
      <li>publish the app, 发布app</li>
    </ol>
  </li>
  <li>utterance
    <ul>
      <li>翻译成其他语言
        <ul>
          <li>把模型导出为 LU 格式</li>
          <li>运行 Ludown 翻译命令</li>
        </ul>
      </li>
      <li>用户输入的语句可以在 utterance page 找到</li>
    </ul>
  </li>
  <li>容器
    <ul>
      <li>要用 GZIP 格式导出 LUIS 模型到容器</li>
      <li>可以使用 trained 或者 published LUIS 模型导出到容器</li>
      <li>把 LUIS 应用通过 Azure Container Instance (ACI)运行到容器中的三个步骤
        <ol>
          <li>把 LUIS 应用 export 成 .gz (GZIP) model 文件
            <ol>
              <li>容器需要读取 .gz 文件</li>
            </ol>
          </li>
          <li>upload model file 到 Azue File Shard
            <ol>
              <li>Azure file shard 可以被容器 mount 上</li>
            </ol>
          </li>
          <li>用 Azure CLI 和 YAML 部署容器
            <ol>
              <li>YAML 中包含了  .gz 文件所在的 shard 的 mount 点</li>
            </ol>
          </li>
          <li>注意: 因为用了 ACI, 所以不需要 <code class="language-plaintext highlighter-rouge">docker run</code>, <code class="language-plaintext highlighter-rouge">docker pull</code> 这样的命令</li>
        </ol>
      </li>
      <li>用 <code class="language-plaintext highlighter-rouge">ducker run</code> 命令启动容器的话, 需要保证 增加 <code class="language-plaintext highlighter-rouge">Eula=accept</code> 这个参数</li>
    </ul>
  </li>
  <li>训练好的模型不会自动发布到endpoint, 需要手动 publish</li>
  <li>你可以有选择的发布模型到生产还是 stagging slot</li>
  <li>生产和staging 环境是彼此独立的, 他们可以有相同的版本, 也可以有不同的版本.</li>
  <li>无法识别 multi-words 的解决方案
    <ul>
      <li>
        <ol>
          <li>Clone a new version</li>
          <li>add Patten.Any 实体 (用大括号把 multi-words 括起来 )</li>
          <li>Train the model</li>
          <li>publish to the staging slot</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>Entity
    <ul>
      <li>ML entity
        <ul>
          <li>基于 labeled 例子, 从上下文中抽取实体</li>
        </ul>
      </li>
      <li>Regex entity
        <ul>
          <li>基于你提供的特定的模式来抽取实体 (正则表达式)</li>
        </ul>
      </li>
      <li>List entity
        <ul>
          <li>基于一组固定的同义词</li>
        </ul>
      </li>
      <li>date entity
        <ul>
          <li>可以给LUIS 对应的 bot 增加时间提醒功能 (比如对病人吃药提醒)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Intent
    <ul>
      <li>无法准确通过 utterance 判断用户意图
        <ul>
          <li>enable active learning</li>
          <li>correct prediction</li>
        </ul>
      </li>
      <li>intend for location 的 例子 :
        <ul>
          <li><code class="language-plaintext highlighter-rouge">Find contacts in London</code> <code class="language-plaintext highlighter-rouge">Who do I know in Seattle?</code> <code class="language-plaintext highlighter-rouge">Search for contacts in Ukraine</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>给 LUIS 设置 schema 的四个步骤
    <ul>
      <li>
        <ol>
          <li>identify your domain (定义你的域)</li>
          <li>identify your intends (定义你的意图)</li>
          <li>create sample utterance for your intends (给每个意图创建用户提的问题的例子)</li>
          <li>identify your entities (定义你的实体)</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>geographyV2 预测模型
    <ul>
      <li>ROLE
        <ul>
          <li>可以对行盘出发和到达进行区分</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>重新训练 LUIS 获取状态的方法
    <ul>
      <li>
        <ol>
          <li>request trainning with http POST</li>
          <li>request trainning status with http GET</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>LUIS 做的多语言模型有口音问题, 解决方法
    <ol>
      <li>通过 API endpoint 把 NormalizeDiacritics 设置成 True</li>
    </ol>
  </li>
  <li>要限制, 只有 虚拟网络 vnet1 内的资源可以访问 LUIS ta1 的服务, 怎么做?
    <ol>
      <li>the virtual network settings for ta1</li>
      <li>说明: 为 LUIS 服务 ta1 设置 virtual network</li>
    </ol>
  </li>
  <li>LUIS 的 bot, 获取 账单地址, 用
    <ol>
      <li>ML</li>
    </ol>
  </li>
  <li>想要开启 LUIS 的 active learning, 需要:
    <ol>
      <li>Add log=true to the prediction endpoint query.</li>
    </ol>
  </li>
  <li>你已经做了一个 LUIS , 用于查找联系人, 现在需要增加一些 intend, 比如 Find contacts in London., Who do I know in Seattle? , Search for contacts in Ukraine. .  方案是:
    <ol>
      <li>You create a new entity for the domain.</li>
      <li>说明:
        <ol>
          <li>原来是找人, 现在是在一个地方找人, 这个地方就是 domain entity</li>
        </ol>
      </li>
    </ol>
  </li>
</ul>

<h3 id="认知搜索">认知搜索</h3>
<ul>
  <li>概念
    <ol>
      <li>Search Unit: 认知搜索的一个计费标准单位</li>
      <li>Replica: 分担请求负载的一个 实例</li>
      <li>Partition: 读/写操作的一个物理存储和 I/O 的单元</li>
      <li>Shard: 是组成 Index 的更小的单位,</li>
    </ol>
  </li>
  <li>创建 认知搜索 indexer 的 4 个步骤
    <ol>
      <li>Create a data source</li>
      <li>Define an index</li>
      <li>Create a indexer</li>
      <li>Schedule a indexer</li>
    </ol>
  </li>
  <li>使用认知搜索的步骤
    <ol>
      <li>Provision service 提供服务</li>
      <li>Create index 创建索引</li>
      <li>Load Data 读取数据</li>
      <li>Send query  and handle response 发送请求, 处理返回</li>
    </ol>
  </li>
  <li>pull 数据 的 Azure 数据源
    <ul>
      <li>Azure Table Storage</li>
      <li>Azure Data Lake Gen2</li>
      <li>Azure Cosmos DB</li>
      <li>Azure Blob Storage ?</li>
    </ul>
  </li>
  <li>Index
    <ul>
      <li>为 index (knowledge base) 增加酒店名字的步骤
        <ol>
          <li>Drop existing index</li>
          <li>Create a revised index</li>
          <li>Load the index with document</li>
        </ol>
      </li>
      <li>为索引追加(房屋)数据 并重新索引 的 代码
        <ul>
          <li>上传新的房屋数据用 <code class="language-plaintext highlighter-rouge">IndexDocumentsAction.Upload()</code> 方法</li>
          <li>上传后要重新创建索引用 <code class="language-plaintext highlighter-rouge">searchClient.indexDocument(entry)</code> 方法</li>
        </ul>
      </li>
      <li>Index 类型
        <ul>
          <li>filter
            <ul>
              <li>过滤的情景</li>
            </ul>
          </li>
          <li>sortable - 设置成true 就可排序</li>
          <li>retrievable - 设置成true 就可搜索 (可返回该字段信息)</li>
          <li>facetable - 设置成true, 就返回分类的点击数</li>
        </ul>
      </li>
      <li>为了确保新的测试结果可以满足定义的需求, 你需要用哪个 REST API ?
        <ol>
          <li>Run Indexer</li>
        </ol>
      </li>
      <li>扫描图片中的文字进行索引
        <ul>
          <li>把这些数据放到多个 virtual folders (虚拟目录).</li>
          <li>为每个目录创建一个 indexer.</li>
          <li>增加 search units (搜索单元).</li>
          <li>在每个 indexer 定义中, 都执行同样的 runtime execution 模式</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Indixer
    <ul>
      <li>需要创建一个 indexer才能把数据源中的数据值与索引字段关联起来</li>
    </ul>
  </li>
  <li>安全
    1. 每个folder 需要有自己的 data source
    2. 可以使用 Azure AD 安全组来过滤搜索结果, 让不同领域的人可搜索自己领域的内容. 
    3. 不需要 access control</li>
  <li>为认知搜索使用了 CMK 加密后的影响
    <ol>
      <li>索引变大</li>
      <li>搜索返回时间变长</li>
      <li>Azure Key 是需要提供的</li>
    </ol>
  </li>
  <li>Porperty
    <ul>
      <li>把增强的数据存到 knowledge store 中 需要的 property
    1. source
    2. tableName</li>
      <li>把skillset (skillset1) 的增强的数据包含到索引中, 需要的 proeperties
        <ol>
          <li>skillSetName</li>
          <li>outputFieldMap</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>query 慢
    <ul>
      <li>增加 partition (增加读写速度)</li>
    </ul>
  </li>
  <li>增加 HA (SLA)
    <ul>
      <li>Click Scale in Azure portal</li>
      <li>把 replica 设置成 3 个</li>
      <li>点击保存按钮</li>
    </ul>
  </li>
  <li>应对高负载
    <ul>
      <li>Provision and attach 认知搜索到一个 skillset 中</li>
    </ul>
  </li>
  <li>Pricing tier
    <ul>
      <li>一旦创建认知服务, 不能修改 pricing tier</li>
      <li>basic 比 standard 差</li>
      <li>pricing tier 类型在 <code class="language-plaintext highlighter-rouge">sku</code> 中设置</li>
      <li>文档的 Text extraction 是免费的</li>
      <li>Image extraction (图片抽取)是付费的, 1000 张图片 1 美元.</li>
    </ul>
  </li>
  <li>Projection 类型
    <ul>
      <li>Table Projection
        <ul>
          <li>存文本</li>
        </ul>
      </li>
      <li>Objection Projection
        <ul>
          <li>存 JSON</li>
        </ul>
      </li>
      <li>File Projection
        <ul>
          <li>存图片</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Build-in skills
    <ul>
      <li>文本分析
        <ul>
          <li>搜索扫描过的图片中的文字</li>
          <li>对多语言的文档进行翻译 (再搜索)</li>
          <li>从 PDF 格式的内容中抽取文本</li>
          <li>检测语言</li>
          <li>分析 sentiment</li>
        </ul>
      </li>
      <li>Computer Vision
        <ul>
          <li>OCR</li>
        </ul>
      </li>
      <li>不提供的服务
        <ul>
          <li>Bing 搜索</li>
          <li>Form Recognizer</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>搜索结果排名
    <ul>
      <li>Scoring profile
        <ul>
          <li>让新加的产品想排名靠前 (date)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Endpoint URL
    <ul>
      <li>https://csearch1.search.windows.net/index/index1/docs/autocomplete?api-verison=20200630</li>
      <li>认知服务名字放最前面</li>
      <li>index1 放在 index 后面</li>
      <li>doc 是 autocomplete</li>
    </ul>
  </li>
  <li>给一个搜索服务创建 key 的 API URL
    <ul>
      <li><code class="language-plaintext highlighter-rouge">https://management.azure.com/subscriptions/{订阅号}/resourceGroups/{GroupName}/providers/Microsoft.Search/searchService/Search1/createQueryKey/Clientapp1?api-version=2020-08-01</code>
        <ol>
          <li><code class="language-plaintext highlighter-rouge">management.azure.com</code> 是管理服务, 创建key 用这个服务</li>
          <li><code class="language-plaintext highlighter-rouge">Microsoft.Search</code> 是搜索服务, 包含了认知搜索</li>
          <li><code class="language-plaintext highlighter-rouge">createQueryKey</code> 用来创建 key</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>同义词 synonym Map
    <ul>
      <li>synonym map 用的 explicit mapping rule , 不是 equivalency rule</li>
      <li>大小写不敏感, 所有同义词在匹配前都会变成小写</li>
      <li>只能通过 认识搜索的 RestAPI 来定义 synonym map, 不能通过 Azure portal 来定义.</li>
    </ul>
  </li>
  <li>认知搜索的table project 是存文本的, 可以有效的和
    <ol>
      <li>Power BI 结合, 方便索引</li>
    </ol>
  </li>
  <li>要让认知搜索可以对 某个字段进行索引, 并可以搜索到, 可以返回, 可以过滤, 那么:
    <ol>
      <li>retrievable - 设置成true 就可搜索 指定字段</li>
      <li>facetable - 设置成true, 可以提供过滤 (filter)</li>
      <li>Searchable - 设置成true 就可以返回指定的 字段</li>
    </ol>
  </li>
</ul>

<h3 id="speech">Speech</h3>
<ul>
  <li>API
    <ul>
      <li>SDK 连接 speech 服务需要 Location 和 Key
        <ul>
          <li>不需要 endpoint URL</li>
          <li>Location 也是 Region, 比如 eastus</li>
          <li>Speech Service 不需要 endpoint, 就可以使用 , 因为 endpoint 只是一个 token</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Speech to Speech
    <ul>
      <li>初始化的顺序
        <ul>
          <li>
            <ol>
              <li>SpeechTranslationConfig</li>
              <li>SpeechRecognizer</li>
              <li>SpeechSynthesizer</li>
            </ol>
          </li>
        </ul>
      </li>
      <li>语音文件的位置
        <ul>
          <li>AudoOutputConfig</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>speech to text
    <ul>
      <li>如果没有特殊指定, 就是用电脑麦克风作为默认输入</li>
      <li>获取用户 intention
        <ul>
          <li>LUIS</li>
          <li>Patten Matching</li>
        </ul>
      </li>
      <li>长时间的录入语音, 并识别某个文字
        <ol>
          <li><code class="language-plaintext highlighter-rouge">speechsdk.SpeechRecognizer</code></li>
          <li><code class="language-plaintext highlighter-rouge">productlist.addPhase("productA")</code></li>
          <li><code class="language-plaintext highlighter-rouge">speech_recgonizer.start_continues_recognition()</code></li>
        </ol>
      </li>
      <li>短暂录入
        <ul>
          <li>once recognition</li>
        </ul>
      </li>
      <li>提高转化能正确率
        <ol>
          <li>Additional marketing text document</li>
          <li>Calls transcribed by human (人工转录的通话)</li>
        </ol>
      </li>
      <li>获取容器资源的命令
        <ul>
          <li><code class="language-plaintext highlighter-rouge">docker pull mcr.microsoft.com/azure-cognitive-service/speechservices/speech-to-text</code></li>
        </ul>
      </li>
      <li>代码中指定Speech to text 的翻译的 目标语言都是:
        <ol>
          <li>2 个字母的简称, 比如 fr, de, es</li>
          <li>都会用 <code class="language-plaintext highlighter-rouge">TranslationRecognizer</code> 方法</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>text to speech
    <ul>
      <li>步骤
        <ol>
          <li>Text input</li>
          <li>Text Analyzer</li>
          <li>Neural acoustic model</li>
          <li>Neural Vocoder</li>
          <li>Audio output</li>
        </ol>
      </li>
      <li>提高语调
        <ul>
          <li>SSML</li>
        </ul>
      </li>
      <li>指定语音名字
        <ul>
          <li><code class="language-plaintext highlighter-rouge">SpeechSynthesisVioceName</code> , 比如林志玲</li>
        </ul>
      </li>
      <li>加快翻译速度
        <ul>
          <li>AudioDataStream</li>
        </ul>
      </li>
      <li>提高语音质量
        <ul>
          <li>Tunning File (在线工具)</li>
        </ul>
      </li>
      <li>获取容器资源的 URL
        <ul>
          <li><code class="language-plaintext highlighter-rouge">mcr.microsoft.com/azure-cognitive-service/speechservices/text-to-speech</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>语音翻译成的语言 的 SDK
    <ul>
      <li>SpeechTranslationConfig</li>
    </ul>
  </li>
  <li>想要给 speech 模型做训练, 要:
    <ol>
      <li>上传一个 .zip 包, 包含 .wav 文件和对应的 文本 transcript</li>
    </ol>
  </li>
</ul>

<h3 id="translator">Translator</h3>
<ul>
  <li>API
    <ul>
      <li><code class="language-plaintext highlighter-rouge">https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&amp;from=zh-hans&amp;to=en&amp;toscript=Latn</code></li>
      <li>说明: 
    1.  源语言 - From
    2.  目标语言 - to
    3.  记录成的文本类型 - toScript</li>
    </ul>
  </li>
  <li>文本翻译, 要求文本内容需要保留在美国, 那么 API 调用就是:
    <ol>
      <li>https://api-nam.cognitive.microsofttranslator.com/translate</li>
      <li>说明:
        <ol>
          <li>nam 表示美国</li>
          <li>apc 表示亚洲</li>
          <li>eur 表示欧洲</li>
          <li>api 表示 global</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>参数
    <ul>
      <li>profanityAction
        <ul>
          <li>delete, 可以去掉翻译中的攻击性文字</li>
        </ul>
      </li>
      <li>includeAlignment
        <ul>
          <li>对齐翻译前和翻译后的文字格式</li>
        </ul>
      </li>
      <li>dynamic dictionary
        <ul>
          <li>翻译转悠名词</li>
        </ul>
      </li>
      <li>notranslate tag
        <ul>
          <li>某些单词不用翻译</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="text-analytics">Text Analytics</h3>
<ul>
  <li>减少 API 请求次数的方法
    <ul>
      <li>用 /analyze 这个 endpoint</li>
      <li>异步请求 API</li>
    </ul>
  </li>
  <li>语言检测
    <ul>
      <li>confidenceScore 是从 0-1, 不0-100</li>
      <li>如果无法分辨文本中的语言, 有默认的语言, 是 <code class="language-plaintext highlighter-rouge">us</code></li>
      <li>不储存检测结果</li>
    </ul>
  </li>
  <li>Sentiment
    <ul>
      <li>API
        <ul>
          <li><code class="language-plaintext highlighter-rouge">eastus.api.congitive.microsoft.com/text/analytics/v2.0/sentiment</code></li>
        </ul>
      </li>
      <li>部署了一个 sentiment 分析的容器, 那么:
        <ol>
          <li>http://localhost:5000/status 可以验证 API key 是否好用</li>
          <li>The container logging provider will write log data.</li>
          <li>http://localhost:5000/swagger 可以查看访问 API 的详情</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>Key phrases
    <ul>
      <li>抽取 key phrases 的步骤
        <ol>
          <li>组织 POST 请求</li>
          <li>Call https://ta1.cognitiveservices.azure.com/text/analytics/V3.1-preview.5/analyze endpoint.</li>
          <li>在 app 中处理 JSON 反馈</li>
        </ol>
      </li>
      <li>返回结果不会包含 confidence level</li>
    </ul>
  </li>
  <li>Sentiment
    <ul>
      <li>可以获得人们的态度的认知服务
        <ol>
          <li>Key phrase extraction</li>
          <li>Sentiment analysis</li>
        </ol>
      </li>
      <li>运行容器的命令
        <ol>
          <li><code class="language-plaintext highlighter-rouge">docker run -rm -it -p 8080:5000 --memory 2g --cpus 1 mcr.microsoft.com/azure-cognitiveservices/textanalytics/sentiment Eula=accept Billing=https://sentiment1.cognitiveservices.azure.com ApiKey=xxxyyyzzz123</code></li>
          <li>Docker 命令参数说明:
            <ol>
              <li>8080 是 VM 端口, 5000 是容器端口</li>
              <li>Billing 是 Endpoint</li>
              <li>Eula 是 end user 同意了 license</li>
              <li>-p 端口</li>
              <li>-rm 选项，在容器退出时就能够自动清理容器内部的文件系统。</li>
              <li>-it 以交互模式运行 Docker</li>
            </ol>
          </li>
        </ol>
      </li>
      <li>分析结果
        <ul>
          <li>如果 结果是 <code class="language-plaintext highlighter-rouge">mixed with a confidence score 0.9</code> 那么 sentiments 组合是
            <ul>
              <li>至少有一个是 positive , 其他是 negative</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="video-analyzer">Video analyzer</h3>
<ul>
  <li>几个概念
    <ol>
      <li>Shots - 镜头
        <ol>
          <li>同一个摄像机在同一个时间连续的拍摄帧</li>
          <li>视频索引器将视频拆分为的临时区段</li>
        </ol>
      </li>
      <li>Keyframes - 关键帧
        <ol>
          <li>Keyframe 一个shot 中最有代表性的帧 ，根据对比度和稳定性等属性进行选择。</li>
        </ol>
      </li>
      <li>Scenes - 场景
        <ol>
          <li>几个连续的镜头(shots) 组成的一个语义关联的单个事件</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>几种模型
    <ol>
      <li>Brands Model
        <ol>
          <li>识别产品, 服务和公司</li>
        </ol>
      </li>
      <li>Person Model
        <ol>
          <li>识别名人</li>
        </ol>
      </li>
      <li>Language Model
        <ol>
          <li>识别行业术语和特定单词</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>找人步骤
    <ol>
      <li>在现有的员工 Person 模型中增加一个Person, 并包含名字</li>
      <li>上传一张面部照片给这个 员工</li>
      <li>reindex employee model</li>
    </ol>
  </li>
  <li>根据视频中出现者搜索视频
    <ul>
      <li>创建一个 person model</li>
      <li>把这个 model 和视频进行关联</li>
    </ul>
  </li>
  <li>找品牌
    <ul>
      <li>让一个品牌可以/不可以被找到
        <ul>
          <li><code class="language-plaintext highlighter-rouge">enable: false/true</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>搜索结果
    <ul>
      <li>会返回匹配到的内容在视频里的时间点</li>
    </ul>
  </li>
  <li>测试一个检测人的样例视频三个步骤
    <ol>
      <li>sign in 视频分析网站 (www.videoindexer.ai)</li>
      <li>点击上传按钮 (上传视频)</li>
      <li>检查邮箱并点击链接 (因为这里要花的视频分析时间可能会长, 等分析完了会发邮件给你)</li>
    </ol>
  </li>
  <li>通过 API 分析视频的正确流程是:
    <ol>
      <li>上传视频到 blob storage</li>
      <li>用 Video Indexer APi 对视频进行索引</li>
      <li>从 Video Indexer API 抽取 transcript</li>
      <li>通过 translator API 对脚本进行翻译</li>
    </ol>
  </li>
</ul>

<h3 id="custom-vision">Custom Vision</h3>
<ul>
  <li>概念
    <ul>
      <li>Precision 精度
        <ul>
          <li>识别了 100 个鸟, 正确识别了 56 个</li>
        </ul>
      </li>
      <li>Recall 回忆
        <ul>
          <li>有 100 个鸟, 识别了 56 个是鸟</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>domain 的区别
    <ul>
      <li>food
        <ul>
          <li>食品</li>
        </ul>
      </li>
      <li>product on shelves
        <ul>
          <li>货架上的商品, 适合超市</li>
        </ul>
      </li>
      <li>Retail
        <ul>
          <li>适合衣服类的日用品</li>
        </ul>
      </li>
      <li>(compact)
        <ul>
          <li>边缘侧的, 放容器的方案</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>目标检测
    <ul>
      <li>步骤:
        <ol>
          <li>创建一个 custom vision resource</li>
          <li>创建一个 Object Detection Project</li>
          <li>上传图片并给图片打标签</li>
          <li>训练模型</li>
          <li>获取 预测模型的 URL 和 key 给应用使用.</li>
        </ol>
      </li>
      <li>提高检测准确率方法
        <ol>
          <li>增加一些带有不同背景的对象的图片, 可以改进 model 的 performance - 正确</li>
          <li>使用提交到生产的新图片对模型进行训练 - 正确</li>
        </ol>
      </li>
      <li>训练效果不佳 的解决办法
        <ol>
          <li>上传新的多个图片,</li>
          <li>使用 smart labeler,</li>
          <li>重新训练模型,</li>
          <li>发布最后的 iteration</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>分类
    <ul>
      <li>步骤:
        <ol>
          <li>创建项目</li>
          <li>上传照片</li>
          <li>给图片打tag</li>
          <li>训练项目</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>容器 / 边缘侧 /edge
    <ul>
      <li>domain 中带有 <code class="language-plaintext highlighter-rouge">compact</code> (紧密) 的就是支持容器的</li>
      <li>一个 custom vision 的 训练好的检测模型用了 General domain, 无法连接外网的情况下, 想要导出模型, 怎么办?
        <ol>
          <li>把 domain 改成 General(compact)</li>
          <li>重新训练模型</li>
          <li>导出模型</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>API
    <ul>
      <li>GetIterationPerformance
        <ul>
          <li>获得模型的准确率</li>
        </ul>
      </li>
      <li>GetImagePerformance
        <ul>
          <li>获取的是被标记了某个tag 的所有图片</li>
        </ul>
      </li>
      <li>GetProject
        <ul>
          <li>返回的是 project 的名字</li>
        </ul>
      </li>
      <li>ExportIteration
        <ul>
          <li>只是返回了一个模型, 不包含 metrics</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>和 TensorFlow 整合
    <ul>
      <li>需要两个文件
        <ul>
          <li>lable.txt</li>
          <li>model.pb</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>要把一个 Custom Vision 模型放到手机端, 需要做成容器化(compact) , 就需要:
    <ol>
      <li>change the model domain</li>
      <li>retrain the model</li>
      <li>Test (optional)</li>
      <li>export the model</li>
    </ol>
  </li>
  <li>如果想把一个 Custom Vision 模型 要从开发环境 导入到 生产环境, 那么
    <ol>
      <li>GetProjects on acvDEV</li>
      <li>ExportProjects on acvDEV</li>
      <li>ImportProjects on avcPROD</li>
    </ol>
  </li>
  <li>要识别生产线上的产品内容的失败, 用 Custom Vision 的三个步骤:
    <ol>
      <li>创建项目</li>
      <li>上传照片和tag</li>
      <li>训练 classifier 模型</li>
    </ol>
  </li>
  <li>给花的分类模型新增加一种新的花, 不需要重新建一个模型, 只需要 在现有模型上
    <ol>
      <li>上传图片, 并给图片标注新的tag 名字</li>
      <li>训练</li>
      <li>发布</li>
    </ol>
  </li>
  <li>要用 1000 张没有任何相关信息的照片 做一个 custom vision 模型, 最短时间可以完成的方法:
    <ol>
      <li>Upload all images</li>
      <li>Get suggested tags</li>
      <li>Review the suggestion and confirm tags</li>
    </ol>
  </li>
</ul>

<h3 id="computer-vision">Computer Vision</h3>
<ul>
  <li>API
    <ul>
      <li>识别品牌和名人
        <ul>
          <li><code class="language-plaintext highlighter-rouge">https://cv1.cognitiveservices.azure.com/vision/v3.2/alanyze?visualFeature=Brands&amp;detail=Celebrities&amp;Language=en&amp;model-version=latest</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Read 和 OCR
    <ul>
      <li>可识别的图片类型, 大小及分辨率
        <ol>
          <li><strong>JPEG</strong> 和 <strong>PNG</strong> 类型图片, 不超过 30M</li>
          <li><strong>GIF</strong> 类型 的 2M 文件, 分辨率在 200 x 300</li>
          <li><strong>BMP</strong> 类型图片 分别率大于 100x100 像素</li>
        </ol>
      </li>
      <li>API
        <ul>
          <li><code class="language-plaintext highlighter-rouge">eastus.api.cognitive.microsoft.com/version/v2.0/ocr</code></li>
          <li>其他Computer Vision API 请求地址
            <ol>
              <li>图片分析: https://{endpoint}/vision/v3.2/analyze[?visualFeatures][&amp;details][&amp;language][&amp;model-version]</li>
              <li>图片描述: https://{endpoint}/vision/v3.2/describe[?maxCandidates][&amp;language][&amp;model-version]</li>
              <li>对象检测: https://{endpoint}/vision/v3.2/detect[?model-version]</li>
              <li>获取兴趣点: https://{endpoint}/vision/v3.2/areaOfInterest[?model-version]</li>
              <li>获取分析结果: https://{endpoint}/vision/v3.2/read/analyzeResults/{operationId}</li>
              <li>创建缩略图: https://{endpoint}/vision/v3.2/generateThumbnail[?width][&amp;height][&amp;smartCropping][&amp;model-version]</li>
              <li>获取模型列表: https://{endpoint}/vision/v3.2/models</li>
              <li>密集复杂多页文本读取(高级 OCR): https://{endpoint}/vision/v3.2/read/analyze[?language][&amp;pages][&amp;readingOrder][&amp;model-version]</li>
              <li>识别特定域中的图像内容: https://{endpoint}/vision/v3.2/models/{model}/analyze[?language][&amp;model-version]</li>
              <li>根据图像中的对象、生物、风景或操作返回标记: https://{endpoint}/vision/v3.2/tag[?language][&amp;model-version]</li>
            </ol>
          </li>
        </ul>
      </li>
      <li>C# 代码
        <ol>
          <li><code class="language-plaintext highlighter-rouge">GetReadResultAsync</code> 是要通过异步的获取图片中读到的结果信息</li>
          <li><code class="language-plaintext highlighter-rouge">while</code> 循环的逻辑是 如果状态还是在 运行中或者是还没开始, 那么就继续循环的打印输出读到的信息, 所以判断逻辑是 <code class="language-plaintext highlighter-rouge">running</code> 和 <code class="language-plaintext highlighter-rouge">NotStarted</code></li>
        </ol>
      </li>
    </ul>
  </li>
  <li>场景
    <ul>
      <li>识别商场排队结账人数
        <ul>
          <li>Spatial Analysis</li>
        </ul>
      </li>
      <li>上传照片, 防止 offensive
        <ul>
          <li>Content Moderator
            <ul>
              <li>属于 Decision API</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Form Recognizer
    <ul>
      <li>分析结果不能导出为 XML 格式. 可以支持的格式是 JSON 和 CSV</li>
      <li>Form recognizer 可以 从 web URL 中获取 发票</li>
      <li>Form recognizer 可以使用 F0 免费处理 2 页的发票</li>
      <li>S0 可以处理 2000 页的 PDF 或 TIFF 的文档</li>
      <li>Form Recognizer 可接受的文件格式和大小分别是
        <ol>
          <li>JPG, PDF, PNG, TIFF</li>
          <li>文件大小小于 50M</li>
        </ol>
      </li>
      <li>定制化表格识别模型用  Blob stroage 上的文件进行训练的步骤
        <ol>
          <li>用Shared Access Signature 来连接到 Azure 存储</li>
          <li>创建一个项目, 输入 endpoint 和 key</li>
          <li>run layout</li>
          <li>apply tags to the forms</li>
          <li>train the model</li>
        </ol>
      </li>
      <li>创建一个定制化模型的步骤
        <ol>
          <li>assemble a training dataset with PDF document
            <ol>
              <li>收集需要被训练的 PDF 文档</li>
            </ol>
          </li>
          <li>upload training dataset to Azure Blob storage
            <ol>
              <li>上传训练数据集到 blob</li>
            </ol>
          </li>
          <li>train the model using the sample labeling tool
            <ol>
              <li>用 labeling tool 训练模型</li>
            </ol>
          </li>
        </ol>
      </li>
      <li>获取容器的 URL
        <ul>
          <li><code class="language-plaintext highlighter-rouge">mcr.microsoft.com/azure-cognitive-services/custom-form/labeltool</code>
说明:
            <ol>
              <li>mcr: microsoft container repository</li>
              <li>custom form: Custom Vision Form Recognizer</li>
              <li>labeltool 是 表格识别器的 镜像名字</li>
            </ol>
          </li>
        </ul>
      </li>
      <li>Form Recognizer 要读取收据, 要用
        <ul>
          <li><code class="language-plaintext highlighter-rouge">begin_recognize_receipts_from_url</code> 方法用来读取收据</li>
          <li>其他: <code class="language-plaintext highlighter-rouge">begin_recognize_content_from_url</code> 方法用来读取表格</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>VisualFeature 参数 包含了
    <ol>
      <li>Tags :
        <ol>
          <li>to generate a list of words for the recognizable objects in the image</li>
          <li>为图片中识别出来的对象创建一个文字列表</li>
        </ol>
      </li>
      <li>Categories:
        <ol>
          <li>使用分类学来描述图片建筑, 食品, 室外 和动物</li>
        </ol>
      </li>
      <li>Adult
        <ol>
          <li>detect if the content violent scenes</li>
          <li>检测是否有暴力内容场景</li>
        </ol>
      </li>
      <li>Brand
        <ol>
          <li>检测图片中知名的品牌和 logo</li>
        </ol>
      </li>
      <li>Description:
        <ol>
          <li>generate a complete sentence that describes the image</li>
          <li>完整的句子描述图片</li>
        </ol>
      </li>
      <li>Object
        <ol>
          <li>detect objects within the image and their location</li>
          <li>检测图片中的对象和他们的位置</li>
        </ol>
      </li>
      <li>其他:
        <ol>
          <li>名人和地标不是 visural feature, 而是 detail 参数的值</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Detail 参数包含了
    <ul>
      <li>landmark 地标</li>
      <li>celebrity 名人</li>
    </ul>
  </li>
  <li>通过 Rest API 获取图片信息的步骤
    <ol>
      <li>创建一个 computer vision 资源, 并获取key</li>
      <li>在 quick start 下面进入 API console</li>
      <li>使用 Detect Object API创建和运行 CURL 命令</li>
    </ol>
  </li>
  <li>API
    <ul>
      <li>创建缩略图
        <ol>
          <li>https:cv1.cognitiveservices.azure.com/vision/v3.1/generateThubmail</li>
          <li>https:uksouth.api.cognitive.microsoft.com/vision/v3.1/generateThubmail
            <ol>
              <li>说明:
                <ol>
                  <li>如果指定了服务的名字(cv1) , 后面要接 cognitiveservices.azure.com</li>
                  <li>如果制定了 region, 后面要接 api.cognitive.microsoft.com</li>
                </ol>
              </li>
            </ol>
          </li>
        </ol>
      </li>
      <li>获取图片的描述和 landmark
        <ul>
          <li><code class="language-plaintext highlighter-rouge">curl https://westus.api.cognitive.microsoft.com/vision/v2.0/analyze?visualFeature=Description&amp;detail=Landmark -H "Ocp-apim-subscription-key:abcdefg12345hijklmnop67890" -H "content-type:applicaiton/json" -d "{'url':'https://images.com/travel_picture.jpeg'}"</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>图片分析中的 captions 就是 tag 的意思
    <ol>
      <li>C# 的语法 <code class="language-plaintext highlighter-rouge">results.Description.Captions</code></li>
      <li>Python 的语法: <code class="language-plaintext highlighter-rouge">tags_result_remote.tags</code></li>
    </ol>
  </li>
</ul>

<h3 id="脸部识别-face-api">脸部识别 Face API</h3>
<ul>
  <li>概念
    <ul>
      <li>Person
        <ul>
          <li>一个人的模型, 包含这个人的多张照片</li>
        </ul>
      </li>
      <li>PersonGroup
        <ul>
          <li>所有人的照片, 最多支持 1000 人, 需要额外训练时间</li>
        </ul>
      </li>
      <li>LargePersonGroup
        <ul>
          <li>所有人的照片, 最多支持 100 万人, 需要额外训练时间</li>
        </ul>
      </li>
      <li>PersonDirectory
        <ul>
          <li>所有人的照片, 可以支持 7500 万人, 不需要训练新的脸</li>
        </ul>
      </li>
      <li>DynamicPersonGroup
        <ul>
          <li>按条件过滤后的脸部信息</li>
        </ul>
      </li>
      <li>Location
        <ul>
          <li>在图片中识别到的面部的方形坐标,  包含了 top, left, height, width (方形脸部在距离图片顶部, 左侧的距离, 方形的高度, 宽度)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>场景
    <ul>
      <li>Face Verification (Verify API)
        <ul>
          <li>大门刷脸</li>
        </ul>
      </li>
      <li>Face identification  (Identify API)
        <ul>
          <li>识别一张图片中的多个脸 , 比如谁参加了第一堂课</li>
        </ul>
      </li>
      <li>Detect API
        <ul>
          <li>是检测, 检测上课的同学的面部表情参数信息来了解学生的参与度(engagement)</li>
        </ul>
      </li>
      <li>Find similar face
        <ul>
          <li>找到和目标脸相似的脸</li>
          <li><code class="language-plaintext highlighter-rouge">.face.detect_with_url</code> 检测图片中的脸, 并把每个脸的数据返回</li>
          <li><code class="language-plaintext highlighter-rouge">.face.find_similar</code> 在多个脸的数据中匹配某一个脸</li>
        </ul>
      </li>
      <li>瞳孔跟踪
        <ul>
          <li>通过 <code class="language-plaintext highlighter-rouge">DetectWithStreamAsync</code> 方法获取瞳孔信息</li>
          <li>把 <code class="language-plaintext highlighter-rouge">returnFaceLandmarks</code> 参数设置成 <code class="language-plaintext highlighter-rouge">true</code></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>.net 识别人脸的代码步骤
    <ol>
      <li>Initialize variables and helper functions</li>
      <li>Authorize API call</li>
      <li>Create Marketing PersonGroup</li>
      <li>Create person</li>
      <li>Add faces</li>
    </ol>
  </li>
  <li>面部匹配,
    <ol>
      <li>如果小于 1000 张图片, 用 faceListId,</li>
      <li>如果 1000 - 100,000, 用 largeFaceListId</li>
    </ol>
  </li>
  <li>通过一个人的样例照片找到这个人的所有照片
    <ol>
      <li>API 用 <code class="language-plaintext highlighter-rouge">findSimilars</code></li>
      <li>mode 用 <code class="language-plaintext highlighter-rouge">matchPerson</code></li>
    </ol>
  </li>
  <li>Face API 的 detection 模型用了 detection_01 发现多模糊的照片或侧脸无法识别, 那么方法是:
    <ol>
      <li>用其他模型
        <ol>
          <li>detection_02</li>
          <li>detection_03</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>用 Face API 查看摄像头前面的人是否是真人, 最好的方式:
    <ol>
      <li><code class="language-plaintext highlighter-rouge">FaceAttributes.HeadPose</code></li>
    </ol>
  </li>
</ul>

<h3 id="认知服务-policy--日志--principle">认知服务 Policy / 日志 / Principle</h3>
<ul>
  <li>关于认知服务的 privacy policy (隐私政策) , 下面的说法:
    <ol>
      <li>用文本分析服务分析的文本会被自动删除</li>
      <li>面部识别服务识别的数据可以删除</li>
      <li>发送给 LUIS 的 Utterance (用户的提问) 默认不会保存, 如果日志打开了, utterance 可以保存 30 天.</li>
    </ol>
  </li>
  <li>你在给认知服务配置诊断日志, 几个场景匹配如下:
    <ol>
      <li>发送日志到一个 repository, 可以通过 log query 访问
        <ol>
          <li>Log Analytics workspace</li>
        </ol>
      </li>
      <li>把数据以流的方式发送到外部的日志分析方案.
        <ol>
          <li>Event Hub</li>
        </ol>
      </li>
      <li>归档日志, 用来审计, 静态分析, 备份. 以 JSON 文件形式保存
        <ol>
          <li>Azure Blob storage</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>关于给学生在社区大学进行工作推荐要使用 认知服务, 会牵扯到几个 AI principle. 下面的匹配关系是:
    <ol>
      <li>工作推荐不会受到学生社会背景的影响 - Fairness 公平</li>
      <li>学生的学术数据, 兴趣爱好等信息不会被学校外部访问 - Privacy and Security 隐私与安全</li>
      <li>AI的行为会通过 guideline 解释给学生, 让他们找到更好的工作 - Transparency 透明</li>
    </ol>
  </li>
  <li>您正在开发一个新的销售系统，该系统将处理来自面向公众的网站的视频和文本。 您计划监视销售系统，以确保无论用户的位置或背景如何，它都能提供公平的结果。 哪两个负责任的 AI 原则提供指导以满足监视要求？每个正确答案都表示解决方案的一部分。 注意：每个正确的选择都值一分。
    <ol>
      <li>fairness 公平</li>
      <li>inclusiveness 包容</li>
    </ol>
  </li>
  <li>如果要让对话机器人更加 包容 (inclusiveness) , 那么就要增加:
    <ol>
      <li>Direct line speech</li>
      <li>说明:
        <ol>
          <li>包容就是让残疾人也能用, 比如不能打字的人, 小孩等, 靠说话也可以和机器人对话, 这就是包容.</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>要用情感分析来决定客服人员的奖金, 怎么做可以满足 responsible AI 的 principles?
    <ol>
      <li>再决定财务奖金之前, 增加一个人工review.</li>
    </ol>
  </li>
</ul>

<h3 id="安全">安全</h3>
<ul>
  <li>为了让多个医疗扫描中心使用 Custom Vision 服务并防止数据泄露, 你需要配置 Azure Policy. 三个步骤
    <ol>
      <li>导航到 Azure Policy , 点击 Assign Policy</li>
      <li>选择你的 Custom Vision 对应的 subscription 和 resource group</li>
      <li>选择认知服务账号, 关闭 public network access policy.</li>
    </ol>
  </li>
  <li>认知服务和其他 Azure 服务整合, 需要确保只能内网访问, 只能接受来自 vnet 的请求, 那么:
    <ol>
      <li>在 Firewall and virtual networks 下面把 <code class="language-plaintext highlighter-rouge">Allow</code> 设置成 <code class="language-plaintext highlighter-rouge">Disable</code></li>
      <li>创建一个 private endpoint</li>
    </ol>
  </li>
  <li>Key 1 泄露了
    <ol>
      <li>update your app to use key2</li>
      <li>reset your key1</li>
      <li>update your app to use key1</li>
    </ol>
  </li>
  <li>重置key2 的 API
    <ol>
      <li>POST <code class="language-plaintext highlighter-rouge">https://management.azure.com/subscriptions/18c51a87-3a69-47a8-aedc-a54745f708a1/resourceGroups/RG1/providers/Microsoft.CognitiveServices/accounts/contoso1/regenerateKey?api-version=2017-04-18</code> Body{“keyName”: “Key2”}</li>
    </ol>
  </li>
  <li>要收集大量的 sensor 的 IOT 数据, 并需要 检测异常, 定义root cause, 发送 incident alert, 那么方案是
    <ol>
      <li>Azure Metrics Advisor</li>
    </ol>
  </li>
  <li>您正在开发一个监控系统，该系统将分析发动机传感器数据，例如转速、角度、温度和压力。系统必须生成警报以响应非典型值。
    <ol>
      <li>Multivariate Anomaly Detection</li>
    </ol>
  </li>
</ul>

<h3 id="devops">DevOps</h3>
<ul>
  <li>ARM
    <ul>
      <li>你想要用 ARM (Azure Resource Manager) template 来重复批量的部署多个 认知服务, ARM 模板文件是什么格式的?
        <ol>
          <li>JSON</li>
        </ol>
      </li>
    </ul>
  </li>
  <li>通过 API call 创建资源, 要用 PUT
    <ul>
      <li><code class="language-plaintext highlighter-rouge">PUT https://management.azure.com/subscriptions/{subscriptionId}/resourcegroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{parentResourcePath}/{resourceType}/{resourceName}?api-version=2021-04-01</code></li>
    </ul>
  </li>
  <li>要做一个异常检测的容器版模型, 并且要保证容器的历史命令行数据不会泄露, 并且要使用 Azure 的 RBAC, 所以建容器的步骤是:
    <ol>
      <li>Pull the Anomaly Detector container image.</li>
      <li>Create a custom Dockerfile.</li>
      <li>Push the image to an Azure container registry.</li>
      <li>Distribute a docker run script.</li>
    </ol>
  </li>
</ul>

<h3 id="cost">Cost</h3>
<ul>
  <li>budget alert
    <ul>
      <li>如果 设置了 600美金 是 Actural 类型的阈值, 那么如果某个月真的花超了 600 才会收到报警</li>
      <li>如果 设置了 900 是 Forecase 类型的阈值, 还没到 900, 就会收到报警邮件了, 会提前发送报警.</li>
    </ul>
  </li>
  <li>5 万张图片要做 OCR 和 文本分析, 需要用什么服务最省钱:
    <ol>
      <li>S0 的认知服务资源(容纳多种服务的)</li>
    </ol>
  </li>
</ul>

            </div>

            <!-- Rating -->
            
            <div class="rating mb-4 d-flex align-items-center">
                <strong class="mr-1">Rating:</strong> <div class="rating-holder">
<div class="c-rating c-rating--regular" data-rating-value="4.5">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
</div>
</div>
            </div>
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2023-05-30">30 May 2023</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#AI">AI</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Azure">Azure</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Data-Science">Data Science</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#LLM">LLM</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#OpenAI">OpenAI</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//ChatGPT-and-OpenAI-Python-API-Bootcamp/"> &laquo; Use ChatGPT in Python</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//ITIL-Certification-In-Action/">Preparing for ITIL Certification &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

<script type="application/ld+json">
{
  "@context": "http://schema.org/",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Thing",
    "name": "Designing and Implementing a Microsoft Azure AI Solution"
  },
  "author": {
    "@type": "Person",
    "name": "Dalong"
  },
  "datePublished": "2023-05-30",
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": "4.5",
    "bestRating": "5"
  }
}
</script>

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#Linux">Linux (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (16)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Mysql">Mysql (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Redis">Redis (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MongoDB">MongoDB (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Flask">Flask (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Django">Django (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#DjangoRest">DjangoRest (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Numpy">Numpy (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Panda">Panda (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Sklearn">Sklearn (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jupyter">Jupyter (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenCV">OpenCV (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AI">AI (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Tensorflow">Tensorflow (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Microservice">Microservice (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Docker">Docker (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#NLP">NLP (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS">AWS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Architecture">Architecture (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Agile">Agile (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Scrum">Scrum (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MLPS">MLPS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#PIPL">PIPL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Metaverse">Metaverse (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Togaf">Togaf (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ChatGPT">ChatGPT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#OpenAI">OpenAI (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#LLM">LLM (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Azure">Azure (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Data-Science">Data Science (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ITIL">ITIL (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#IT">IT (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Jekyll">Jekyll (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Github">Github (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Liquid">Liquid (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Markdown">Markdown (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2023 Dalong's personal blog 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="#">Designed</a> by Dalong.work
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>



<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>
